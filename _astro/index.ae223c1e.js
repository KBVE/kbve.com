let a=0,v=[];function c(){return a+=1,()=>{if(a-=1,0===a){let l=v;v=[];for(let e of l)e()}}}function h(l){let e=c();return l().finally(e)}let l=[],p=(e,t)=>{let n=[],f={get:()=>(f.lc||f.listen((()=>{}))(),f.value),l:t||0,lc:0,listen:(l,e)=>(f.lc=n.push(l,e||f.l)/2,()=>{let e=n.indexOf(l);~e&&(n.splice(e,2),f.lc--,f.lc||f.off())}),notify(e){let t=!l.length;for(let t=0;t<n.length;t+=2)l.push(n[t],f.value,e,n[t+1]);if(t){for(let e=0;e<l.length;e+=4){let t=!1;for(let n=e+7;n<l.length;n+=4)if(l[n]<l[e+3]){t=!0;break}t?l.push(l[e],l[e+1],l[e+2],l[e+3]):l[e](l[e+1],l[e+2])}l.length=0}},off(){},set(l){f.value!==l&&(f.value=l,f.notify())},subscribe(l,e){let t=f.listen(l,e);return l(f.value),t},value:e};return f};export{p as a,h as t};