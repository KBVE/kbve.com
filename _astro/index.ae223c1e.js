let a=0,v=[];function c(){return a+=1,()=>{if(a-=1,a===0){let i=v;v=[];for(let r of i)r()}}}function h(i){let r=c();return i().finally(r)}let l=[],p=(i,r)=>{let s=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},l:r||0,lc:0,listen(n,u){return t.lc=s.push(n,u||t.l)/2,()=>{let e=s.indexOf(n);~e&&(s.splice(e,2),t.lc--,t.lc||t.off())}},notify(n){let u=!l.length;for(let e=0;e<s.length;e+=2)l.push(s[e],t.value,n,s[e+1]);if(u){for(let e=0;e<l.length;e+=4){let o=!1;for(let f=e+7;f<l.length;f+=4)if(l[f]<l[e+3]){o=!0;break}o?l.push(l[e],l[e+1],l[e+2],l[e+3]):l[e](l[e+1],l[e+2])}l.length=0}},off(){},set(n){t.value!==n&&(t.value=n,t.notify())},subscribe(n,u){let e=t.listen(n,u);return n(t.value),e},value:i};return t};export{p as a,h as t};
