import{p as St,f as W}from"./flowDb-9e6c6aac.696b2301.js";import{h as S,u as Lt,r as Et,p as _t,l as Tt,d as D,f as tt,G as Nt}from"./layout.7aaa9cf2.js";import{h as x,o as G,p as z,q as et,c as J,j as rt,l as I,r as V,t as At}from"./mermaid.core.fc10fbca.js";import{a as N,b as at,i as nt,c as _,e as st,d as it,f as Ct,g as It}from"./styles-7882abfe.45539472.js";import{l as Bt}from"./line.7a53eeb2.js";import{s as Mt}from"./selectAll.2e4f3ba6.js";import"./preload-helper.101896b7.js";import"./_commonjsHelpers.042e6b4d.js";import"./index-1e7f2254.aa259384.js";import"./edges-66ea8538.5e165bf0.js";import"./createText-a49d2d2a.f288beb4.js";import"./svgDraw-95adee0a.6ad4e298.js";import"./array.9f3ba611.js";import"./path.53f90ab3.js";function Dt(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Pt(t,e){return fetch(t,e).then(Dt)}function Rt(t){return(e,r)=>Pt(e,r).then((e=>(new DOMParser).parseFromString(e,t)))}var Gt=Rt("image/svg+xml"),Y={normal:$t,vee:Wt,undirected:Vt};function Ut(t){Y=t}function $t(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function Wt(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function Vt(t,e,r,a){var n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");N(n,r[a+"Style"]),r[a+"Class"]&&n.attr("class",r[a+"Class"])}function zt(t,e){var r=t;return r.node().appendChild(e.label),N(r,e.labelStyle),r}function Yt(t,e){for(var r=t.append("text"),a=Ht(e.label).split("\n"),n=0;n<a.length;n++)r.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(a[n]);return N(r,e.labelStyle),r}function Ht(t){for(var e,r="",a=!1,n=0;n<t.length;++n)if(e=t[n],a){if("n"===e)r+="\n";else r+=e;a=!1}else"\\"===e?a=!0:r+=e;return r}function K(t,e,r){var a=e.label,n=t.append("g");"svg"===e.labelType?zt(n,e):"string"!=typeof a||"html"===e.labelType?at(n,e):Yt(n,e);var i,s=n.node().getBBox();switch(r){case"top":i=-e.height/2;break;case"bottom":i=e.height/2-s.height;break;default:i=-s.height/2}return n.attr("transform","translate("+-s.width/2+","+i+")"),n}var H=function(t,e){var r=e.nodes().filter((function(t){return nt(e,t)})),a=t.selectAll("g.cluster").data(r,(function(t){return t}));_(a.exit(),e).style("opacity",0).remove();var n=a.enter().append("g").attr("class","cluster").attr("id",(function(t){return e.node(t).id})).style("opacity",0).each((function(t){var r=e.node(t),a=x(this);x(this).append("rect"),K(a.append("g").attr("class","label"),r,r.clusterLabelPos)}));return a=a.merge(n),(a=_(a,e).style("opacity",1)).selectAll("rect").each((function(t){var r=e.node(t),a=x(this);N(a,r.style)})),a};function Xt(t){H=t}let X=function(t,e){var r,a=t.selectAll("g.edgeLabel").data(e.edges(),(function(t){return st(t)})).classed("update",!0);return a.exit().remove(),a.enter().append("g").classed("edgeLabel",!0).style("opacity",0),(a=t.selectAll("g.edgeLabel")).each((function(t){var r=x(this);r.select(".label").remove();var a=e.edge(t),n=K(r,e.edge(t),0).classed("label",!0),i=n.node().getBBox();a.labelId&&n.attr("id",a.labelId),S(a,"width")||(a.width=i.width),S(a,"height")||(a.height=i.height)})),r=a.exit?a.exit():a.selectAll(null),_(r,e).style("opacity",0).remove(),a};function Ft(t){X=t}function O(t,e){return t.intersect(e)}var F=function(t,e,r){var a=t.selectAll("g.edgePath").data(e.edges(),(function(t){return st(t)})).classed("update",!0),n=Zt(a,e);Ot(a,e);var i=void 0!==a.merge?a.merge(n):a;return _(i,e).style("opacity",1),i.each((function(t){var r=x(this),a=e.edge(t);a.elem=this,a.id&&r.attr("id",a.id),it(r,a.class,(r.classed("update")?"update ":"")+"edgePath")})),i.selectAll("path.path").each((function(t){var r=e.edge(t);r.arrowheadId=Lt("arrowhead");var a=x(this).attr("marker-end",(function(){return"url("+Qt(location.href,r.arrowheadId)+")"})).style("fill","none");_(a,e).attr("d",(function(t){return Jt(e,t)})),N(a,r.style)})),i.selectAll("defs *").remove(),i.selectAll("defs").each((function(t){var a=e.edge(t);(0,r[a.arrowhead])(x(this),a.arrowheadId,a,"arrowhead")})),i};function qt(t){F=t}function Qt(t,e){return t.split("#")[0]+"#"+e}function Jt(t,e){var r=t.edge(e),a=t.node(e.v),n=t.node(e.w),i=r.points.slice(1,r.points.length-1);return i.unshift(O(a,i[0])),i.push(O(n,i[i.length-1])),ot(r,i)}function ot(t,e){var r=(Bt||Gt.line)().x((function(t){return t.x})).y((function(t){return t.y}));return(r.curve||r.interpolate)(t.curve),r(e)}function Kt(t){var e=t.getBBox(),r=t.ownerSVGElement.getScreenCTM().inverse().multiply(t.getScreenCTM()).translate(e.width/2,e.height/2);return{x:r.e,y:r.f}}function Zt(t,e){var r=t.enter().append("g").attr("class","edgePath").style("opacity",0);return r.append("path").attr("class","path").attr("d",(function(t){var r=e.edge(t),a=e.node(t.v).elem;return ot(r,Et(r.points.length).map((function(){return Kt(a)})))})),r.append("defs"),r}function Ot(t,e){var r=t.exit();_(r,e).style("opacity",0).remove()}var q=function(t,e,r){var a,n=e.nodes().filter((function(t){return!nt(e,t)})),i=t.selectAll("g.node").data(n,(function(t){return t})).classed("update",!0);return i.exit().remove(),i.enter().append("g").attr("class","node").style("opacity",0),(i=t.selectAll("g.node")).each((function(t){var a=e.node(t),n=x(this);it(n,a.class,(n.classed("update")?"update ":"")+"node"),n.select("g.label").remove();var i=n.append("g").attr("class","label"),s=K(i,a),o=r[a.shape],l=_t(s.node().getBBox(),"width","height");a.elem=this,a.id&&n.attr("id",a.id),a.labelId&&i.attr("id",a.labelId),S(a,"width")&&(l.width=a.width),S(a,"height")&&(l.height=a.height),l.width+=a.paddingLeft+a.paddingRight,l.height+=a.paddingTop+a.paddingBottom,i.attr("transform","translate("+(a.paddingLeft-a.paddingRight)/2+","+(a.paddingTop-a.paddingBottom)/2+")");var d=x(this);d.select(".label-container").remove();var c=o(d,l,a).classed("label-container",!0);N(c,a.style);var h=c.node().getBBox();a.width=h.width,a.height=h.height})),a=i.exit?i.exit():i.selectAll(null),_(a,e).style("opacity",0).remove(),i};function jt(t){q=t}function te(t,e){var r=t.filter((function(){return!x(this).classed("update")}));function a(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}r.attr("transform",a),_(t,e).style("opacity",1).attr("transform",a),_(r.selectAll("rect"),e).attr("width",(function(t){return e.node(t).width})).attr("height",(function(t){return e.node(t).height})).attr("x",(function(t){return-e.node(t).width/2})).attr("y",(function(t){return-e.node(t).height/2}))}function ee(t,e){function r(t){var r=e.edge(t);return S(r,"x")?"translate("+r.x+","+r.y+")":""}t.filter((function(){return!x(this).classed("update")})).attr("transform",r),_(t,e).style("opacity",1).attr("transform",r)}function re(t,e){function r(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}t.filter((function(){return!x(this).classed("update")})).attr("transform",r),_(t,e).style("opacity",1).attr("transform",r)}function lt(t,e,r,a){var n=t.x,i=t.y,s=n-a.x,o=i-a.y,l=Math.sqrt(e*e*o*o+r*r*s*s),d=Math.abs(e*r*s/l);a.x<n&&(d=-d);var c=Math.abs(e*r*o/l);return a.y<i&&(c=-c),{x:n+d,y:i+c}}function ae(t,e,r){return lt(t,e,e,r)}function ne(t,e,r,a){var n,i,s,o,l,d,c,h,u,p,f,g,y;if(n=e.y-t.y,s=t.x-e.x,l=e.x*t.y-t.x*e.y,u=n*r.x+s*r.y+l,p=n*a.x+s*a.y+l,!(0!==u&&0!==p&&j(u,p)||(i=a.y-r.y,o=r.x-a.x,d=a.x*r.y-r.x*a.y,c=i*t.x+o*t.y+d,h=i*e.x+o*e.y+d,0!==c&&0!==h&&j(c,h)||(f=n*o-i*s,0===f))))return g=Math.abs(f/2),{x:(y=s*d-o*l)<0?(y-g)/f:(y+g)/f,y:(y=i*l-n*d)<0?(y-g)/f:(y+g)/f}}function j(t,e){return t*e>0}function T(t,e,r){var a=t.x,n=t.y,i=[],s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;e.forEach((function(t){s=Math.min(s,t.x),o=Math.min(o,t.y)}));for(var l=a-t.width/2-s,d=n-t.height/2-o,c=0;c<e.length;c++){var h=e[c],u=e[c<e.length-1?c+1:0],p=ne(t,r,{x:l+h.x,y:d+h.y},{x:l+u.x,y:d+u.y});p&&i.push(p)}return i.length?(i.length>1&&i.sort((function(t,e){var a=t.x-r.x,n=t.y-r.y,i=Math.sqrt(a*a+n*n),s=e.x-r.x,o=e.y-r.y,l=Math.sqrt(s*s+o*o);return i<l?-1:i===l?0:1})),i[0]):(console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",t),t)}function Z(t,e){var r,a,n=t.x,i=t.y,s=e.x-n,o=e.y-i,l=t.width/2,d=t.height/2;return Math.abs(o)*l>Math.abs(s)*d?(o<0&&(d=-d),r=0===o?0:d*s/o,a=d):(s<0&&(l=-l),r=l,a=0===s?0:l*o/s),{x:n+r,y:i+a}}var Q={rect:ie,ellipse:oe,circle:le,diamond:ce};function se(t){Q=t}function ie(t,e,r){var a=t.insert("rect",":first-child").attr("rx",r.rx).attr("ry",r.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height);return r.intersect=function(t){return Z(r,t)},a}function oe(t,e,r){var a=e.width/2,n=e.height/2,i=t.insert("ellipse",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("rx",a).attr("ry",n);return r.intersect=function(t){return lt(r,a,n,t)},i}function le(t,e,r){var a=Math.max(e.width,e.height)/2,n=t.insert("circle",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("r",a);return r.intersect=function(t){return ae(r,a,t)},n}function ce(t,e,r){var a=e.width*Math.SQRT2/2,n=e.height*Math.SQRT2/2,i=[{x:0,y:-n},{x:-a,y:0},{x:0,y:n},{x:a,y:0}],s=t.insert("polygon",":first-child").attr("points",i.map((function(t){return t.x+","+t.y})).join(" "));return r.intersect=function(t){return T(r,i,t)},s}function de(){var t=function(t,e){fe(e);var r=P(t,"output"),a=P(r,"clusters"),n=P(r,"edgePaths"),i=X(P(r,"edgeLabels"),e),s=q(P(r,"nodes"),e,Q);Tt(e),re(s,e),ee(i,e),F(n,e,Y),te(H(a,e),e),pe(e)};return t.createNodes=function(e){return arguments.length?(jt(e),t):q},t.createClusters=function(e){return arguments.length?(Xt(e),t):H},t.createEdgeLabels=function(e){return arguments.length?(Ft(e),t):X},t.createEdgePaths=function(e){return arguments.length?(qt(e),t):F},t.shapes=function(e){return arguments.length?(se(e),t):Q},t.arrows=function(e){return arguments.length?(Ut(e),t):Y},t}var he={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"},ue={arrowhead:"normal",curve:G};function fe(t){t.nodes().forEach((function(e){var r=t.node(e);!S(r,"label")&&!t.children(e).length&&(r.label=e),S(r,"paddingX")&&D(r,{paddingLeft:r.paddingX,paddingRight:r.paddingX}),S(r,"paddingY")&&D(r,{paddingTop:r.paddingY,paddingBottom:r.paddingY}),S(r,"padding")&&D(r,{paddingLeft:r.padding,paddingRight:r.padding,paddingTop:r.padding,paddingBottom:r.padding}),D(r,he),tt(["paddingLeft","paddingRight","paddingTop","paddingBottom"],(function(t){r[t]=Number(r[t])})),S(r,"width")&&(r._prevWidth=r.width),S(r,"height")&&(r._prevHeight=r.height)})),t.edges().forEach((function(e){var r=t.edge(e);S(r,"label")||(r.label=""),D(r,ue)}))}function pe(t){tt(t.nodes(),(function(e){var r=t.node(e);S(r,"_prevWidth")?r.width=r._prevWidth:delete r.width,S(r,"_prevHeight")?r.height=r._prevHeight:delete r.height,delete r._prevWidth,delete r._prevHeight}))}function P(t,e){var r=t.select("g."+e);return r.empty()&&(r=t.append("g").attr("class",e)),r}function ct(t,e,r){const a=.9*(e.width+e.height),n=[{x:a/2,y:0},{x:a,y:-a/2},{x:a/2,y:-a},{x:0,y:-a/2}],i=A(t,a,a,n);return r.intersect=function(t){return T(r,n,t)},i}function dt(t,e,r){const a=e.height,n=a/4,i=e.width+2*n,s=[{x:n,y:0},{x:i-n,y:0},{x:i,y:-a/2},{x:i-n,y:-a},{x:n,y:-a},{x:0,y:-a/2}],o=A(t,i,a,s);return r.intersect=function(t){return T(r,s,t)},o}function ht(t,e,r){const a=e.width,n=e.height,i=[{x:-n/2,y:0},{x:a,y:0},{x:a,y:-n},{x:-n/2,y:-n},{x:0,y:-n/2}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function ut(t,e,r){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function ft(t,e,r){const a=e.width,n=e.height,i=[{x:2*n/6,y:0},{x:a+n/6,y:0},{x:a-2*n/6,y:-n},{x:-n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function pt(t,e,r){const a=e.width,n=e.height,i=[{x:-2*n/6,y:0},{x:a+2*n/6,y:0},{x:a-n/6,y:-n},{x:n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function vt(t,e,r){const a=e.width,n=e.height,i=[{x:n/6,y:0},{x:a-n/6,y:0},{x:a+2*n/6,y:-n},{x:-2*n/6,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function yt(t,e,r){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a+n/2,y:0},{x:a,y:-n/2},{x:a+n/2,y:-n},{x:0,y:-n}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function gt(t,e,r){const a=e.height,n=e.width+a/4,i=t.insert("rect",":first-child").attr("rx",a/2).attr("ry",a/2).attr("x",-n/2).attr("y",-a/2).attr("width",n).attr("height",a);return r.intersect=function(t){return Z(r,t)},i}function mt(t,e,r){const a=e.width,n=e.height,i=[{x:0,y:0},{x:a,y:0},{x:a,y:-n},{x:0,y:-n},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-n},{x:-8,y:-n},{x:-8,y:0}],s=A(t,a,n,i);return r.intersect=function(t){return T(r,i,t)},s}function wt(t,e,r){const a=e.width,n=a/2,i=n/(2.5+a/50),s=e.height+i,o="M 0,"+i+" a "+n+","+i+" 0,0,0 "+a+" 0 a "+n+","+i+" 0,0,0 "+-a+" 0 l 0,"+s+" a "+n+","+i+" 0,0,0 "+a+" 0 l 0,"+-s,l=t.attr("label-offset-y",i).insert("path",":first-child").attr("d",o).attr("transform","translate("+-a/2+","+-(s/2+i)+")");return r.intersect=function(t){const e=Z(r,t),a=e.x-r.x;if(0!=n&&(Math.abs(a)<r.width/2||Math.abs(a)==r.width/2&&Math.abs(e.y-r.y)>r.height/2-i)){let s=i*i*(1-a*a/(n*n));0!=s&&(s=Math.sqrt(s)),s=i-s,t.y-r.y>0&&(s=-s),e.y+=s}return e},l}function ve(t){t.shapes().question=ct,t.shapes().hexagon=dt,t.shapes().stadium=gt,t.shapes().subroutine=mt,t.shapes().cylinder=wt,t.shapes().rect_left_inv_arrow=ht,t.shapes().lean_right=ut,t.shapes().lean_left=ft,t.shapes().trapezoid=pt,t.shapes().inv_trapezoid=vt,t.shapes().rect_right_inv_arrow=yt}function ye(t){t({question:ct}),t({hexagon:dt}),t({stadium:gt}),t({subroutine:mt}),t({cylinder:wt}),t({rect_left_inv_arrow:ht}),t({lean_right:ut}),t({lean_left:ft}),t({trapezoid:pt}),t({inv_trapezoid:vt}),t({rect_right_inv_arrow:yt})}function A(t,e,r,a){return t.insert("polygon",":first-child").attr("points",a.map((function(t){return t.x+","+t.y})).join(" ")).attr("transform","translate("+-e/2+","+r/2+")")}const ge={addToRender:ve,addToRenderV2:ye},xt={},me=function(t){const e=Object.keys(t);for(const r of e)xt[r]=t[r]},bt=function(t,e,r,a,n,i){const s=a?a.select(`[id="${r}"]`):x(`[id="${r}"]`),o=n||document;Object.keys(t).forEach((function(r){const a=t[r];let n="default";a.classes.length>0&&(n=a.classes.join(" "));const l=z(a.styles);let d,c=void 0!==a.text?a.text:a.id;if(et(J().flowchart.htmlLabels)){const t={label:c.replace(/fa[blrs]?:fa-[\w-]+/g,(t=>`<i class='${t.replace(":"," ")}'></i>`))};d=at(s,t).node(),d.parentNode.removeChild(d)}else{const t=o.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("style",l.labelStyle.replace("color:","fill:"));const e=c.split(rt.lineBreakRegex);for(const r of e){const e=o.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),e.setAttribute("dy","1em"),e.setAttribute("x","1"),e.textContent=r,t.appendChild(e)}d=t}let h=0,u="";switch(a.type){case"round":h=5,u="rect";break;case"square":case"group":default:u="rect";break;case"diamond":u="question";break;case"hexagon":u="hexagon";break;case"odd":case"odd_right":u="rect_left_inv_arrow";break;case"lean_right":u="lean_right";break;case"lean_left":u="lean_left";break;case"trapezoid":u="trapezoid";break;case"inv_trapezoid":u="inv_trapezoid";break;case"circle":u="circle";break;case"ellipse":u="ellipse";break;case"stadium":u="stadium";break;case"subroutine":u="subroutine";break;case"cylinder":u="cylinder"}I.warn("Adding node",a.id,a.domId),e.setNode(i.db.lookUpDomId(a.id),{labelType:"svg",labelStyle:l.labelStyle,shape:u,label:d,rx:h,ry:h,class:n,style:l.style,id:i.db.lookUpDomId(a.id)})}))},kt=function(t,e,r){let a,n,i=0;if(void 0!==t.defaultStyle){const e=z(t.defaultStyle);a=e.style,n=e.labelStyle}t.forEach((function(s){i++;const o="L-"+s.start+"-"+s.end,l="LS-"+s.start,d="LE-"+s.end,c={};"arrow_open"===s.type?c.arrowhead="none":c.arrowhead="normal";let h="",u="";if(void 0!==s.style){const t=z(s.style);h=t.style,u=t.labelStyle}else switch(s.stroke){case"normal":h="fill:none",void 0!==a&&(h=a),void 0!==n&&(u=n);break;case"dotted":h="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":h=" stroke-width: 3.5px;fill:none"}c.style=h,c.labelStyle=u,void 0!==s.interpolate?c.curve=V(s.interpolate,G):void 0!==t.defaultInterpolate?c.curve=V(t.defaultInterpolate,G):c.curve=V(xt.curve,G),void 0===s.text?void 0!==s.style&&(c.arrowheadStyle="fill: #333"):(c.arrowheadStyle="fill: #333",c.labelpos="c",et(J().flowchart.htmlLabels)?(c.labelType="html",c.label=`<span id="L-${o}" class="edgeLabel L-${l}' L-${d}" style="${c.labelStyle}">${s.text.replace(/fa[blrs]?:fa-[\w-]+/g,(t=>`<i class='${t.replace(":"," ")}'></i>`))}</span>`):(c.labelType="text",c.label=s.text.replace(rt.lineBreakRegex,"\n"),void 0===s.style&&(c.style=c.style||"stroke: #333; stroke-width: 1.5px;fill:none"),c.labelStyle=c.labelStyle.replace("color:","fill:"))),c.id=o,c.class=l+" "+d,c.minlen=s.length||1,e.setEdge(r.db.lookUpDomId(s.start),r.db.lookUpDomId(s.end),c,i)}))},we=function(t,e){I.info("Extracting classes"),e.db.clear();try{return e.parse(t),e.db.getClasses()}catch(t){return I.error(t),{}}},xe=function(t,e,r,a){I.info("Drawing flowchart"),a.db.clear();const{securityLevel:n,flowchart:i}=J();let s;"sandbox"===n&&(s=x("#i"+e));const o=x("sandbox"===n?s.nodes()[0].contentDocument.body:"body"),l="sandbox"===n?s.nodes()[0].contentDocument:document;try{a.parser.parse(t)}catch{I.debug("Parsing failed")}let d=a.db.getDirection();void 0===d&&(d="TD");const c=i.nodeSpacing||50,h=i.rankSpacing||50,u=new Nt({multigraph:!0,compound:!0}).setGraph({rankdir:d,nodesep:c,ranksep:h,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let p;const f=a.db.getSubGraphs();for(let t=f.length-1;t>=0;t--)p=f[t],a.db.addVertex(p.id,p.title,"group",void 0,p.classes);const g=a.db.getVertices();I.warn("Get vertices",g);const y=a.db.getEdges();let b=0;for(b=f.length-1;b>=0;b--){p=f[b],Mt("cluster").append("text");for(let t=0;t<p.nodes.length;t++)I.warn("Setting subgraph",p.nodes[t],a.db.lookUpDomId(p.nodes[t]),a.db.lookUpDomId(p.id)),u.setParent(a.db.lookUpDomId(p.nodes[t]),a.db.lookUpDomId(p.id))}bt(g,u,e,o,l,a),kt(y,u,a);const w=new de;ge.addToRender(w),w.arrows().none=function(t,e,r,a){const n=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 0 0 L 0 0 z");N(n,r[a+"Style"])},w.arrows().normal=function(t,e){t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowheadPath").style("stroke-width",1).style("stroke-dasharray","1,0")};const m=o.select(`[id="${e}"]`),v=o.select("#"+e+" g");for(w(v,u),v.selectAll("g.node").attr("title",(function(){return a.db.getTooltip(this.id)})),a.db.indexNodes("subGraph"+b),b=0;b<f.length;b++)if(p=f[b],"undefined"!==p.title){const t=l.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(p.id)+'"] rect'),r=l.querySelectorAll("#"+e+' [id="'+a.db.lookUpDomId(p.id)+'"]'),n=t[0].x.baseVal.value,i=t[0].y.baseVal.value,s=t[0].width.baseVal.value,o=x(r[0]).select(".label");o.attr("transform",`translate(${n+s/2}, ${i+14})`),o.attr("id",e+"Text");for(let t=0;t<p.classes.length;t++)r[0].classList.add(p.classes[t])}if(!i.htmlLabels){const t=l.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const e of t){const t=e.getBBox(),r=l.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("rx",0),r.setAttribute("ry",0),r.setAttribute("width",t.width),r.setAttribute("height",t.height),e.insertBefore(r,e.firstChild)}}At(u,m,i.diagramPadding,i.useMaxWidth),Object.keys(g).forEach((function(t){const r=g[t];if(r.link){const i=o.select("#"+e+' [id="'+a.db.lookUpDomId(t)+'"]');if(i){const t=l.createElementNS("http://www.w3.org/2000/svg","a");t.setAttributeNS("http://www.w3.org/2000/svg","class",r.classes.join(" ")),t.setAttributeNS("http://www.w3.org/2000/svg","href",r.link),t.setAttributeNS("http://www.w3.org/2000/svg","rel","noopener"),"sandbox"===n?t.setAttributeNS("http://www.w3.org/2000/svg","target","_top"):r.linkTarget&&t.setAttributeNS("http://www.w3.org/2000/svg","target",r.linkTarget);const e=i.insert((function(){return t}),":first-child"),a=i.select(".label-container");a&&e.append((function(){return a.node()}));const s=i.select(".label");s&&e.append((function(){return s.node()}))}}}))},be={setConf:me,addVertices:bt,addEdges:kt,getClasses:we,draw:xe},Re={parser:St,db:W,renderer:Ct,styles:It,init:t=>{t.flowchart||(t.flowchart={}),t.flowchart.arrowMarkerAbsolute=t.arrowMarkerAbsolute,be.setConf(t.flowchart),W.clear(),W.setGen("gen-1")}};export{Re as diagram};