import{r as v,j as e}from"./react.CvslfkeK.js";import{H as F}from"./@hcaptcha.BS9qM8Gp.js";import{u as c}from"./@nanostores.J-Z5GVtw.js";import{u as H}from"./react-hook-form.xQQCzVAN.js";import{t as y}from"./tailwind-merge.B9ugUrge.js";import{c as N}from"./clsx.B-dksMZM.js";import{a as d}from"./nanostores.Bo9-_MAV.js";import{s as I}from"./supabaseClient.BT68OKvR.js";import{s as R,a as z}from"./OAuthSignIn.CWAZp8dT.js";import"./@react-three.B-wTPXHf.js";import"./@babel.iCE8PrbV.js";import"./@supabase.d6fxE5ud.js";import"./Page.astro_astro_type_script_index_0_lang.Db7LHE3J.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";const w=d(""),f=d(""),i=d(""),m=d(""),x=d(!1),g=d(null);async function W(){const l=w.get(),r=f.get(),s=g.get();if(i.set(""),m.set(""),!l||!r){i.set("Email and password are required.");return}if(!s){i.set("Please complete the hCaptcha challenge.");return}x.set(!0);try{const{data:a,error:o}=await I.auth.signInWithPassword({email:l,password:r,options:{captchaToken:s}});if(o)throw o;m.set("Login successful! Redirecting..."),setTimeout(()=>{window.location.href="https://kbve.com/profile/"},1500)}catch(a){i.set(a.message||"Login failed.")}finally{x.set(!1)}}const D="e19cf4a6-2168-49a2-88fe-716e97569e88",V=({open:l,loading:r,error:s,success:a,onClose:o})=>l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:e.jsxs("div",{className:"bg-neutral-900 text-white rounded-xl shadow-lg p-8 max-w-sm w-full flex flex-col items-center relative",children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-cyan-400 mb-4"}),e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Logging inâ€¦"})]}),!r&&(s||a)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s?"text-red-400 text-lg font-semibold mb-2":"text-green-400 text-lg font-semibold mb-2",children:s||a}),e.jsx("button",{onClick:o,className:"mt-4 px-4 py-2 rounded bg-cyan-600 hover:bg-cyan-700 text-white font-bold shadow",children:"Close"})]})]})}):null,re=()=>{const l=c(w),r=c(f),s=c(i),a=c(m),o=c(x),C=c(g),E=t=>w.set(t),L=t=>f.set(t),h=t=>i.set(t),S=t=>m.set(t),_=t=>x.set(t),p=t=>g.set(t),{handleSubmit:A,register:j,formState:{errors:n},setValue:k}=H({defaultValues:{email:l,password:r}}),[M,u]=v.useState(!1),b=v.useRef(null),P=async t=>{if(h(""),S(""),u(!0),!C){h("Please complete the hCaptcha challenge."),u(!1);return}_(!0);try{await W()}catch(q){h(q.message||"Login failed.")}finally{_(!1),b.current&&(b.current.reset(),p(null))}},T=()=>{u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(V,{open:M,loading:o,error:s,success:a,onClose:T}),e.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[e.jsxs("button",{onClick:R,className:"flex items-center justify-center gap-2 w-full py-2 rounded bg-black text-white font-semibold shadow hover:bg-gray-800 transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 .5C5.73.5.5 5.74.5 12.02c0 5.1 3.29 9.43 7.86 10.96.58.11.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.53-1.34-1.3-1.7-1.3-1.7-1.06-.72.08-.71.08-.71 1.17.08 1.78 1.2 1.78 1.2 1.04 1.78 2.73 1.27 3.4.97.11-.75.41-1.27.74-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.29 1.19-3.1-.12-.29-.52-1.46.11-3.05 0 0 .97-.31 3.18 1.18a11.1 11.1 0 0 1 2.9-.39c.98 0 1.97.13 2.9.39 2.2-1.49 3.17-1.18 3.17-1.18.63 1.59.23 2.76.11 3.05.74.81 1.19 1.84 1.19 3.1 0 4.43-2.69 5.41-5.25 5.7.42.36.79 1.09.79 2.2 0 1.59-.01 2.87-.01 3.26 0 .31.21.68.8.56C20.71 21.45 24 17.12 24 12.02 24 5.74 18.27.5 12 .5z"})}),"Continue with GitHub"]}),e.jsxs("button",{onClick:z,className:"flex items-center justify-center gap-2 w-full py-2 rounded bg-[#5865F2] text-white font-semibold shadow hover:bg-[#4752c4] transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20.317 4.3698a19.7913 19.7913 0 0 0-4.8851-1.5152.0741.0741 0 0 0-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 0 0-.0785-.037 19.7363 19.7363 0 0 0-4.8852 1.515.0699.0699 0 0 0-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 0 0 .0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 0 0 .0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 0 0-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 0 1-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 0 1 .0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 0 1 .0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 0 1-.0066.1276c-.598.3428-1.2205.6447-1.8733.8923a.0766.0766 0 0 0-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 0 0 .0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 0 0 .0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 0 0-.0312-.0286zM8.02 15.3312c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"})}),"Continue with Discord"]})]}),e.jsxs("form",{onSubmit:A(P),className:y("login-form flex flex-col gap-4"),style:{maxWidth:400,margin:"0 auto"},children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-2 text-white [text-shadow:_0_1px_2px_black] shadow-black shadow-lg",children:"Login"}),s&&e.jsx("div",{className:"text-red-500 text-center [text-shadow:_0_1px_2px_black] shadow-black shadow-md",children:s}),a&&e.jsx("div",{className:"text-green-500 text-center [text-shadow:_0_1px_2px_black] shadow-black shadow-md",children:a}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:e.jsx("span",{className:"text-white [text-shadow:_0_1px_2px_black] shadow-black",children:"Email"})}),e.jsx("input",{type:"email",...j("email",{required:"Email is required"}),value:l,onChange:t=>{E(t.target.value),k("email",t.target.value)},className:N("block w-full rounded border px-3 py-2 bg-white/80 dark:bg-stone-900/80 text-white [text-shadow:_0_1px_2px_black] shadow-black",n.email&&"border-red-500")}),n.email&&e.jsx("span",{className:"text-red-500 text-sm [text-shadow:_0_1px_2px_black] shadow-black",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:e.jsx("span",{className:"text-white [text-shadow:_0_1px_2px_black] shadow-black",children:"Password"})}),e.jsx("input",{type:"password",...j("password",{required:"Password is required"}),value:r,onChange:t=>{L(t.target.value),k("password",t.target.value)},className:N("block w-full rounded border px-3 py-2 bg-white/80 dark:bg-stone-900/80 text-white [text-shadow:_0_1px_2px_black] shadow-black",n.password&&"border-red-500")}),n.password&&e.jsx("span",{className:"text-red-500 text-sm [text-shadow:_0_1px_2px_black] shadow-black",children:n.password.message})]}),e.jsx("div",{className:"my-2",children:e.jsx(F,{ref:b,sitekey:D,onVerify:t=>p(t),onExpire:()=>p(null)})}),e.jsx("button",{type:"submit",disabled:o,className:y("block w-full py-2 rounded bg-gradient-to-br from-cyan-500 to-purple-500 text-white font-semibold shadow hover:from-cyan-400 hover:to-purple-400 transition drop-shadow-[0_1px_2px_rgba(0,0,0,1)] shadow-black shadow-lg",o&&"opacity-60 cursor-not-allowed"),children:o?"Logging in...":"Login"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"text-white [text-shadow:_0_1px_2px_black] shadow-black",children:["Don't have an account?"," ",e.jsx("a",{href:"/register",className:"underline text-cyan-200 hover:text-cyan-400",children:"Register here"})]})})]})]})};export{re as Login};
