function Z(i){const t=+this._x.call(null,i),n=+this._y.call(null,i),e=+this._z.call(null,i);return Y(this.cover(t,n,e),t,n,e,i)}function Y(i,t,n,e,r){if(isNaN(t)||isNaN(n)||isNaN(e))return i;var s,l=i._root,a={data:r},f=i._x0,h=i._y0,c=i._z0,o=i._x1,_=i._y1,u=i._z1,w,v,A,x,N,g,I,y,z,b,M;if(!l)return i._root=a,i;for(;l.length;)if((I=t>=(w=(f+o)/2))?f=w:o=w,(y=n>=(v=(h+_)/2))?h=v:_=v,(z=e>=(A=(c+u)/2))?c=A:u=A,s=l,!(l=l[b=z<<2|y<<1|I]))return s[b]=a,i;if(x=+i._x.call(null,l.data),N=+i._y.call(null,l.data),g=+i._z.call(null,l.data),t===x&&n===N&&e===g)return a.next=l,s?s[b]=a:i._root=a,i;do s=s?s[b]=new Array(8):i._root=new Array(8),(I=t>=(w=(f+o)/2))?f=w:o=w,(y=n>=(v=(h+_)/2))?h=v:_=v,(z=e>=(A=(c+u)/2))?c=A:u=A;while((b=z<<2|y<<1|I)===(M=(g>=A)<<2|(N>=v)<<1|x>=w));return s[M]=l,s[b]=a,i}function B(i){Array.isArray(i)||(i=Array.from(i));const t=i.length,n=new Float64Array(t),e=new Float64Array(t),r=new Float64Array(t);let s=1/0,l=1/0,a=1/0,f=-1/0,h=-1/0,c=-1/0;for(let o=0,_,u,w,v;o<t;++o)isNaN(u=+this._x.call(null,_=i[o]))||isNaN(w=+this._y.call(null,_))||isNaN(v=+this._z.call(null,_))||(n[o]=u,e[o]=w,r[o]=v,u<s&&(s=u),u>f&&(f=u),w<l&&(l=w),w>h&&(h=w),v<a&&(a=v),v>c&&(c=v));if(s>f||l>h||a>c)return this;this.cover(s,l,a).cover(f,h,c);for(let o=0;o<t;++o)Y(this,n[o],e[o],r[o],i[o]);return this}function C(i,t,n){if(isNaN(i=+i)||isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,s=this._z0,l=this._x1,a=this._y1,f=this._z1;if(isNaN(e))l=(e=Math.floor(i))+1,a=(r=Math.floor(t))+1,f=(s=Math.floor(n))+1;else{for(var h=l-e||1,c=this._root,o,_;e>i||i>=l||r>t||t>=a||s>n||n>=f;)switch(_=(n<s)<<2|(t<r)<<1|i<e,o=new Array(8),o[_]=c,c=o,h*=2,_){case 0:l=e+h,a=r+h,f=s+h;break;case 1:e=l-h,a=r+h,f=s+h;break;case 2:l=e+h,r=a-h,f=s+h;break;case 3:e=l-h,r=a-h,f=s+h;break;case 4:l=e+h,a=r+h,s=f-h;break;case 5:e=l-h,a=r+h,s=f-h;break;case 6:l=e+h,r=a-h,s=f-h;break;case 7:e=l-h,r=a-h,s=f-h;break}this._root&&this._root.length&&(this._root=c)}return this._x0=e,this._y0=r,this._z0=s,this._x1=l,this._y1=a,this._z1=f,this}function D(){var i=[];return this.visit(function(t){if(!t.length)do i.push(t.data);while(t=t.next)}),i}function E(i){return arguments.length?this.cover(+i[0][0],+i[0][1],+i[0][2]).cover(+i[1][0],+i[1][1],+i[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function p(i,t,n,e,r,s,l){this.node=i,this.x0=t,this.y0=n,this.z0=e,this.x1=r,this.y1=s,this.z1=l}function G(i,t,n,e){var r,s=this._x0,l=this._y0,a=this._z0,f,h,c,o,_,u,w=this._x1,v=this._y1,A=this._z1,x=[],N=this._root,g,I;for(N&&x.push(new p(N,s,l,a,w,v,A)),e==null?e=1/0:(s=i-e,l=t-e,a=n-e,w=i+e,v=t+e,A=n+e,e*=e);g=x.pop();)if(!(!(N=g.node)||(f=g.x0)>w||(h=g.y0)>v||(c=g.z0)>A||(o=g.x1)<s||(_=g.y1)<l||(u=g.z1)<a))if(N.length){var y=(f+o)/2,z=(h+_)/2,b=(c+u)/2;x.push(new p(N[7],y,z,b,o,_,u),new p(N[6],f,z,b,y,_,u),new p(N[5],y,h,b,o,z,u),new p(N[4],f,h,b,y,z,u),new p(N[3],y,z,c,o,_,b),new p(N[2],f,z,c,y,_,b),new p(N[1],y,h,c,o,z,b),new p(N[0],f,h,c,y,z,b)),(I=(n>=b)<<2|(t>=z)<<1|i>=y)&&(g=x[x.length-1],x[x.length-1]=x[x.length-1-I],x[x.length-1-I]=g)}else{var M=i-+this._x.call(null,N.data),j=t-+this._y.call(null,N.data),O=n-+this._z.call(null,N.data),P=M*M+j*j+O*O;if(P<e){var q=Math.sqrt(e=P);s=i-q,l=t-q,a=n-q,w=i+q,v=t+q,A=n+q,r=N.data}}return r}function H(i){if(isNaN(_=+this._x.call(null,i))||isNaN(u=+this._y.call(null,i))||isNaN(w=+this._z.call(null,i)))return this;var t,n=this._root,e,r,s,l=this._x0,a=this._y0,f=this._z0,h=this._x1,c=this._y1,o=this._z1,_,u,w,v,A,x,N,g,I,y,z;if(!n)return this;if(n.length)for(;;){if((N=_>=(v=(l+h)/2))?l=v:h=v,(g=u>=(A=(a+c)/2))?a=A:c=A,(I=w>=(x=(f+o)/2))?f=x:o=x,t=n,!(n=n[y=I<<2|g<<1|N]))return this;if(!n.length)break;(t[y+1&7]||t[y+2&7]||t[y+3&7]||t[y+4&7]||t[y+5&7]||t[y+6&7]||t[y+7&7])&&(e=t,z=y)}for(;n.data!==i;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):t?(s?t[y]=s:delete t[y],(n=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&n===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!n.length&&(e?e[z]=n:this._root=n),this):(this._root=s,this)}function J(i){for(var t=0,n=i.length;t<n;++t)this.remove(i[t]);return this}function K(){return this._root}function L(){var i=0;return this.visit(function(t){if(!t.length)do++i;while(t=t.next)}),i}function Q(i){var t=[],n,e=this._root,r,s,l,a,f,h,c;for(e&&t.push(new p(e,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=t.pop();)if(!i(e=n.node,s=n.x0,l=n.y0,a=n.z0,f=n.x1,h=n.y1,c=n.z1)&&e.length){var o=(s+f)/2,_=(l+h)/2,u=(a+c)/2;(r=e[7])&&t.push(new p(r,o,_,u,f,h,c)),(r=e[6])&&t.push(new p(r,s,_,u,o,h,c)),(r=e[5])&&t.push(new p(r,o,l,u,f,_,c)),(r=e[4])&&t.push(new p(r,s,l,u,o,_,c)),(r=e[3])&&t.push(new p(r,o,_,a,f,h,u)),(r=e[2])&&t.push(new p(r,s,_,a,o,h,u)),(r=e[1])&&t.push(new p(r,o,l,a,f,_,u)),(r=e[0])&&t.push(new p(r,s,l,a,o,_,u))}return this}function R(i){var t=[],n=[],e;for(this._root&&t.push(new p(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=t.pop();){var r=e.node;if(r.length){var s,l=e.x0,a=e.y0,f=e.z0,h=e.x1,c=e.y1,o=e.z1,_=(l+h)/2,u=(a+c)/2,w=(f+o)/2;(s=r[0])&&t.push(new p(s,l,a,f,_,u,w)),(s=r[1])&&t.push(new p(s,_,a,f,h,u,w)),(s=r[2])&&t.push(new p(s,l,u,f,_,c,w)),(s=r[3])&&t.push(new p(s,_,u,f,h,c,w)),(s=r[4])&&t.push(new p(s,l,a,w,_,u,o)),(s=r[5])&&t.push(new p(s,_,a,w,h,u,o)),(s=r[6])&&t.push(new p(s,l,u,w,_,c,o)),(s=r[7])&&t.push(new p(s,_,u,w,h,c,o))}n.push(e)}for(;e=n.pop();)i(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this}function S(i){return i[0]}function T(i){return arguments.length?(this._x=i,this):this._x}function U(i){return i[1]}function V(i){return arguments.length?(this._y=i,this):this._y}function W(i){return i[2]}function $(i){return arguments.length?(this._z=i,this):this._z}function d(i,t,n,e){var r=new F(t??S,n??U,e??W,NaN,NaN,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function F(i,t,n,e,r,s,l,a,f){this._x=i,this._y=t,this._z=n,this._x0=e,this._y0=r,this._z0=s,this._x1=l,this._y1=a,this._z1=f,this._root=void 0}function X(i){for(var t={data:i.data},n=t;i=i.next;)n=n.next={data:i.data};return t}var k=d.prototype=F.prototype;k.copy=function(){var i=new F(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),t=this._root,n,e;if(!t)return i;if(!t.length)return i._root=X(t),i;for(n=[{source:t,target:i._root=new Array(8)}];t=n.pop();)for(var r=0;r<8;++r)(e=t.source[r])&&(e.length?n.push({source:e,target:t.target[r]=new Array(8)}):t.target[r]=X(e));return i};k.add=Z;k.addAll=B;k.cover=C;k.data=D;k.extent=E;k.find=G;k.remove=H;k.removeAll=J;k.root=K;k.size=L;k.visit=Q;k.visitAfter=R;k.x=T;k.y=V;k.z=$;export{d as o};
