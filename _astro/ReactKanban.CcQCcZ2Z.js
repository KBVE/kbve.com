import{j as s,r as m}from"./react.XJQ4OnvF.js";import{u as T,a as v,D as K,r as B,b as A,c as G,C as V,d as N,T as q,P as J}from"./@dnd-kit.CZoI31gw.js";import{c as j}from"./clsx.B-dksMZM.js";import{t as f}from"./tailwind-merge.B9ugUrge.js";import{a as $,e as g}from"./npchandler.Cs5KoD5X.js";import{a as F}from"./@nanostores.kqnvP3SD.js";import{E as z}from"./ExpandIcon.Bpk_t6hV.js";import"./@react-three.DzcfnNYH.js";import"./react-dom.3umP1jIU.js";import"./scheduler.CzFDRTuY.js";import"./@supabase.BrxtDNAR.js";import"./Tabs.astro_astro_type_script_index_0_lang.BYjWCQXm.js";import"./dexie.FI_cDWIf.js";import"./nanostores.Bo9-_MAV.js";import"./axios.dxcvQi4N.js";class H extends ${itemPositionsStore;constructor(){super(),this.itemPositionsStore=F("kanBanItemPositions",{},{encode:JSON.stringify,decode:JSON.parse})}saveItemPositions(t){this.itemPositionsStore.set(t),console.log("Item positions saved to KanbanBase:",t)}loadItemPositions(){const t=this.itemPositionsStore.get();return console.log("Item positions loaded from KanbanBase:",t),t||{}}resetItemPositions(t){const n=Object.keys(t).reduce((i,u)=>(i[u]=[],i),{});this.itemPositionsStore.set(n),console.log("Item positions reset to:",n)}}const b=new H,P=f("p-5 border-gray-200 dark:text-neutral-200 rounded-md","w-full md:w-1/4","flex flex-col items-center"),L=f("flex flex-wrap flex-grow bg-gray-500 p-5 rounded-md","w-full md:w-3/4"),Q=({title:a,message:t,isVisible:n,onClose:i})=>n?s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white p-5 rounded shadow-lg w-96",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:a}),s.jsxs("p",{className:"mb-4",children:["This is the content of the modal for item ",a,".",t]}),s.jsx("button",{className:"bg-cyan-500 text-gray-500 py-2 px-4 rounded hover:bg-cyan-600",onClick:i,children:"Close"})]})}):null,w=({id:a,onExpandClick:t})=>{const{attributes:n,listeners:i,setNodeRef:u,transform:h,isDragging:x}=G({id:a}),I={transform:V.Translate.toString(h)};return s.jsxs("div",{ref:u,className:f("p-3 border border-cyan-500 rounded-md m-2 cursor-grab bg-cyan-300 dark:text-neutral-600 flex items-center justify-between",j({"opacity-50":x})),style:I,...i,...n,children:[a,s.jsx("button",{onClick:t,className:"ml-2 p-2 rounded-full bg-gray-200 hover:bg-gray-300",children:s.jsx(z,{className:"w-4 h-4 text-gray-800 dark:text-gray-200"})})]})},U=({id:a,children:t})=>{const{setNodeRef:n,isOver:i}=N({id:a});return s.jsxs("div",{ref:n,className:f("p-5 border-dashed border-2 border-gray-300 rounded-md m-3 min-h-[150px]","w-full sm:w-[45%] md:w-[30%]",j({"bg-cyan-100":i,"bg-white":!i})),children:[s.jsx("h3",{className:f("font-bold mb-3"),children:a}),t]})},W=({id:a,children:t})=>{const{setNodeRef:n,isOver:i}=N({id:a});return s.jsxs("div",{ref:n,className:f(P,"border-2 border-dashed border-gray-400",j({"bg-cyan-500":i})),children:[s.jsx("h3",{className:f("font-bold text-xl mb-4"),children:"Kanban"}),t]})},X=({items:a,onItemExpandClick:t})=>s.jsxs("div",{className:P,children:[s.jsx("h3",{className:f("font-bold text-xl mb-4"),children:"Available Items"}),a.map(n=>s.jsx(w,{id:n,onExpandClick:()=>t(n)},n))]}),Y=({containers:a})=>{const[t,n]=m.useState({}),[i,u]=m.useState(["Item 1","Item 2","Item 3","Function","IGBC"]),[h,x]=m.useState(null),[I,S]=m.useState(!1),[D,E]=m.useState(""),[O,Z]=m.useState(""),C=()=>{const o={TODO:[],"IN-PROGRESS":[],DONE:[]},e=b.loadItemPositions(),p=Object.values(e).flatMap(r=>r.map(d=>d.id));u(r=>[...new Set([...r,...p])]),b.resetItemPositions(o),n(o),console.log("Kanban reset completed.")},M=T(v(J,{activationConstraint:{distance:5}}),v(q,{activationConstraint:{delay:100,tolerance:5}}));m.useEffect(()=>{(async()=>{try{const e=await b.loadProfile();console.log(`Data: ${e}`)}catch(e){console.error("Error loading profile or item positions:",e)}})()},[]),m.useEffect(()=>{const o=b.loadItemPositions();n(o);const e=new Set(Object.values(o).flatMap(p=>p.map(r=>r.id)));u(p=>p.filter(r=>!e.has(r)))},[]);const y=o=>{g.emit("openModal",{message:`Modal for ${o}`})};m.useEffect(()=>{const o=e=>{e&&E(e.message),S(!0)};return g.on("openModal",o),()=>{g.off("openModal",o)}},[]),m.useEffect(()=>{const o=e=>{if(e)switch(e.npcId){case"Reset":C()}};return g.on("npcInteraction",o),()=>{g.off("npcInteraction",o)}},[]);const k=async o=>{const{active:e,over:p}=o;if(!p){x(null);return}const r=Object.keys(t).find(l=>t[l]?.some(c=>c.id===e.id)),d=p.id;if(d==="sidebar")i.includes(e.id)||u(l=>[...l,e.id]),r&&n(l=>{const c={...l,[r]:l[r].filter(R=>R.id!==e.id)};return b.saveItemPositions(c),c});else if(!r)u(l=>l.filter(c=>c!==e.id)),n(l=>{const c={...l,[d]:[...l[d]||[],{id:e.id,container:d}]};return b.saveItemPositions(c),c});else if(r!==d){const l={...t,[r]:t[r].filter(c=>c.id!==e.id),[d]:[...t[d]||[],{id:e.id,container:d}]};n(l),b.saveItemPositions(l)}x(null)};return s.jsxs(K,{sensors:M,collisionDetection:B,onDragStart:o=>x(o.active.id),onDragEnd:k,children:[s.jsxs("div",{className:f("flex flex-col md:flex-row"),children:[s.jsx(W,{id:"sidebar",children:s.jsx(X,{items:i,onItemExpandClick:y})}),s.jsx("div",{className:L,children:a.map(o=>s.jsx(U,{id:o,children:t[o]?.map(e=>s.jsx(w,{id:e.id,onExpandClick:()=>y(e.id)},e.id))},o))})]}),s.jsx(A,{children:h?s.jsx("div",{children:h}):null}),s.jsx(Q,{title:D,message:O,isVisible:I,onClose:()=>S(!1)})]})},pe=()=>s.jsx(Y,{containers:["TODO","IN-PROGRESS","DONE"]});export{pe as default};
