import{O as _r,P as mr,S as yr,i as vr,s as br,W as wr,C as Pt,j as B,c as kr,D as Tr,r as P,p as M,a as Sr,w,v as Pe,m as Er,t as Or,b as xr,d as jr,e as Ar,f as Cr,o as Rr,g as Pr,h as O,l as x,n as F,A as $r,u as v,B as Zt,k as er,y as te,q as tr,E as ne,F as ye,G as Ir,x as rr,H as Dr,I as Lr,J as Ur,K as ge,L as Fr,M as Nr}from"./storage.4aa08090.js";import{g as Br,c as Mr}from"./_commonjsHelpers.725317a4.js";import{_ as We}from"./preload-helper.cf010ec4.js";import{a as sr}from"./index.ae223c1e.js";function Hr(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var qr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Gr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>qr(void 0,void 0,void 0,function*(){return yield(yield We(()=>Promise.resolve().then(()=>Xe),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class yt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class zr extends yt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Jr extends yt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Kr extends yt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Vr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};class Wr{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=Gr(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Vr(this,void 0,void 0,function*(){try{const{headers:i,method:s,body:o}=t;let a={},l;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const h=yield this.fetch(`${this.url}/${e}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:l}).catch(m=>{throw new zr(m)}),c=h.headers.get("x-relay-error");if(c&&c==="true")throw new Jr(h);if(!h.ok)throw new Kr(h);let d=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return d==="application/json"?p=yield h.json():d==="application/octet-stream"?p=yield h.blob():d==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null}}catch(i){return{data:null,error:i}}})}}var ut={exports:{}};(function(n,e){var t=typeof self<"u"?self:Mr,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function l(u){return u&&DataView.prototype.isPrototypeOf(u)}if(a.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(u){return u&&h.indexOf(Object.prototype.toString.call(u))>-1};function d(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function p(u){return typeof u!="string"&&(u=String(u)),u}function m(u){var f={next:function(){var k=u.shift();return{done:k===void 0,value:k}}};return a.iterable&&(f[Symbol.iterator]=function(){return f}),f}function _(u){this.map={},u instanceof _?u.forEach(function(f,k){this.append(k,f)},this):Array.isArray(u)?u.forEach(function(f){this.append(f[0],f[1])},this):u&&Object.getOwnPropertyNames(u).forEach(function(f){this.append(f,u[f])},this)}_.prototype.append=function(u,f){u=d(u),f=p(f);var k=this.map[u];this.map[u]=k?k+", "+f:f},_.prototype.delete=function(u){delete this.map[d(u)]},_.prototype.get=function(u){return u=d(u),this.has(u)?this.map[u]:null},_.prototype.has=function(u){return this.map.hasOwnProperty(d(u))},_.prototype.set=function(u,f){this.map[d(u)]=p(f)},_.prototype.forEach=function(u,f){for(var k in this.map)this.map.hasOwnProperty(k)&&u.call(f,this.map[k],k,this)},_.prototype.keys=function(){var u=[];return this.forEach(function(f,k){u.push(k)}),m(u)},_.prototype.values=function(){var u=[];return this.forEach(function(f){u.push(f)}),m(u)},_.prototype.entries=function(){var u=[];return this.forEach(function(f,k){u.push([k,f])}),m(u)},a.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function g(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function b(u){return new Promise(function(f,k){u.onload=function(){f(u.result)},u.onerror=function(){k(u.error)}})}function j(u){var f=new FileReader,k=b(f);return f.readAsArrayBuffer(u),k}function U(u){var f=new FileReader,k=b(f);return f.readAsText(u),k}function q(u){for(var f=new Uint8Array(u),k=new Array(f.length),S=0;S<f.length;S++)k[S]=String.fromCharCode(f[S]);return k.join("")}function I(u){if(u.slice)return u.slice(0);var f=new Uint8Array(u.byteLength);return f.set(new Uint8Array(u)),f.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(u){this._bodyInit=u,u?typeof u=="string"?this._bodyText=u:a.blob&&Blob.prototype.isPrototypeOf(u)?this._bodyBlob=u:a.formData&&FormData.prototype.isPrototypeOf(u)?this._bodyFormData=u:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)?this._bodyText=u.toString():a.arrayBuffer&&a.blob&&l(u)?(this._bodyArrayBuffer=I(u.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(u)||c(u))?this._bodyArrayBuffer=I(u):this._bodyText=u=Object.prototype.toString.call(u):this._bodyText="",this.headers.get("content-type")||(typeof u=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var u=g(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(j)}),this.text=function(){var u=g(this);if(u)return u;if(this._bodyBlob)return U(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(q(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(Y)}),this.json=function(){return this.text().then(JSON.parse)},this}var W=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function G(u){var f=u.toUpperCase();return W.indexOf(f)>-1?f:u}function D(u,f){f=f||{};var k=f.body;if(u instanceof D){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,f.headers||(this.headers=new _(u.headers)),this.method=u.method,this.mode=u.mode,this.signal=u.signal,!k&&u._bodyInit!=null&&(k=u._bodyInit,u.bodyUsed=!0)}else this.url=String(u);if(this.credentials=f.credentials||this.credentials||"same-origin",(f.headers||!this.headers)&&(this.headers=new _(f.headers)),this.method=G(f.method||this.method||"GET"),this.mode=f.mode||this.mode||null,this.signal=f.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&k)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(k)}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})};function Y(u){var f=new FormData;return u.trim().split("&").forEach(function(k){if(k){var S=k.split("="),$=S.shift().replace(/\+/g," "),y=S.join("=").replace(/\+/g," ");f.append(decodeURIComponent($),decodeURIComponent(y))}}),f}function ie(u){var f=new _,k=u.replace(/\r?\n[\t ]+/g," ");return k.split(/\r?\n/).forEach(function(S){var $=S.split(":"),y=$.shift().trim();if(y){var Q=$.join(":").trim();f.append(y,Q)}}),f}R.call(D.prototype);function A(u,f){f||(f={}),this.type="default",this.status=f.status===void 0?200:f.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in f?f.statusText:"OK",this.headers=new _(f.headers),this.url=f.url||"",this._initBody(u)}R.call(A.prototype),A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},A.error=function(){var u=new A(null,{status:0,statusText:""});return u.type="error",u};var ce=[301,302,303,307,308];A.redirect=function(u,f){if(ce.indexOf(f)===-1)throw new RangeError("Invalid status code");return new A(null,{status:f,headers:{location:u}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(f,k){this.message=f,this.name=k;var S=Error(f);this.stack=S.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function z(u,f){return new Promise(function(k,S){var $=new D(u,f);if($.signal&&$.signal.aborted)return S(new o.DOMException("Aborted","AbortError"));var y=new XMLHttpRequest;function Q(){y.abort()}y.onload=function(){var J={status:y.status,statusText:y.statusText,headers:ie(y.getAllResponseHeaders()||"")};J.url="responseURL"in y?y.responseURL:J.headers.get("X-Request-URL");var pe="response"in y?y.response:y.responseText;k(new A(pe,J))},y.onerror=function(){S(new TypeError("Network request failed"))},y.ontimeout=function(){S(new TypeError("Network request failed"))},y.onabort=function(){S(new o.DOMException("Aborted","AbortError"))},y.open($.method,$.url,!0),$.credentials==="include"?y.withCredentials=!0:$.credentials==="omit"&&(y.withCredentials=!1),"responseType"in y&&a.blob&&(y.responseType="blob"),$.headers.forEach(function(J,pe){y.setRequestHeader(pe,J)}),$.signal&&($.signal.addEventListener("abort",Q),y.onreadystatechange=function(){y.readyState===4&&$.signal.removeEventListener("abort",Q)}),y.send(typeof $._bodyInit>"u"?null:$._bodyInit)})}return z.polyfill=!0,s.fetch||(s.fetch=z,s.Headers=_,s.Request=D,s.Response=A),o.Headers=_,o.Request=D,o.Response=A,o.fetch=z,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(ut,ut.exports);var vt=ut.exports;const bt=Br(vt),Xe=Hr({__proto__:null,default:bt},[vt]);class Xr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=bt:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{var o,a,l;let h=null,c=null,d=null,p=s.status,m=s.statusText;if(s.ok){if(this.method!=="HEAD"){const j=await s.text();j===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=j:c=JSON.parse(j))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),b=(a=s.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&b&&b.length>1&&(d=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(h={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,d=null,p=406,m="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const g=await s.text();try{h=JSON.parse(g),Array.isArray(h)&&s.status===404&&(c=[],h=null,p=200,m="OK")}catch{s.status===404&&g===""?(p=204,m="No Content"):h={message:g}}if(h&&this.isMaybeSingle&&(!((l=h?.details)===null||l===void 0)&&l.includes("Results contain 0 rows"))&&(h=null,p=200,m="OK"),h&&this.shouldThrowOnError)throw h}return{error:h,data:c,count:d,status:p,statusText:m}});return this.shouldThrowOnError||(i=i.catch(s=>{var o,a,l;return{error:{message:`${(o=s?.name)!==null&&o!==void 0?o:"FetchError"}: ${s?.message}`,details:`${(a=s?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=s?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}}class Yr extends Xr{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i}={}){const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const i=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:s=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ve extends Yr{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let s="";i==="plain"?s="pl":i==="phrase"?s="ph":i==="websearch"&&(s="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Qr{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=t,this.schema=r,this.fetch=i}select(e,{head:t=!1,count:r}={}){const i=t?"HEAD":"GET";let s=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ve({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const i="POST",s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ve({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:s=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((h,c)=>h.concat(Object.keys(c)),[]);if(l.length>0){const h=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",h.join(","))}}return new ve({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new ve({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ve({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Zr="1.8.0",es={"X-Client-Info":`postgrest-js/${Zr}`};class wt{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},es),t),this.schemaName=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new Qr(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new wt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:i}={}){let s;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(s="HEAD",Object.entries(t).forEach(([h,c])=>{o.searchParams.append(h,`${c}`)})):(s="POST",a=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new ve({method:s,url:o,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}}var it,$t;function ts(){if($t)return it;$t=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return it=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),it}const rs="websocket",ss="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",is=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],ns="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",os=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],as="1.0.34",ls={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},cs="https://github.com/theturtle32/WebSocket-Node",hs={node:">=4.0.0"},us={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},ds={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},fs={verbose:!1},ps={test:"tape test/unit/*.js",gulp:"gulp"},gs="index",_s={lib:"./lib"},ms="lib/browser.js",ys="Apache-2.0",vs={name:rs,description:ss,keywords:is,author:ns,contributors:os,version:as,repository:ls,homepage:cs,engines:hs,dependencies:us,devDependencies:ds,config:fs,scripts:ps,main:gs,directories:_s,browser:ms,license:ys};var bs=vs.version,de;if(typeof globalThis=="object")de=globalThis;else try{de=ts()}catch{}finally{if(!de&&typeof window<"u"&&(de=window),!de)throw new Error("Could not determine global this")}var Ae=de.WebSocket||de.MozWebSocket,ws=bs;function ir(n,e){var t;return e?t=new Ae(n,e):t=new Ae(n),t}Ae&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(ir,n,{get:function(){return Ae[n]}})});var ks={w3cwebsocket:Ae?ir:null,version:ws};const Ts="2.7.3",Ss={"X-Client-Info":`realtime-js/${Ts}`},Es="1.0.0",nr=1e4,Os=1e3;var xe;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(xe||(xe={}));var V;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(V||(V={}));var ee;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(ee||(ee={}));var dt;(function(n){n.websocket="websocket"})(dt||(dt={}));var fe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(fe||(fe={}));class or{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class xs{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const l=r.decode(e.slice(o,o+s));o=o+s;const h=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:h}}}class nt{constructor(e,t,r={},i=nr){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var It;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(It||(It={}));class je{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=je.syncState(this.state,i,s,o),this.pendingDiffs.forEach(l=>{this.state=je.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=je.syncDiff(this.state,i,s,o),a())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const s=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(s,(h,c)=>{o[h]||(l[h]=c)}),this.map(o,(h,c)=>{const d=s[h];if(d){const p=c.map(b=>b.presence_ref),m=d.map(b=>b.presence_ref),_=c.filter(b=>m.indexOf(b.presence_ref)<0),g=d.filter(b=>p.indexOf(b.presence_ref)<0);_.length>0&&(a[h]=_),g.length>0&&(l[h]=g)}else a[h]=c}),this.syncDiff(s,{joins:a,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(a,l)=>{var h;const c=(h=e[a])!==null&&h!==void 0?h:[];if(e[a]=this.cloneDeep(l),c.length>0){const d=e[a].map(m=>m.presence_ref),p=c.filter(m=>d.indexOf(m.presence_ref)<0);e[a].unshift(...p)}r(a,c,l)}),this.map(o,(a,l)=>{let h=e[a];if(!h)return;const c=l.map(d=>d.presence_ref);h=h.filter(d=>c.indexOf(d.presence_ref)<0),e[a]=h,i(a,h,l),h.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var C;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(C||(C={}));const Dt=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,o)=>(s[o]=js(o,n,e,i),s),{})},js=(n,e,t,r)=>{const i=e.find(a=>a.name===n),s=i?.type,o=t[n];return s&&!r.includes(s)?ar(s,o):ft(o)},ar=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Ps(e,t)}switch(n){case C.bool:return As(e);case C.float4:case C.float8:case C.int2:case C.int4:case C.int8:case C.numeric:case C.oid:return Cs(e);case C.json:case C.jsonb:return Rs(e);case C.timestamp:return $s(e);case C.abstime:case C.date:case C.daterange:case C.int4range:case C.int8range:case C.money:case C.reltime:case C.text:case C.time:case C.timestamptz:case C.timetz:case C.tsrange:case C.tstzrange:return ft(e);default:return ft(e)}},ft=n=>n,As=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Cs=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Rs=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Ps=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let s;const o=n.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>ar(e,a))}return n},$s=n=>typeof n=="string"?n.replace(" ","T"):n;var Lt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})},Ut;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ut||(Ut={}));var Ft;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(Ft||(Ft={}));var Nt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Nt||(Nt={}));class kt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=V.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new nt(this,ee.join,this.params,this.timeout),this.rejoinTimer=new or(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=V.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=V.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ee.reply,{},(i,s)=>{this._trigger(this._replyEventName(s),i)}),this.presence=new je(this)}subscribe(e,t=this.timeout){var r,i;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));const a={},l={broadcast:s,presence:o,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{const d=this.bindings.postgres_changes,p=(c=d?.length)!==null&&c!==void 0?c:0,m=[];for(let _=0;_<p;_++){const g=d[_],{filter:{event:b,schema:j,table:U,filter:q}}=g,I=h&&h[_];if(I&&I.event===b&&I.schema===j&&I.table===U&&I.filter===q)m.push(Object.assign(Object.assign({},g),{id:I.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return Lt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return Lt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var i,s,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(s=(i=this.params)===null||i===void 0?void 0:i.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=V.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ee.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const i=new nt(this,ee.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new nt(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,s;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:h,join:c}=ee;if(r&&[a,l,h,c].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,t,r);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(m=>{var _,g,b;return((_=m.filter)===null||_===void 0?void 0:_.event)==="*"||((b=(g=m.filter)===null||g===void 0?void 0:g.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(m=>m.callback(p,r)):(s=this.bindings[o])===null||s===void 0||s.filter(m=>{var _,g,b,j,U,q;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in m){const I=m.id,R=(_=m.filter)===null||_===void 0?void 0:_.event;return I&&((g=t.ids)===null||g===void 0?void 0:g.includes(I))&&(R==="*"||R?.toLocaleLowerCase()===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const I=(U=(j=m?.filter)===null||j===void 0?void 0:j.event)===null||U===void 0?void 0:U.toLocaleLowerCase();return I==="*"||I===((q=t?.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===o}).map(m=>{if(typeof p=="object"&&"ids"in p){const _=p.data,{schema:g,table:b,commit_timestamp:j,type:U,errors:q}=_;p=Object.assign(Object.assign({},{schema:g,table:b,commit_timestamp:j,eventType:U,new:{},old:{},errors:q}),this._getPayloadRecords(_))}m.callback(p,r)})}_isClosed(){return this.state===V.closed}_isJoined(){return this.state===V.joined}_isJoining(){return this.state===V.joining}_isLeaving(){return this.state===V.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&kt.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ee.close,{},e)}_onError(e){this._on(ee.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=V.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Dt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Dt(e.columns,e.old_record)),t}}var ot=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Is=()=>{};class Ds{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Ss,this.params={},this.timeout=nr,this.transport=ks.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Is,this.conn=null,this.sendBuffer=[],this.serializer=new xs,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${dt.websocket}`,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.transport&&(this.transport=t.transport),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t?.params)===null||r===void 0?void 0:r.eventsPerSecond;i&&(this.eventsPerSecondLimitMs=Math.floor(1e3/i)),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t?.encode?t.encode:(s,o)=>o(JSON.stringify(s)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new or(()=>ot(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return ot(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return ot(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case xe.connecting:return fe.Connecting;case xe.open:return fe.Open;case xe.closing:return fe.Closing;default:return fe.Closed}}isConnected(){return this.connectionState()===fe.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new kt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:i,ref:s}=e;let o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};if(this.log("push",`${t} ${r} (${s})`,i),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(ee.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Es}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:s,ref:o}=t;(o&&o===this.pendingHeartbeatRef||i===s?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${i} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(i,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ee.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Os,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class Tt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function H(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ls extends Tt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Bt extends Tt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var lr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const cr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>lr(void 0,void 0,void 0,function*(){return yield(yield We(()=>Promise.resolve().then(()=>Xe),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Us=()=>lr(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield We(()=>Promise.resolve().then(()=>Xe),void 0)).Response:Response});var be=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const at=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Fs=(n,e)=>be(void 0,void 0,void 0,function*(){const t=yield Us();n instanceof t?n.json().then(r=>{e(new Ls(at(r),n.status||500))}).catch(r=>{e(new Bt(at(r),r))}):e(new Bt(at(n),n))}),Ns=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};function Ye(n,e,t,r,i,s){return be(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Ns(e,r,i,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Fs(l,a))})})}function pt(n,e,t,r){return be(this,void 0,void 0,function*(){return Ye(n,"GET",e,t,r)})}function ae(n,e,t,r,i){return be(this,void 0,void 0,function*(){return Ye(n,"POST",e,r,i,t)})}function Bs(n,e,t,r,i){return be(this,void 0,void 0,function*(){return Ye(n,"PUT",e,r,i,t)})}function hr(n,e,t,r,i){return be(this,void 0,void 0,function*(){return Ye(n,"DELETE",e,r,i,t)})}var X=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Ms={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Mt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Hs{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=cr(i)}uploadOrUpdate(e,t,r,i){return X(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},Mt),i),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl)):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(t),h=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:s,headers:a},o?.duplex?{duplex:o.duplex}:{}));return c.ok?{data:{path:l},error:null}:{data:null,error:yield c.json()}}catch(s){if(H(s))return{data:null,error:s};throw s}})}upload(e,t,r){return X(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return X(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const h=Object.assign({upsert:Mt.upsert},i),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",h.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",h.cacheControl)):(l=r,c["cache-control"]=`max-age=${h.cacheControl}`,c["content-type"]=h.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c});return d.ok?{data:{path:s},error:null}:{data:null,error:yield d.json()}}catch(l){if(H(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return X(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield ae(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),i=new URL(this.url+r.url),s=i.searchParams.get("token");if(!s)throw new Tt("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:s},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}})}update(e,t,r){return X(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return X(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}})}copy(e,t){return X(this,void 0,void 0,function*(){try{return{data:{path:(yield ae(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return X(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield ae(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(H(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return X(this,void 0,void 0,function*(){try{const i=yield ae(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(H(i))return{data:null,error:i};throw i}})}download(e,t){return X(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(t?.transform||{}),o=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield pt(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(H(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],s=t?.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&i.push(s);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&i.push(l);let h=i.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${h}`)}}}remove(e){return X(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}})}list(e,t,r){return X(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Ms),t),{prefix:e||""});return{data:yield ae(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(H(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const qs="2.5.1",Gs={"X-Client-Info":`storage-js/${qs}`};var _e=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};class zs{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Gs),t),this.fetch=cr(r)}listBuckets(){return _e(this,void 0,void 0,function*(){try{return{data:yield pt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(H(e))return{data:null,error:e};throw e}})}getBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield pt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return _e(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return _e(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}})}emptyBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield ae(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}})}}class Js extends zs{constructor(e,t={},r){super(e,t,r)}from(e){return new Hs(this.url,this.headers,e,this.fetch)}}const Ks="2.32.0",Vs={"X-Client-Info":`supabase-js/${Ks}`};var Ws=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Xs=n=>{let e;return n?e=n:typeof fetch>"u"?e=bt:e=fetch,(...t)=>e(...t)},Ys=()=>typeof Headers>"u"?vt.Headers:Headers,Qs=(n,e,t)=>{const r=Xs(t),i=Ys();return(s,o)=>Ws(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let h=new i(o?.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},o),{headers:h}))})};function Zs(n){return n.replace(/\/$/,"")}function ei(n,e){const{db:t,auth:r,realtime:i,global:s}=n,{db:o,auth:a,realtime:l,global:h}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},h),s)}}function ti(n){return Math.round(Date.now()/1e3)+n}function ri(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const se=()=>typeof document<"u",ue={tested:!1,writable:!1},Ke=()=>{if(!se())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ue.tested)return ue.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ue.tested=!0,ue.writable=!0}catch{ue.tested=!0,ue.writable=!1}return ue.writable};function lt(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const ur=n=>{let e;return n?e=n:typeof fetch>"u"?e=async(...t)=>await(await We(()=>Promise.resolve().then(()=>Xe),void 0)).fetch(...t):e=fetch,(...t)=>e(...t)},si=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Se=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Me=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ct=async(n,e)=>{await n.removeItem(e)};function ii(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,i,s,o,a,l,h,c=0;for(n=n.replace("-","+").replace("_","/");c<n.length;)o=e.indexOf(n.charAt(c++)),a=e.indexOf(n.charAt(c++)),l=e.indexOf(n.charAt(c++)),h=e.indexOf(n.charAt(c++)),r=o<<2|a>>4,i=(a&15)<<4|l>>2,s=(l&3)<<6|h,t=t+String.fromCharCode(r),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),h!=64&&s!=0&&(t=t+String.fromCharCode(s));return t}class Qe{constructor(){this.promise=new Qe.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Qe.promiseConstructor=Promise;function Ht(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ii(r))}async function dr(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function ni(n,e){return new Promise((r,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await n(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function oi(n){return("0"+n.toString(16)).substr(-2)}function He(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,oi).join("")}async function ai(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}function li(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qe(n){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=await ai(n);return li(e)}const ci="__stack_guard__",hi="__",ui=/__stack_guard__([a-zA-Z0-9_-]+)__/;let gt=!1,Ze,_t=!1;function Ee(n){var e,t;Ze();let r;try{throw new Error}catch(s){r=s}const i=(t=(e=r.stack)===null||e===void 0?void 0:e.split(`
`))!==null&&t!==void 0?t:[];for(let s=0;s<i.length;s+=1){const a=i[s].match(ui);if(a&&a[1]===n)return!0}return!1}async function Ve(n,e){await Ze();const t=`${ci}${n}${hi}`,r={[t]:async()=>await e()};return Object.assign(r[t],{displayName:t}),await r[t]()}async function qt(){return gt||await Ze(),_t}let Gt=!1;Ze=async()=>{gt||(gt=!0,await Ve("ENV_CHECK",async()=>{await dr(0);const n=Ee("ENV_CHECK");return _t=n,!n&&!Gt&&(Gt=!0,console.warn("@supabase/gotrue-js: Stack guards not supported in this environment. Generally not an issue but may point to a very conservative transpilation environment (use ES2017 or above) that implements async/await with generators, or this is a JavaScript engine that does not support async/await stack traces. Safari is known to not support stack guards.")),n}))};class St extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function T(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class di extends St{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function fi(n){return T(n)&&n.name==="AuthApiError"}class fr extends St{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class we extends St{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class me extends we{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class ht extends we{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Ge extends we{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class ze extends we{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zt extends we{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class mt extends we{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Jt(n){return T(n)&&n.name==="AuthRetryableFetchError"}var pi=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const Oe=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),gi=[502,503,504];async function Kt(n){if(!si(n))throw new mt(Oe(n),0);if(gi.includes(n.status))throw new mt(Oe(n),n.status);let e;try{e=await n.json()}catch(t){throw new fr(Oe(t),t)}throw new di(Oe(e),n.status||500)}const _i=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function E(n,e,t,r){var i;const s=Object.assign({},r?.headers);r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(i=r?.query)!==null&&i!==void 0?i:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await mi(n,e,t+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function mi(n,e,t,r,i,s){const o=_i(e,r,i,s);let a;try{a=await n(t,o)}catch(l){throw console.error(l),new mt(Oe(l),0)}if(a.ok||await Kt(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Kt(l)}}function oe(n){var e;let t=null;wi(n)&&(t=Object.assign({},n),t.expires_at=ti(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function le(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function yi(n){return{data:n,error:null}}function vi(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s}=n,o=pi(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:s},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function bi(n){return n}function wi(n){return n.access_token&&n.refresh_token&&n.expires_in}var ki=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class Ti{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=ur(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await E(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(T(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await E(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:le})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=ki(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r?.newEmail,delete i.newEmail),await E(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:vi,redirectTo:t?.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await E(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:le})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,s,o,a,l;try{const h={nextPage:null,lastPage:0,total:0},c=await E(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:bi});if(c.error)throw c.error;const d=await c.json(),p=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,m=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(_=>{const g=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(_.split(";")[1].split("=")[1]);h[`${b}Page`]=g}),h.total=parseInt(p)),{data:Object.assign(Object.assign({},d),h),error:null}}catch(h){if(T(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await E(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:le})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await E(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:le})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await E(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:le})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await E(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(T(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await E(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}}const pr="2.46.1",Si="http://localhost:9999",Ei="supabase.auth.token",Oi={"X-Client-Info":`gotrue-js/${pr}`},Vt=10,Wt={getItem:n=>Ke()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ke()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ke()&&globalThis.localStorage.removeItem(n)}};function xi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}xi();const ji={url:Si,storageKey:Ei,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Oi,flowType:"implicit",debug:!1},Je=30*1e3,Xt=3;async function Ai(n,e,t){return await t()}class Ce{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=Ce.nextInstanceID,Ce.nextInstanceID+=1,this.instanceID>0&&se()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},ji),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||Wt,this.admin=new Ti({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=ur(r.fetch),this.lock=r.lock||Ai,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===Wt&&!Ke()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),se()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} (${pr}) ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise?this.initializePromise:this._initialize()}async _initialize(){if(this.initializePromise)throw new Error("Double call of #_initialize()");return this.initializePromise=this._acquireLock(-1,async()=>await Ve("_initialize",async()=>{try{const e=se()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};const{session:i,redirectType:s}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",s),await this._saveSession(i),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return T(e)?{error:e}:{error:new fr("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}})),await this.initializePromise}async signUp(e){var t,r,i;try{await this._removeSession();let s;if("email"in e){const{email:c,password:d,options:p}=e;let m=null,_=null;if(this.flowType==="pkce"){const g=He();await Se(this.storage,`${this.storageKey}-code-verifier`,g),m=await qe(g),_=g===m?"plain":"s256"}s=await E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p?.emailRedirectTo,body:{email:c,password:d,data:(t=p?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:m,code_challenge_method:_},xform:oe})}else if("phone"in e){const{phone:c,password:d,options:p}=e;s=await E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(r=p?.data)!==null&&r!==void 0?r:{},channel:(i=p?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:oe})}else throw new Ge("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(s){if(T(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:s,password:o,options:a}=e;t=await E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:oe})}else if("phone"in e){const{phone:s,password:o,options:a}=e;t=await E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:oe})}else throw new Ge("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ht}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:i})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,s;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){const t=await Me(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:i}=await E(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:oe});return await ct(this.storage,`${this.storageKey}-code-verifier`),i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ht}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:i})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:i,access_token:s,nonce:o}=e,a=await E(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:oe}),{data:l,error:h}=a;return h?{data:{user:null,session:null},error:h}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ht}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:h})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,s,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:l}=e;let h=null,c=null;if(this.flowType==="pkce"){const p=He();await Se(this.storage,`${this.storageKey}-code-verifier`,p),h=await qe(p),c=p===h?"plain":"s256"}const{error:d}=await E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:c},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:h,error:c}=await E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:c}}throw new Ge("You must provide either an email or phone number.")}catch(a){if(T(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await E(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:oe});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,h=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{return await this._removeSession(),await E(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:yi})}catch(s){if(T(s))return{data:null,error:s};throw s}}async reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new me;const{error:i}=await E(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:s}=e,{error:o}=await E(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:i,options:s}=e,{data:o,error:a}=await E(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Ge("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return this._useSession(async e=>e)}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{return await qt()?Ee("_acquireLock")?(this._debug("#_acquireLock","recursive call"),await t()):await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{return await Ve("_acquireLock",async()=>await t())}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey)}}):(this._debug("#_acquireLock","Stack guards not supported, so exclusive locking is not performed as it can lead to deadlocks if the lock is attempted to be recursively acquired (as the recursion cannot be detected)."),await t())}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{if(Ee("_useSession")){this._debug("#_useSession","recursive call");const t=await this.__loadSession();return await e(t)}return await this._acquireLock(-1,async()=>await Ve("_useSession",async()=>{const t=await this.__loadSession();return await e(t)}))}finally{this._debug("#_useSession","end")}}async __loadSession(){if(this._debug("#__loadSession()","begin"),this.logDebugMessages&&!Ee("_useSession")&&await qt())throw new Error("Please use #_useSession()");Ee("_initialize")&&this._debug("#__loadSession","#_initialize recursion detected",new Error().stack),await this.initializePromise;try{let e=null;if(this.persistSession){const s=await Me(this.storage,this.storageKey);this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){try{return e?await E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:le}):await this._useSession(async t=>{var r,i;const{data:s,error:o}=t;if(o)throw o;return await E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:le})})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:s}=r;if(s)throw s;if(!i.session)throw new me;const o=i.session,{data:a,error:l}=await E(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:e,jwt:o.access_token,xform:le});if(l)throw l;return o.user=a.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Ht(e)}async setSession(e){try{if(!e.access_token||!e.refresh_token)throw new me;const t=Date.now()/1e3;let r=t,i=!0,s=null;const o=Ht(e.access_token);if(o.exp&&(r=o.exp,i=r<=t),i){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this.getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new me;const{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!se())throw new ze("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new ze("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new zt("Not a valid PKCE flow url.");const t=lt(window.location.href);if(e){if(!t.code)throw new zt("No code detected.");const{data:g,error:b}=await this.exchangeCodeForSession(t.code);if(b)throw b;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:g.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new ze(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:a,token_type:l}=t;if(!s||!a||!o||!l)throw new ze("No session defined in URL");const h=Math.round(Date.now()/1e3),c=parseInt(a),d=h+c,{data:p,error:m}=await this.getUser(s);if(m)throw m;const _={provider_token:r,provider_refresh_token:i,access_token:s,expires_in:c,expires_at:d,refresh_token:o,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:_,redirectType:t.type},error:null}}catch(t){if(T(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=lt(window.location.href);return!!(se()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=lt(window.location.href),t=await Me(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return{error:s};const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(fi(a)&&(a.status===404||a.status===401)))return{error:a}}return e!=="others"&&(await this._removeSession(),await ct(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=ri(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:s},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;if(this.flowType==="pkce"){const s=He();await Se(this.storage,`${this.storageKey}-code-verifier`,s),r=await qe(s),i=s===r?"plain":"s256"}try{return await E(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(T(s))return{data:null,error:s};throw s}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ni(async i=>(await dr(i*200),this._debug(t,"refreshing attempt",i),await E(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:oe})),(i,s,o)=>o&&o.error&&Jt(o.error)&&Date.now()+(i+1)*200-r<Je)}catch(r){if(this._debug(t,"error",r),T(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),se()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Me(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<i+Vt;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Vt}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Jt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new me;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Qe;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new me;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(i,"error",s),T(s)){const o={session:null,error:s};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){s.push(l)}});if(await Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),Se(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),this.persistSession?await ct(this.storage,this.storageKey):this.inMemorySession=null}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&se()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Je);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Je);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Je}ms, refresh threshold is ${Xt} ticks`),i<=Xt&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!se()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?setTimeout(async()=>{e||(await this.initializePromise,await this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()},0):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){const r=[`provider=${encodeURIComponent(e)}`];if(t?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t?.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const i=He();await Se(this.storage,`${this.storageKey}-code-verifier`,i);const s=await qe(i),o=i===s?"plain":"s256";this._debug("PKCE","code verifier",`${i.substring(0,5)}...`,"code challenge",s,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t?.queryParams){const i=new URLSearchParams(t.queryParams);r.push(i.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;return s?{data:null,error:s}:await E(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:s,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=await E(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(!((i=a?.totp)===null||i===void 0)&&i.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _verify(e){try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;if(s)return{data:null,error:s};const{data:o,error:a}=await E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _challenge(e){try{return await this._useSession(async t=>{var r;const{data:i,error:s}=t;return s?{data:null,error:s}:await E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],i=r.filter(s=>s.factor_type==="totp"&&s.status==="verified");return{data:{all:r,totp:i},error:null}}async _getAuthenticatorAssuranceLevel(){return await this._useSession(async e=>{var t,r;const{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(i.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const c=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:c},error:null}})}}Ce.nextInstanceID=0;globalThis&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class Ci extends Ce{constructor(e){super(e)}}var Ri=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{h(r.next(c))}catch(d){o(d)}}function l(c){try{h(r.throw(c))}catch(d){o(d)}}function h(c){c.done?s(c.value):i(c.value).then(a,l)}h((r=r.apply(n,e||[])).next())})};const Pi={headers:Vs},$i={schema:"public"},Ii={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Di={};class Li{constructor(e,t,r){var i,s,o,a,l,h,c,d;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const p=Zs(e);this.realtimeUrl=`${p}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${p}/auth/v1`,this.storageUrl=`${p}/storage/v1`,this.functionsUrl=`${p}/functions/v1`;const m=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,_={db:$i,realtime:Di,auth:Object.assign(Object.assign({},Ii),{storageKey:m}),global:Pi},g=ei(r??{},_);this.storageKey=(s=(i=g.auth)===null||i===void 0?void 0:i.storageKey)!==null&&s!==void 0?s:"",this.headers=(a=(o=g.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((l=g.auth)!==null&&l!==void 0?l:{},this.headers,(h=g.global)===null||h===void 0?void 0:h.fetch),this.fetch=Qs(t,this._getAccessToken.bind(this),(c=g.global)===null||c===void 0?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},g.realtime)),this.rest=new wt(`${p}/rest/v1`,{headers:this.headers,schema:(d=g.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Wr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Js(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ri(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:s,flowType:o,debug:a},l,h){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ci({url:this.authUrl,headers:Object.assign(Object.assign({},c),l),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:o,debug:a,fetch:h})}_initRealtimeClient(e){return new Ds(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ui=(n,e,t)=>new Li(n,e,t),Re=sr(void 0),Yt=sr(void 0);//!         [MAIN]
const et=Ui(mr,_r);et.auth.getSession().then(({data:{session:n}})=>{n?Re.set(n):Re.set(void 0)});et.auth.onAuthStateChange((n,e)=>{e?Re.set(e):Re.set(void 0)});Re.subscribe(async n=>{n?.user?.id?Yt.set(await Fi()):Yt.set(void 0)});const Fi=async()=>{try{return(await et.auth.getSession()).data.session?.user}catch{return}};function Qt(n){let e,t;return{c(){e=O("script"),this.h()},l(r){e=x(r,"SCRIPT",{src:!0});var i=F(e);i.forEach(P),this.h()},h(){$r(e.src,t=n[8])||v(e,"src",t),e.async=!0,e.defer=!0},m(r,i){Pe(r,e,i)},p:Zt,d(r){r&&P(e)}}}function Ni(n){let e,t="Register your KBVE Account!";return{c(){e=O("h1"),e.textContent=t,this.h()},l(r){e=x(r,"H1",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-1rn4tp3"&&(e.textContent=t),this.h()},h(){v(e,"class","text-xl font-bold leading-tight tracking-tight gradient-text md:text-2xl")},m(r,i){Pe(r,e,i)},p:Zt,d(r){r&&P(e)}}}function Bi(n){let e,t,r,i='<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 20"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.147 15.085a7.159 7.159 0 0 1-6.189 3.307A6.713 6.713 0 0 1 3.1 15.444c-2.679-4.513.287-8.737.888-9.548A4.373 4.373 0 0 0 5 1.608c1.287.953 6.445 3.218 5.537 10.5 1.5-1.122 2.706-3.01 2.853-6.14 1.433 1.049 3.993 5.395 1.757 9.117Z"></path></svg> <span class="sr-only">Fire icon</span>',s,o,a,l,h,c='<span class="sr-only">Close</span> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path></svg>',d,p;return{c(){e=O("h1"),t=O("div"),r=O("div"),r.innerHTML=i,s=B(),o=O("div"),a=er(n[6]),l=B(),h=O("button"),h.innerHTML=c,this.h()},l(m){e=x(m,"H1",{});var _=F(e);t=x(_,"DIV",{id:!0,class:!0,role:!0});var g=F(t);r=x(g,"DIV",{class:!0,"data-svelte-h":!0}),te(r)!=="svelte-5am7pi"&&(r.innerHTML=i),s=M(g),o=x(g,"DIV",{class:!0});var b=F(o);a=tr(b,n[6]),b.forEach(P),l=M(g),h=x(g,"BUTTON",{type:!0,class:!0,"data-dismiss-target":!0,"aria-label":!0,"data-svelte-h":!0}),te(h)!=="svelte-1gk004k"&&(h.innerHTML=c),g.forEach(P),_.forEach(P),this.h()},h(){v(r,"class","inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-blue-500 bg-blue-100 rounded-lg dark:bg-blue-800 dark:text-blue-200"),v(o,"class","ml-3 text-sm font-normal capitalize"),v(h,"type","button"),v(h,"class","ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700"),v(h,"data-dismiss-target","#toast-default"),v(h,"aria-label","Close"),v(t,"id","toast-default"),v(t,"class","flex items-center w-full max-w-xs p-4 bg-offset rounded-lg shadow dark:text-gray-400 dark:bg-gray-800"),v(t,"role","alert")},m(m,_){Pe(m,e,_),w(e,t),w(t,r),w(t,s),w(t,o),w(o,a),w(t,l),w(t,h),d||(p=ye(h,"click",n[9]),d=!0)},p(m,_){_[0]&64&&rr(a,m[6])},d(m){m&&P(e),d=!1,p()}}}function Mi(n){let e,t,r,i='<img class="w-32 mr-2" src="https://kbve.com/assets/img/letter_logo.svg" alt="logo"/>',s,o,a,l,h,c,d,p,m="Your email",_,g,b,j,U,q="Your Username",I,R,W,G,D,Y="Password",ie,A,ce,z,u,f="Confirm Password",k,S,$,y,Q,J,pe='<div class="flex items-start"></div> <a href="/account/recovery" class="text-sm font-medium text-secondary hover:underline dark:text-primary-500">Forgot password?</a>',tt,re,ke,Te=n[1]?"Loading":"Login",$e,rt,he,Et='Have an account yet? <a href="/account/login" class="font-medium text-primary-600 hover:underline dark:text-primary-500">Login!</a>',st,Ot;function xt(L,K){return L[6]?Bi:Ni}let Ie=xt(n),Z=Ie(n);return{c(){e=O("section"),t=O("div"),r=O("a"),r.innerHTML=i,s=B(),o=O("div"),a=O("div"),l=O("div"),Z.c(),h=B(),c=O("form"),d=O("div"),p=O("label"),p.textContent=m,_=B(),g=O("input"),b=B(),j=O("div"),U=O("label"),U.textContent=q,I=B(),R=O("input"),W=B(),G=O("div"),D=O("label"),D.textContent=Y,ie=B(),A=O("input"),ce=B(),z=O("div"),u=O("label"),u.textContent=f,k=B(),S=O("input"),$=B(),y=O("div"),Q=B(),J=O("div"),J.innerHTML=pe,tt=B(),re=O("button"),ke=O("span"),$e=er(Te),rt=B(),he=O("p"),he.innerHTML=Et,this.h()},l(L){e=x(L,"SECTION",{class:!0});var K=F(e);t=x(K,"DIV",{class:!0});var De=F(t);r=x(De,"A",{href:!0,class:!0,"data-svelte-h":!0}),te(r)!=="svelte-j5g76x"&&(r.innerHTML=i),s=M(De),o=x(De,"DIV",{class:!0});var jt=F(o);a=x(jt,"DIV",{class:!0});var Le=F(a);l=x(Le,"DIV",{class:!0});var At=F(l);Z.l(At),At.forEach(P),h=M(Le),c=x(Le,"FORM",{class:!0,action:!0});var N=F(c);d=x(N,"DIV",{});var Ue=F(d);p=x(Ue,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(p)!=="svelte-1avffmu"&&(p.textContent=m),_=M(Ue),g=x(Ue,"INPUT",{type:!0,name:!0,id:!0,class:!0,placeholder:!0}),Ue.forEach(P),b=M(N),j=x(N,"DIV",{});var Fe=F(j);U=x(Fe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(U)!=="svelte-15wap3a"&&(U.textContent=q),I=M(Fe),R=x(Fe,"INPUT",{type:!0,name:!0,id:!0,class:!0,placeholder:!0}),Fe.forEach(P),W=M(N),G=x(N,"DIV",{});var Ne=F(G);D=x(Ne,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(D)!=="svelte-1jjewb5"&&(D.textContent=Y),ie=M(Ne),A=x(Ne,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,class:!0}),Ne.forEach(P),ce=M(N),z=x(N,"DIV",{});var Be=F(z);u=x(Be,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(u)!=="svelte-1hztx1h"&&(u.textContent=f),k=M(Be),S=x(Be,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,class:!0}),Be.forEach(P),$=M(N),y=x(N,"DIV",{id:!0,class:!0}),F(y).forEach(P),Q=M(N),J=x(N,"DIV",{class:!0,"data-svelte-h":!0}),te(J)!=="svelte-16lot9q"&&(J.innerHTML=pe),tt=M(N),re=x(N,"BUTTON",{type:!0,class:!0});var Ct=F(re);ke=x(Ct,"SPAN",{});var Rt=F(ke);$e=tr(Rt,Te),Rt.forEach(P),Ct.forEach(P),rt=M(N),he=x(N,"P",{class:!0,"data-svelte-h":!0}),te(he)!=="svelte-154mv0h"&&(he.innerHTML=Et),N.forEach(P),Le.forEach(P),jt.forEach(P),De.forEach(P),K.forEach(P),this.h()},h(){v(r,"href","/#"),v(r,"class","flex items-center mb-6"),v(l,"class","min-h-[100px]"),v(p,"for","email"),v(p,"class","block mb-2 text-sm font-medium"),v(g,"type","email"),v(g,"name","email"),v(g,"id","email"),v(g,"class","bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),v(g,"placeholder","name@company.com"),g.required=!0,v(U,"for","username"),v(U,"class","block mb-2 text-sm font-medium"),v(R,"type","text"),v(R,"name","username"),v(R,"id","username"),v(R,"class","bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),v(R,"placeholder","Username-chan"),R.required=!0,v(D,"for","password"),v(D,"class","block mb-2 text-sm font-medium"),v(A,"type","password"),v(A,"name","password"),v(A,"id","password"),v(A,"placeholder","••••••••"),v(A,"class","bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),A.required=!0,v(u,"for","password"),v(u,"class","block mb-2 text-sm font-medium"),v(S,"type","password"),v(S,"name","confirm"),v(S,"id","confirm"),v(S,"placeholder","••••••••"),v(S,"class","bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),S.required=!0,v(y,"id","h-captcha-"+n[7]),v(y,"class","flex justify-center"),v(J,"class","flex items-center justify-between"),v(re,"type","submit"),v(re,"class","w-full bg-secondary hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"),re.disabled=n[1],v(he,"class","text-sm font-light text-primary"),v(c,"class","space-y-4 md:space-y-6"),v(c,"action","#"),v(a,"class","p-6 space-y-4 md:space-y-6 sm:p-8"),v(o,"class","w-full bg-transparent rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0"),v(t,"class","flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0"),v(e,"class","")},m(L,K){Pe(L,e,K),w(e,t),w(t,r),w(t,s),w(t,o),w(o,a),w(a,l),Z.m(l,null),w(a,h),w(a,c),w(c,d),w(d,p),w(d,_),w(d,g),ne(g,n[3]),w(c,b),w(c,j),w(j,U),w(j,I),w(j,R),ne(R,n[2]),w(c,W),w(c,G),w(G,D),w(G,ie),w(G,A),ne(A,n[5]),w(c,ce),w(c,z),w(z,u),w(z,k),w(z,S),ne(S,n[4]),w(c,$),w(c,y),w(c,Q),w(c,J),w(c,tt),w(c,re),w(re,ke),w(ke,$e),w(c,rt),w(c,he),st||(Ot=[ye(g,"input",n[21]),ye(R,"input",n[22]),ye(A,"input",n[23]),ye(S,"input",n[24]),ye(c,"submit",Ir(n[10]))],st=!0)},p(L,K){Ie===(Ie=xt(L))&&Z?Z.p(L,K):(Z.d(1),Z=Ie(L),Z&&(Z.c(),Z.m(l,null))),K[0]&8&&g.value!==L[3]&&ne(g,L[3]),K[0]&4&&R.value!==L[2]&&ne(R,L[2]),K[0]&32&&A.value!==L[5]&&ne(A,L[5]),K[0]&16&&S.value!==L[4]&&ne(S,L[4]),K[0]&2&&Te!==(Te=L[1]?"Loading":"Login")&&rr($e,Te),K[0]&2&&(re.disabled=L[1])},d(L){L&&P(e),Z.d(),st=!1,Dr(Ot)}}}function Hi(n){let e,t,r,i,s=n[0]&&!window?.hcaptcha&&Qt(n);return r=new wr({props:{background:"https://images.unsplash.com/photo-1597851065532-055f97d12e47?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",$$slots:{default:[Mi]},$$scope:{ctx:n}}}),{c(){s&&s.c(),e=Pt(),t=B(),kr(r.$$.fragment)},l(o){const a=Tr("svelte-1fvsnp3",document.head);s&&s.l(a),e=Pt(),a.forEach(P),t=M(o),Sr(r.$$.fragment,o)},m(o,a){s&&s.m(document.head,null),w(document.head,e),Pe(o,t,a),Er(r,o,a),i=!0},p(o,a){o[0]&&!window?.hcaptcha?s?s.p(o,a):(s=Qt(o),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null);const l={};a[0]&126|a[1]&4&&(l.$$scope={dirty:a,ctx:o}),r.$set(l)},i(o){i||(Or(r.$$.fragment,o),i=!0)},o(o){xr(r.$$.fragment,o),i=!1},d(o){o&&P(t),s&&s.d(o),P(e),jr(r,o)}}}var gr=(n=>(n.DARK="dark",n.LIGHT="light",n))(gr||{});function qi(n,e,t){let r;Ar(n,Nr,y=>t(6,r=y));const i=Cr();let{sitekey:s=Lr}=e,{apihost:o=Ur}=e,{hl:a=""}=e,{reCaptchaCompat:l=!1}=e,{theme:h=gr.DARK}=e,{size:c="compact"}=e;const d=()=>{_&&g&&b&&hcaptcha.reset(b)},p=y=>{if(_&&g&&b)return hcaptcha.execute(b,y)},m=Math.floor(Math.random()*100);let _=!1,g=!1,b,j;const U=new URLSearchParams({recaptchacompat:l?"on":"off",onload:"hcaptchaOnLoad",render:"explicit"}),q=`${o}?${U.toString()}`;Rr(()=>{s||t(11,s=window.sitekey),window.hcaptchaOnLoad=()=>{i("load"),t(19,g=!0)},window.onSuccess=y=>{i("success",{token:y}),ie=y},window.onError=()=>{i("error")},window.onClose=()=>{i("close")},window.onExpired=()=>{i("expired"),d()},i("mount"),t(0,_=!0)}),Pr(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,g&&(hcaptcha=null)});let I=new RegExp(/^[a-z0-9]+$/i),R=!1,W="",G="",D="",Y="",ie="";const A=async()=>{ge("")},ce=()=>W.length<8?(ge("username has to be 8 or more characters"),d(),!1):I.test(W)?D!=Y?(ge("passwords do not match"),d(),!1):Y.length<8?(ge("password has to be at least 8 characters or stronger "),d(),!1):!0:(ge("username has to be alpha-numeric a-Z and 0-9 only "),d(),!1),z=async()=>{ce()&&u()},u=async()=>{try{t(1,R=!0);const{data:y,error:Q}=await et.auth.signUp({email:G,password:Y,options:{captchaToken:ie,data:{username:W}}});if(Q)throw Q;location.assign("/account/profile")}catch(y){y instanceof Error&&(Fr(y.message),ge(y.message))}finally{t(1,R=!1)}};function f(){G=this.value,t(3,G)}function k(){W=this.value,t(2,W)}function S(){Y=this.value,t(5,Y)}function $(){D=this.value,t(4,D)}return n.$$set=y=>{"sitekey"in y&&t(11,s=y.sitekey),"apihost"in y&&t(12,o=y.apihost),"hl"in y&&t(13,a=y.hl),"reCaptchaCompat"in y&&t(14,l=y.reCaptchaCompat),"theme"in y&&t(15,h=y.theme),"size"in y&&t(16,c=y.size)},n.$$.update=()=>{n.$$.dirty[0]&1681409&&_&&g&&(b=hcaptcha.render(`h-captcha-${m}`,{sitekey:s,hl:a,theme:h,callback:"onSuccess","error-callback":"onError","close-callback":"onClose","expired-callback":"onExpired",size:c}),t(20,j=window.document.getElementById("skeleton")),j&&j.remove())},[_,R,W,G,D,Y,r,m,q,A,z,s,o,a,l,h,c,d,p,g,j,f,k,S,$]}class Vi extends yr{constructor(e){super(),vr(this,e,qi,Hi,br,{sitekey:11,apihost:12,hl:13,reCaptchaCompat:14,theme:15,size:16,reset:17,execute:18},null,[-1,-1])}get reset(){return this.$$.ctx[17]}get execute(){return this.$$.ctx[18]}}export{Vi as default};
