import{p as Q,d as B,s as X,D as H,a as Z,S as j,b as F,c as I}from"./styles-f626f8de.1153f6a1.js";import{G as tt}from"./layout.ed770cd8.js";import{l,c as g,h as x,u as et,i as ot,j as w}from"./mermaid.core.1c8e99f2.js";import{r as st}from"./index-4c4adb72.98423bc4.js";import"./purify.es.0c4a0514.js";import"./preload-helper.cf010ec4.js";import"./_commonjsHelpers.725317a4.js";import"./edges-b00f0ec2.c7621506.js";import"./createText-285e50b4.05980229.js";import"./svgDraw-5d8a058e.a447c9ce.js";import"./line.531991ab.js";import"./array.9f3ba611.js";import"./path.53f90ab3.js";const A="rect",C="rectWithTitle",nt="start",ct="end",it="divider",rt="roundedWithTitle",lt="note",at="noteGroup",_="statediagram",dt="state",Et=`${_}-${dt}`,U="transition",St="note",pt="note-edge",Tt=`${U} ${pt}`,_t=`${_}-${St}`,ut="cluster",Dt=`${_}-${ut}`,ft="cluster-alt",bt=`${_}-${ft}`,V="parent",Y="note",ht="state",N="----",At=`${N}${Y}`,M=`${N}${V}`,W="fill:none",m="fill: #333",z="c",q="text",K="normal";let y={},E=0;const yt=function(t){const e=Object.keys(t);for(const s of e)t[s]},gt=function(t,e){l.trace("Extracting classes"),e.db.clear();try{return e.parser.parse(t),e.db.extract(e.db.getRootDocV2()),e.db.getClasses()}catch(t){return t}};function $t(t){return null==t?"":t.classes?t.classes.join(" "):""}function R(t="",e=0,s="",o=N){const a=null!==s&&s.length>0?`${o}${s}`:"";return`${ht}-${t}${a}-${e}`}const h=(t,e,s,o,a,r)=>{const i=s.id,n=$t(o[i]);if("root"!==i){let e=A;!0===s.start&&(e=nt),!1===s.start&&(e=ct),s.type!==H&&(e=s.type),y[i]||(y[i]={id:i,shape:e,description:w.sanitizeText(i,g()),classes:`${n} ${Et}`});const o=y[i];s.description&&(Array.isArray(o.description)?(o.shape=C,o.description.push(s.description)):o.description.length>0?(o.shape=C,o.description===i?o.description=[s.description]:o.description=[o.description,s.description]):(o.shape=A,o.description=s.description),o.description=w.sanitizeTextOrArray(o.description,g())),1===o.description.length&&o.shape===C&&(o.shape=A),!o.type&&s.doc&&(l.info("Setting cluster for ",i,G(s)),o.type="group",o.dir=G(s),o.shape=s.type===Z?it:rt,o.classes=o.classes+" "+Dt+" "+(r?bt:""));const a={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:i,dir:o.dir,domId:R(i,E),type:o.type,padding:15,centerLabel:!0};if(s.note){const e={labelStyle:"",shape:lt,labelText:s.note.text,classes:_t,style:"",id:i+At+"-"+E,domId:R(i,E,Y),type:o.type,padding:15},r={labelStyle:"",shape:at,labelText:s.note.text,classes:o.classes,style:"",id:i+M,domId:R(i,E,V),type:"group",padding:0};E++;const n=i+M;t.setNode(n,r),t.setNode(e.id,e),t.setNode(i,a),t.setParent(i,n),t.setParent(e.id,n);let d=i,c=e.id;"left of"===s.note.position&&(d=e.id,c=i),t.setEdge(d,c,{arrowhead:"none",arrowType:"",style:W,labelStyle:"",classes:Tt,arrowheadStyle:m,labelpos:z,labelType:q,thickness:K})}else t.setNode(i,a)}e&&"root"!==e.id&&(l.trace("Setting node ",i," to be child of its parent ",e.id),t.setParent(i,e.id)),s.doc&&(l.trace("Adding nodes children "),xt(t,s,s.doc,o,a,!r))},xt=(t,e,s,o,a,r)=>{l.trace("items",s),s.forEach((s=>{switch(s.stmt){case F:case H:h(t,e,s,o,a,r);break;case j:{h(t,e,s.state1,o,a,r),h(t,e,s.state2,o,a,r);const i={id:"edge"+E,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:W,labelStyle:"",label:w.sanitizeText(s.description,g()),arrowheadStyle:m,labelpos:z,labelType:q,thickness:K,classes:U};t.setEdge(s.state1.id,s.state2.id,i,E),E++}}}))},G=(t,e=I)=>{let s=e;if(t.doc)for(let e=0;e<t.doc.length;e++){const o=t.doc[e];"dir"===o.stmt&&(s=o.value)}return s},Ct=async function(t,e,s,o){l.info("Drawing state diagram (v2)",e),y={},o.db.getDirection();const{securityLevel:a,state:r}=g(),i=r.nodeSpacing||50,n=r.rankSpacing||50;l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),l.info(o.db.getRootDocV2());const d=o.db.getStates(),c=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:G(o.db.getRootDocV2()),nodesep:i,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let p;h(c,void 0,o.db.getRootDocV2(),d,o.db,!0),"sandbox"===a&&(p=x("#i"+e));const b=x("sandbox"===a?p.nodes()[0].contentDocument.body:"body"),m=b.select(`[id="${e}"]`),f=b.select("#"+e+" g");await st(f,c,["barb"],_,e);et.insertTitle(m,"statediagramTitleText",r.titleTopMargin,o.db.getDiagramTitle());const u=m.node().getBBox(),$=u.width+16,w=u.height+16;m.attr("class",_);const T=m.node().getBBox();ot(m,w,$,r.useMaxWidth);const j=`${T.x-8} ${T.y-8} ${$} ${w}`;l.debug(`viewBox ${j}`),m.attr("viewBox",j);const E=document.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const t of E){const e=t.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg",A);s.setAttribute("rx",0),s.setAttribute("ry",0),s.setAttribute("width",e.width),s.setAttribute("height",e.height),t.insertBefore(s,t.firstChild)}},Rt={setConf:yt,getClasses:gt,draw:Ct},Yt={parser:Q,db:B,renderer:Rt,styles:X,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,B.clear()}};export{Yt as diagram};