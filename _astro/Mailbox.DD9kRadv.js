import{r as n,j as e}from"./react.CvslfkeK.js";import{u as h}from"./@nanostores.J-Z5GVtw.js";import{u as f}from"./userstate.CoPpB5mD.js";import{s as b}from"./supabaseClient.CVZbm2yK.js";import{R as j,S as o,I as x,M as y}from"./lucide-react.CRoChsBw.js";import"./@react-three.B-wTPXHf.js";import"./nanostores.Bo9-_MAV.js";import"./@supabase.F_L0RkYn.js";import"./Page.astro_astro_type_script_index_0_lang.CHoS6oJr.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";async function c(){const{data:t,error:s}=await b.rpc("proxy_fetch_user_messages");return s?(console.error("[fetchUserMessages] RPC Error:",s),[]):t}const g=[{key:"all",label:"All",icon:e.jsx(y,{size:18})},{key:"sent",label:"Sent",icon:e.jsx(o,{size:18})},{key:"received",label:"Received",icon:e.jsx(x,{size:18})}],A=()=>{const t=h(f),[s,i]=n.useState([]),[m,l]=n.useState(!0),[a,u]=n.useState("all");n.useEffect(()=>{l(!0),c().then(r=>{i(r||[]),l(!1)})},[]);const d=n.useMemo(()=>a==="all"?s:a==="sent"?s.filter(r=>r.sender===t):a==="received"?s.filter(r=>r.receiver===t):s,[s,a,t]);return e.jsxs("div",{className:"w-full max-w-3xl mx-auto mt-8",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[g.map(r=>e.jsxs("button",{className:`flex items-center gap-1 px-4 py-2 rounded-lg font-medium border transition ${a===r.key?"bg-cyan-600 text-white border-cyan-700":"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 border-neutral-300 dark:border-neutral-700 hover:bg-cyan-100 dark:hover:bg-cyan-900"}`,onClick:()=>u(r.key),children:[r.icon," ",r.label]},r.key)),e.jsx("button",{className:"ml-auto flex items-center gap-1 px-3 py-2 rounded-lg border border-cyan-400 text-cyan-700 dark:text-cyan-200 bg-cyan-50 dark:bg-cyan-900 hover:bg-cyan-100 dark:hover:bg-cyan-800 transition",onClick:async()=>{l(!0),i(await c()),l(!1)},title:"Refresh",children:e.jsx(j,{size:16})})]}),e.jsx("div",{className:"bg-white dark:bg-neutral-900 rounded-xl shadow border border-neutral-200 dark:border-neutral-800 p-4 min-h-[300px]",children:m?e.jsx("div",{className:"text-center text-neutral-500 dark:text-neutral-400 py-12",children:"Loading messages..."}):d.length===0?e.jsx("div",{className:"text-center text-neutral-500 dark:text-neutral-400 py-12",children:"No messages found."}):e.jsx("ul",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:d.map((r,p)=>e.jsxs("li",{className:"py-4 flex items-start gap-4",children:[e.jsx("span",{className:`mt-1 ${r.sender===t?"text-cyan-500":"text-yellow-500"}`,children:r.sender===t?e.jsx(o,{size:20}):e.jsx(x,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-neutral-800 dark:text-neutral-100",children:r.title}),e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(r.created_at).toLocaleString()})]}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 mt-1",children:r.message}),e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:r.sender===t?e.jsxs(e.Fragment,{children:["To: ",e.jsx("span",{className:"font-medium",children:r.receiver_username||r.receiver})]}):e.jsxs(e.Fragment,{children:["From: ",e.jsx("span",{className:"font-medium",children:r.sender_username||r.sender})]})})]})]},r.id||p))})})]})};export{A as Mailbox};
