import{G as ye,M as ke,b as Ce,C as De,B as Te,c as Me,d as Ae,V as Le,S as Re,e as Ee,T as Se,f as Fe,L as ze,g as Be,Q as Ie,h as Ue,i as Ve}from"./three.BmISNF3o.js";import{g as Ge}from"./ngraph.graph.B_kgC_3e.js";import{f as He}from"./ngraph.forcelayout.eT2I1L7B.js";import{i as Ne}from"./kapsule.DoQQNCoE.js";import{i as w}from"./accessor-fn.C9ws9bwr.js";import{v as We}from"./data-joint.qYY_m3_J.js";import{t as ve}from"./tinycolor2.Begke6kS.js";import{o as $e}from"./d3-scale.Btia-9_0.js";import{s as Ke}from"./d3-scale-chromatic.BvAsqZ2o.js";import{m as qe,a as Qe}from"./d3-array.tv6RD-6E.js";import{f as Je,a as Xe,b as Ye,c as Ze,d as er}from"./d3-force-3d.CDnzDXUk.js";import{g as rr}from"./@react-three.DzcfnNYH.js";function te(r,e){(e==null||e>r.length)&&(e=r.length);for(var n=0,t=Array(e);n<e;n++)t[n]=r[n];return t}function nr(r){if(Array.isArray(r))return r}function tr(r){if(Array.isArray(r))return te(r)}function or(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ar(r,e,n){return e=Y(e),yr(r,le()?Reflect.construct(e,n||[],Y(r).constructor):e.apply(r,n))}function ir(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ur(r,e,n){if(le())return Reflect.construct.apply(null,arguments);var t=[null];t.push.apply(t,e);var p=new(r.bind.apply(r,t));return p}function lr(r,e,n){return Object.defineProperty(r,"prototype",{writable:!1}),r}function ue(r,e,n){return(e=mr(e))in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function Y(r){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(r)}function cr(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&oe(r,e)}function le(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(le=function(){return!!r})()}function fr(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function dr(r,e){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var t,p,g,y,b=[],P=!0,s=!1;try{if(g=(n=n.call(r)).next,e!==0)for(;!(P=(t=g.call(n)).done)&&(b.push(t.value),b.length!==e);P=!0);}catch(T){s=!0,p=T}finally{try{if(!P&&n.return!=null&&(y=n.return(),Object(y)!==y))return}finally{if(s)throw p}}return b}}function pr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function de(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),n.push.apply(n,t)}return n}function me(r){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?de(Object(n),!0).forEach(function(t){ue(r,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))})}return r}function hr(r,e){if(r==null)return{};var n,t,p=gr(r,e);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(r);for(t=0;t<g.length;t++)n=g[t],e.includes(n)||{}.propertyIsEnumerable.call(r,n)&&(p[n]=r[n])}return p}function gr(r,e){if(r==null)return{};var n={};for(var t in r)if({}.hasOwnProperty.call(r,t)){if(e.includes(t))continue;n[t]=r[t]}return n}function yr(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return or(r)}function oe(r,e){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},oe(r,e)}function pe(r,e){return nr(r)||dr(r,e)||be(r,e)||pr()}function U(r){return tr(r)||fr(r)||be(r)||sr()}function vr(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function mr(r){var e=vr(r,"string");return typeof e=="symbol"?e:e+""}function ae(r){"@babel/helpers - typeof";return ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(r)}function be(r,e){if(r){if(typeof r=="string")return te(r,e);var n={}.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(r,e):void 0}}var Oe=function(e){e instanceof Array?e.forEach(Oe):(e.map&&e.map.dispose(),e.dispose())},_e=function(e){e.geometry&&e.geometry.dispose(),e.material&&Oe(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(_e)},ie=function(e){for(;e.children.length;){var n=e.children[0];e.remove(n),_e(n)}},br=["objFilter"];function q(r,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=n.objFilter,p=t===void 0?function(){return!0}:t,g=hr(n,br);return We(r,e.children.filter(p),function(y){return e.add(y)},function(y){e.remove(y),ie(y)},me({objBindAttr:"__threeObj"},g))}var Q=function(e){return isNaN(e)?parseInt(ve(e).toHex(),16):e},ne=function(e){return isNaN(e)?ve(e).getAlpha():1},Or=$e(Ke);function se(r,e,n){!e||typeof n!="string"||r.filter(function(t){return!t[n]}).forEach(function(t){t[n]=Or(e(t))})}function _r(r,e){var n=r.nodes,t=r.links,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},g=p.nodeFilter,y=g===void 0?function(){return!0}:g,b=p.onLoopError,P=b===void 0?function(l){throw"Invalid DAG structure! Found cycle in node path: ".concat(l.join(" -> "),".")}:b,s={};n.forEach(function(l){return s[e(l)]={data:l,out:[],depth:-1,skip:!y(l)}}),t.forEach(function(l){var v=l.source,f=l.target,a=i(v),_=i(f);if(!s.hasOwnProperty(a))throw"Missing source node with id: ".concat(a);if(!s.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var k=s[a],C=s[_];k.out.push(C);function i(O){return ae(O)==="object"?e(O):O}});var T=[];c(Object.values(s));var L=Object.assign.apply(Object,[{}].concat(U(Object.entries(s).filter(function(l){var v=pe(l,2),f=v[1];return!f.skip}).map(function(l){var v=pe(l,2),f=v[0],a=v[1];return ue({},f,a.depth)}))));return L;function c(l){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=function(){var i=l[_];if(v.indexOf(i)!==-1){var O=[].concat(U(v.slice(v.indexOf(i))),[i]).map(function(R){return e(R.data)});return T.some(function(R){return R.length===O.length&&R.every(function(z,x){return z===O[x]})})||(T.push(O),P(O)),1}f>i.depth&&(i.depth=f,c(i.out,[].concat(U(v),[i]),f+(i.skip?0:1)))},_=0,k=l.length;_<k;_++)a()}}var u=window.THREE?window.THREE:{Group:ye,Mesh:ke,MeshLambertMaterial:Ce,Color:De,BufferGeometry:Te,BufferAttribute:Me,Matrix4:Ae,Vector3:Le,SphereGeometry:Re,CylinderGeometry:Ee,TubeGeometry:Se,ConeGeometry:Fe,Line:ze,LineBasicMaterial:Be,QuadraticBezierCurve3:Ie,CubicBezierCurve3:Ue,Box3:Ve},he={graph:Ge,forcelayout:He},wr=2,ge=new u.BufferGeometry().setAttribute?"setAttribute":"addAttribute",X=new u.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",jr=Ne({props:{jsonUrl:{onChange:function(e,n){var t=this;e&&!n.fetchingJson&&(n.fetchingJson=!0,n.onLoading(),fetch(e).then(function(p){return p.json()}).then(function(p){n.fetchingJson=!1,n.onFinishLoading(p),t.graphData(p)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,n){n.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,n){var t=n.d3ForceLayout.force("charge");t&&t.strength(e>2?-60:-30),e<3&&p(n.graphData.nodes,"z"),e<2&&p(n.graphData.nodes,"y");function p(g,y){g.forEach(function(b){delete b[y],delete b["v".concat(y)]})}}},dagMode:{onChange:function(e,n){!e&&n.forceEngine==="d3"&&(n.graphData.nodes||[]).forEach(function(t){return t.fx=t.fy=t.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,n){n.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,n){n.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,n){n.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,n,t){return t===void 0?e.d3ForceLayout.force(n):(e.d3ForceLayout.force(n,t),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var n=e.forceEngine!=="ngraph";return e.engineRunning&&t(),p(),g(),this;function t(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||n&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[n?"tick":"step"](),e.onEngineTick());var y=w(e.nodeThreeObjectExtend);e.graphData.nodes.forEach(function(c){var l=c.__threeObj;if(l){var v=n?c:e.layout.getNodePosition(c[e.nodeId]),f=y(c);(!e.nodePositionUpdate||!e.nodePositionUpdate(f?l.children[0]:l,{x:v.x,y:v.y,z:v.z},c)||f)&&(l.position.x=v.x,l.position.y=v.y||0,l.position.z=v.z||0)}});var b=w(e.linkWidth),P=w(e.linkCurvature),s=w(e.linkCurveRotation),T=w(e.linkThreeObjectExtend);e.graphData.links.forEach(function(c){var l=c.__lineObj;if(l){var v=n?c:e.layout.getLinkPosition(e.layout.graph.getLink(c.source,c.target).id),f=v[n?"source":"from"],a=v[n?"target":"to"];if(!(!f||!a||!f.hasOwnProperty("x")||!a.hasOwnProperty("x"))){L(c);var _=T(c);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(_?l.children[1]:l,{start:{x:f.x,y:f.y,z:f.z},end:{x:a.x,y:a.y,z:a.z}},c)&&!_)){var k=30,C=c.__curve,i=l.children.length?l.children[0]:l;if(i.type==="Line"){if(C)i.geometry.setFromPoints(C.getPoints(k));else{var O=i.geometry.getAttribute("position");(!O||!O.array||O.array.length!==6)&&i.geometry[ge]("position",O=new u.BufferAttribute(new Float32Array(2*3),3)),O.array[0]=f.x,O.array[1]=f.y||0,O.array[2]=f.z||0,O.array[3]=a.x,O.array[4]=a.y||0,O.array[5]=a.z||0,O.needsUpdate=!0}i.geometry.computeBoundingSphere()}else if(i.type==="Mesh")if(C){i.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1));var B=Math.ceil(b(c)*10)/10,V=B/2,$=new u.TubeGeometry(C,k,V,e.linkResolution,!1);i.geometry.dispose(),i.geometry=$}else{if(!i.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var R=Math.ceil(b(c)*10)/10,z=R/2,x=new u.CylinderGeometry(z,z,1,e.linkResolution,1,!1);x[X](new u.Matrix4().makeTranslation(0,1/2,0)),x[X](new u.Matrix4().makeRotationX(Math.PI/2)),i.geometry.dispose(),i.geometry=x}var E=new u.Vector3(f.x,f.y||0,f.z||0),S=new u.Vector3(a.x,a.y||0,a.z||0),F=E.distanceTo(S);i.position.x=E.x,i.position.y=E.y,i.position.z=E.z,i.scale.z=F,i.parent.localToWorld(S),i.lookAt(S)}}}}});function L(c){var l=n?c:e.layout.getLinkPosition(e.layout.graph.getLink(c.source,c.target).id),v=l[n?"source":"from"],f=l[n?"target":"to"];if(!(!v||!f||!v.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var a=P(c);if(!a)c.__curve=null;else{var _=new u.Vector3(v.x,v.y||0,v.z||0),k=new u.Vector3(f.x,f.y||0,f.z||0),C=_.distanceTo(k),i,O=s(c);if(C>0){var R=f.x-v.x,z=f.y-v.y||0,x=new u.Vector3().subVectors(k,_),E=x.clone().multiplyScalar(a).cross(R!==0||z!==0?new u.Vector3(0,0,1):new u.Vector3(0,1,0)).applyAxisAngle(x.normalize(),O).add(new u.Vector3().addVectors(_,k).divideScalar(2));i=new u.QuadraticBezierCurve3(_,E,k)}else{var S=a*70,F=-O,B=F+Math.PI/2;i=new u.CubicBezierCurve3(_,new u.Vector3(S*Math.cos(B),S*Math.sin(B),0).add(_),new u.Vector3(S*Math.cos(F),S*Math.sin(F),0).add(_),k)}c.__curve=i}}}}function p(){var y=w(e.linkDirectionalArrowRelPos),b=w(e.linkDirectionalArrowLength),P=w(e.nodeVal);e.graphData.links.forEach(function(s){var T=s.__arrowObj;if(T){var L=n?s:e.layout.getLinkPosition(e.layout.graph.getLink(s.source,s.target).id),c=L[n?"source":"from"],l=L[n?"target":"to"];if(!(!c||!l||!c.hasOwnProperty("x")||!l.hasOwnProperty("x"))){var v=Math.cbrt(Math.max(0,P(c)||1))*e.nodeRelSize,f=Math.cbrt(Math.max(0,P(l)||1))*e.nodeRelSize,a=b(s),_=y(s),k=s.__curve?function(x){return s.__curve.getPoint(x)}:function(x){var E=function(F,B,V,$){return B[F]+(V[F]-B[F])*$||0};return{x:E("x",c,l,x),y:E("y",c,l,x),z:E("z",c,l,x)}},C=s.__curve?s.__curve.getLength():Math.sqrt(["x","y","z"].map(function(x){return Math.pow((l[x]||0)-(c[x]||0),2)}).reduce(function(x,E){return x+E},0)),i=v+a+(C-v-f-a)*_,O=k(i/C),R=k((i-a)/C);["x","y","z"].forEach(function(x){return T.position[x]=R[x]});var z=ur(u.Vector3,U(["x","y","z"].map(function(x){return O[x]})));T.parent.localToWorld(z),T.lookAt(z)}}})}function g(){var y=w(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(b){var P=b.__photonsObj&&b.__photonsObj.children,s=b.__singleHopPhotonsObj&&b.__singleHopPhotonsObj.children;if(!((!s||!s.length)&&(!P||!P.length))){var T=n?b:e.layout.getLinkPosition(e.layout.graph.getLink(b.source,b.target).id),L=T[n?"source":"from"],c=T[n?"target":"to"];if(!(!L||!c||!L.hasOwnProperty("x")||!c.hasOwnProperty("x"))){var l=y(b),v=b.__curve?function(a){return b.__curve.getPoint(a)}:function(a){var _=function(C,i,O,R){return i[C]+(O[C]-i[C])*R||0};return{x:_("x",L,c,a),y:_("y",L,c,a),z:_("z",L,c,a)}},f=[].concat(U(P||[]),U(s||[]));f.forEach(function(a,_){var k=a.parent.__linkThreeObjType==="singleHopPhotons";if(a.hasOwnProperty("__progressRatio")||(a.__progressRatio=k?0:_/P.length),a.__progressRatio+=l,a.__progressRatio>=1)if(!k)a.__progressRatio=a.__progressRatio%1;else{a.parent.remove(a),ie(a);return}var C=a.__progressRatio,i=v(C);["x","y","z"].forEach(function(O){return a.position[O]=i[O]})})}}})}},emitParticle:function(e,n){if(n&&e.graphData.links.includes(n)){if(!n.__singleHopPhotonsObj){var t=new u.Group;t.__linkThreeObjType="singleHopPhotons",n.__singleHopPhotonsObj=t,e.graphScene.add(t)}var p=w(e.linkDirectionalParticleWidth),g=Math.ceil(p(n)*10)/10/2,y=e.linkDirectionalParticleResolution,b=new u.SphereGeometry(g,y,y),P=w(e.linkColor),s=w(e.linkDirectionalParticleColor),T=s(n)||P(n)||"#f0f0f0",L=new u.Color(Q(T)),c=e.linkOpacity*3,l=new u.MeshLambertMaterial({color:L,transparent:!0,opacity:c});n.__singleHopPhotonsObj.add(new u.Mesh(b,l))}return this},getGraphBbox:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var t=function p(g){var y=[];if(g.geometry){g.geometry.computeBoundingBox();var b=new u.Box3;b.copy(g.geometry.boundingBox).applyMatrix4(g.matrixWorld),y.push(b)}return y.concat.apply(y,U((g.children||[]).filter(function(P){return!P.hasOwnProperty("__graphObjType")||P.__graphObjType==="node"&&n(P.__data)}).map(p)))}(e.graphScene);return t.length?Object.assign.apply(Object,U(["x","y","z"].map(function(p){return ue({},p,[qe(t,function(g){return g.min[p]}),Qe(t,function(g){return g.max[p]})])}))):null}},stateInit:function(){return{d3ForceLayout:Je().force("link",Xe()).force("charge",Ye()).force("center",Ze()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,n){n.graphScene=e},update:function(e,n){var t=function(o){return o.some(function(d){return n.hasOwnProperty(d)})};if(e.engineRunning=!1,e.onUpdate(),e.nodeAutoColorBy!==null&&t(["nodeAutoColorBy","graphData","nodeColor"])&&se(e.graphData.nodes,w(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&t(["linkAutoColorBy","graphData","linkColor"])&&se(e.graphData.links,w(e.linkAutoColorBy),e.linkColor),e._flushObjects||t(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var p=w(e.nodeThreeObject),g=w(e.nodeThreeObjectExtend),y=w(e.nodeVal),b=w(e.nodeColor),P=w(e.nodeVisibility),s={},T={};q(e.graphData.nodes.filter(P),e.graphScene,{purge:e._flushObjects||t(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(o){return o.__graphObjType==="node"},createObj:function(o){var d=p(o),j=g(o);d&&e.nodeThreeObject===d&&(d=d.clone());var m;return d&&!j?m=d:(m=new u.Mesh,m.__graphDefaultObj=!0,d&&j&&m.add(d)),m.__graphObjType="node",m},updateObj:function(o,d){if(o.__graphDefaultObj){var j=y(d)||1,m=Math.cbrt(j)*e.nodeRelSize,M=e.nodeResolution;(!o.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||o.geometry.parameters.radius!==m||o.geometry.parameters.widthSegments!==M)&&(s.hasOwnProperty(j)||(s[j]=new u.SphereGeometry(m,M,M)),o.geometry.dispose(),o.geometry=s[j]);var A=b(d),D=new u.Color(Q(A||"#ffffaa")),I=e.nodeOpacity*ne(A);(o.material.type!=="MeshLambertMaterial"||!o.material.color.equals(D)||o.material.opacity!==I)&&(T.hasOwnProperty(A)||(T[A]=new u.MeshLambertMaterial({color:D,transparent:!0,opacity:I})),o.material.dispose(),o.material=T[A])}}})}if(e._flushObjects||t(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var L=w(e.linkThreeObject),c=w(e.linkThreeObjectExtend),l=w(e.linkMaterial),v=w(e.linkVisibility),f=w(e.linkColor),a=w(e.linkWidth),_={},k={},C={},i=e.graphData.links.filter(v);if(q(i,e.graphScene,{objBindAttr:"__lineObj",purge:e._flushObjects||t(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(o){return o.__graphObjType==="link"},exitObj:function(o){var d=o.__data&&o.__data.__singleHopPhotonsObj;d&&(d.parent.remove(d),ie(d),delete o.__data.__singleHopPhotonsObj)},createObj:function(o){var d=L(o),j=c(o);d&&e.linkThreeObject===d&&(d=d.clone());var m;if(!d||j){var M=!!a(o);if(M)m=new u.Mesh;else{var A=new u.BufferGeometry;A[ge]("position",new u.BufferAttribute(new Float32Array(2*3),3)),m=new u.Line(A)}}var D;return d?j?(D=new u.Group,D.__graphDefaultObj=!0,D.add(m),D.add(d)):D=d:(D=m,D.__graphDefaultObj=!0),D.renderOrder=10,D.__graphObjType="link",D},updateObj:function(o,d){if(o.__graphDefaultObj){var j=o.children.length?o.children[0]:o,m=Math.ceil(a(d)*10)/10,M=!!m;if(M){var A=m/2,D=e.linkResolution;if(!j.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||j.geometry.parameters.radiusTop!==A||j.geometry.parameters.radialSegments!==D){if(!_.hasOwnProperty(m)){var I=new u.CylinderGeometry(A,A,1,D,1,!1);I[X](new u.Matrix4().makeTranslation(0,1/2,0)),I[X](new u.Matrix4().makeRotationX(Math.PI/2)),_[m]=I}j.geometry.dispose(),j.geometry=_[m]}}var K=l(d);if(K)j.material=K;else{var H=f(d),W=new u.Color(Q(H||"#f0f0f0")),N=e.linkOpacity*ne(H),G=M?"MeshLambertMaterial":"LineBasicMaterial";if(j.material.type!==G||!j.material.color.equals(W)||j.material.opacity!==N){var re=M?k:C;re.hasOwnProperty(H)||(re[H]=new u[G]({color:W,transparent:N<1,opacity:N,depthWrite:N>=1})),j.material.dispose(),j.material=re[H]}}}}}),e.linkDirectionalArrowLength||n.hasOwnProperty("linkDirectionalArrowLength")){var O=w(e.linkDirectionalArrowLength),R=w(e.linkDirectionalArrowColor);q(i.filter(O),e.graphScene,{objBindAttr:"__arrowObj",objFilter:function(o){return o.__linkThreeObjType==="arrow"},createObj:function(){var o=new u.Mesh(void 0,new u.MeshLambertMaterial({transparent:!0}));return o.__linkThreeObjType="arrow",o},updateObj:function(o,d){var j=O(d),m=e.linkDirectionalArrowResolution;if(!o.geometry.type.match(/^Cone(Buffer)?Geometry$/)||o.geometry.parameters.height!==j||o.geometry.parameters.radialSegments!==m){var M=new u.ConeGeometry(j*.25,j,m);M.translate(0,j/2,0),M.rotateX(Math.PI/2),o.geometry.dispose(),o.geometry=M}var A=R(d)||f(d)||"#f0f0f0";o.material.color=new u.Color(Q(A)),o.material.opacity=e.linkOpacity*3*ne(A)}})}if(e.linkDirectionalParticles||n.hasOwnProperty("linkDirectionalParticles")){var z=w(e.linkDirectionalParticles),x=w(e.linkDirectionalParticleWidth),E=w(e.linkDirectionalParticleColor),S={},F={};q(i.filter(z),e.graphScene,{objBindAttr:"__photonsObj",objFilter:function(o){return o.__linkThreeObjType==="photons"},createObj:function(){var o=new u.Group;return o.__linkThreeObjType="photons",o},updateObj:function(o,d){var j=Math.round(Math.abs(z(d))),m=!!o.children.length&&o.children[0],M=Math.ceil(x(d)*10)/10/2,A=e.linkDirectionalParticleResolution,D;m&&m.geometry.parameters.radius===M&&m.geometry.parameters.widthSegments===A?D=m.geometry:(F.hasOwnProperty(M)||(F[M]=new u.SphereGeometry(M,A,A)),D=F[M],m&&m.geometry.dispose());var I=E(d)||f(d)||"#f0f0f0",K=new u.Color(Q(I)),H=e.linkOpacity*3,W;m&&m.material.color.equals(K)&&m.material.opacity===H?W=m.material:(S.hasOwnProperty(I)||(S[I]=new u.MeshLambertMaterial({color:K,transparent:!0,opacity:H})),W=S[I],m&&m.material.dispose()),q(U(new Array(j)).map(function(N,G){return{idx:G}}),o,{idAccessor:function(G){return G.idx},createObj:function(){return new u.Mesh(D,W)},updateObj:function(G){G.geometry=D,G.material=W}})}})}}if(e._flushObjects=!1,t(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(h){h.source=h[e.linkSource],h.target=h[e.linkTarget]});var B=e.forceEngine!=="ngraph",V;if(B){(V=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var $=e.d3ForceLayout.force("link");$&&$.id(function(h){return h[e.nodeId]}).links(e.graphData.links);var Z=e.dagMode&&_r(e.graphData,function(h){return h[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),ee=Math.max.apply(Math,U(Object.values(Z||[]))),ce=e.dagLevelDistance||e.graphData.nodes.length/(ee||1)*wr*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(n.dagMode)){var we=["lr","rl"].includes(n.dagMode)?"fx":["td","bu"].includes(n.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(h){return delete h[we]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var je=["rl","td","zout"].includes(e.dagMode),Pe=function(o){return(Z[o[e.nodeId]]-ee/2)*ce*(je?-1:1)},xe=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(h){return h[xe]=Pe(h)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?er(function(h){var o=Z[h[e.nodeId]]||-1;return(e.dagMode==="radialin"?ee-o:o)*ce}).strength(function(h){return e.dagNodeFilter(h)?1:0}):null)}else{var J=he.graph();e.graphData.nodes.forEach(function(h){J.addNode(h[e.nodeId])}),e.graphData.links.forEach(function(h){J.addLink(h.source,h.target)}),V=he.forcelayout(J,me({dimensions:e.numDimensions},e.ngraphPhysics)),V.graph=J}for(var fe=0;fe<e.warmupTicks&&!(B&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);fe++)V[B?"tick":"step"]();e.layout=V,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function Pr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,t=function(p){function g(){var y;ir(this,g);for(var b=arguments.length,P=new Array(b),s=0;s<b;s++)P[s]=arguments[s];return y=ar(this,g,[].concat(P)),y.__kapsuleInstance=r().apply(void 0,[].concat(U(n?[y]:[]),P)),y}return cr(g,p),lr(g)}(e);return Object.keys(r()).forEach(function(p){return t.prototype[p]=function(){var g,y=(g=this.__kapsuleInstance)[p].apply(g,arguments);return y===this.__kapsuleInstance?this:y}}),t}var xr=window.THREE?window.THREE:{Group:ye},kr=Pr(jr,xr.Group,!0);const Cr=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})),Ur=rr(Cr);export{Ur as r,kr as t};
