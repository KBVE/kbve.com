import{j as s}from"./jsx-runtime.CzgMDNMm.js";import{r}from"./index.DQ2WTIsS.js";import{K as I,k as c}from"./npchandler.6lM6j_9q.js";import"./preload-helper.ygWHROA3.js";import"./index.CFX5TIQh.js";import"./index.BH1EYZ08.js";const V=()=>{const[b,u]=r.useState(!1),[p,n]=r.useState(null),[m,h]=r.useState(null),[i,S]=r.useState({email:"",password:""}),[v,l]=r.useState(!1),[f,E]=r.useState(!1),t=r.useRef(null),w=e=>{const{name:o,value:a}=e.target;S(d=>({...d,[o]:a}))};r.useEffect(()=>{const e=document.createElement("script");return e.src="https://hcaptcha.com/1/api.js?onload=hcaptchaOnLoad&render=explicit",e.async=!0,e.defer=!0,document.body.appendChild(e),window.hcaptchaOnLoad=()=>{E(!0)},window.onSuccess=o=>{h(o)},window.onError=()=>{n("Captcha Error: Please try again."),t.current!==null&&window.hcaptcha.reset(t.current)},window.onExpired=()=>{h(null),n("Captcha expired: Please complete the captcha again."),t.current!==null&&window.hcaptcha.reset(t.current)},()=>{window.hcaptchaOnLoad=void 0,window.onSuccess=void 0,window.onError=void 0,window.onExpired=void 0,document.body.removeChild(e),t.current=null}},[]),r.useEffect(()=>{if(f&&window.hcaptcha){const e=window.hcaptcha.render("h-captcha",{sitekey:I.get().hcaptcha,callback:"onSuccess","expired-callback":"onExpired","error-callback":"onError"});t.current=e}},[f]),r.useEffect(()=>{const e=document.getElementById("skeleton");e?(e.style.transition="opacity 0.5s ease-out",e.style.opacity="0",setTimeout(()=>{e.remove(),l(!0)},500)):l(!0)},[]);const N=async()=>{if(n(null),!m){n("Please complete the captcha."),t.current!==null&&window.hcaptcha.reset(t.current);return}const e=await c.createActionULID("loginUser");try{if(await c.loginUser(i.email,i.password,e,m))if(u(!0),window.vuplex)try{const a=await c.getSupabaseClient();if(!a){console.error("Supabase client is not initialized."),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase client not initialized!"}));return}const{data:d,error:g}=await a.auth.refreshSession();if(g){console.error("Failed to refresh session:",g),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase Refresh Session"}));return}const{session:x,user:y}=d;if(!x||!y){console.error("Session or user data is missing."),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase User Data Missing"}));return}const k=JSON.stringify({type:"sessionUpdate",message:"User session updated successfully.",data:{session:x,user:y}});window.vuplex.postMessage(k),window.vuplex.postMessage(JSON.stringify({type:"confirm",message:"Hello from VuPlex"}))}catch(a){console.error("An error occurred while refreshing the session and sending data to Vuplex:",a),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from KBVE Vuplex!"}))}else console.log("No Vuplex Found");else{const a=await c.getDetailedErrorByActionId(e);n(a||"Failed to log in. Please try again."),t.current!==null&&window.hcaptcha.reset(t.current)}}catch(o){console.error("Sign-in failed:",o),n("An error occurred during sign-in. Please try again."),t.current!==null&&window.hcaptcha.reset(t.current)}},j=e=>{e.preventDefault(),N()};return s.jsx("div",{className:"flex flex-col items-center justify-center h-screen p-4",children:b?s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-lg",children:"You are signed in!"}),s.jsx("button",{className:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition",onClick:()=>{u(!1),l(!0)},children:"Sign Out"})]}):s.jsxs("form",{className:`w-full max-w-sm transition-opacity duration-500 rounded-lg p-4 bg-yellow-50/60 dark:bg-neutral-500  ${v?"opacity-100":"opacity-0"}`,onSubmit:j,children:[s.jsx("h2",{className:"text-xl mb-4",children:"Sign In"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),s.jsx("input",{type:"email",id:"email",name:"email",className:"w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",value:i.email,onChange:w,required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Password"}),s.jsx("input",{type:"password",id:"password",name:"password",className:"w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",value:i.password,onChange:w,required:!0})]}),s.jsx("div",{className:"mb-4",children:s.jsx("div",{id:"h-captcha",className:"my-4"})}),s.jsx("button",{type:"submit",className:"w-full bg-cyan-500 text-white py-2 rounded hover:bg-cyan-600 transition",children:"Sign In"}),p&&s.jsx("p",{className:"text-red-500 mt-4",children:p})]})})};export{V as default};
