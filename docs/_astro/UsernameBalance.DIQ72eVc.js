import{R as u,j as e}from"./react.CvslfkeK.js";import{u as w}from"./react-hook-form.D5LhBzNo.js";import{u as x}from"./@nanostores.J-Z5GVtw.js";import{s as j,c as N,e as b}from"./userstate.BzozS-xg.js";import{s as k}from"./supabaseClient.hNbicnCU.js";import"./@react-three.B-wTPXHf.js";import"./nanostores.Bo9-_MAV.js";import"./@supabase.BIuyOdEW.js";import"./Page.astro_astro_type_script_index_0_lang.BAyQMTx_.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";const p=/^[a-z0-9_-]{3,30}$/,L=()=>{const t=x(N),g=x(b),{register:f,handleSubmit:h,formState:{errors:i,isSubmitting:a},setError:n,setValue:S}=w(),[o,l]=u.useState(null);u.useEffect(()=>{j()},[]);const y=async r=>{if(l(null),!t){n("username",{type:"manual",message:"User not logged in."});return}try{const{data:v,error:m}=await k.functions.invoke("register-user",{body:{username:r.username}});m?n("username",{type:"manual",message:m.message||"Registration failed."}):(l("Username registered successfully!"),b.set(r.username))}catch{n("username",{type:"manual",message:"Network error."})}},d=r=>typeof r=="string"&&p.test(r),s=d(g)||d(t?.user_metadata?.username),c=t?.user_metadata?.avatar_url||t?.user_metadata?.picture||null;return e.jsxs("div",{className:"onboarding-card flex flex-col items-center gap-6 p-6 max-w-md mx-auto bg-white/80 dark:bg-zinc-900/80 border border-cyan-100 dark:border-zinc-800 shadow-xl rounded-2xl",children:[t&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c&&e.jsx("img",{src:c,alt:"User Avatar",className:"w-20 h-20 rounded-full border-4 border-cyan-400 shadow-md mb-2 bg-white object-cover"}),e.jsx("div",{className:"text-lg font-semibold text-zinc-800 dark:text-zinc-100",children:t.user_metadata?.display_name||t.email})]}),e.jsx("h2",{className:"text-2xl font-bold text-cyan-600 dark:text-cyan-300 mb-2 drop-shadow",children:s?"Update your username":"Choose your username"}),e.jsxs("form",{onSubmit:h(y),className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"text",...f("username",{required:"Username is required",pattern:{value:p,message:"3-30 chars, lowercase letters, numbers, _ or -"},onChange:r=>(r.target.value=r.target.value.toLowerCase(),r)}),placeholder:"Username",className:"border-2 border-cyan-200 dark:border-cyan-700 rounded-lg px-4 py-3 text-lg bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 shadow-sm transition",disabled:a||s}),i.username&&e.jsx("div",{className:"text-red-500 text-xs font-medium",children:i.username.message}),e.jsx("button",{type:"submit",className:"bg-gradient-to-br from-cyan-500 to-purple-500 text-white px-6 py-2 rounded-full font-bold shadow hover:from-cyan-400 hover:to-purple-400 hover:shadow-lg transition disabled:opacity-50 text-lg",disabled:a||s,children:s?"Username Set":a?"Registering...":"Register"})]}),o&&e.jsx("div",{className:"text-green-500 text-sm font-semibold",children:o}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 border border-cyan-200 dark:border-cyan-700 max-w-xs",children:[e.jsx("div",{className:"text-2xl text-green-600 dark:text-green-400 font-bold mb-2",children:"Success!"}),e.jsx("div",{className:"text-base text-neutral-700 dark:text-neutral-200 text-center",children:"Your username has been registered."}),e.jsx("a",{href:"/profile",className:"mt-2 px-5 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold shadow hover:from-cyan-400 hover:to-purple-400 transition-colors",children:"Go to Profile"}),e.jsx("button",{onClick:()=>l(null),className:"text-xs text-cyan-600 dark:text-cyan-300 mt-2 underline",children:"Close"})]})}),s&&e.jsx("div",{className:"text-cyan-600 text-xs font-medium",children:"You are already onboarded."})]})};export{L as default};
