import{p as r}from"./@nanostores.J-Z5GVtw.js";import{s as a}from"./supabaseClient.BT68OKvR.js";import{a as n}from"./nanostores.Bo9-_MAV.js";const u=n(null),c=n(null),l=r("user:id",void 0),d=r("user:email",void 0),m=r("user:username",void 0),_=n(!0),v=n("");function f(e){return e?JSON.stringify(e):""}function g(e){return e?JSON.parse(e):void 0}const o=r("user:balance",void 0,{encode:f,decode:g});async function b(){const{data:e}=await a.auth.getUser();if(typeof window<"u"&&localStorage.getItem("isMember")===null&&localStorage.setItem("isMember","false"),e?.user){u.set(e.user),l.set(e.user.id??void 0),d.set(e.user.email??void 0);const t=e.user.user_metadata?.username??void 0;c.set(t??null),m.set(t),typeof window<"u"&&localStorage.setItem("isMember","true")}else u.set(null),l.set(void 0),d.set(void 0),c.set(null),m.set(void 0),typeof window<"u"&&localStorage.setItem("isMember","false")}async function w(e,t=!0){if(!e){o.set(void 0);return}const{data:s,error:i}=await a.rpc("get_user_balance_context",{p_identifier:e,use_cache:t});s&&s.length>0&&!i?o.set(s[0]):(console.error("[syncUserBalance] Failed to fetch balance:",i?.message),o.set(void 0))}async function A(e){const{data:t,error:s}=await a.rpc("proxy_get_username",{p_user_id:e});return s?(console.error("[getUsernameByUuid] Failed to fetch username:",s.message),null):t}async function B(e){const{data:t,error:s}=await a.rpc("proxy_get_uuid",{p_username:e});return s?(console.error("[getUuidByUsername] Failed to fetch UUID:",s.message),null):t}export{w as a,o as b,u as c,B as d,c as e,_ as f,A as g,v as h,b as s,l as u};
