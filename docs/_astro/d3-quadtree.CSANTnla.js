function M(t){const i=+this._x.call(null,t),r=+this._y.call(null,t);return I(this.cover(i,r),i,r,t)}function I(t,i,r,n){if(isNaN(i)||isNaN(r))return t;var e,h,s,o,a,u,l,_,f,x=t._root,c={data:n},y=t._x0,p=t._y0,w=t._x1,v=t._y1;if(!x)return t._root=c,t;for(;x.length;)if((u=i>=(h=(y+w)/2))?y=h:w=h,(l=r>=(s=(p+v)/2))?p=s:v=s,e=x,!(x=x[_=l<<1|u]))return e[_]=c,t;if(o=+t._x.call(null,x.data),a=+t._y.call(null,x.data),i===o&&r===a)return c.next=x,e?e[_]=c:t._root=c,t;do{e=e?e[_]=new Array(4):t._root=new Array(4),(u=i>=(h=(y+w)/2))?y=h:w=h,(l=r>=(s=(p+v)/2))?p=s:v=s}while((_=l<<1|u)==(f=(a>=s)<<1|o>=h));return e[f]=x,e[_]=c,t}function j(t){var i,r,n,e,h=t.length,s=new Array(h),o=new Array(h),a=1/0,u=1/0,l=-1/0,_=-1/0;for(r=0;r<h;++r)isNaN(n=+this._x.call(null,i=t[r]))||isNaN(e=+this._y.call(null,i))||(s[r]=n,o[r]=e,n<a&&(a=n),n>l&&(l=n),e<u&&(u=e),e>_&&(_=e));if(a>l||u>_)return this;for(this.cover(a,u).cover(l,_),r=0;r<h;++r)I(this,s[r],o[r],t[r]);return this}function Q(t,i){if(isNaN(t=+t)||isNaN(i=+i))return this;var r=this._x0,n=this._y0,e=this._x1,h=this._y1;if(isNaN(r))e=(r=Math.floor(t))+1,h=(n=Math.floor(i))+1;else{for(var s,o,a=e-r||1,u=this._root;r>t||t>=e||n>i||i>=h;)switch(o=(i<n)<<1|t<r,s=new Array(4),s[o]=u,u=s,a*=2,o){case 0:e=r+a,h=n+a;break;case 1:r=e-a,h=n+a;break;case 2:e=r+a,n=h-a;break;case 3:r=e-a,n=h-a}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=n,this._x1=e,this._y1=h,this}function P(){var t=[];return this.visit((function(i){if(!i.length)do{t.push(i.data)}while(i=i.next)})),t}function X(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function w(t,i,r,n,e){this.node=t,this.x0=i,this.y0=r,this.x1=n,this.y1=e}function Y(t,i,r){var n,e,h,s,o,a,u,l=this._x0,_=this._y0,f=this._x1,x=this._y1,c=[],y=this._root;for(y&&c.push(new w(y,l,_,f,x)),null==r?r=1/0:(l=t-r,_=i-r,f=t+r,x=i+r,r*=r);a=c.pop();)if(!(!(y=a.node)||(e=a.x0)>f||(h=a.y0)>x||(s=a.x1)<l||(o=a.y1)<_))if(y.length){var p=(e+s)/2,v=(h+o)/2;c.push(new w(y[3],p,v,s,o),new w(y[2],e,v,p,o),new w(y[1],p,h,s,v),new w(y[0],e,h,p,v)),(u=(i>=v)<<1|t>=p)&&(a=c[c.length-1],c[c.length-1]=c[c.length-1-u],c[c.length-1-u]=a)}else{var d=t-+this._x.call(null,y.data),N=i-+this._y.call(null,y.data),g=d*d+N*N;if(g<r){var A=Math.sqrt(r=g);l=t-A,_=i-A,f=t+A,x=i+A,n=y.data}}return n}function B(t){if(isNaN(h=+this._x.call(null,t))||isNaN(s=+this._y.call(null,t)))return this;var i,r,n,e,h,s,o,a,u,l,_,f,x=this._root,c=this._x0,y=this._y0,p=this._x1,w=this._y1;if(!x)return this;if(x.length)for(;;){if((u=h>=(o=(c+p)/2))?c=o:p=o,(l=s>=(a=(y+w)/2))?y=a:w=a,i=x,!(x=x[_=l<<1|u]))return this;if(!x.length)break;(i[_+1&3]||i[_+2&3]||i[_+3&3])&&(r=i,f=_)}for(;x.data!==t;)if(n=x,!(x=x.next))return this;return(e=x.next)&&delete x.next,n?(e?n.next=e:delete n.next,this):i?(e?i[_]=e:delete i[_],(x=i[0]||i[1]||i[2]||i[3])&&x===(i[3]||i[2]||i[1]||i[0])&&!x.length&&(r?r[f]=x:this._root=x),this):(this._root=e,this)}function C(t){for(var i=0,r=t.length;i<r;++i)this.remove(t[i]);return this}function D(){return this._root}function E(){var t=0;return this.visit((function(i){if(!i.length)do{++t}while(i=i.next)})),t}function F(t){var i,r,n,e,h,s,o=[],a=this._root;for(a&&o.push(new w(a,this._x0,this._y0,this._x1,this._y1));i=o.pop();)if(!t(a=i.node,n=i.x0,e=i.y0,h=i.x1,s=i.y1)&&a.length){var u=(n+h)/2,l=(e+s)/2;(r=a[3])&&o.push(new w(r,u,l,h,s)),(r=a[2])&&o.push(new w(r,n,l,u,s)),(r=a[1])&&o.push(new w(r,u,e,h,l)),(r=a[0])&&o.push(new w(r,n,e,u,l))}return this}function G(t){var i,r=[],n=[];for(this._root&&r.push(new w(this._root,this._x0,this._y0,this._x1,this._y1));i=r.pop();){var e=i.node;if(e.length){var h,s=i.x0,o=i.y0,a=i.x1,u=i.y1,l=(s+a)/2,_=(o+u)/2;(h=e[0])&&r.push(new w(h,s,o,l,_)),(h=e[1])&&r.push(new w(h,l,o,a,_)),(h=e[2])&&r.push(new w(h,s,_,l,u)),(h=e[3])&&r.push(new w(h,l,_,a,u))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function H(t){return t[0]}function J(t){return arguments.length?(this._x=t,this):this._x}function K(t){return t[1]}function L(t){return arguments.length?(this._y=t,this):this._y}function O(t,i,r){var n=new A(i??H,r??K,NaN,NaN,NaN,NaN);return null==t?n:n.addAll(t)}function A(t,i,r,n,e,h){this._x=t,this._y=i,this._x0=r,this._y0=n,this._x1=e,this._y1=h,this._root=void 0}function k(t){for(var i={data:t.data},r=i;t=t.next;)r=r.next={data:t.data};return i}var p=O.prototype=A.prototype;p.copy=function(){var t,i,r=new A(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root;if(!n)return r;if(!n.length)return r._root=k(n),r;for(t=[{source:n,target:r._root=new Array(4)}];n=t.pop();)for(var e=0;e<4;++e)(i=n.source[e])&&(i.length?t.push({source:i,target:n.target[e]=new Array(4)}):n.target[e]=k(i));return r},p.add=M,p.addAll=j,p.cover=Q,p.data=P,p.extent=X,p.find=Y,p.remove=B,p.removeAll=C,p.root=D,p.size=E,p.visit=F,p.visitAfter=G,p.x=J,p.y=L;export{O as q};