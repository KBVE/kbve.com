import{S as Fi,i as Ki,s as qi,z as mo,A as Mi,f as hn,l as Li,q as mr,v as Ui,w as $i,B as zi,e as Hi,b as Wi,d as Vi,y as Ji,j as Gi,k as Xi}from"./index.SuMQvQK_.js";import{g as Yi}from"./globals.D0QH3NT1.js";import{p as Qi}from"./index.CgBe15gE.js";import{t as Zi}from"./index.BH1EYZ08.js";import{j as cn}from"./jsx-runtime.CzgMDNMm.js";import{R as ea,r as cr,c as yo,g as ta}from"./index.DQ2WTIsS.js";var Ao=(i=>(i.DARK="dark",i.LIGHT="light",i))(Ao||{});const na="5ba581fa-b6fc-4bb0-8222-02fcd6a59e35",ra="https://js.hcaptcha.com/1/api.js";function To(i,r){return function(){return i.apply(r,arguments)}}const{toString:oa}=Object.prototype,{getPrototypeOf:Er}=Object,yn=(i=>r=>{const a=oa.call(r);return i[a]||(i[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=i=>(i=i.toLowerCase(),r=>yn(r)===i),gn=i=>r=>typeof r===i,{isArray:ht}=Array,Tt=gn("undefined");function ia(i){return i!==null&&!Tt(i)&&i.constructor!==null&&!Tt(i.constructor)&&_e(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Ro=Oe("ArrayBuffer");function aa(i){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(i):r=i&&i.buffer&&Ro(i.buffer),r}const sa=gn("string"),_e=gn("function"),Do=gn("number"),vn=i=>i!==null&&typeof i=="object",ua=i=>i===!0||i===!1,ln=i=>{if(yn(i)!=="object")return!1;const r=Er(i);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},ca=Oe("Date"),la=Oe("File"),fa=Oe("Blob"),da=Oe("FileList"),ha=i=>vn(i)&&_e(i.pipe),pa=i=>{let r;return i&&(typeof FormData=="function"&&i instanceof FormData||_e(i.append)&&((r=yn(i))==="formdata"||r==="object"&&_e(i.toString)&&i.toString()==="[object FormData]"))},ma=Oe("URLSearchParams"),ya=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rt(i,r,{allOwnKeys:a=!1}={}){if(i===null||typeof i>"u")return;let u,d;if(typeof i!="object"&&(i=[i]),ht(i))for(u=0,d=i.length;u<d;u++)r.call(null,i[u],u,i);else{const f=a?Object.getOwnPropertyNames(i):Object.keys(i),p=f.length;let O;for(u=0;u<p;u++)O=f[u],r.call(null,i[O],O,i)}}function Io(i,r){r=r.toLowerCase();const a=Object.keys(i);let u=a.length,d;for(;u-- >0;)if(d=a[u],r===d.toLowerCase())return d;return null}const jo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bo=i=>!Tt(i)&&i!==jo;function yr(){const{caseless:i}=Bo(this)&&this||{},r={},a=(u,d)=>{const f=i&&Io(r,d)||d;ln(r[f])&&ln(u)?r[f]=yr(r[f],u):ln(u)?r[f]=yr({},u):ht(u)?r[f]=u.slice():r[f]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&Rt(arguments[u],a);return r}const ga=(i,r,a,{allOwnKeys:u}={})=>(Rt(r,(d,f)=>{a&&_e(d)?i[f]=To(d,a):i[f]=d},{allOwnKeys:u}),i),va=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),ba=(i,r,a,u)=>{i.prototype=Object.create(r.prototype,u),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:r.prototype}),a&&Object.assign(i.prototype,a)},wa=(i,r,a,u)=>{let d,f,p;const O={};if(r=r||{},i==null)return r;do{for(d=Object.getOwnPropertyNames(i),f=d.length;f-- >0;)p=d[f],(!u||u(p,i,r))&&!O[p]&&(r[p]=i[p],O[p]=!0);i=a!==!1&&Er(i)}while(i&&(!a||a(i,r))&&i!==Object.prototype);return r},_a=(i,r,a)=>{i=String(i),(a===void 0||a>i.length)&&(a=i.length),a-=r.length;const u=i.indexOf(r,a);return u!==-1&&u===a},xa=i=>{if(!i)return null;if(ht(i))return i;let r=i.length;if(!Do(r))return null;const a=new Array(r);for(;r-- >0;)a[r]=i[r];return a},Pa=(i=>r=>i&&r instanceof i)(typeof Uint8Array<"u"&&Er(Uint8Array)),Ea=(i,r)=>{const u=(i&&i[Symbol.iterator]).call(i);let d;for(;(d=u.next())&&!d.done;){const f=d.value;r.call(i,f[0],f[1])}},Ca=(i,r)=>{let a;const u=[];for(;(a=i.exec(r))!==null;)u.push(a);return u},Sa=Oe("HTMLFormElement"),Oa=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,d){return u.toUpperCase()+d}),go=(({hasOwnProperty:i})=>(r,a)=>i.call(r,a))(Object.prototype),ka=Oe("RegExp"),Fo=(i,r)=>{const a=Object.getOwnPropertyDescriptors(i),u={};Rt(a,(d,f)=>{let p;(p=r(d,f,i))!==!1&&(u[f]=p||d)}),Object.defineProperties(i,u)},Na=i=>{Fo(i,(r,a)=>{if(_e(i)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=i[a];if(_e(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},Aa=(i,r)=>{const a={},u=d=>{d.forEach(f=>{a[f]=!0})};return ht(i)?u(i):u(String(i).split(r)),a},Ta=()=>{},Ra=(i,r)=>(i=+i,Number.isFinite(i)?i:r),lr="abcdefghijklmnopqrstuvwxyz",vo="0123456789",Ko={DIGIT:vo,ALPHA:lr,ALPHA_DIGIT:lr+lr.toUpperCase()+vo},Da=(i=16,r=Ko.ALPHA_DIGIT)=>{let a="";const{length:u}=r;for(;i--;)a+=r[Math.random()*u|0];return a};function Ia(i){return!!(i&&_e(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const ja=i=>{const r=new Array(10),a=(u,d)=>{if(vn(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[d]=u;const f=ht(u)?[]:{};return Rt(u,(p,O)=>{const D=a(p,d+1);!Tt(D)&&(f[O]=D)}),r[d]=void 0,f}}return u};return a(i,0)},Ba=Oe("AsyncFunction"),Fa=i=>i&&(vn(i)||_e(i))&&_e(i.then)&&_e(i.catch),N={isArray:ht,isArrayBuffer:Ro,isBuffer:ia,isFormData:pa,isArrayBufferView:aa,isString:sa,isNumber:Do,isBoolean:ua,isObject:vn,isPlainObject:ln,isUndefined:Tt,isDate:ca,isFile:la,isBlob:fa,isRegExp:ka,isFunction:_e,isStream:ha,isURLSearchParams:ma,isTypedArray:Pa,isFileList:da,forEach:Rt,merge:yr,extend:ga,trim:ya,stripBOM:va,inherits:ba,toFlatObject:wa,kindOf:yn,kindOfTest:Oe,endsWith:_a,toArray:xa,forEachEntry:Ea,matchAll:Ca,isHTMLForm:Sa,hasOwnProperty:go,hasOwnProp:go,reduceDescriptors:Fo,freezeMethods:Na,toObjectSet:Aa,toCamelCase:Oa,noop:Ta,toFiniteNumber:Ra,findKey:Io,global:jo,isContextDefined:Bo,ALPHABET:Ko,generateString:Da,isSpecCompliantForm:Ia,toJSONObject:ja,isAsyncFn:Ba,isThenable:Fa};function Q(i,r,a,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",r&&(this.code=r),a&&(this.config=a),u&&(this.request=u),d&&(this.response=d)}N.inherits(Q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:N.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const qo=Q.prototype,Mo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Mo[i]={value:i}});Object.defineProperties(Q,Mo);Object.defineProperty(qo,"isAxiosError",{value:!0});Q.from=(i,r,a,u,d,f)=>{const p=Object.create(qo);return N.toFlatObject(i,p,function(D){return D!==Error.prototype},O=>O!=="isAxiosError"),Q.call(p,i.message,r,a,u,d),p.cause=i,p.name=i.name,f&&Object.assign(p,f),p};const Ka=null;function gr(i){return N.isPlainObject(i)||N.isArray(i)}function Lo(i){return N.endsWith(i,"[]")?i.slice(0,-2):i}function bo(i,r,a){return i?i.concat(r).map(function(d,f){return d=Lo(d),!a&&f?"["+d+"]":d}).join(a?".":""):r}function qa(i){return N.isArray(i)&&!i.some(gr)}const Ma=N.toFlatObject(N,{},null,function(r){return/^is[A-Z]/.test(r)});function bn(i,r,a){if(!N.isObject(i))throw new TypeError("target must be an object");r=r||new FormData,a=N.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,se){return!N.isUndefined(se[$])});const u=a.metaTokens,d=a.visitor||M,f=a.dots,p=a.indexes,D=(a.Blob||typeof Blob<"u"&&Blob)&&N.isSpecCompliantForm(r);if(!N.isFunction(d))throw new TypeError("visitor must be a function");function q(L){if(L===null)return"";if(N.isDate(L))return L.toISOString();if(!D&&N.isBlob(L))throw new Q("Blob is not supported. Use a Buffer instead.");return N.isArrayBuffer(L)||N.isTypedArray(L)?D&&typeof Blob=="function"?new Blob([L]):Buffer.from(L):L}function M(L,$,se){let le=L;if(L&&!se&&typeof L=="object"){if(N.endsWith($,"{}"))$=u?$:$.slice(0,-2),L=JSON.stringify(L);else if(N.isArray(L)&&qa(L)||(N.isFileList(L)||N.endsWith($,"[]"))&&(le=N.toArray(L)))return $=Lo($),le.forEach(function(te,$e){!(N.isUndefined(te)||te===null)&&r.append(p===!0?bo([$],$e,f):p===null?$:$+"[]",q(te))}),!1}return gr(L)?!0:(r.append(bo(se,$,f),q(L)),!1)}const A=[],Y=Object.assign(Ma,{defaultVisitor:M,convertValue:q,isVisitable:gr});function re(L,$){if(!N.isUndefined(L)){if(A.indexOf(L)!==-1)throw Error("Circular reference detected in "+$.join("."));A.push(L),N.forEach(L,function(le,he){(!(N.isUndefined(le)||le===null)&&d.call(r,le,N.isString(he)?he.trim():he,$,Y))===!0&&re(le,$?$.concat(he):[he])}),A.pop()}}if(!N.isObject(i))throw new TypeError("data must be an object");return re(i),r}function wo(i){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function Cr(i,r){this._pairs=[],i&&bn(i,this,r)}const Uo=Cr.prototype;Uo.append=function(r,a){this._pairs.push([r,a])};Uo.toString=function(r){const a=r?function(u){return r.call(this,u,wo)}:wo;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function La(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $o(i,r,a){if(!r)return i;const u=a&&a.encode||La,d=a&&a.serialize;let f;if(d?f=d(r,a):f=N.isURLSearchParams(r)?r.toString():new Cr(r,a).toString(u),f){const p=i.indexOf("#");p!==-1&&(i=i.slice(0,p)),i+=(i.indexOf("?")===-1?"?":"&")+f}return i}class _o{constructor(){this.handlers=[]}use(r,a,u){return this.handlers.push({fulfilled:r,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){N.forEach(this.handlers,function(u){u!==null&&r(u)})}}const zo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ua=typeof URLSearchParams<"u"?URLSearchParams:Cr,$a=typeof FormData<"u"?FormData:null,za=typeof Blob<"u"?Blob:null,Ha={isBrowser:!0,classes:{URLSearchParams:Ua,FormData:$a,Blob:za},protocols:["http","https","file","blob","url","data"]},Ho=typeof window<"u"&&typeof document<"u",Wa=(i=>Ho&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),Va=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ja=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ho,hasStandardBrowserEnv:Wa,hasStandardBrowserWebWorkerEnv:Va},Symbol.toStringTag,{value:"Module"})),Se={...Ja,...Ha};function Ga(i,r){return bn(i,new Se.classes.URLSearchParams,Object.assign({visitor:function(a,u,d,f){return Se.isNode&&N.isBuffer(a)?(this.append(u,a.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},r))}function Xa(i){return N.matchAll(/\w+|\[(\w*)]/g,i).map(r=>r[0]==="[]"?"":r[1]||r[0])}function Ya(i){const r={},a=Object.keys(i);let u;const d=a.length;let f;for(u=0;u<d;u++)f=a[u],r[f]=i[f];return r}function Wo(i){function r(a,u,d,f){let p=a[f++];if(p==="__proto__")return!0;const O=Number.isFinite(+p),D=f>=a.length;return p=!p&&N.isArray(d)?d.length:p,D?(N.hasOwnProp(d,p)?d[p]=[d[p],u]:d[p]=u,!O):((!d[p]||!N.isObject(d[p]))&&(d[p]=[]),r(a,u,d[p],f)&&N.isArray(d[p])&&(d[p]=Ya(d[p])),!O)}if(N.isFormData(i)&&N.isFunction(i.entries)){const a={};return N.forEachEntry(i,(u,d)=>{r(Xa(u),d,a,0)}),a}return null}function Qa(i,r,a){if(N.isString(i))try{return(r||JSON.parse)(i),N.trim(i)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(i)}const Sr={transitional:zo,adapter:["xhr","http"],transformRequest:[function(r,a){const u=a.getContentType()||"",d=u.indexOf("application/json")>-1,f=N.isObject(r);if(f&&N.isHTMLForm(r)&&(r=new FormData(r)),N.isFormData(r))return d?JSON.stringify(Wo(r)):r;if(N.isArrayBuffer(r)||N.isBuffer(r)||N.isStream(r)||N.isFile(r)||N.isBlob(r))return r;if(N.isArrayBufferView(r))return r.buffer;if(N.isURLSearchParams(r))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let O;if(f){if(u.indexOf("application/x-www-form-urlencoded")>-1)return Ga(r,this.formSerializer).toString();if((O=N.isFileList(r))||u.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return bn(O?{"files[]":r}:r,D&&new D,this.formSerializer)}}return f||d?(a.setContentType("application/json",!1),Qa(r)):r}],transformResponse:[function(r){const a=this.transitional||Sr.transitional,u=a&&a.forcedJSONParsing,d=this.responseType==="json";if(r&&N.isString(r)&&(u&&!this.responseType||d)){const p=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(r)}catch(O){if(p)throw O.name==="SyntaxError"?Q.from(O,Q.ERR_BAD_RESPONSE,this,null,this.response):O}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Se.classes.FormData,Blob:Se.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};N.forEach(["delete","get","head","post","put","patch"],i=>{Sr.headers[i]={}});const Or=Sr,Za=N.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),es=i=>{const r={};let a,u,d;return i&&i.split(`
`).forEach(function(p){d=p.indexOf(":"),a=p.substring(0,d).trim().toLowerCase(),u=p.substring(d+1).trim(),!(!a||r[a]&&Za[a])&&(a==="set-cookie"?r[a]?r[a].push(u):r[a]=[u]:r[a]=r[a]?r[a]+", "+u:u)}),r},xo=Symbol("internals");function At(i){return i&&String(i).trim().toLowerCase()}function fn(i){return i===!1||i==null?i:N.isArray(i)?i.map(fn):String(i)}function ts(i){const r=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(i);)r[u[1]]=u[2];return r}const ns=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function fr(i,r,a,u,d){if(N.isFunction(u))return u.call(this,r,a);if(d&&(r=a),!!N.isString(r)){if(N.isString(u))return r.indexOf(u)!==-1;if(N.isRegExp(u))return u.test(r)}}function rs(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,a,u)=>a.toUpperCase()+u)}function os(i,r){const a=N.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(i,u+a,{value:function(d,f,p){return this[u].call(this,r,d,f,p)},configurable:!0})})}class wn{constructor(r){r&&this.set(r)}set(r,a,u){const d=this;function f(O,D,q){const M=At(D);if(!M)throw new Error("header name must be a non-empty string");const A=N.findKey(d,M);(!A||d[A]===void 0||q===!0||q===void 0&&d[A]!==!1)&&(d[A||D]=fn(O))}const p=(O,D)=>N.forEach(O,(q,M)=>f(q,M,D));return N.isPlainObject(r)||r instanceof this.constructor?p(r,a):N.isString(r)&&(r=r.trim())&&!ns(r)?p(es(r),a):r!=null&&f(a,r,u),this}get(r,a){if(r=At(r),r){const u=N.findKey(this,r);if(u){const d=this[u];if(!a)return d;if(a===!0)return ts(d);if(N.isFunction(a))return a.call(this,d,u);if(N.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,a){if(r=At(r),r){const u=N.findKey(this,r);return!!(u&&this[u]!==void 0&&(!a||fr(this,this[u],u,a)))}return!1}delete(r,a){const u=this;let d=!1;function f(p){if(p=At(p),p){const O=N.findKey(u,p);O&&(!a||fr(u,u[O],O,a))&&(delete u[O],d=!0)}}return N.isArray(r)?r.forEach(f):f(r),d}clear(r){const a=Object.keys(this);let u=a.length,d=!1;for(;u--;){const f=a[u];(!r||fr(this,this[f],f,r,!0))&&(delete this[f],d=!0)}return d}normalize(r){const a=this,u={};return N.forEach(this,(d,f)=>{const p=N.findKey(u,f);if(p){a[p]=fn(d),delete a[f];return}const O=r?rs(f):String(f).trim();O!==f&&delete a[f],a[O]=fn(d),u[O]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const a=Object.create(null);return N.forEach(this,(u,d)=>{u!=null&&u!==!1&&(a[d]=r&&N.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,a])=>r+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...a){const u=new this(r);return a.forEach(d=>u.set(d)),u}static accessor(r){const u=(this[xo]=this[xo]={accessors:{}}).accessors,d=this.prototype;function f(p){const O=At(p);u[O]||(os(d,p),u[O]=!0)}return N.isArray(r)?r.forEach(f):f(r),this}}wn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);N.reduceDescriptors(wn.prototype,({value:i},r)=>{let a=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(u){this[a]=u}}});N.freezeMethods(wn);const De=wn;function dr(i,r){const a=this||Or,u=r||a,d=De.from(u.headers);let f=u.data;return N.forEach(i,function(O){f=O.call(a,f,d.normalize(),r?r.status:void 0)}),d.normalize(),f}function Vo(i){return!!(i&&i.__CANCEL__)}function Dt(i,r,a){Q.call(this,i??"canceled",Q.ERR_CANCELED,r,a),this.name="CanceledError"}N.inherits(Dt,Q,{__CANCEL__:!0});function is(i,r,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?i(a):r(new Q("Request failed with status code "+a.status,[Q.ERR_BAD_REQUEST,Q.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const as=Se.hasStandardBrowserEnv?{write(i,r,a,u,d,f){const p=[i+"="+encodeURIComponent(r)];N.isNumber(a)&&p.push("expires="+new Date(a).toGMTString()),N.isString(u)&&p.push("path="+u),N.isString(d)&&p.push("domain="+d),f===!0&&p.push("secure"),document.cookie=p.join("; ")},read(i){const r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ss(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function us(i,r){return r?i.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):i}function Jo(i,r){return i&&!ss(r)?us(i,r):r}const cs=Se.hasStandardBrowserEnv?function(){const r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function d(f){let p=f;return r&&(a.setAttribute("href",p),p=a.href),a.setAttribute("href",p),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=d(window.location.href),function(p){const O=N.isString(p)?d(p):p;return O.protocol===u.protocol&&O.host===u.host}}():function(){return function(){return!0}}();function ls(i){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return r&&r[1]||""}function fs(i,r){i=i||10;const a=new Array(i),u=new Array(i);let d=0,f=0,p;return r=r!==void 0?r:1e3,function(D){const q=Date.now(),M=u[f];p||(p=q),a[d]=D,u[d]=q;let A=f,Y=0;for(;A!==d;)Y+=a[A++],A=A%i;if(d=(d+1)%i,d===f&&(f=(f+1)%i),q-p<r)return;const re=M&&q-M;return re?Math.round(Y*1e3/re):void 0}}function Po(i,r){let a=0;const u=fs(50,250);return d=>{const f=d.loaded,p=d.lengthComputable?d.total:void 0,O=f-a,D=u(O),q=f<=p;a=f;const M={loaded:f,total:p,progress:p?f/p:void 0,bytes:O,rate:D||void 0,estimated:D&&p&&q?(p-f)/D:void 0,event:d};M[r?"download":"upload"]=!0,i(M)}}const ds=typeof XMLHttpRequest<"u",hs=ds&&function(i){return new Promise(function(a,u){let d=i.data;const f=De.from(i.headers).normalize();let{responseType:p,withXSRFToken:O}=i,D;function q(){i.cancelToken&&i.cancelToken.unsubscribe(D),i.signal&&i.signal.removeEventListener("abort",D)}let M;if(N.isFormData(d)){if(Se.hasStandardBrowserEnv||Se.hasStandardBrowserWebWorkerEnv)f.setContentType(!1);else if((M=f.getContentType())!==!1){const[$,...se]=M?M.split(";").map(le=>le.trim()).filter(Boolean):[];f.setContentType([$||"multipart/form-data",...se].join("; "))}}let A=new XMLHttpRequest;if(i.auth){const $=i.auth.username||"",se=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";f.set("Authorization","Basic "+btoa($+":"+se))}const Y=Jo(i.baseURL,i.url);A.open(i.method.toUpperCase(),$o(Y,i.params,i.paramsSerializer),!0),A.timeout=i.timeout;function re(){if(!A)return;const $=De.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),le={data:!p||p==="text"||p==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:$,config:i,request:A};is(function(te){a(te),q()},function(te){u(te),q()},le),A=null}if("onloadend"in A?A.onloadend=re:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(re)},A.onabort=function(){A&&(u(new Q("Request aborted",Q.ECONNABORTED,i,A)),A=null)},A.onerror=function(){u(new Q("Network Error",Q.ERR_NETWORK,i,A)),A=null},A.ontimeout=function(){let se=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const le=i.transitional||zo;i.timeoutErrorMessage&&(se=i.timeoutErrorMessage),u(new Q(se,le.clarifyTimeoutError?Q.ETIMEDOUT:Q.ECONNABORTED,i,A)),A=null},Se.hasStandardBrowserEnv&&(O&&N.isFunction(O)&&(O=O(i)),O||O!==!1&&cs(Y))){const $=i.xsrfHeaderName&&i.xsrfCookieName&&as.read(i.xsrfCookieName);$&&f.set(i.xsrfHeaderName,$)}d===void 0&&f.setContentType(null),"setRequestHeader"in A&&N.forEach(f.toJSON(),function(se,le){A.setRequestHeader(le,se)}),N.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),p&&p!=="json"&&(A.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&A.addEventListener("progress",Po(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&A.upload&&A.upload.addEventListener("progress",Po(i.onUploadProgress)),(i.cancelToken||i.signal)&&(D=$=>{A&&(u(!$||$.type?new Dt(null,i,A):$),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(D),i.signal&&(i.signal.aborted?D():i.signal.addEventListener("abort",D)));const L=ls(Y);if(L&&Se.protocols.indexOf(L)===-1){u(new Q("Unsupported protocol "+L+":",Q.ERR_BAD_REQUEST,i));return}A.send(d||null)})},vr={http:Ka,xhr:hs};N.forEach(vr,(i,r)=>{if(i){try{Object.defineProperty(i,"name",{value:r})}catch{}Object.defineProperty(i,"adapterName",{value:r})}});const Eo=i=>`- ${i}`,ps=i=>N.isFunction(i)||i===null||i===!1,Go={getAdapter:i=>{i=N.isArray(i)?i:[i];const{length:r}=i;let a,u;const d={};for(let f=0;f<r;f++){a=i[f];let p;if(u=a,!ps(a)&&(u=vr[(p=String(a)).toLowerCase()],u===void 0))throw new Q(`Unknown adapter '${p}'`);if(u)break;d[p||"#"+f]=u}if(!u){const f=Object.entries(d).map(([O,D])=>`adapter ${O} `+(D===!1?"is not supported by the environment":"is not available in the build"));let p=r?f.length>1?`since :
`+f.map(Eo).join(`
`):" "+Eo(f[0]):"as no adapter specified";throw new Q("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return u},adapters:vr};function hr(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Dt(null,i)}function Co(i){return hr(i),i.headers=De.from(i.headers),i.data=dr.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Go.getAdapter(i.adapter||Or.adapter)(i).then(function(u){return hr(i),u.data=dr.call(i,i.transformResponse,u),u.headers=De.from(u.headers),u},function(u){return Vo(u)||(hr(i),u&&u.response&&(u.response.data=dr.call(i,i.transformResponse,u.response),u.response.headers=De.from(u.response.headers))),Promise.reject(u)})}const So=i=>i instanceof De?i.toJSON():i;function dt(i,r){r=r||{};const a={};function u(q,M,A){return N.isPlainObject(q)&&N.isPlainObject(M)?N.merge.call({caseless:A},q,M):N.isPlainObject(M)?N.merge({},M):N.isArray(M)?M.slice():M}function d(q,M,A){if(N.isUndefined(M)){if(!N.isUndefined(q))return u(void 0,q,A)}else return u(q,M,A)}function f(q,M){if(!N.isUndefined(M))return u(void 0,M)}function p(q,M){if(N.isUndefined(M)){if(!N.isUndefined(q))return u(void 0,q)}else return u(void 0,M)}function O(q,M,A){if(A in r)return u(q,M);if(A in i)return u(void 0,q)}const D={url:f,method:f,data:f,baseURL:p,transformRequest:p,transformResponse:p,paramsSerializer:p,timeout:p,timeoutMessage:p,withCredentials:p,withXSRFToken:p,adapter:p,responseType:p,xsrfCookieName:p,xsrfHeaderName:p,onUploadProgress:p,onDownloadProgress:p,decompress:p,maxContentLength:p,maxBodyLength:p,beforeRedirect:p,transport:p,httpAgent:p,httpsAgent:p,cancelToken:p,socketPath:p,responseEncoding:p,validateStatus:O,headers:(q,M)=>d(So(q),So(M),!0)};return N.forEach(Object.keys(Object.assign({},i,r)),function(M){const A=D[M]||d,Y=A(i[M],r[M],M);N.isUndefined(Y)&&A!==O||(a[M]=Y)}),a}const Xo="1.6.7",kr={};["object","boolean","number","function","string","symbol"].forEach((i,r)=>{kr[i]=function(u){return typeof u===i||"a"+(r<1?"n ":" ")+i}});const Oo={};kr.transitional=function(r,a,u){function d(f,p){return"[Axios v"+Xo+"] Transitional option '"+f+"'"+p+(u?". "+u:"")}return(f,p,O)=>{if(r===!1)throw new Q(d(p," has been removed"+(a?" in "+a:"")),Q.ERR_DEPRECATED);return a&&!Oo[p]&&(Oo[p]=!0,console.warn(d(p," has been deprecated since v"+a+" and will be removed in the near future"))),r?r(f,p,O):!0}};function ms(i,r,a){if(typeof i!="object")throw new Q("options must be an object",Q.ERR_BAD_OPTION_VALUE);const u=Object.keys(i);let d=u.length;for(;d-- >0;){const f=u[d],p=r[f];if(p){const O=i[f],D=O===void 0||p(O,f,i);if(D!==!0)throw new Q("option "+f+" must be "+D,Q.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Q("Unknown option "+f,Q.ERR_BAD_OPTION)}}const br={assertOptions:ms,validators:kr},Ue=br.validators;class pn{constructor(r){this.defaults=r,this.interceptors={request:new _o,response:new _o}}async request(r,a){try{return await this._request(r,a)}catch(u){if(u instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const f=d.stack?d.stack.replace(/^.+\n/,""):"";u.stack?f&&!String(u.stack).endsWith(f.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+f):u.stack=f}throw u}}_request(r,a){typeof r=="string"?(a=a||{},a.url=r):a=r||{},a=dt(this.defaults,a);const{transitional:u,paramsSerializer:d,headers:f}=a;u!==void 0&&br.assertOptions(u,{silentJSONParsing:Ue.transitional(Ue.boolean),forcedJSONParsing:Ue.transitional(Ue.boolean),clarifyTimeoutError:Ue.transitional(Ue.boolean)},!1),d!=null&&(N.isFunction(d)?a.paramsSerializer={serialize:d}:br.assertOptions(d,{encode:Ue.function,serialize:Ue.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let p=f&&N.merge(f.common,f[a.method]);f&&N.forEach(["delete","get","head","post","put","patch","common"],L=>{delete f[L]}),a.headers=De.concat(p,f);const O=[];let D=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(a)===!1||(D=D&&$.synchronous,O.unshift($.fulfilled,$.rejected))});const q=[];this.interceptors.response.forEach(function($){q.push($.fulfilled,$.rejected)});let M,A=0,Y;if(!D){const L=[Co.bind(this),void 0];for(L.unshift.apply(L,O),L.push.apply(L,q),Y=L.length,M=Promise.resolve(a);A<Y;)M=M.then(L[A++],L[A++]);return M}Y=O.length;let re=a;for(A=0;A<Y;){const L=O[A++],$=O[A++];try{re=L(re)}catch(se){$.call(this,se);break}}try{M=Co.call(this,re)}catch(L){return Promise.reject(L)}for(A=0,Y=q.length;A<Y;)M=M.then(q[A++],q[A++]);return M}getUri(r){r=dt(this.defaults,r);const a=Jo(r.baseURL,r.url);return $o(a,r.params,r.paramsSerializer)}}N.forEach(["delete","get","head","options"],function(r){pn.prototype[r]=function(a,u){return this.request(dt(u||{},{method:r,url:a,data:(u||{}).data}))}});N.forEach(["post","put","patch"],function(r){function a(u){return function(f,p,O){return this.request(dt(O||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:f,data:p}))}}pn.prototype[r]=a(),pn.prototype[r+"Form"]=a(!0)});const dn=pn;class Nr{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(f){a=f});const u=this;this.promise.then(d=>{if(!u._listeners)return;let f=u._listeners.length;for(;f-- >0;)u._listeners[f](d);u._listeners=null}),this.promise.then=d=>{let f;const p=new Promise(O=>{u.subscribe(O),f=O}).then(d);return p.cancel=function(){u.unsubscribe(f)},p},r(function(f,p,O){u.reason||(u.reason=new Dt(f,p,O),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const a=this._listeners.indexOf(r);a!==-1&&this._listeners.splice(a,1)}static source(){let r;return{token:new Nr(function(d){r=d}),cancel:r}}}const ys=Nr;function gs(i){return function(a){return i.apply(null,a)}}function vs(i){return N.isObject(i)&&i.isAxiosError===!0}const wr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wr).forEach(([i,r])=>{wr[r]=i});const bs=wr;function Yo(i){const r=new dn(i),a=To(dn.prototype.request,r);return N.extend(a,dn.prototype,r,{allOwnKeys:!0}),N.extend(a,r,null,{allOwnKeys:!0}),a.create=function(d){return Yo(dt(i,d))},a}const ie=Yo(Or);ie.Axios=dn;ie.CanceledError=Dt;ie.CancelToken=ys;ie.isCancel=Vo;ie.VERSION=Xo;ie.toFormData=bn;ie.AxiosError=Q;ie.Cancel=ie.CanceledError;ie.all=function(r){return Promise.all(r)};ie.spread=gs;ie.isAxiosError=vs;ie.mergeConfig=dt;ie.AxiosHeaders=De;ie.formToJSON=i=>Wo(N.isHTMLForm(i)?new FormData(i):i);ie.getAdapter=Go.getAdapter;ie.HttpStatusCode=bs;ie.default=ie;const ws={id:"",title:"",description:"",journals:[],isComplete:!1,reward:""},_s={backpack:[],equipment:{head:null,body:null,legs:null,feet:null,hands:null,weapon:null,shield:null,accessory:null}},Qo={},xs={inCombat:!1,isDead:!1,isResting:!1,activeBoosts:{}},Ps={username:"Guest",health:"100",mana:"100",energy:"100",maxHealth:"100",maxMana:"100",maxEnergy:"100",armour:"0",agility:"0",strength:"0",intelligence:"0",experience:"0",reputation:"0",faith:"0"},Es={stats:Ps,inventory:_s,state:xs},Cs={tooltipItem:{id:null,position:{x:0,y:0}},submenuItem:{id:null,position:{x:0,y:0}},tooltipNPC:{id:null,position:{x:0,y:0}},isStatsMenuCollapsed:!1,isSettingsMenuCollapsed:!1,debugMode:!1},Ss={gamemode:"Idle",action:{type:"ROLL_DICE",diceValues:[],isRolling:!1},textures:{side1:"",side2:"",side3:"",side4:"",side5:"",side6:""}};function et(i,r){return Qi(i,r,{encode(a){return JSON.stringify(a)},decode(a){try{return JSON.parse(a)}catch{return r}}})}et("playerData",Es);et("quest",ws);et("items",Qo);et("notifications",[]);et("itemDB",Qo);const _r=et("settings",Cs);et("minigameState",Ss);const Os=i=>_r.get()[i],Zo=(i,r)=>{Zi(async()=>{const a=_r.get();_r.set({...a,[i]:r})})},ks=()=>{Zo("debugMode",!0)},Ns=()=>{Zo("debugMode",!1)},_n=()=>Os("debugMode"),mn=i=>typeof i=="string"?i:JSON.stringify(i,null,2),As=i=>{_n()&&console.log(`[DEBUG] ${mn(i)}`)},Ts=i=>{_n()&&console.warn(`[DEBUG] ${mn(i)}`)},Rs=(i,r)=>{_n()&&(r instanceof Error?console.error(`[DEBUG] ${mn(i)} - Error: ${r.message}
${r.stack}`):console.error(`[DEBUG] ${mn(i)}`))},H={enable:ks,disable:Ns,isEnabled:_n,log:As,warn:Ts,error:Rs};class Ds{constructor(){this.events={},this.lastEmitted=new Map}on(r,a){this.events[r]||(this.events[r]=[]),this.events[r]?.push(a)}off(r,a){this.events[r]&&(this.events[r]=this.events[r]?.filter(u=>u!==a))}emit(r,a,u=0,d){const f=Date.now(),p=this.lastEmitted.get(r)||0;if(f-p>=u){if(!this.events[r])return;this.events[r]?.forEach(O=>O(a)),d&&H.isEnabled()&&H.log(`Event: ${String(r)} - Message: ${d}`),H.isEnabled()&&H.log(`Event Data: ${String(r)} - Data: ${a?JSON.stringify(a):"No data"}`),this.lastEmitted.set(r,f)}}}const ft=new Ds;function Is(i){const{elementIdOrName:r,duration:a=500,onComplete:u}=i;let d=null;if(d=document.getElementById(r),!d){const f=document.getElementsByName(r);f.length>0&&(d=f[0])}if(!d){H.error(`Loader element with ID or name "${r}" not found.`);return}if(!(d instanceof HTMLElement)){H.error(`Element found by "${r}" is not an HTMLElement.`);return}H.log(`Removing loader element with ID or name "${r}" with duration ${a}ms.`),d.classList.add("opacity-0","transition-opacity",`duration-${a}`),setTimeout(()=>{d.style.display="none",H.log(`Loader element with ID or name "${r}" has been hidden.`),u&&u()},a)}const js=({text:i,speed:r=80,onComplete:a})=>{const[u,d]=cr.useState([]),f=cr.useRef([]);return cr.useEffect(()=>{let p,O=0;const D=i.split(/(<\/?span[^>]*>)/g).filter(Boolean),q=[];D.forEach((A,Y)=>{if(A.startsWith("<span")||A.startsWith("</span")){const re=A.match(/<span class="([^"]*)">/);if(re){const L=re[1];q.push(cn.jsx("span",{className:L},`span-${Y}`))}else q.push(cn.jsx("span",{},`span-${Y}`))}else A.split("").forEach((re,L)=>{q.push(cn.jsx("span",{children:re},`char-${Y}-${L}`))})}),O=0;const M=()=>{O<q.length?(f.current=[...f.current,q[O]],d([...f.current]),O++,p=window.setTimeout(M,r)):a&&a()};return f.current=[],d([]),M(),()=>{window.clearTimeout(p)}},[i,r,a]),cn.jsx("div",{children:u})};ea.memo(js);class ei extends Phaser.GameObjects.Container{constructor(r,a,u,d){const f=a.x,p=a.y-a.height+10;super(r,f,p),this.sprite=a;const O=150,D=40+d.length*20;this.background=r.add.rectangle(0,0,O,D,0,.7),this.text=r.add.text(0,-D/2+10,u,{fontSize:"12px",color:"#ffffff"}).setOrigin(.5),this.buttons=d.map((q,M)=>{const A=r.add.text(0,-D/2+30+M*20,q.label,{fontSize:"12px",color:"#00ff00"}).setOrigin(.5);return A.setInteractive({useHandCursor:!0}),A.on("pointerdown",q.callback),A}),this.add(this.background),this.add(this.text),this.buttons.forEach(q=>this.add(q)),this.scene.add.existing(this)}updatePosition(){this.setPosition(this.sprite.x-30,this.sprite.y-this.sprite.height-this.background.height/2+100)}static attachToSprite(r,a,u,d){a.setInteractive(),a.on("pointerover",f=>{const p={npcId:a.name,npcName:u,actions:d.map(D=>D.label),coords:{x:f.x,y:f.y}};if(ft.emit("npcInteraction",p),!a.getData("tooltipMenu")){const D=new ei(r,a,u,d);a.setData("tooltipMenu",D)}const O=a.getData("tooltipMenu");O.setVisible(!0),O.updatePosition()}),a.on("pointerout",()=>{const f=a.getData("tooltipMenu");f&&f.setVisible(!1)})}static updateAllTooltipPositions(r){r.children.list.forEach(a=>{if(a instanceof Phaser.GameObjects.Sprite){const u=a.getData("tooltipMenu");u&&u.updatePosition()}})}}class Gs extends Phaser.GameObjects.Sprite{}var ti={exports:{}};(function(i,r){(function(a,u){i.exports=u()})(yo,function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])})(e,t)},u=function(){return(u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function d(e,t,n){if(n||arguments.length===2)for(var o,s=0,c=t.length;s<c;s++)!o&&s in t||((o=o||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:yo,p=Object.keys,O=Array.isArray;function D(e,t){return typeof t!="object"||p(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var q=Object.getPrototypeOf,M={}.hasOwnProperty;function A(e,t){return M.call(e,t)}function Y(e,t){typeof t=="function"&&(t=t(q(e))),(typeof Reflect>"u"?p:Reflect.ownKeys)(t).forEach(function(n){L(e,n,t[n])})}var re=Object.defineProperty;function L(e,t,n,o){re(e,t,D(n&&A(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},o))}function $(e){return{from:function(t){return e.prototype=Object.create(t.prototype),L(e.prototype,"constructor",e),{extend:Y.bind(null,e.prototype)}}}}var se=Object.getOwnPropertyDescriptor,le=[].slice;function he(e,t,n){return le.call(e,t,n)}function te(e,t){return t(e)}function $e(e){if(!e)throw new Error("Assertion Failed")}function Ar(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function ke(e,t){if(typeof t=="string"&&A(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],o=0,s=t.length;o<s;++o){var c=ke(e,t[o]);n.push(c)}return n}var l=t.indexOf(".");if(l!==-1){var h=e[t.substr(0,l)];return h==null?void 0:ke(h,t.substr(l+1))}}function ve(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){$e(typeof n!="string"&&"length"in n);for(var o=0,s=t.length;o<s;++o)ve(e,t[o],n[o])}else{var c,l,h=t.indexOf(".");h!==-1?(c=t.substr(0,h),(l=t.substr(h+1))===""?n===void 0?O(e)&&!isNaN(parseInt(c))?e.splice(c,1):delete e[c]:e[c]=n:ve(h=!(h=e[c])||!A(e,c)?e[c]={}:h,l,n)):n===void 0?O(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Tr(e){var t,n={};for(t in e)A(e,t)&&(n[t]=e[t]);return n}var ni=[].concat;function Rr(e){return ni.apply([],e)}var Te="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Rr([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return f[e]}),Dr=new Set(Te.map(function(e){return f[e]})),pt=null;function Ie(e){return pt=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var o=pt.get(n);if(o)return o;if(O(n)){o=[],pt.set(n,o);for(var s=0,c=n.length;s<c;++s)o.push(t(n[s]))}else if(Dr.has(n.constructor))o=n;else{var l,h=q(n);for(l in o=h===Object.prototype?{}:Object.create(h),pt.set(n,o),n)A(n,l)&&(o[l]=t(n[l]))}return o}(e),pt=null,e}var ri={}.toString;function xn(e){return ri.call(e).slice(8,-1)}var Pn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",oi=typeof Pn=="symbol"?function(e){var t;return e!=null&&(t=e[Pn])&&t.apply(e)}:function(){return null};function ze(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var tt={};function Ne(e){var t,n,o,s;if(arguments.length===1){if(O(e))return e.slice();if(this===tt&&typeof e=="string")return[e];if(s=oi(e)){for(n=[];!(o=s.next()).done;)n.push(o.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var En=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},gt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],we=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(gt),ii={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function nt(e,t){this.name=e,this.message=t}function Ir(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,o,s){return s.indexOf(n)===o}).join(`
`)}function It(e,t,n,o){this.failures=t,this.failedKeys=o,this.successCount=n,this.message=Ir(e,t)}function rt(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Ir(e,this.failures)}$(nt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),$(It).from(nt),$(rt).from(nt);var Cn=we.reduce(function(e,t){return e[t]=t+"Error",e},{}),ai=nt,z=we.reduce(function(e,t){var n=t+"Error";function o(s,c){this.name=n,s?typeof s=="string"?(this.message="".concat(s).concat(c?`
 `+c:""),this.inner=c||null):typeof s=="object"&&(this.message="".concat(s.name," ").concat(s.message),this.inner=s):(this.message=ii[t]||n,this.inner=null)}return $(o).from(ai),e[t]=o,e},{});z.Syntax=SyntaxError,z.Type=TypeError,z.Range=RangeError;var jr=gt.reduce(function(e,t){return e[t+"Error"]=z[t],e},{}),jt=we.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=z[t]),e},{});function ne(){}function mt(e){return e}function si(e,t){return e==null||e===mt?t:function(n){return t(e(n))}}function He(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ui(e,t){return e===ne?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var o=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var c=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?He(o,this.onsuccess):o),s&&(this.onerror=this.onerror?He(s,this.onerror):s),c!==void 0?c:n}}function ci(e,t){return e===ne?t:function(){e.apply(this,arguments);var n=this.onsuccess,o=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?He(n,this.onsuccess):n),o&&(this.onerror=this.onerror?He(o,this.onerror):o)}}function li(e,t){return e===ne?t:function(n){var o=e.apply(this,arguments);D(n,o);var s=this.onsuccess,c=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?He(s,this.onsuccess):s),c&&(this.onerror=this.onerror?He(c,this.onerror):c),o===void 0?n===void 0?void 0:n:D(o,n)}}function fi(e,t){return e===ne?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Sn(e,t){return e===ne?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var o=this,s=arguments.length,c=new Array(s);s--;)c[s]=arguments[s];return n.then(function(){return t.apply(o,c)})}return t.apply(this,arguments)}}jt.ModifyError=It,jt.DexieError=nt,jt.BulkError=rt;var Pe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Br(e){Pe=e}var yt={},Fr=100,Te=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,q(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,q(t),e]}(),gt=Te[0],we=Te[1],Te=Te[2],we=we&&we.then,vt=gt&&gt.constructor,On=!!Te,bt=function(e,t){wt.push([e,t]),Bt&&(queueMicrotask(hi),Bt=!1)},kn=!0,Bt=!0,We=[],Ft=[],Nn=mt,je={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ne,pgp:!1,env:{},finalize:ne},U=je,wt=[],Ve=0,Kt=[];function K(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=U;if(typeof e!="function"){if(e!==yt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Tn(this,this._value))}this._state=null,this._value=null,++t.ref,function n(o,s){try{s(function(c){if(o._state===null){if(c===o)throw new TypeError("A promise cannot be resolved with itself.");var l=o._lib&&ot();c&&typeof c.then=="function"?n(o,function(h,v){c instanceof K?c._then(h,v):c.then(h,v)}):(o._state=!0,o._value=c,qr(o)),l&&it()}},Tn.bind(null,o))}catch(c){Tn(o,c)}}(this,e)}var An={get:function(){var e=U,t=Ut;function n(o,s){var c=this,l=!e.global&&(e!==U||t!==Ut),h=l&&!Fe(),v=new K(function(y,_){Rn(c,new Kr(Lr(o,e,l,h),Lr(s,e,l,h),y,_,e))});return this._consoleTask&&(v._consoleTask=this._consoleTask),v}return n.prototype=yt,n},set:function(e){L(this,"then",e&&e.prototype===yt?An:{get:function(){return e},set:An.set})}};function Kr(e,t,n,o,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=o,this.psd=s}function Tn(e,t){var n,o;Ft.push(t),e._state===null&&(n=e._lib&&ot(),t=Nn(t),e._state=!1,e._value=t,o=e,We.some(function(s){return s._value===o._value})||We.push(o),qr(e),n&&it())}function qr(e){var t=e._listeners;e._listeners=[];for(var n=0,o=t.length;n<o;++n)Rn(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),Ve===0&&(++Ve,bt(function(){--Ve==0&&Dn()},[]))}function Rn(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ve,bt(di,[n,e,t])}else e._listeners.push(t)}function di(e,t,n){try{var o,s=t._value;!t._state&&Ft.length&&(Ft=[]),o=Pe&&t._consoleTask?t._consoleTask.run(function(){return e(s)}):e(s),t._state||Ft.indexOf(s)!==-1||function(c){for(var l=We.length;l;)if(We[--l]._value===c._value)return We.splice(l,1)}(t),n.resolve(o)}catch(c){n.reject(c)}finally{--Ve==0&&Dn(),--n.psd.ref||n.psd.finalize()}}function hi(){Je(je,function(){ot()&&it()})}function ot(){var e=kn;return Bt=kn=!1,e}function it(){var e,t,n;do for(;0<wt.length;)for(e=wt,wt=[],n=e.length,t=0;t<n;++t){var o=e[t];o[0].apply(null,o[1])}while(0<wt.length);Bt=kn=!0}function Dn(){var e=We;We=[],e.forEach(function(o){o._PSD.onunhandled.call(null,o._value,o)});for(var t=Kt.slice(0),n=t.length;n;)t[--n]()}function qt(e){return new K(yt,!1,e)}function ae(e,t){var n=U;return function(){var o=ot(),s=U;try{return Ke(n,!0),e.apply(this,arguments)}catch(c){t&&t(c)}finally{Ke(s,!1),o&&it()}}}Y(K.prototype,{then:An,_then:function(e,t){Rn(this,new Kr(null,null,e,t,U))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(o){return(o instanceof t?n:qt)(o)}):this.then(null,function(o){return(o&&o.name===t?n:qt)(o)})},finally:function(e){return this.then(function(t){return K.resolve(e()).then(function(){return t})},function(t){return K.resolve(e()).then(function(){return qt(t)})})},timeout:function(e,t){var n=this;return e<1/0?new K(function(o,s){var c=setTimeout(function(){return s(new z.Timeout(t))},e);n.then(o,s).finally(clearTimeout.bind(null,c))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(K.prototype,Symbol.toStringTag,"Dexie.Promise"),je.env=Mr(),Y(K,{all:function(){var e=Ne.apply(null,arguments).map($t);return new K(function(t,n){e.length===0&&t([]);var o=e.length;e.forEach(function(s,c){return K.resolve(s).then(function(l){e[c]=l,--o||t(e)},n)})})},resolve:function(e){return e instanceof K?e:e&&typeof e.then=="function"?new K(function(t,n){e.then(t,n)}):new K(yt,!0,e)},reject:qt,race:function(){var e=Ne.apply(null,arguments).map($t);return new K(function(t,n){e.map(function(o){return K.resolve(o).then(t,n)})})},PSD:{get:function(){return U},set:function(e){return U=e}},totalEchoes:{get:function(){return Ut}},newPSD:Be,usePSD:Je,scheduler:{get:function(){return bt},set:function(e){bt=e}},rejectionMapper:{get:function(){return Nn},set:function(e){Nn=e}},follow:function(e,t){return new K(function(n,o){return Be(function(s,c){var l=U;l.unhandleds=[],l.onunhandled=c,l.finalize=He(function(){var h,v=this;h=function(){v.unhandleds.length===0?s():c(v.unhandleds[0])},Kt.push(function y(){h(),Kt.splice(Kt.indexOf(y),1)}),++Ve,bt(function(){--Ve==0&&Dn()},[])},l.finalize),e()},t,n,o)})}}),vt&&(vt.allSettled&&L(K,"allSettled",function(){var e=Ne.apply(null,arguments).map($t);return new K(function(t){e.length===0&&t([]);var n=e.length,o=new Array(n);e.forEach(function(s,c){return K.resolve(s).then(function(l){return o[c]={status:"fulfilled",value:l}},function(l){return o[c]={status:"rejected",reason:l}}).then(function(){return--n||t(o)})})})}),vt.any&&typeof AggregateError<"u"&&L(K,"any",function(){var e=Ne.apply(null,arguments).map($t);return new K(function(t,n){e.length===0&&n(new AggregateError([]));var o=e.length,s=new Array(o);e.forEach(function(c,l){return K.resolve(c).then(function(h){return t(h)},function(h){s[l]=h,--o||n(new AggregateError(s))})})})}));var fe={awaits:0,echoes:0,id:0},pi=0,Mt=[],Lt=0,Ut=0,mi=0;function Be(e,t,n,o){var s=U,c=Object.create(s);return c.parent=s,c.ref=0,c.global=!1,c.id=++mi,je.env,c.env=On?{Promise:K,PromiseProp:{value:K,configurable:!0,writable:!0},all:K.all,race:K.race,allSettled:K.allSettled,any:K.any,resolve:K.resolve,reject:K.reject}:{},t&&D(c,t),++s.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()},o=Je(c,e,n,o),c.ref===0&&c.finalize(),o}function at(){return fe.id||(fe.id=++pi),++fe.awaits,fe.echoes+=Fr,fe.id}function Fe(){return!!fe.awaits&&(--fe.awaits==0&&(fe.id=0),fe.echoes=fe.awaits*Fr,!0)}function $t(e){return fe.echoes&&e&&e.constructor===vt?(at(),e.then(function(t){return Fe(),t},function(t){return Fe(),ue(t)})):e}function yi(){var e=Mt[Mt.length-1];Mt.pop(),Ke(e,!1)}function Ke(e,t){var n,o=U;(t?!fe.echoes||Lt++&&e===U:!Lt||--Lt&&e===U)||queueMicrotask(t?function(s){++Ut,fe.echoes&&--fe.echoes!=0||(fe.echoes=fe.awaits=fe.id=0),Mt.push(U),Ke(s,!0)}.bind(null,e):yi),e!==U&&(U=e,o===je&&(je.env=Mr()),On&&(n=je.env.Promise,t=e.env,(o.global||e.global)&&(Object.defineProperty(f,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Mr(){var e=f.Promise;return On?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Je(e,t,n,o,s){var c=U;try{return Ke(e,!0),t(n,o,s)}finally{Ke(c,!1)}}function Lr(e,t,n,o){return typeof e!="function"?e:function(){var s=U;n&&at(),Ke(t,!0);try{return e.apply(this,arguments)}finally{Ke(s,!1),o&&queueMicrotask(Fe)}}}function In(e){Promise===vt&&fe.echoes===0?Lt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+we).indexOf("[native code]")===-1&&(at=Fe=ne);var ue=K.reject,Ge="￿",Ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ur="String expected.",st=[],zt="__dbnames",jn="readonly",Bn="readwrite";function Xe(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var $r={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ht(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Ie(t))[e],t}}function zr(){throw z.Type()}function ee(e,t){try{var n=Hr(e),o=Hr(t);if(n!==o)return n==="Array"?1:o==="Array"?-1:n==="binary"?1:o==="binary"?-1:n==="string"?1:o==="string"?-1:n==="Date"?1:o!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(s,c){for(var l=s.length,h=c.length,v=l<h?l:h,y=0;y<v;++y)if(s[y]!==c[y])return s[y]<c[y]?-1:1;return l===h?0:l<h?-1:1}(Wr(e),Wr(t));case"Array":return function(s,c){for(var l=s.length,h=c.length,v=l<h?l:h,y=0;y<v;++y){var _=ee(s[y],c[y]);if(_!==0)return _}return l===h?0:l<h?-1:1}(e,t)}}catch{}return NaN}function Hr(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=xn(e),e==="ArrayBuffer"?"binary":e)}function Wr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Vr=(oe.prototype._trans=function(e,t,n){var o=this._tx||U.trans,s=this.name,c=Pe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function l(y,_,m){if(!m.schema[s])throw new z.NotFound("Table "+s+" not part of transaction");return t(m.idbtrans,m)}var h=ot();try{var v=o&&o.db._novip===this.db._novip?o===U.trans?o._promise(e,l,n):Be(function(){return o._promise(e,l,n)},{trans:o,transless:U.transless||U}):function y(_,m,x,g){if(_.idbdb&&(_._state.openComplete||U.letThrough||_._vip)){var w=_._createTransaction(m,x,_._dbSchema);try{w.create(),_._state.PR1398_maxLoop=3}catch(P){return P.name===Cn.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return y(_,m,x,g)})):ue(P)}return w._promise(m,function(P,b){return Be(function(){return U.trans=w,g(P,b,w)})}).then(function(P){if(m==="readwrite")try{w.idbtrans.commit()}catch{}return m==="readonly"?P:w._completion.then(function(){return P})})}if(_._state.openComplete)return ue(new z.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._state.autoOpen)return ue(new z.DatabaseClosed);_.open().catch(ne)}return _._state.dbReadyPromise.then(function(){return y(_,m,x,g)})}(this.db,e,[this.name],l);return c&&(v._consoleTask=c,v=v.catch(function(y){return console.trace(y),ue(y)})),v}finally{h&&it()}},oe.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?ue(new z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(o){return n.core.get({trans:o,key:e}).then(function(s){return n.hook.reading.fire(s)})}).then(t)},oe.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(O(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=p(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(v){if(v.compound&&t.every(function(_){return 0<=v.keyPath.indexOf(_)})){for(var y=0;y<t.length;++y)if(t.indexOf(v.keyPath[y])===-1)return!1;return!0}return!1}).sort(function(v,y){return v.keyPath.length-y.keyPath.length})[0];if(n&&this.db._maxKey!==Ge){var l=n.keyPath.slice(0,t.length);return this.where(l).equals(l.map(function(y){return e[y]}))}!n&&Pe&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var o=this.schema.idxByName,s=this.db._deps.indexedDB;function c(v,y){return s.cmp(v,y)===0}var h=t.reduce(function(x,y){var _=x[0],m=x[1],x=o[y],g=e[y];return[_||x,_||!x?Xe(m,x&&x.multi?function(w){return w=ke(w,y),O(w)&&w.some(function(P){return c(g,P)})}:function(w){return c(g,ke(w,y))}):m]},[null,null]),l=h[0],h=h[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(h):n?this.filter(h):this.where(t).equals("")},oe.prototype.filter=function(e){return this.toCollection().and(e)},oe.prototype.count=function(e){return this.toCollection().count(e)},oe.prototype.offset=function(e){return this.toCollection().offset(e)},oe.prototype.limit=function(e){return this.toCollection().limit(e)},oe.prototype.each=function(e){return this.toCollection().each(e)},oe.prototype.toArray=function(e){return this.toCollection().toArray(e)},oe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},oe.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,O(e)?"[".concat(e.join("+"),"]"):e))},oe.prototype.reverse=function(){return this.toCollection().reverse()},oe.prototype.mapToClass=function(e){var t,n=this.db,o=this.name;function s(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof zr&&(function(v,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function _(){this.constructor=v}a(v,y),v.prototype=y===null?Object.create(y):(_.prototype=y.prototype,new _)}(s,t=e),Object.defineProperty(s.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),s.prototype.table=function(){return o},e=s);for(var c=new Set,l=e.prototype;l;l=q(l))Object.getOwnPropertyNames(l).forEach(function(v){return c.add(v)});function h(v){if(!v)return v;var y,_=Object.create(e.prototype);for(y in v)if(!c.has(y))try{_[y]=v[y]}catch{}return _}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=h,this.hook("reading",h),e},oe.prototype.defineClass=function(){return this.mapToClass(function(e){D(this,e)})},oe.prototype.add=function(e,t){var n=this,o=this.schema.primKey,s=o.auto,c=o.keyPath,l=e;return c&&s&&(l=Ht(c)(e)),this._trans("readwrite",function(h){return n.core.mutate({trans:h,type:"add",keys:t!=null?[t]:null,values:[l]})}).then(function(h){return h.numFailures?K.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{ve(e,c,h)}catch{}return h})},oe.prototype.update=function(e,t){return typeof e!="object"||O(e)?this.where(":id").equals(e).modify(t):(e=ke(e,this.schema.primKey.keyPath),e===void 0?ue(new z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},oe.prototype.put=function(e,t){var n=this,o=this.schema.primKey,s=o.auto,c=o.keyPath,l=e;return c&&s&&(l=Ht(c)(e)),this._trans("readwrite",function(h){return n.core.mutate({trans:h,type:"put",values:[l],keys:t!=null?[t]:null})}).then(function(h){return h.numFailures?K.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{ve(e,c,h)}catch{}return h})},oe.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?K.reject(n.failures[0]):void 0})},oe.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:$r})}).then(function(t){return t.numFailures?K.reject(t.failures[0]):void 0})},oe.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(o){return o.map(function(s){return t.hook.reading.fire(s)})})})},oe.prototype.bulkAdd=function(e,t,n){var o=this,s=Array.isArray(t)?t:void 0,c=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(l){var y=o.schema.primKey,h=y.auto,y=y.keyPath;if(y&&s)throw new z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var v=e.length,y=y&&h?e.map(Ht(y)):e;return o.core.mutate({trans:l,type:"add",keys:s,values:y,wantResults:c}).then(function(w){var m=w.numFailures,x=w.results,g=w.lastResult,w=w.failures;if(m===0)return c?x:g;throw new rt("".concat(o.name,".bulkAdd(): ").concat(m," of ").concat(v," operations failed"),w)})})},oe.prototype.bulkPut=function(e,t,n){var o=this,s=Array.isArray(t)?t:void 0,c=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(l){var y=o.schema.primKey,h=y.auto,y=y.keyPath;if(y&&s)throw new z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var v=e.length,y=y&&h?e.map(Ht(y)):e;return o.core.mutate({trans:l,type:"put",keys:s,values:y,wantResults:c}).then(function(w){var m=w.numFailures,x=w.results,g=w.lastResult,w=w.failures;if(m===0)return c?x:g;throw new rt("".concat(o.name,".bulkPut(): ").concat(m," of ").concat(v," operations failed"),w)})})},oe.prototype.bulkUpdate=function(e){var t=this,n=this.core,o=e.map(function(l){return l.key}),s=e.map(function(l){return l.changes}),c=[];return this._trans("readwrite",function(l){return n.getMany({trans:l,keys:o,cache:"clone"}).then(function(h){var v=[],y=[];e.forEach(function(m,x){var g=m.key,w=m.changes,P=h[x];if(P){for(var b=0,E=Object.keys(w);b<E.length;b++){var C=E[b],S=w[C];if(C===t.schema.primKey.keyPath){if(ee(S,g)!==0)throw new z.Constraint("Cannot update primary key in bulkUpdate()")}else ve(P,C,S)}c.push(x),v.push(g),y.push(P)}});var _=v.length;return n.mutate({trans:l,type:"put",keys:v,values:y,updates:{keys:o,changeSpecs:s}}).then(function(m){var x=m.numFailures,g=m.failures;if(x===0)return _;for(var w=0,P=Object.keys(g);w<P.length;w++){var b,E=P[w],C=c[Number(E)];C!=null&&(b=g[E],delete g[E],g[C]=b)}throw new rt("".concat(t.name,".bulkUpdate(): ").concat(x," of ").concat(_," operations failed"),g)})})})},oe.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(o){return t.core.mutate({trans:o,type:"delete",keys:e})}).then(function(l){var s=l.numFailures,c=l.lastResult,l=l.failures;if(s===0)return c;throw new rt("".concat(t.name,".bulkDelete(): ").concat(s," of ").concat(n," operations failed"),l)})},oe);function oe(){}function _t(e){function t(l,h){if(h){for(var v=arguments.length,y=new Array(v-1);--v;)y[v-1]=arguments[v];return n[l].subscribe.apply(null,y),e}if(typeof l=="string")return n[l]}var n={};t.addEventType=c;for(var o=1,s=arguments.length;o<s;++o)c(arguments[o]);return t;function c(l,h,v){if(typeof l!="object"){var y;h=h||fi;var _={subscribers:[],fire:v=v||ne,subscribe:function(m){_.subscribers.indexOf(m)===-1&&(_.subscribers.push(m),_.fire=h(_.fire,m))},unsubscribe:function(m){_.subscribers=_.subscribers.filter(function(x){return x!==m}),_.fire=_.subscribers.reduce(h,v)}};return n[l]=t[l]=_}p(y=l).forEach(function(m){var x=y[m];if(O(x))c(m,y[m][0],y[m][1]);else{if(x!=="asap")throw new z.InvalidArgument("Invalid event config");var g=c(m,mt,function(){for(var w=arguments.length,P=new Array(w);w--;)P[w]=arguments[w];g.subscribers.forEach(function(b){Ar(function(){b.apply(null,P)})})})}})}}function xt(e,t){return $(t).from({prototype:e}),t}function ut(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Fn(e,t){e.filter=Xe(e.filter,t)}function Kn(e,t,n){var o=e.replayFilter;e.replayFilter=o?function(){return Xe(o(),t())}:t,e.justLimit=n&&!o}function Wt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new z.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Jr(e,t,n){var o=Wt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:o,range:e.range}})}function Vt(e,t,n,o){var s=e.replayFilter?Xe(e.filter,e.replayFilter()):e.filter;if(e.or){var c={},l=function(h,v,y){var _,m;s&&!s(v,y,function(x){return v.stop(x)},function(x){return v.fail(x)})||((m=""+(_=v.primaryKey))=="[object ArrayBuffer]"&&(m=""+new Uint8Array(_)),A(c,m)||(c[m]=!0,t(h,v,y)))};return Promise.all([e.or._iterate(l,n),Gr(Jr(e,o,n),e.algorithm,l,!e.keysOnly&&e.valueMapper)])}return Gr(Jr(e,o,n),Xe(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Gr(e,t,n,o){var s=ae(o?function(c,l,h){return n(o(c),l,h)}:n);return e.then(function(c){if(c)return c.start(function(){var l=function(){return c.continue()};t&&!t(c,function(h){return l=h},function(h){c.stop(h),l=ne},function(h){c.fail(h),l=ne})||s(c.value,c,function(h){return l=h}),l()})})}var Te=Symbol(),Pt=(Xr.prototype.execute=function(e){if(this.add!==void 0){var t=this.add;if(O(t))return d(d([],O(e)?e:[],!0),t,!0).sort();if(typeof t=="number")return(Number(e)||0)+t;if(typeof t=="bigint")try{return BigInt(e)+t}catch{return BigInt(0)+t}throw new TypeError("Invalid term ".concat(t))}if(this.remove!==void 0){var n=this.remove;if(O(n))return O(e)?e.filter(function(o){return!n.includes(o)}).sort():[];if(typeof n=="number")return Number(e)-n;if(typeof n=="bigint")try{return BigInt(e)-n}catch{return BigInt(0)-n}throw new TypeError("Invalid subtrahend ".concat(n))}return t=(t=this.replacePrefix)===null||t===void 0?void 0:t[0],t&&typeof e=="string"&&e.startsWith(t)?this.replacePrefix[1]+e.substring(t.length):e},Xr);function Xr(e){Object.assign(this,e)}var gi=(Z.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,ue.bind(null,n.error)):n.table._trans("readonly",e).then(t)},Z.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ue.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Z.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Xe(t.algorithm,e)},Z.prototype._iterate=function(e,t){return Vt(this._ctx,e,t,this._ctx.table.core)},Z.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&D(n,e),t._ctx=n,t},Z.prototype.raw=function(){return this._ctx.valueMapper=null,this},Z.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Vt(t,e,n,t.table.core)})},Z.prototype.count=function(e){var t=this;return this._read(function(n){var o=t._ctx,s=o.table.core;if(ut(o,!0))return s.count({trans:n,query:{index:Wt(o,s.schema),range:o.range}}).then(function(l){return Math.min(l,o.limit)});var c=0;return Vt(o,function(){return++c,!1},n,s).then(function(){return c})}).then(e)},Z.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),o=n[0],s=n.length-1;function c(v,y){return y?c(v[n[y]],y-1):v[o]}var l=this._ctx.dir==="next"?1:-1;function h(v,y){return v=c(v,s),y=c(y,s),v<y?-l:y<v?l:0}return this.toArray(function(v){return v.sort(h)}).then(t)},Z.prototype.toArray=function(e){var t=this;return this._read(function(n){var o=t._ctx;if(o.dir==="next"&&ut(o,!0)&&0<o.limit){var s=o.valueMapper,c=Wt(o,o.table.core.schema);return o.table.core.query({trans:n,limit:o.limit,values:!0,query:{index:c,range:o.range}}).then(function(h){return h=h.result,s?h.map(s):h})}var l=[];return Vt(o,function(h){return l.push(h)},n,o.table.core).then(function(){return l})},e)},Z.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,ut(t)?Kn(t,function(){var n=e;return function(o,s){return n===0||(n===1?--n:s(function(){o.advance(n),n=0}),!1)}}):Kn(t,function(){var n=e;return function(){return--n<0}})),this},Z.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Kn(this._ctx,function(){var t=e;return function(n,o,s){return--t<=0&&o(s),0<=t}},!0),this},Z.prototype.until=function(e,t){return Fn(this._ctx,function(n,o,s){return!e(n.value)||(o(s),t)}),this},Z.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},Z.prototype.last=function(e){return this.reverse().first(e)},Z.prototype.filter=function(e){var t;return Fn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Xe(t.isMatch,e),this},Z.prototype.and=function(e){return this.filter(e)},Z.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Z.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Z.prototype.desc=function(){return this.reverse()},Z.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,o){e(o.key,o)})},Z.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Z.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,o){e(o.primaryKey,o)})},Z.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(o,s){n.push(s.key)}).then(function(){return n}).then(e)},Z.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&ut(t,!0)&&0<t.limit)return this._read(function(o){var s=Wt(t,t.table.core.schema);return t.table.core.query({trans:o,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(o){return o.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(o,s){n.push(s.primaryKey)}).then(function(){return n}).then(e)},Z.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Z.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},Z.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Z.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Fn(this._ctx,function(s){var o=s.primaryKey.toString(),s=A(t,o);return t[o]=!0,!s}),this},Z.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(o){var s,c,l;l=typeof e=="function"?e:(s=p(e),c=s.length,function(b){for(var E=!1,C=0;C<c;++C){var S=s[C],k=e[S],T=ke(b,S);k instanceof Pt?(ve(b,S,k.execute(T)),E=!0):T!==k&&(ve(b,S,k),E=!0)}return E});function h(b,S){var C=S.failures,S=S.numFailures;w+=b-S;for(var k=0,T=p(C);k<T.length;k++){var B=T[k];g.push(C[B])}}var v=n.table.core,y=v.schema.primaryKey,_=y.outbound,m=y.extractKey,x=t.db._options.modifyChunkSize||200,g=[],w=0,P=[];return t.clone().primaryKeys().then(function(b){function E(S){var k=Math.min(x,b.length-S);return v.getMany({trans:o,keys:b.slice(S,S+k),cache:"immutable"}).then(function(T){for(var B=[],R=[],j=_?[]:null,F=[],I=0;I<k;++I){var W=T[I],V={value:Ie(W),primKey:b[S+I]};l.call(V,V.value,V)!==!1&&(V.value==null?F.push(b[S+I]):_||ee(m(W),m(V.value))===0?(R.push(V.value),_&&j.push(b[S+I])):(F.push(b[S+I]),B.push(V.value)))}return Promise.resolve(0<B.length&&v.mutate({trans:o,type:"add",values:B}).then(function(X){for(var J in X.failures)F.splice(parseInt(J),1);h(B.length,X)})).then(function(){return(0<R.length||C&&typeof e=="object")&&v.mutate({trans:o,type:"put",keys:j,values:R,criteria:C,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<S}).then(function(X){return h(R.length,X)})}).then(function(){return(0<F.length||C&&e===qn)&&v.mutate({trans:o,type:"delete",keys:F,criteria:C,isAdditionalChunk:0<S}).then(function(X){return h(F.length,X)})}).then(function(){return b.length>S+k&&E(S+x)})})}var C=ut(n)&&n.limit===1/0&&(typeof e!="function"||e===qn)&&{index:n.index,range:n.range};return E(0).then(function(){if(0<g.length)throw new It("Error modifying one or more objects",g,w,P);return b.length})})})},Z.prototype.delete=function(){var e=this._ctx,t=e.range;return ut(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var o=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:n,query:{index:o,range:s}}).then(function(c){return e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(function(l){var h=l.failures;if(l.lastResult,l.results,l=l.numFailures,l)throw new It("Could not delete some values",Object.keys(h).map(function(v){return h[v]}),c-l);return c-l})})}):this.modify(qn)},Z);function Z(){}var qn=function(e,t){return t.value=null};function vi(e,t){return e<t?-1:e===t?0:1}function bi(e,t){return t<e?-1:e===t?0:1}function be(e,t,n){return e=e instanceof Qr?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function ct(e){return new e.Collection(e,function(){return Yr("")}).limit(0)}function Jt(e,t,n,o){var s,c,l,h,v,y,_,m=n.length;if(!n.every(function(w){return typeof w=="string"}))return be(e,Ur);function x(w){s=w==="next"?function(b){return b.toUpperCase()}:function(b){return b.toLowerCase()},c=w==="next"?function(b){return b.toLowerCase()}:function(b){return b.toUpperCase()},l=w==="next"?vi:bi;var P=n.map(function(b){return{lower:c(b),upper:s(b)}}).sort(function(b,E){return l(b.lower,E.lower)});h=P.map(function(b){return b.upper}),v=P.map(function(b){return b.lower}),_=(y=w)==="next"?"":o}x("next"),e=new e.Collection(e,function(){return qe(h[0],v[m-1]+o)}),e._ondirectionchange=function(w){x(w)};var g=0;return e._addAlgorithm(function(w,P,b){var E=w.key;if(typeof E!="string")return!1;var C=c(E);if(t(C,v,g))return!0;for(var S=null,k=g;k<m;++k){var T=function(B,R,j,F,I,W){for(var V=Math.min(B.length,F.length),X=-1,J=0;J<V;++J){var xe=R[J];if(xe!==F[J])return I(B[J],j[J])<0?B.substr(0,J)+j[J]+j.substr(J+1):I(B[J],F[J])<0?B.substr(0,J)+F[J]+j.substr(J+1):0<=X?B.substr(0,X)+R[X]+j.substr(X+1):null;I(B[J],xe)<0&&(X=J)}return V<F.length&&W==="next"?B+j.substr(B.length):V<B.length&&W==="prev"?B.substr(0,j.length):X<0?null:B.substr(0,X)+F[X]+j.substr(X+1)}(E,C,h[k],v[k],l,y);T===null&&S===null?g=k+1:(S===null||0<l(S,T))&&(S=T)}return P(S!==null?function(){w.continue(S+_)}:b),!1}),e}function qe(e,t,n,o){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:o}}function Yr(e){return{type:1,lower:e,upper:e}}var Qr=(Object.defineProperty(de.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),de.prototype.between=function(e,t,n,o){n=n!==!1,o=o===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||o)&&(!n||!o)?ct(this):new this.Collection(this,function(){return qe(e,t,!n,!o)})}catch{return be(this,Ae)}},de.prototype.equals=function(e){return e==null?be(this,Ae):new this.Collection(this,function(){return Yr(e)})},de.prototype.above=function(e){return e==null?be(this,Ae):new this.Collection(this,function(){return qe(e,void 0,!0)})},de.prototype.aboveOrEqual=function(e){return e==null?be(this,Ae):new this.Collection(this,function(){return qe(e,void 0,!1)})},de.prototype.below=function(e){return e==null?be(this,Ae):new this.Collection(this,function(){return qe(void 0,e,!1,!0)})},de.prototype.belowOrEqual=function(e){return e==null?be(this,Ae):new this.Collection(this,function(){return qe(void 0,e)})},de.prototype.startsWith=function(e){return typeof e!="string"?be(this,Ur):this.between(e,e+Ge,!0,!0)},de.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Jt(this,function(t,n){return t.indexOf(n[0])===0},[e],Ge)},de.prototype.equalsIgnoreCase=function(e){return Jt(this,function(t,n){return t===n[0]},[e],"")},de.prototype.anyOfIgnoreCase=function(){var e=Ne.apply(tt,arguments);return e.length===0?ct(this):Jt(this,function(t,n){return n.indexOf(t)!==-1},e,"")},de.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ne.apply(tt,arguments);return e.length===0?ct(this):Jt(this,function(t,n){return n.some(function(o){return t.indexOf(o)===0})},e,Ge)},de.prototype.anyOf=function(){var e=this,t=Ne.apply(tt,arguments),n=this._cmp;try{t.sort(n)}catch{return be(this,Ae)}if(t.length===0)return ct(this);var o=new this.Collection(this,function(){return qe(t[0],t[t.length-1])});o._ondirectionchange=function(c){n=c==="next"?e._ascending:e._descending,t.sort(n)};var s=0;return o._addAlgorithm(function(c,l,h){for(var v=c.key;0<n(v,t[s]);)if(++s===t.length)return l(h),!1;return n(v,t[s])===0||(l(function(){c.continue(t[s])}),!1)}),o},de.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},de.prototype.noneOf=function(){var e=Ne.apply(tt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return be(this,Ae)}var t=e.reduce(function(n,o){return n?n.concat([[n[n.length-1][1],o]]):[[-1/0,o]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},de.prototype.inAnyRange=function(E,t){var n=this,o=this._cmp,s=this._ascending,c=this._descending,l=this._min,h=this._max;if(E.length===0)return ct(this);if(!E.every(function(C){return C[0]!==void 0&&C[1]!==void 0&&s(C[0],C[1])<=0}))return be(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",z.InvalidArgument);var v=!t||t.includeLowers!==!1,y=t&&t.includeUppers===!0,_,m=s;function x(C,S){return m(C[0],S[0])}try{(_=E.reduce(function(C,S){for(var k=0,T=C.length;k<T;++k){var B=C[k];if(o(S[0],B[1])<0&&0<o(S[1],B[0])){B[0]=l(B[0],S[0]),B[1]=h(B[1],S[1]);break}}return k===T&&C.push(S),C},[])).sort(x)}catch{return be(this,Ae)}var g=0,w=y?function(C){return 0<s(C,_[g][1])}:function(C){return 0<=s(C,_[g][1])},P=v?function(C){return 0<c(C,_[g][0])}:function(C){return 0<=c(C,_[g][0])},b=w,E=new this.Collection(this,function(){return qe(_[0][0],_[_.length-1][1],!v,!y)});return E._ondirectionchange=function(C){m=C==="next"?(b=w,s):(b=P,c),_.sort(x)},E._addAlgorithm(function(C,S,k){for(var T,B=C.key;b(B);)if(++g===_.length)return S(k),!1;return!w(T=B)&&!P(T)||(n._cmp(B,_[g][1])===0||n._cmp(B,_[g][0])===0||S(function(){m===s?C.continue(_[g][0]):C.continue(_[g][1])}),!1)}),E},de.prototype.startsWithAnyOf=function(){var e=Ne.apply(tt,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?ct(this):this.inAnyRange(e.map(function(t){return[t,t+Ge]})):be(this,"startsWithAnyOf() only works with strings")},de);function de(){}function Ee(e){return ae(function(t){return Et(t),e(t.target.error),!1})}function Et(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Ct="storagemutated",Mn="x-storagemutated-1",Me=_t(null,Ct),wi=(Ce.prototype._lock=function(){return $e(!U.global),++this._reculock,this._reculock!==1||U.global||(U.lockOwnerFor=this),this},Ce.prototype._unlock=function(){if($e(!U.global),--this._reculock==0)for(U.global||(U.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Je(e[1],e[0])}catch{}}return this},Ce.prototype._locked=function(){return this._reculock&&U.lockOwnerFor!==this},Ce.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,o=this.db._state.dbOpenError;if($e(!this.idbtrans),!e&&!n)switch(o&&o.name){case"DatabaseClosedError":throw new z.DatabaseClosed(o);case"MissingAPIError":throw new z.MissingAPI(o.message,o);default:throw new z.OpenFailed(o)}if(!this.active)throw new z.TransactionInactive;return $e(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ae(function(s){Et(s),t._reject(e.error)}),e.onabort=ae(function(s){Et(s),t.active&&t._reject(new z.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=ae(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Me.storagemutated.fire(e.mutatedParts)}),this},Ce.prototype._promise=function(e,t,n){var o=this;if(e==="readwrite"&&this.mode!=="readwrite")return ue(new z.ReadOnly("Transaction is readonly"));if(!this.active)return ue(new z.TransactionInactive);if(this._locked())return new K(function(c,l){o._blockedFuncs.push([function(){o._promise(e,t,n).then(c,l)},U])});if(n)return Be(function(){var c=new K(function(l,h){o._lock();var v=t(l,h,o);v&&v.then&&v.then(l,h)});return c.finally(function(){return o._unlock()}),c._lib=!0,c});var s=new K(function(c,l){var h=t(c,l,o);h&&h.then&&h.then(c,l)});return s._lib=!0,s},Ce.prototype._root=function(){return this.parent?this.parent._root():this},Ce.prototype.waitFor=function(e){var t,n=this._root(),o=K.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return o}):(n._waitingFor=o,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function c(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=c)}());var s=n._waitingFor;return new K(function(c,l){o.then(function(h){return n._waitingQueue.push(ae(c.bind(null,h)))},function(h){return n._waitingQueue.push(ae(l.bind(null,h)))}).finally(function(){n._waitingFor===s&&(n._waitingFor=null)})})},Ce.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new z.Abort))},Ce.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(A(t,e))return t[e];var n=this.schema[e];if(!n)throw new z.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},Ce);function Ce(){}function Ln(e,t,n,o,s,c,l){return{name:e,keyPath:t,unique:n,multi:o,auto:s,compound:c,src:(n&&!l?"&":"")+(o?"*":"")+(s?"++":"")+Zr(t)}}function Zr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Un(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(o=function(s){return[s.name,s]},n.reduce(function(s,c,l){return l=o(c,l),l&&(s[l[0]]=l[1]),s},{}))};var o}var St=function(e){try{return e.only([[]]),St=function(){return[[]]},[[]]}catch{return St=function(){return Ge},Ge}};function $n(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return ke(n,t)}:function(n){return ke(n,e)};var t}function eo(e){return[].slice.call(e)}var _i=0;function Ot(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function xi(e,t,v){function o(b){if(b.type===3)return null;if(b.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var g=b.lower,w=b.upper,P=b.lowerOpen,b=b.upperOpen;return g===void 0?w===void 0?null:t.upperBound(w,!!b):w===void 0?t.lowerBound(g,!!P):t.bound(g,w,!!P,!!b)}function s(x){var g,w=x.name;return{name:w,schema:x,mutate:function(P){var b=P.trans,E=P.type,C=P.keys,S=P.values,k=P.range;return new Promise(function(T,B){T=ae(T);var R=b.objectStore(w),j=R.keyPath==null,F=E==="put"||E==="add";if(!F&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);var I,W=(C||S||{length:1}).length;if(C&&S&&C.length!==S.length)throw new Error("Given keys array must have same length as given values array.");if(W===0)return T({numFailures:0,failures:{},results:[],lastResult:void 0});function V(ge){++xe,Et(ge)}var X=[],J=[],xe=0;if(E==="deleteRange"){if(k.type===4)return T({numFailures:xe,failures:J,results:[],lastResult:void 0});k.type===3?X.push(I=R.clear()):X.push(I=R.delete(o(k)))}else{var j=F?j?[S,C]:[S,null]:[C,null],G=j[0],me=j[1];if(F)for(var ye=0;ye<W;++ye)X.push(I=me&&me[ye]!==void 0?R[E](G[ye],me[ye]):R[E](G[ye])),I.onerror=V;else for(ye=0;ye<W;++ye)X.push(I=R[E](G[ye])),I.onerror=V}function un(ge){ge=ge.target.result,X.forEach(function(Ze,ur){return Ze.error!=null&&(J[ur]=Ze.error)}),T({numFailures:xe,failures:J,results:E==="delete"?C:X.map(function(Ze){return Ze.result}),lastResult:ge})}I.onerror=function(ge){V(ge),un(ge)},I.onsuccess=un})},getMany:function(P){var b=P.trans,E=P.keys;return new Promise(function(C,S){C=ae(C);for(var k,T=b.objectStore(w),B=E.length,R=new Array(B),j=0,F=0,I=function(X){X=X.target,R[X._pos]=X.result,++F===j&&C(R)},W=Ee(S),V=0;V<B;++V)E[V]!=null&&((k=T.get(E[V]))._pos=V,k.onsuccess=I,k.onerror=W,++j);j===0&&C(R)})},get:function(P){var b=P.trans,E=P.key;return new Promise(function(C,S){C=ae(C);var k=b.objectStore(w).get(E);k.onsuccess=function(T){return C(T.target.result)},k.onerror=Ee(S)})},query:(g=y,function(P){return new Promise(function(b,E){b=ae(b);var C,S,k,j=P.trans,T=P.values,B=P.limit,I=P.query,R=B===1/0?void 0:B,F=I.index,I=I.range,j=j.objectStore(w),F=F.isPrimaryKey?j:j.index(F.name),I=o(I);if(B===0)return b({result:[]});g?((R=T?F.getAll(I,R):F.getAllKeys(I,R)).onsuccess=function(W){return b({result:W.target.result})},R.onerror=Ee(E)):(C=0,S=!T&&"openKeyCursor"in F?F.openKeyCursor(I):F.openCursor(I),k=[],S.onsuccess=function(W){var V=S.result;return V?(k.push(T?V.value:V.primaryKey),++C===B?b({result:k}):void V.continue()):b({result:k})},S.onerror=Ee(E))})}),openCursor:function(P){var b=P.trans,E=P.values,C=P.query,S=P.reverse,k=P.unique;return new Promise(function(T,B){T=ae(T);var F=C.index,R=C.range,j=b.objectStore(w),j=F.isPrimaryKey?j:j.index(F.name),F=S?k?"prevunique":"prev":k?"nextunique":"next",I=!E&&"openKeyCursor"in j?j.openKeyCursor(o(R),F):j.openCursor(o(R),F);I.onerror=Ee(B),I.onsuccess=ae(function(W){var V,X,J,xe,G=I.result;G?(G.___id=++_i,G.done=!1,V=G.continue.bind(G),X=(X=G.continuePrimaryKey)&&X.bind(G),J=G.advance.bind(G),xe=function(){throw new Error("Cursor not stopped")},G.trans=b,G.stop=G.continue=G.continuePrimaryKey=G.advance=function(){throw new Error("Cursor not started")},G.fail=ae(B),G.next=function(){var me=this,ye=1;return this.start(function(){return ye--?me.continue():me.stop()}).then(function(){return me})},G.start=function(me){function ye(){if(I.result)try{me()}catch(ge){G.fail(ge)}else G.done=!0,G.start=function(){throw new Error("Cursor behind last entry")},G.stop()}var un=new Promise(function(ge,Ze){ge=ae(ge),I.onerror=Ee(Ze),G.fail=Ze,G.stop=function(ur){G.stop=G.continue=G.continuePrimaryKey=G.advance=xe,ge(ur)}});return I.onsuccess=ae(function(ge){I.onsuccess=ye,ye()}),G.continue=V,G.continuePrimaryKey=X,G.advance=J,ye(),un},T(G)):T(null)},B)})},count:function(P){var b=P.query,E=P.trans,C=b.index,S=b.range;return new Promise(function(k,T){var B=E.objectStore(w),R=C.isPrimaryKey?B:B.index(C.name),B=o(S),R=B?R.count(B):R.count();R.onsuccess=ae(function(j){return k(j.target.result)}),R.onerror=Ee(T)})}}}var c,l,h,_=(l=v,h=eo((c=e).objectStoreNames),{schema:{name:c.name,tables:h.map(function(x){return l.objectStore(x)}).map(function(x){var g=x.keyPath,b=x.autoIncrement,w=O(g),P={},b={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g==null,compound:w,keyPath:g,autoIncrement:b,unique:!0,extractKey:$n(g)},indexes:eo(x.indexNames).map(function(E){return x.index(E)}).map(function(k){var C=k.name,S=k.unique,T=k.multiEntry,k=k.keyPath,T={name:C,compound:O(k),keyPath:k,unique:S,multiEntry:T,extractKey:$n(k)};return P[Ot(k)]=T}),getIndexByKeyPath:function(E){return P[Ot(E)]}};return P[":id"]=b.primaryKey,g!=null&&(P[Ot(g)]=b.primaryKey),b})},hasGetAll:0<h.length&&"getAll"in l.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),v=_.schema,y=_.hasGetAll,_=v.tables.map(s),m={};return _.forEach(function(x){return m[x.name]=x}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(x){if(!m[x])throw new Error("Table '".concat(x,"' not found"));return m[x]},MIN_KEY:-1/0,MAX_KEY:St(t),schema:v}}function Pi(e,t,n,o){var s=n.IDBKeyRange;return n.indexedDB,{dbcore:(o=xi(t,s,o),e.dbcore.reduce(function(c,l){return l=l.create,u(u({},c),l(c))},o))}}function Gt(e,o){var n=o.db,o=Pi(e._middlewares,n,e._deps,o);e.core=o.dbcore,e.tables.forEach(function(s){var c=s.name;e.core.schema.tables.some(function(l){return l.name===c})&&(s.core=e.core.table(c),e[c]instanceof e.Table&&(e[c].core=s.core))})}function Xt(e,t,n,o){n.forEach(function(s){var c=o[s];t.forEach(function(l){var h=function v(y,_){return se(y,_)||(y=q(y))&&v(y,_)}(l,s);(!h||"value"in h&&h.value===void 0)&&(l===e.Transaction.prototype||l instanceof e.Transaction?L(l,s,{get:function(){return this.table(s)},set:function(v){re(this,s,{value:v,writable:!0,configurable:!0,enumerable:!0})}}):l[s]=new e.Table(s,c))})})}function zn(e,t){t.forEach(function(n){for(var o in n)n[o]instanceof e.Table&&delete n[o]})}function Ei(e,t){return e._cfg.version-t._cfg.version}function Ci(e,t,n,o){var s=e._dbSchema;n.objectStoreNames.contains("$meta")&&!s.$meta&&(s.$meta=Un("$meta",no("")[0],[]),e._storeNames.push("$meta"));var c=e._createTransaction("readwrite",e._storeNames,s);c.create(n),c._completion.catch(o);var l=c._reject.bind(c),h=U.transless||U;Be(function(){return U.trans=c,U.transless=h,t!==0?(Gt(e,n),y=t,((v=c).storeNames.includes("$meta")?v.table("$meta").get("version").then(function(_){return _??y}):K.resolve(y)).then(function(_){return x=_,g=c,w=n,P=[],_=(m=e)._versions,b=m._dbSchema=Qt(0,m.idbdb,w),(_=_.filter(function(E){return E._cfg.version>=x})).length!==0?(_.forEach(function(E){P.push(function(){var C=b,S=E._cfg.dbschema;Zt(m,C,w),Zt(m,S,w),b=m._dbSchema=S;var k=Hn(C,S);k.add.forEach(function(F){Wn(w,F[0],F[1].primKey,F[1].indexes)}),k.change.forEach(function(F){if(F.recreate)throw new z.Upgrade("Not yet support for changing primary key");var I=w.objectStore(F.name);F.add.forEach(function(W){return Yt(I,W)}),F.change.forEach(function(W){I.deleteIndex(W.name),Yt(I,W)}),F.del.forEach(function(W){return I.deleteIndex(W)})});var T=E._cfg.contentUpgrade;if(T&&E._cfg.version>x){Gt(m,w),g._memoizedTables={};var B=Tr(S);k.del.forEach(function(F){B[F]=C[F]}),zn(m,[m.Transaction.prototype]),Xt(m,[m.Transaction.prototype],p(B),B),g.schema=B;var R,j=En(T);return j&&at(),k=K.follow(function(){var F;(R=T(g))&&j&&(F=Fe.bind(null,null),R.then(F,F))}),R&&typeof R.then=="function"?K.resolve(R):k.then(function(){return R})}}),P.push(function(C){var S,k,T=E._cfg.dbschema;S=T,k=C,[].slice.call(k.db.objectStoreNames).forEach(function(B){return S[B]==null&&k.db.deleteObjectStore(B)}),zn(m,[m.Transaction.prototype]),Xt(m,[m.Transaction.prototype],m._storeNames,m._dbSchema),g.schema=m._dbSchema}),P.push(function(C){m.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(m.idbdb.version/10)===E._cfg.version?(m.idbdb.deleteObjectStore("$meta"),delete m._dbSchema.$meta,m._storeNames=m._storeNames.filter(function(S){return S!=="$meta"})):C.objectStore("$meta").put(E._cfg.version,"version"))})}),function E(){return P.length?K.resolve(P.shift()(g.idbtrans)).then(E):K.resolve()}().then(function(){to(b,w)})):K.resolve();var m,x,g,w,P,b}).catch(l)):(p(s).forEach(function(_){Wn(n,_,s[_].primKey,s[_].indexes)}),Gt(e,n),void K.follow(function(){return e.on.populate.fire(c)}).catch(l));var v,y})}function Si(e,t){to(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Qt(0,e.idbdb,t);Zt(e,e._dbSchema,t);for(var o=0,s=Hn(n,e._dbSchema).change;o<s.length;o++){var c=function(l){if(l.change.length||l.recreate)return console.warn("Unable to patch indexes of table ".concat(l.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=t.objectStore(l.name);l.add.forEach(function(v){Pe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(l.name,".").concat(v.src)),Yt(h,v)})}(s[o]);if(typeof c=="object")return c.value}}function Hn(e,t){var n,o={del:[],add:[],change:[]};for(n in e)t[n]||o.del.push(n);for(n in t){var s=e[n],c=t[n];if(s){var l={name:n,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||s.primKey.auto!==c.primKey.auto)l.recreate=!0,o.change.push(l);else{var h=s.idxByName,v=c.idxByName,y=void 0;for(y in h)v[y]||l.del.push(y);for(y in v){var _=h[y],m=v[y];_?_.src!==m.src&&l.change.push(m):l.add.push(m)}(0<l.del.length||0<l.add.length||0<l.change.length)&&o.change.push(l)}}else o.add.push([n,c])}return o}function Wn(e,t,n,o){var s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return o.forEach(function(c){return Yt(s,c)}),s}function to(e,t){p(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(Pe&&console.debug("Dexie: Creating missing table",n),Wn(t,n,e[n].primKey,e[n].indexes))})}function Yt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Qt(e,t,n){var o={};return he(t.objectStoreNames,0).forEach(function(s){for(var c=n.objectStore(s),l=Ln(Zr(y=c.keyPath),y||"",!0,!1,!!c.autoIncrement,y&&typeof y!="string",!0),h=[],v=0;v<c.indexNames.length;++v){var _=c.index(c.indexNames[v]),y=_.keyPath,_=Ln(_.name,y,!!_.unique,!!_.multiEntry,!1,y&&typeof y!="string",!1);h.push(_)}o[s]=Un(s,l,h)}),o}function Zt(e,t,n){for(var o=n.db.objectStoreNames,s=0;s<o.length;++s){var c=o[s],l=n.objectStore(c);e._hasGetAll="getAll"in l;for(var h=0;h<l.indexNames.length;++h){var v=l.indexNames[h],y=l.index(v).keyPath,_=typeof y=="string"?y:"["+he(y).join("+")+"]";!t[c]||(y=t[c].idxByName[_])&&(y.name=v,delete t[c].idxByName[_],t[c].idxByName[v]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function no(e){return e.split(",").map(function(t,n){var o=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Ln(o,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),O(s),n===0)})}var Oi=(en.prototype._parseStoresSpec=function(e,t){p(e).forEach(function(n){if(e[n]!==null){var o=no(e[n]),s=o.shift();if(s.unique=!0,s.multi)throw new z.Schema("Primary key cannot be multi-valued");o.forEach(function(c){if(c.auto)throw new z.Schema("Only primary key can be marked as autoIncrement (++)");if(!c.keyPath)throw new z.Schema("Index must have a name and cannot be an empty string")}),t[n]=Un(n,s,o)}})},en.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?D(this._cfg.storesSource,n):n;var n=t._versions,o={},s={};return n.forEach(function(c){D(o,c._cfg.storesSource),s=c._cfg.dbschema={},c._parseStoresSpec(o,s)}),t._dbSchema=s,zn(t,[t._allTables,t,t.Transaction.prototype]),Xt(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],p(s),s),t._storeNames=p(s),this},en.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Sn(this._cfg.contentUpgrade||ne,e),this},en);function en(){}function Vn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Re(zt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Jn(e){return e&&typeof e.databases=="function"}function Gn(e){return Be(function(){return U.letThrough=!0,e()})}function Xn(e){return!("from"in e)}var pe=function(e,t){if(!this){var n=new pe;return e&&"d"in e&&D(n,e),n}D(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function kt(e,t,n){var o=ee(t,n);if(!isNaN(o)){if(0<o)throw RangeError();if(Xn(e))return D(e,{from:t,to:n,d:1});var s=e.l,o=e.r;if(ee(n,e.from)<0)return s?kt(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ro(e);if(0<ee(t,e.to))return o?kt(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ro(e);ee(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),0<ee(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,s&&!e.l&&Nt(e,s),o&&n&&Nt(e,o)}}function Nt(e,t){Xn(t)||function n(o,v){var c=v.from,l=v.to,h=v.l,v=v.r;kt(o,c,l),h&&n(o,h),v&&n(o,v)}(e,t)}function tn(e,t){var n=Yn(t),o=n.next();if(o.done)return!1;for(var s=o.value,c=Yn(e),l=c.next(s.from),h=l.value;!o.done&&!l.done;){if(ee(h.from,s.to)<=0&&0<=ee(h.to,s.from))return!0;ee(s.from,h.from)<0?s=(o=n.next(h.from)).value:h=(l=c.next(s.from)).value}return!1}function Yn(e){var t=Xn(e)?null:{s:0,n:e};return{next:function(n){for(var o=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,o)for(;t.n.l&&ee(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!o||ee(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ro(e){var t,n,o=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),s=1<o?"r":o<-1?"l":"";s&&(t=s=="r"?"l":"r",n=u({},e),o=e[s],e.from=o.from,e.to=o.to,e[s]=o[s],n[s]=o[t],(e[t]=n).d=oo(n)),e.d=oo(e)}function oo(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function nn(e,t){return p(t).forEach(function(n){e[n]?Nt(e[n],t[n]):e[n]=function o(s){var c,l,h={};for(c in s)A(s,c)&&(l=s[c],h[c]=!l||typeof l!="object"||Dr.has(l.constructor)?l:o(l));return h}(t[n])}),e}function Qn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&tn(t[n],e[n])})}Y(pe.prototype,((we={add:function(e){return Nt(this,e),this},addKey:function(e){return kt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return kt(t,n,n)}),this}})[Pn]=function(){return Yn(this)},we));var Ye={},Zn={},er=!1;function rn(e){nn(Zn,e),er||(er=!0,setTimeout(function(){er=!1,tr(Zn,!(Zn={}))},0))}function tr(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var o=0,s=Object.values(Ye);o<s.length;o++)io(l=s[o],e,n,t);else for(var c in e){var l,h=/^idb\:\/\/(.*)\/(.*)\//.exec(c);h&&(c=h[1],h=h[2],(l=Ye["idb://".concat(c,"/").concat(h)])&&io(l,e,n,t))}n.forEach(function(v){return v()})}function io(e,t,n,o){for(var s=[],c=0,l=Object.entries(e.queries.query);c<l.length;c++){for(var h=l[c],v=h[0],y=[],_=0,m=h[1];_<m.length;_++){var x=m[_];Qn(t,x.obsSet)?x.subscribers.forEach(function(b){return n.add(b)}):o&&y.push(x)}o&&s.push([v,y])}if(o)for(var g=0,w=s;g<w.length;g++){var P=w[g],v=P[0],y=P[1];e.queries.query[v]=y}}function ki(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?ue(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var o=t.openCanceller,s=Math.round(10*e.verno),c=!1;function l(){if(t.openCanceller!==o)throw new z.DatabaseClosed("db.open() was cancelled")}function h(){return new K(function(x,g){if(l(),!n)throw new z.MissingAPI;var w=e.name,P=t.autoSchema||!s?n.open(w):n.open(w,s);if(!P)throw new z.MissingAPI;P.onerror=Ee(g),P.onblocked=ae(e._fireOnBlocked),P.onupgradeneeded=ae(function(b){var E;_=P.transaction,t.autoSchema&&!e._options.allowEmptyDB?(P.onerror=Et,_.abort(),P.result.close(),(E=n.deleteDatabase(w)).onsuccess=E.onerror=ae(function(){g(new z.NoSuchDatabase("Database ".concat(w," doesnt exist")))})):(_.onerror=Ee(g),b=b.oldVersion>Math.pow(2,62)?0:b.oldVersion,m=b<1,e.idbdb=P.result,c&&Si(e,_),Ci(e,b/10,_,g))},g),P.onsuccess=ae(function(){_=null;var b,E,C,S,k,T=e.idbdb=P.result,B=he(T.objectStoreNames);if(0<B.length)try{var R=T.transaction((S=B).length===1?S[0]:S,"readonly");if(t.autoSchema)E=T,C=R,(b=e).verno=E.version/10,C=b._dbSchema=Qt(0,E,C),b._storeNames=he(E.objectStoreNames,0),Xt(b,[b._allTables],p(C),C);else if(Zt(e,e._dbSchema,R),((k=Hn(Qt(0,(k=e).idbdb,R),k._dbSchema)).add.length||k.change.some(function(j){return j.add.length||j.change.length}))&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),T.close(),s=T.version+1,c=!0,x(h());Gt(e,R)}catch{}st.push(e),T.onversionchange=ae(function(j){t.vcFired=!0,e.on("versionchange").fire(j)}),T.onclose=ae(function(j){e.on("close").fire(j)}),m&&(k=e._deps,R=w,T=k.indexedDB,k=k.IDBKeyRange,Jn(T)||R===zt||Vn(T,k).put({name:R}).catch(ne)),x()},g)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<s)return s=0,h()}return K.reject(x)})}var v,y=t.dbReadyResolve,_=null,m=!1;return K.race([o,(typeof navigator>"u"?K.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function g(){return indexedDB.databases().finally(x)}v=setInterval(g,100),g()}).finally(function(){return clearInterval(v)}):Promise.resolve()).then(h)]).then(function(){return l(),t.onReadyBeingFired=[],K.resolve(Gn(function(){return e.on.ready.fire(e.vip)})).then(function x(){if(0<t.onReadyBeingFired.length){var g=t.onReadyBeingFired.reduce(Sn,ne);return t.onReadyBeingFired=[],K.resolve(Gn(function(){return g(e.vip)})).then(x)}})}).finally(function(){t.openCanceller===o&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(x){t.dbOpenError=x;try{_&&_.abort()}catch{}return o===t.openCanceller&&e._close(),ue(x)}).finally(function(){t.openComplete=!0,y()}).then(function(){var x;return m&&(x={},e.tables.forEach(function(g){g.schema.indexes.forEach(function(w){w.name&&(x["idb://".concat(e.name,"/").concat(g.name,"/").concat(w.name)]=new pe(-1/0,[[[]]]))}),x["idb://".concat(e.name,"/").concat(g.name,"/")]=x["idb://".concat(e.name,"/").concat(g.name,"/:dels")]=new pe(-1/0,[[[]]])}),Me(Ct).fire(x),tr(x,!0)),e})}function nr(e){function t(c){return e.next(c)}var n=s(t),o=s(function(c){return e.throw(c)});function s(c){return function(v){var h=c(v),v=h.value;return h.done?v:v&&typeof v.then=="function"?v.then(n,o):O(v)?Promise.all(v).then(n,o):n(v)}}return s(t)()}function on(e,t,n){for(var o=O(e)?e.slice():[e],s=0;s<n;++s)o.push(t);return o}var Ni={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return u(u({},e),{table:function(t){var n=e.table(t),o=n.schema,s={},c=[];function l(m,x,g){var w=Ot(m),P=s[w]=s[w]||[],b=m==null?0:typeof m=="string"?1:m.length,E=0<x,E=u(u({},g),{name:E?"".concat(w,"(virtual-from:").concat(g.name,")"):g.name,lowLevelIndex:g,isVirtual:E,keyTail:x,keyLength:b,extractKey:$n(m),unique:!E&&g.unique});return P.push(E),E.isPrimaryKey||c.push(E),1<b&&l(b===2?m[0]:m.slice(0,b-1),x+1,g),P.sort(function(C,S){return C.keyTail-S.keyTail}),E}t=l(o.primaryKey.keyPath,0,o.primaryKey),s[":id"]=[t];for(var h=0,v=o.indexes;h<v.length;h++){var y=v[h];l(y.keyPath,0,y)}function _(m){var x,g=m.query.index;return g.isVirtual?u(u({},m),{query:{index:g.lowLevelIndex,range:(x=m.query.range,g=g.keyTail,{type:x.type===1?2:x.type,lower:on(x.lower,x.lowerOpen?e.MAX_KEY:e.MIN_KEY,g),lowerOpen:!0,upper:on(x.upper,x.upperOpen?e.MIN_KEY:e.MAX_KEY,g),upperOpen:!0})}}):m}return u(u({},n),{schema:u(u({},o),{primaryKey:t,indexes:c,getIndexByKeyPath:function(m){return(m=s[Ot(m)])&&m[0]}}),count:function(m){return n.count(_(m))},query:function(m){return n.query(_(m))},openCursor:function(m){var x=m.query.index,g=x.keyTail,w=x.isVirtual,P=x.keyLength;return w?n.openCursor(_(m)).then(function(E){return E&&b(E)}):n.openCursor(m);function b(E){return Object.create(E,{continue:{value:function(C){C!=null?E.continue(on(C,m.reverse?e.MAX_KEY:e.MIN_KEY,g)):m.unique?E.continue(E.key.slice(0,P).concat(m.reverse?e.MIN_KEY:e.MAX_KEY,g)):E.continue()}},continuePrimaryKey:{value:function(C,S){E.continuePrimaryKey(on(C,e.MAX_KEY,g),S)}},primaryKey:{get:function(){return E.primaryKey}},key:{get:function(){var C=E.key;return P===1?C[0]:C.slice(0,P)}},value:{get:function(){return E.value}}})}}})}})}};function rr(e,t,n,o){return n=n||{},o=o||"",p(e).forEach(function(s){var c,l,h;A(t,s)?(c=e[s],l=t[s],typeof c=="object"&&typeof l=="object"&&c&&l?(h=xn(c))!==xn(l)?n[o+s]=t[s]:h==="Object"?rr(c,l,n,o+s+"."):c!==l&&(n[o+s]=t[s]):c!==l&&(n[o+s]=t[s])):n[o+s]=void 0}),p(t).forEach(function(s){A(e,s)||(n[o+s]=t[s])}),n}function or(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Ai={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return u(u({},e),{table:function(t){var n=e.table(t),o=n.schema.primaryKey;return u(u({},n),{mutate:function(s){var c=U.trans,l=c.table(t).hook,h=l.deleting,v=l.creating,y=l.updating;switch(s.type){case"add":if(v.fire===ne)break;return c._promise("readwrite",function(){return _(s)},!0);case"put":if(v.fire===ne&&y.fire===ne)break;return c._promise("readwrite",function(){return _(s)},!0);case"delete":if(h.fire===ne)break;return c._promise("readwrite",function(){return _(s)},!0);case"deleteRange":if(h.fire===ne)break;return c._promise("readwrite",function(){return function m(x,g,w){return n.query({trans:x,values:!1,query:{index:o,range:g},limit:w}).then(function(P){var b=P.result;return _({type:"delete",keys:b,trans:x}).then(function(E){return 0<E.numFailures?Promise.reject(E.failures[0]):b.length<w?{failures:[],numFailures:0,lastResult:void 0}:m(x,u(u({},g),{lower:b[b.length-1],lowerOpen:!0}),w)})})}(s.trans,s.range,1e4)},!0)}return n.mutate(s);function _(m){var x,g,w,P=U.trans,b=m.keys||or(o,m);if(!b)throw new Error("Keys missing");return(m=m.type==="add"||m.type==="put"?u(u({},m),{keys:b}):u({},m)).type!=="delete"&&(m.values=d([],m.values,!0)),m.keys&&(m.keys=d([],m.keys,!0)),x=n,w=b,((g=m).type==="add"?Promise.resolve([]):x.getMany({trans:g.trans,keys:w,cache:"immutable"})).then(function(E){var C=b.map(function(S,k){var T,B,R,j=E[k],F={onerror:null,onsuccess:null};return m.type==="delete"?h.fire.call(F,S,j,P):m.type==="add"||j===void 0?(T=v.fire.call(F,S,m.values[k],P),S==null&&T!=null&&(m.keys[k]=S=T,o.outbound||ve(m.values[k],o.keyPath,S))):(T=rr(j,m.values[k]),(B=y.fire.call(F,T,S,j,P))&&(R=m.values[k],Object.keys(B).forEach(function(I){A(R,I)?R[I]=B[I]:ve(R,I,B[I])}))),F});return n.mutate(m).then(function(S){for(var k=S.failures,T=S.results,B=S.numFailures,S=S.lastResult,R=0;R<b.length;++R){var j=(T||b)[R],F=C[R];j==null?F.onerror&&F.onerror(k[R]):F.onsuccess&&F.onsuccess(m.type==="put"&&E[R]?m.values[R]:j)}return{failures:k,results:T,numFailures:B,lastResult:S}}).catch(function(S){return C.forEach(function(k){return k.onerror&&k.onerror(S)}),Promise.reject(S)})})}}})}})}};function ao(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var o=[],s=0,c=0;s<t.keys.length&&c<e.length;++s)ee(t.keys[s],e[c])===0&&(o.push(n?Ie(t.values[s]):t.values[s]),++c);return o.length===e.length?o:null}catch{return null}}var Ti={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return u(u({},n),{getMany:function(o){if(!o.cache)return n.getMany(o);var s=ao(o.keys,o.trans._cache,o.cache==="clone");return s?K.resolve(s):n.getMany(o).then(function(c){return o.trans._cache={keys:o.keys,values:o.cache==="clone"?Ie(c):c},c})},mutate:function(o){return o.type!=="add"&&(o.trans._cache=null),n.mutate(o)}})}}}};function so(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function uo(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ri={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new pe(e.MIN_KEY,e.MAX_KEY);return u(u({},e),{transaction:function(o,s,c){if(U.subscr&&s!=="readonly")throw new z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(U.querier));return e.transaction(o,s,c)},table:function(o){var s=e.table(o),c=s.schema,l=c.primaryKey,m=c.indexes,h=l.extractKey,v=l.outbound,y=l.autoIncrement&&m.filter(function(g){return g.compound&&g.keyPath.includes(l.keyPath)}),_=u(u({},s),{mutate:function(g){function w(I){return I="idb://".concat(t,"/").concat(o,"/").concat(I),S[I]||(S[I]=new pe)}var P,b,E,C=g.trans,S=g.mutatedParts||(g.mutatedParts={}),k=w(""),T=w(":dels"),B=g.type,F=g.type==="deleteRange"?[g.range]:g.type==="delete"?[g.keys]:g.values.length<50?[or(l,g).filter(function(I){return I}),g.values]:[],R=F[0],j=F[1],F=g.trans._cache;return O(R)?(k.addKeys(R),(F=B==="delete"||R.length===j.length?ao(R,F):null)||T.addKeys(R),(F||j)&&(P=w,b=F,E=j,c.indexes.forEach(function(I){var W=P(I.name||"");function V(J){return J!=null?I.extractKey(J):null}function X(J){return I.multiEntry&&O(J)?J.forEach(function(xe){return W.addKey(xe)}):W.addKey(J)}(b||E).forEach(function(J,me){var G=b&&V(b[me]),me=E&&V(E[me]);ee(G,me)!==0&&(G!=null&&X(G),me!=null&&X(me))})}))):R?(j={from:R.lower,to:R.upper},T.add(j),k.add(j)):(k.add(n),T.add(n),c.indexes.forEach(function(I){return w(I.name).add(n)})),s.mutate(g).then(function(I){return!R||g.type!=="add"&&g.type!=="put"||(k.addKeys(I.results),y&&y.forEach(function(W){var V=g.values.map(function(J){return W.extractKey(J)}),X=W.keyPath.findIndex(function(J){return J===l.keyPath});I.results.forEach(function(J){return V[X]=J}),w(W.name).addKeys(V)})),C.mutatedParts=nn(C.mutatedParts||{},S),I})}}),m=function(w){var P=w.query,w=P.index,P=P.range;return[w,new pe((w=P.lower)!==null&&w!==void 0?w:e.MIN_KEY,(P=P.upper)!==null&&P!==void 0?P:e.MAX_KEY)]},x={get:function(g){return[l,new pe(g.key)]},getMany:function(g){return[l,new pe().addKeys(g.keys)]},count:m,query:m,openCursor:m};return p(x).forEach(function(g){_[g]=function(w){var P=U.subscr,b=!!P,E=so(U,s)&&uo(g,w)?w.obsSet={}:P;if(b){var C=function(j){return j="idb://".concat(t,"/").concat(o,"/").concat(j),E[j]||(E[j]=new pe)},S=C(""),k=C(":dels"),P=x[g](w),b=P[0],P=P[1];if((g==="query"&&b.isPrimaryKey&&!w.values?k:C(b.name||"")).add(P),!b.isPrimaryKey){if(g!=="count"){var T=g==="query"&&v&&w.values&&s.query(u(u({},w),{values:!1}));return s[g].apply(this,arguments).then(function(j){if(g==="query"){if(v&&w.values)return T.then(function(V){return V=V.result,S.addKeys(V),j});var F=w.values?j.result.map(h):j.result;(w.values?S:k).addKeys(F)}else if(g==="openCursor"){var I=j,W=w.values;return I&&Object.create(I,{key:{get:function(){return k.addKey(I.primaryKey),I.key}},primaryKey:{get:function(){var V=I.primaryKey;return k.addKey(V),V}},value:{get:function(){return W&&S.addKey(I.primaryKey),I.value}}})}return j})}k.add(n)}}return s[g].apply(this,arguments)}}),_}})}};function co(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var o=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===o?null:(t=u({},t),O(t.keys)&&(t.keys=t.keys.filter(function(s,c){return!(c in n.failures)})),"values"in t&&O(t.values)&&(t.values=t.values.filter(function(s,c){return!(c in n.failures)})),t)}function ir(e,t){return n=e,((o=t).lower===void 0||(o.lowerOpen?0<ee(n,o.lower):0<=ee(n,o.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?ee(e,t.upper)<0:ee(e,t.upper)<=0));var n,o}function lo(e,t,x,o,s,c){if(!x||x.length===0)return e;var l=t.query.index,h=l.multiEntry,v=t.query.range,y=o.schema.primaryKey.extractKey,_=l.extractKey,m=(l.lowLevelIndex||l).extractKey,x=x.reduce(function(g,w){var P=g,b=w.type==="add"||w.type==="put"?w.values.filter(function(k){return k=_(k),h&&O(k)?k.some(function(T){return ir(T,v)}):ir(k,v)}).map(function(k){return k=Ie(k),c&&Object.freeze(k),k}):[];switch(w.type){case"add":P=g.concat(t.values?b:b.map(function(T){return y(T)}));break;case"put":var E=new pe().addKeys(w.values.map(function(T){return y(T)})),P=g.filter(function(T){return T=t.values?y(T):T,!tn(new pe(T),E)}).concat(t.values?b:b.map(function(T){return y(T)}));break;case"delete":var C=new pe().addKeys(w.keys);P=g.filter(function(T){return T=t.values?y(T):T,!tn(new pe(T),C)});break;case"deleteRange":var S=w.range;P=g.filter(function(T){return!ir(y(T),S)})}return P},e);return x===e?e:(x.sort(function(g,w){return ee(m(g),m(w))||ee(y(g),y(w))}),t.limit&&t.limit<1/0&&(x.length>t.limit?x.length=t.limit:e.length===t.limit&&x.length<t.limit&&(s.dirty=!0)),c?Object.freeze(x):x)}function fo(e,t){return ee(e.lower,t.lower)===0&&ee(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Di(e,t){return function(n,o,s,c){if(n===void 0)return o!==void 0?-1:0;if(o===void 0)return 1;if((o=ee(n,o))===0){if(s&&c)return 0;if(s)return 1;if(c)return-1}return o}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,o,s,c){if(n===void 0)return o!==void 0?1:0;if(o===void 0)return-1;if((o=ee(n,o))===0){if(s&&c)return 0;if(s)return-1;if(c)return 1}return o}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Ii(e,t,n,o){e.subscribers.add(n),o.addEventListener("abort",function(){var s,c;e.subscribers.delete(n),e.subscribers.size===0&&(s=e,c=t,setTimeout(function(){s.subscribers.size===0&&ze(c,s)},3e3))})}var ji={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return u(u({},e),{transaction:function(n,o,s){var c,l,h=e.transaction(n,o,s);return o==="readwrite"&&(l=(c=new AbortController).signal,s=function(v){return function(){if(c.abort(),o==="readwrite"){for(var y=new Set,_=0,m=n;_<m.length;_++){var x=m[_],g=Ye["idb://".concat(t,"/").concat(x)];if(g){var w=e.table(x),P=g.optimisticOps.filter(function(W){return W.trans===h});if(h._explicit&&v&&h.mutatedParts)for(var b=0,E=Object.values(g.queries.query);b<E.length;b++)for(var C=0,S=(B=E[b]).slice();C<S.length;C++)Qn((R=S[C]).obsSet,h.mutatedParts)&&(ze(B,R),R.subscribers.forEach(function(W){return y.add(W)}));else if(0<P.length){g.optimisticOps=g.optimisticOps.filter(function(W){return W.trans!==h});for(var k=0,T=Object.values(g.queries.query);k<T.length;k++)for(var B,R,j,F=0,I=(B=T[k]).slice();F<I.length;F++)(R=I[F]).res!=null&&h.mutatedParts&&(v&&!R.dirty?(j=Object.isFrozen(R.res),j=lo(R.res,R.req,P,w,R,j),R.dirty?(ze(B,R),R.subscribers.forEach(function(W){return y.add(W)})):j!==R.res&&(R.res=j,R.promise=K.resolve({result:j}))):(R.dirty&&ze(B,R),R.subscribers.forEach(function(W){return y.add(W)})))}}}y.forEach(function(W){return W()})}}},h.addEventListener("abort",s(!1),{signal:l}),h.addEventListener("error",s(!1),{signal:l}),h.addEventListener("complete",s(!0),{signal:l})),h},table:function(n){var o=e.table(n),s=o.schema.primaryKey;return u(u({},o),{mutate:function(c){var l=U.trans;if(s.outbound||l.db._options.cache==="disabled"||l.explicit)return o.mutate(c);var h=Ye["idb://".concat(t,"/").concat(n)];return h?(l=o.mutate(c),c.type!=="add"&&c.type!=="put"||!(50<=c.values.length||or(s,c).some(function(v){return v==null}))?(h.optimisticOps.push(c),c.mutatedParts&&rn(c.mutatedParts),l.then(function(v){0<v.numFailures&&(ze(h.optimisticOps,c),(v=co(0,c,v))&&h.optimisticOps.push(v),c.mutatedParts&&rn(c.mutatedParts))}),l.catch(function(){ze(h.optimisticOps,c),c.mutatedParts&&rn(c.mutatedParts)})):l.then(function(v){var y=co(0,u(u({},c),{values:c.values.map(function(g,m){var x,g=(x=s.keyPath)!==null&&x!==void 0&&x.includes(".")?Ie(g):u({},g);return ve(g,s.keyPath,v.results[m]),g})}),v);h.optimisticOps.push(y),queueMicrotask(function(){return c.mutatedParts&&rn(c.mutatedParts)})}),l):o.mutate(c)},query:function(c){if(!so(U,o)||!uo("query",c))return o.query(c);var l=((y=U.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",m=U,h=m.requery,v=m.signal,y=function(w,P,b,E){var C=Ye["idb://".concat(w,"/").concat(P)];if(!C)return[];if(!(P=C.queries[b]))return[null,!1,C,null];var S=P[(E.query?E.query.index.name:null)||""];if(!S)return[null,!1,C,null];switch(b){case"query":var k=S.find(function(T){return T.req.limit===E.limit&&T.req.values===E.values&&fo(T.req.query.range,E.query.range)});return k?[k,!0,C,S]:[S.find(function(T){return("limit"in T.req?T.req.limit:1/0)>=E.limit&&(!E.values||T.req.values)&&Di(T.req.query.range,E.query.range)}),!1,C,S];case"count":return k=S.find(function(T){return fo(T.req.query.range,E.query.range)}),[k,!!k,C,S]}}(t,n,"query",c),_=y[0],m=y[1],x=y[2],g=y[3];return _&&m?_.obsSet=c.obsSet:(m=o.query(c).then(function(w){var P=w.result;if(_&&(_.res=P),l){for(var b=0,E=P.length;b<E;++b)Object.freeze(P[b]);Object.freeze(P)}else w.result=Ie(P);return w}).catch(function(w){return g&&_&&ze(g,_),Promise.reject(w)}),_={obsSet:c.obsSet,promise:m,subscribers:new Set,type:"query",req:c,dirty:!1},g?g.push(_):(g=[_],(x=x||(Ye["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[c.query.index.name||""]=g)),Ii(_,g,h,v),_.promise.then(function(w){return{result:lo(w.result,c,x?.optimisticOps,o,_,l)}})}})}})}};function an(e,t){return new Proxy(e,{get:function(n,o,s){return o==="db"?t:Reflect.get(n,o,s)}})}var Re=(ce.prototype.version=function(e){if(isNaN(e)||e<.1)throw new z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(o){return o._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Ei),n.stores({}),this._state.autoSchema=!1,n)},ce.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||U.letThrough||this._vip)?e():new K(function(n,o){if(t._state.openComplete)return o(new z.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void o(new z.DatabaseClosed);t.open().catch(ne)}t._state.dbReadyPromise.then(n,o)}).then(e)},ce.prototype.use=function(e){var t=e.stack,n=e.create,o=e.level,s=e.name;return s&&this.unuse({stack:t,name:s}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:o??10,name:s}),e.sort(function(c,l){return c.level-l.level}),this},ce.prototype.unuse=function(e){var t=e.stack,n=e.name,o=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return o?s.create!==o:!!n&&s.name!==n})),this},ce.prototype.open=function(){var e=this;return Je(je,function(){return ki(e)})},ce.prototype._close=function(){var e=this._state,t=st.indexOf(this);if(0<=t&&st.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new K(function(n){e.dbReadyResolve=n}),e.openCanceller=new K(function(n,o){e.cancelOpen=o}))},ce.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new z.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new z.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ce.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",o=this._state;return new K(function(s,c){function l(){t.close(e);var h=t._deps.indexedDB.deleteDatabase(t.name);h.onsuccess=ae(function(){var v,y,_;v=t._deps,y=t.name,_=v.indexedDB,v=v.IDBKeyRange,Jn(_)||y===zt||Vn(_,v).delete(y).catch(ne),s()}),h.onerror=Ee(c),h.onblocked=t._fireOnBlocked}if(n)throw new z.InvalidArgument("Invalid closeOptions argument to db.delete()");o.isBeingOpened?o.dbReadyPromise.then(l):l()})},ce.prototype.backendDB=function(){return this.idbdb},ce.prototype.isOpen=function(){return this.idbdb!==null},ce.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ce.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ce.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ce.prototype,"tables",{get:function(){var e=this;return p(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),ce.prototype.transaction=function(){var e=function(t,n,o){var s=arguments.length;if(s<2)throw new z.InvalidArgument("Too few arguments");for(var c=new Array(s-1);--s;)c[s-1]=arguments[s];return o=c.pop(),[t,Rr(c),o]}.apply(this,arguments);return this._transaction.apply(this,e)},ce.prototype._transaction=function(e,t,n){var o=this,s=U.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);var c,l,h=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(l=t.map(function(y){if(y=y instanceof o.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===jn)c=jn;else{if(e!="rw"&&e!=Bn)throw new z.InvalidArgument("Invalid transaction mode: "+e);c=Bn}if(s){if(s.mode===jn&&c===Bn){if(!h)throw new z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&l.forEach(function(y){if(s&&s.storeNames.indexOf(y)===-1){if(!h)throw new z.SubTransaction("Table "+y+" not included in parent transaction.");s=null}}),h&&s&&!s.active&&(s=null)}}catch(y){return s?s._promise(null,function(_,m){m(y)}):ue(y)}var v=function y(_,m,x,g,w){return K.resolve().then(function(){var P=U.transless||U,b=_._createTransaction(m,x,_._dbSchema,g);if(b.explicit=!0,P={trans:b,transless:P},g)b.idbtrans=g.idbtrans;else try{b.create(),b.idbtrans._explicit=!0,_._state.PR1398_maxLoop=3}catch(S){return S.name===Cn.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return y(_,m,x,null,w)})):ue(S)}var E,C=En(w);return C&&at(),P=K.follow(function(){var S;(E=w.call(b,b))&&(C?(S=Fe.bind(null,null),E.then(S,S)):typeof E.next=="function"&&typeof E.throw=="function"&&(E=nr(E)))},P),(E&&typeof E.then=="function"?K.resolve(E).then(function(S){return b.active?S:ue(new z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):P.then(function(){return E})).then(function(S){return g&&b._resolve(),b._completion.then(function(){return S})}).catch(function(S){return b._reject(S),ue(S)})})}.bind(null,this,c,l,s,n);return s?s._promise(c,v,"lock"):U.trans?Je(U.transless,function(){return o._whenReady(v)}):this._whenReady(v)},ce.prototype.table=function(e){if(!A(this._allTables,e))throw new z.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ce);function ce(e,t){var n=this;this._middlewares={},this.verno=0;var o=ce.dependencies;this._options=t=u({addons:ce.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},o=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,c,l,h,v,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};y.dbReadyPromise=new K(function(m){y.dbReadyResolve=m}),y.openCanceller=new K(function(m,x){y.cancelOpen=x}),this._state=y,this.name=e,this.on=_t(this,"populate","blocked","versionchange","close",{ready:[Sn,ne]}),this.on.ready.subscribe=te(this.on.ready.subscribe,function(m){return function(x,g){ce.vip(function(){var w,P=n._state;P.openComplete?(P.dbOpenError||K.resolve().then(x),g&&m(x)):P.onReadyBeingFired?(P.onReadyBeingFired.push(x),g&&m(x)):(m(x),w=n,g||m(function b(){w.on.ready.unsubscribe(x),w.on.ready.unsubscribe(b)}))})}}),this.Collection=(s=this,xt(gi.prototype,function(E,b){this.db=s;var g=$r,w=null;if(b)try{g=b()}catch(C){w=C}var P=E._ctx,b=P.table,E=b.hook.reading.fire;this._ctx={table:b,index:P.index,isPrimKey:!P.index||b.schema.primKey.keyPath&&P.index===b.schema.primKey.name,range:g,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:w,or:P.or,valueMapper:E!==mt?E:null}})),this.Table=(c=this,xt(Vr.prototype,function(m,x,g){this.db=c,this._tx=g,this.name=m,this.schema=x,this.hook=c._allTables[m]?c._allTables[m].hook:_t(null,{creating:[ui,ne],reading:[si,mt],updating:[li,ne],deleting:[ci,ne]})})),this.Transaction=(l=this,xt(wi.prototype,function(m,x,g,w,P){var b=this;this.db=l,this.mode=m,this.storeNames=x,this.schema=g,this.chromeTransactionDurability=w,this.idbtrans=null,this.on=_t(this,"complete","error","abort"),this.parent=P||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new K(function(E,C){b._resolve=E,b._reject=C}),this._completion.then(function(){b.active=!1,b.on.complete.fire()},function(E){var C=b.active;return b.active=!1,b.on.error.fire(E),b.parent?b.parent._reject(E):C&&b.idbtrans&&b.idbtrans.abort(),ue(E)})})),this.Version=(h=this,xt(Oi.prototype,function(m){this.db=h,this._cfg={version:m,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(v=this,xt(Qr.prototype,function(m,x,g){if(this.db=v,this._ctx={table:m,index:x===":id"?null:x,or:g},this._cmp=this._ascending=ee,this._descending=function(w,P){return ee(P,w)},this._max=function(w,P){return 0<ee(w,P)?w:P},this._min=function(w,P){return ee(w,P)<0?w:P},this._IDBKeyRange=v._deps.IDBKeyRange,!this._IDBKeyRange)throw new z.MissingAPI})),this.on("versionchange",function(m){0<m.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(m){!m.newVersion||m.newVersion<m.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(m.oldVersion/10))}),this._maxKey=St(t.IDBKeyRange),this._createTransaction=function(m,x,g,w){return new n.Transaction(m,x,g,n._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(m){n.on("blocked").fire(m),st.filter(function(x){return x.name===n.name&&x!==n&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(m)})},this.use(Ti),this.use(ji),this.use(Ri),this.use(Ni),this.use(Ai);var _=new Proxy(this,{get:function(m,x,g){if(x==="_vip")return!0;if(x==="table")return function(P){return an(n.table(P),_)};var w=Reflect.get(m,x,g);return w instanceof Vr?an(w,_):x==="tables"?w.map(function(P){return an(P,_)}):x==="_createTransaction"?function(){return an(w.apply(this,arguments),_)}:w}});this.vip=_,o.forEach(function(m){return m(n)})}var sn,we=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Bi=(ar.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},ar.prototype[we]=function(){return this},ar);function ar(e){this._subscribe=e}try{sn={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{sn={indexedDB:null,IDBKeyRange:null}}function ho(e){var t,n=!1,o=new Bi(function(s){var c=En(e),l,h=!1,v={},y={},_={get closed(){return h},unsubscribe:function(){h||(h=!0,l&&l.abort(),m&&Me.storagemutated.unsubscribe(g))}};s.start&&s.start(_);var m=!1,x=function(){return In(w)},g=function(P){nn(v,P),Qn(y,v)&&x()},w=function(){var P,b,E;!h&&sn.indexedDB&&(v={},P={},l&&l.abort(),l=new AbortController,E=function(C){var S=ot();try{c&&at();var k=Be(e,C);return k=c?k.finally(Fe):k}finally{S&&it()}}(b={subscr:P,signal:l.signal,requery:x,querier:e,trans:null}),Promise.resolve(E).then(function(C){n=!0,t=C,h||b.signal.aborted||(v={},function(S){for(var k in S)if(A(S,k))return;return 1}(y=P)||m||(Me(Ct,g),m=!0),In(function(){return!h&&s.next&&s.next(C)}))},function(C){n=!1,["DatabaseClosedError","AbortError"].includes(C?.name)||h||In(function(){h||s.error&&s.error(C)})}))};return setTimeout(x,0),_});return o.hasValue=function(){return n},o.getValue=function(){return t},o}var Qe=Re;function sr(e){var t=Le;try{Le=!0,Me.storagemutated.fire(e),tr(e,!0)}finally{Le=t}}Y(Qe,u(u({},jt),{delete:function(e){return new Qe(e,{addons:[]}).delete()},exists:function(e){return new Qe(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Qe.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(Jn(n)?Promise.resolve(n.databases()).then(function(o){return o.map(function(s){return s.name}).filter(function(s){return s!==zt})}):Vn(n,t).toCollection().primaryKeys()).then(e)}catch{return ue(new z.MissingAPI)}var t,n},defineClass:function(){return function(e){D(this,e)}},ignoreTransaction:function(e){return U.trans?Je(U.transless,e):e()},vip:Gn,async:function(e){return function(){try{var t=nr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:K.resolve(t)}catch(n){return ue(n)}}},spawn:function(e,t,n){try{var o=nr(e.apply(n,t||[]));return o&&typeof o.then=="function"?o:K.resolve(o)}catch(s){return ue(s)}},currentTransaction:{get:function(){return U.trans||null}},waitFor:function(e,t){return t=K.resolve(typeof e=="function"?Qe.ignoreTransaction(e):e).timeout(t||6e4),U.trans?U.trans.waitFor(t):t},Promise:K,debug:{get:function(){return Pe},set:function(e){Br(e)}},derive:$,extend:D,props:Y,override:te,Events:_t,on:Me,liveQuery:ho,extendObservabilitySet:nn,getByKeyPath:ke,setByKeyPath:ve,delByKeyPath:function(e,t){typeof t=="string"?ve(e,t,void 0):"length"in t&&[].map.call(t,function(n){ve(e,n,void 0)})},shallowClone:Tr,deepClone:Ie,getObjectDiff:rr,cmp:ee,asap:Ar,minKey:-1/0,addons:[],connections:st,errnames:Cn,dependencies:sn,cache:Ye,semVer:"4.0.7",version:"4.0.7".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Qe.maxKey=St(Qe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Me(Ct,function(e){Le||(e=new CustomEvent(Mn,{detail:e}),Le=!0,dispatchEvent(e),Le=!1)}),addEventListener(Mn,function(e){e=e.detail,Le||sr(e)}));var lt,Le=!1,po=function(){};return typeof BroadcastChannel<"u"&&((po=function(){(lt=new BroadcastChannel(Mn)).onmessage=function(e){return e.data&&sr(e.data)}})(),typeof lt.unref=="function"&&lt.unref(),Me(Ct,function(e){Le||lt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Re.disableBfCache&&e.persisted){Pe&&console.debug("Dexie: handling persisted pagehide"),lt?.close();for(var t=0,n=st;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Re.disableBfCache&&e.persisted&&(Pe&&console.debug("Dexie: handling persisted pageshow"),po(),sr({all:new pe(-1/0,[[]])}))})),K.rejectionMapper=function(e,t){return!e||e instanceof nt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!jr[e.name]?e:(t=new jr[e.name](t||e.message,e),"stack"in e&&L(t,"stack",{get:function(){return this.inner.stack}}),t)},Br(Pe),u(Re,Object.freeze({__proto__:null,Dexie:Re,liveQuery:ho,Entity:zr,cmp:ee,PropModSymbol:Te,PropModification:Pt,replacePrefix:function(e,t){return new Pt({replacePrefix:[e,t]})},add:function(e){return new Pt({add:e})},remove:function(e){return new Pt({remove:e})},default:Re,RangeSet:pe,mergeRanges:Nt,rangesOverlap:tn}),{default:Re}),Re})})(ti);var Bs=ti.exports;const xr=ta(Bs),ko=Symbol.for("Dexie"),Pr=globalThis[ko]||(globalThis[ko]=xr);if(xr.semVer!==Pr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${xr.semVer} and ${Pr.semVer}`);class Fs extends Pr{constructor(){super("NPCDatabase"),this.version(3).stores({npcs:"id,name",sprites:"id",avatars:"id",dialogues:"id"}),this.npcs=this.table("npcs"),this.sprites=this.table("sprites"),this.avatars=this.table("avatars"),this.dialogues=this.table("dialogues")}async addNPC(r){await this.npcs.put(r)}async getNPC(r){return await this.npcs.get(r)}async getNPCByName(r){return await this.npcs.where("name").equals(r).first()}async getAllNPCs(){return await this.npcs.toArray()}async exportNPCs(){const r=await this.getAllNPCs();return JSON.stringify(r,null,2)}async importNPCs(r){const a=JSON.parse(r);await this.npcs.bulkPut(a)}async fetchNPCData(r){try{return(await ie.get(r)).data}catch(a){H.error(`Failed to fetch NPC data from ${r}:`,a);return}}async addSprite(r){await this.sprites.put(r)}async getSprite(r){return await this.sprites.get(r)}async getAllSprites(){return await this.sprites.toArray()}async addAvatar(r){await this.avatars.put(r)}async getAvatar(r){return await this.avatars.get(r)}async getAllAvatars(){return await this.avatars.toArray()}async urlToBlob(r){try{return(await ie.get(r,{responseType:"blob"})).data}catch(a){H.error(`Failed to fetch blob from ${r}:`,a);return}}async addNewSprite(r,a){const u=await this.urlToBlob(r);if(u){const d={...a,spriteData:u};return await this.addSprite(d),d.id}}async addNewNPC(r,a,u){const d={...r,spriteImageId:a,avatarImageId:u};await this.addNPC(d)}async addNewAvatar(r,a){const u=await this.urlToBlob(r);if(u){const d={...a,avatarData:u};return await this.addAvatar(d),d.id}}async fetchAvatars(r){try{const u=(await ie.get(r)).data.key;for(const d in u){const f=u[d];let p=await this.urlToBlob(f.avatarLocation);if(p||(p=await this.urlToBlob(`https://kbve.com${f.avatarLocation}`)),p){const O={id:f.id,avatarName:f.avatarName,avatarLocation:f.avatarLocation,avatarData:p,slug:f.slug};await this.addAvatar(O)}}}catch(a){H.error(`Failed to fetch avatars from ${r}:`,a)}}async fetchSprites(r){try{const u=(await ie.get(r)).data.key;for(const d in u){const f=u[d];let p=await this.urlToBlob(f.assetLocation);if(p||(p=await this.urlToBlob(`https://kbve.com${f.assetLocation}`)),p){const O={id:f.id,spriteName:f.spriteName,assetLocation:f.assetLocation,frameWidth:f.frameWidth,frameHeight:f.frameHeight,scale:f.scale,slug:f.slug,spriteData:p};await this.addSprite(O)}}}catch(a){H.error(`Failed to fetch sprites from ${r}:`,a)}}async fetchNPCs(r){try{const u=(await ie.get(r)).data.key;for(const d in u){const f=u[d],p={id:f.id,name:f.name,spriteKey:f.spriteKey,walkingAnimationMapping:f.walkingAnimationMapping,startPosition:f.startPosition,speed:f.speed,scale:f.scale,slug:f.slug,actions:f.actions,effects:f.effects,stats:f.stats,spriteImageId:f.spriteImageId,avatarImageId:f.avatarImageId,dialogues:f.dialogues||[]};await this.addNPC(p)}}catch(a){H.error(`Failed to fetch NPCs from ${r}:`,a)}}async initializeDatabase(r="https://kbve.com"){await this.fetchAvatars(`${r}/api/avatardb.json`),await this.fetchSprites(`${r}/api/spritedb.json`),await this.fetchNPCs(`${r}/api/npcdb.json`),await this.fetchDialogues(`${r}/api/dialogue.json`)}async loadNPC(r,a,u,d){try{H.log(`Loading NPC with name: ${a}`);const f=await this.getNPCByName(a);if(!f)throw new Error(`NPC with name ${a} not found`);H.log(`NPC Data: ${JSON.stringify(f)}`),await this.loadCharacter(r,f.id,u,d)}catch(f){f instanceof Error?H.error(`Failed to load NPC: ${f.message}`):H.error("Failed to load NPC:",f)}}async loadCharacter(r,a,u,d){try{H.log(`Loading NPC with ID: ${a}`);const f=await this.getNPC(a);if(!f)throw new Error(`NPC with ID ${a} not found`);H.log(`NPC Data: ${JSON.stringify(f)}`);const p=f.spriteKey;if(r.textures.exists(p))H.log(`Texture with key ${p} already loaded.`),this.addNPCToScene(r,f,u,d);else{H.log(`Texture with key ${p} not found, attempting to load.`);const O=await this.getSprite(f.spriteImageId);if(O&&O.spriteData){H.log(`Sprite Data: ${JSON.stringify(O)}`);const D=URL.createObjectURL(O.spriteData);r.load.spritesheet(p,D,{frameWidth:O.frameWidth,frameHeight:O.frameHeight}),r.load.once("complete",()=>{H.log(`Texture ${p} loaded successfully.`),this.addNPCToScene(r,f,u,d)}),r.load.start()}else throw new Error(`Sprite with ID ${f.spriteImageId} not found`)}}catch(f){f instanceof Error?H.error(`Failed to load NPC: ${f.message}`):H.error("Failed to load NPC:",f)}}addNPCToScene(r,a,u,d){try{H.log(`Adding NPC to scene: ${JSON.stringify(a)}`),H.log(`Using sprite key: ${a.spriteKey}`);const f=r.add.sprite(0,0,a.spriteKey);f.scale=a.scale||1.5,f.name=a.id||"Error Missing Name",H.log(`NPC Sprite created with texture key ${a.spriteKey} at position (${a.startPosition.x}, ${a.startPosition.y})`);const p={id:a.id,sprite:f,walkingAnimationMapping:a.walkingAnimationMapping,startPosition:{x:u??a.startPosition.x,y:d??a.startPosition.y},speed:a.speed};if(H.log(`Grid engine config: ${JSON.stringify(p)}`),!r.textures.exists(a.spriteKey))throw new Error(`Texture with key ${a.spriteKey} does not exist in the scene`);r.gridEngine.addCharacter(p),H.log(`NPC added to grid engine with ID ${a.id}`),((D,q,M)=>{const A=r.gridEngine.getPosition(D.name);H.log(`Attaching NPC events to ${q} at position: ${JSON.stringify(A)}`),Ms.attachNPCEvent(D,q,M,{coords:A})})(f,a.name,a.actions.map(D=>({label:D}))),H.log(`NPC ${a.name} added to scene successfully`)}catch(f){f instanceof Error?H.error(`Error adding NPC to scene from addNPCToScene: ${f.message}`):H.error("Error adding NPC to scene:",f)}}async addDialogue(r){await this.dialogues.put(r)}async getDialogue(r){return await this.dialogues.get(r)}async getAllDialogues(){return await this.dialogues.toArray()}async getDialoguesForNPC(r){const a=await this.getNPC(r);if(!a)throw new Error(`NPC with ID ${r} not found`);return(await Promise.all((a.dialogues||[]).map(d=>this.getDialogue(d.dialogueId)))).filter(d=>d!==void 0)}async markDialogueAsRead(r,a){const u=await this.getNPC(r);if(!u)throw new Error(`NPC with ID ${r} not found`);const d=u.dialogues?.find(f=>f.dialogueId===a);d&&(d.read=!0,await this.addNPC(u))}async fetchDialogues(r){try{const u=(await ie.get(r)).data.key,d=Object.values(u).map(f=>({...f}));await this.dialogues.bulkPut(d)}catch(a){H.error(`Failed to fetch dialogues from ${r}:`,a)}}async getPrioritizedDialoguesForNPC(r){try{const a=await this.getNPC(r);if(!a)throw new Error(`NPC with ID ${r} not found`);const d=(await Promise.all((a.dialogues||[]).map(async f=>{const p=await this.getDialogue(f.dialogueId);return p?{...p,priority:f.priority,read:f.read}:null}))).filter(f=>f!==null);return d.sort((f,p)=>p.priority-f.priority),d}catch(a){return H.error(`Failed to get prioritized dialogues for NPC with ID ${r}:`,a),[]}}async getNPCNameById(r){return(await this.getNPC(r))?.name}async getNPCAvatarById(r){const a=await this.getNPC(r);if(a?.avatarImageId)return(await this.getAvatar(a.avatarImageId))?.avatarData}async getNPCSlugById(r){return(await this.getNPC(r))?.slug}async getNPCHealthById(r){try{return(await this.getNPC(r))?.stats?.health}catch(a){H.error(`Failed to get health for NPC with ID ${r}:`,a);return}}async getNPCManaById(r){try{return(await this.getNPC(r))?.stats?.mana}catch(a){H.error(`Failed to get mana for NPC with ID ${r}:`,a);return}}async createNPCSession(r,a){try{const u=this.getNPCNameById(a),d=this.getNPCSlugById(a),f=this.getNPCAvatarById(a),p=this.getNPCHealthById(a),O=this.getNPCManaById(a),[D,q,M,A,Y]=await Promise.all([u,d,f,p,O]),re={...r.get(),[`${a}_name`]:D||"Unknown",[`${a}_slug`]:q||"Unknown",[`${a}_avatar`]:M?URL.createObjectURL(M):"Unknown",[`${a}_health`]:A||"100",[`${a}_mana`]:Y||"100"};r.set(re)}catch{const d={...r.get(),[`${a}_name`]:"Unknown",[`${a}_slug`]:"Unknown",[`${a}_avatar`]:"Unknown",[`${a}_hp`]:"100",[`${a}_mana`]:"100"};r.set(d)}}}const Ks=new Fs;class qs{constructor(){this.actionHandlers={talk:this.talkToNPC.bind(this),quest:this.questWithNPC.bind(this),trade:this.tradeWithNPC.bind(this),combat:this.startCombat.bind(this),heal:this.healNPC.bind(this),steal:this.stealFromNPC.bind(this),lore:this.loreFromNPC.bind(this)}}getActionHandler(r){return this.actionHandlers[r]}loreFromNPC(r){H.log(`Pulling up the lore of the NPC with ID: ${r.npcId}`)}questWithNPC(r){H.log(`Starting quest with NPC with ID: ${r.npcId}`)}healNPC(r){H.log(`Healing NPC with ID: ${r.npcId}`)}async talkToNPC(r){try{H.log(`Talking to NPC with ID: ${r.npcId}`);const a=await Ks.getPrioritizedDialoguesForNPC(r.npcId);if(H.log(a),a.length>0){const u=a[0];ft.emit("npcDialogue",{npcId:r.npcId,dialogue:u},1e3)}else H.log("No dialogues available for this NPC.")}catch(a){H.error(`Failed to fetch dialogues for NPC with ID ${r.npcId}:`,a)}}tradeWithNPC(r){H.log(`Trading with NPC with ID: ${r.npcId}`)}moveToNPC(r){const u=r.data?.coords||{x:10,y:15};ft.emit("playerMove",u)}stealFromNPC(r){H.log(`Attempting to steal from NPC with ID: ${r.npcId}`);const a={npcId:r.npcId,npcName:r.npcName,data:r.data};ft.emit("playerSteal",a)}startCombat(r){H.log(`Starting combat with NPC with ID: ${r.npcId}`)}checkFish(r){H.log(`Checking fish for NPC with ID: ${r.npcId}`)}attachNPCEvent(r,a,u,d){r.setInteractive(),r.on("pointerover",f=>{const p={npcId:r.name||"",npcName:a,actions:u.map(O=>O.label),data:d||{},coords:{x:f.x,y:f.y}};ft.emit("npcInteraction",p)}),r.on("pointerout",()=>{}),r.on("pointerdown",f=>{const p={npcId:r.name||"",npcName:a,actions:u.map(O=>O.label),data:d||{},coords:{x:f.x,y:f.y}};H.log(`Click Registered at X: ${p.coords.x} Y: ${p.coords.y}`),ft.emit("npcInteractionClick",p,1e3)})}}const Ms=new qs,{document:pr}=Yi;function No(i){let r,a;return{c(){r=Hi("script"),this.h()},l(u){r=Wi(u,"SCRIPT",{src:!0});var d=Vi(r);d.forEach(hn),this.h()},h(){Ji(r.src,a=i[1])||Gi(r,"src",a),r.async=!0,r.defer=!0},m(u,d){Xi(u,r,d)},p:mr,d(u){u&&hn(r)}}}function Ls(i){let r,a=i[0]&&!window?.hcaptcha&&No(i);return{c(){a&&a.c(),r=mo()},l(u){const d=Mi("svelte-1lq4rqf",pr.head);a&&a.l(d),r=mo(),d.forEach(hn)},m(u,d){a&&a.m(pr.head,null),Li(pr.head,r)},p(u,[d]){u[0]&&!window?.hcaptcha?a?a.p(u,d):(a=No(u),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},i:mr,o:mr,d(u){a&&a.d(u),hn(r)}}}function Us(i,r,a){const u=Ui(),d=()=>{p&&O&&D&&hcaptcha.reset(D)},f=te=>{if(p&&O&&D)return hcaptcha.execute(D,te)};let p=!1,O=!1,D;const q={hl:"",sitekey:na,apihost:ra,reCaptchaCompat:!0,theme:Ao.DARK,size:"compact"},M=new URLSearchParams({recaptchacompat:"on",onload:"hcaptchaOnLoad",render:"explicit"}),A=`${q.apihost}?${M.toString()}`;let{baseClasses:Y="inline-flex w-full items-center justify-center gap-x-2 rounded-lg px-4 py-1 text-sm font-bold text-neutral-700 focus-visible:ring outline-none transition duration-300"}=r,{borderClasses:re="border border-transparent"}=r,{bgColorClasses:L="bg-yellow-400 dark:focus:outline-none"}=r,{hoverClasses:$="hover:bg-yellow-500"}=r,{fontSizeClasses:se="2xl:text-base"}=r,{disabledClasses:le="disabled:pointer-events-none disabled:opacity-50 disabled:animate-pulse"}=r,{ringClasses:he="ring-zinc-500 dark:ring-zinc-200"}=r;return $i(()=>{Is({elementIdOrName:"skeleton_login_loader",duration:500}),document.getElementById("astro_error_message")&&document.getElementById("astro_error_message"),window.hcaptchaOnLoad=()=>{u("load"),O=!0},window.onSuccess=te=>{u("success",{token:te})},window.onError=()=>{u("error")},window.onClose=()=>{u("close")},window.onExpired=()=>{u("expired"),d()},u("mount"),a(0,p=!0)}),zi(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,O&&(hcaptcha=null)}),i.$$set=te=>{"baseClasses"in te&&a(4,Y=te.baseClasses),"borderClasses"in te&&a(5,re=te.borderClasses),"bgColorClasses"in te&&a(6,L=te.bgColorClasses),"hoverClasses"in te&&a(7,$=te.hoverClasses),"fontSizeClasses"in te&&a(8,se=te.fontSizeClasses),"disabledClasses"in te&&a(9,le=te.disabledClasses),"ringClasses"in te&&a(10,he=te.ringClasses)},[p,A,d,f,Y,re,L,$,se,le,he]}class Xs extends Fi{constructor(r){super(),Ki(this,r,Us,Ls,qi,{reset:2,execute:3,baseClasses:4,borderClasses:5,bgColorClasses:6,hoverClasses:7,fontSizeClasses:8,disabledClasses:9,ringClasses:10})}get reset(){return this.$$.ctx[2]}get execute(){return this.$$.ctx[3]}}export{Xs as default};
