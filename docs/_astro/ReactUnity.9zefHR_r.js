import{r,j as t}from"./react.C2V1wh_4.js";import{K as I,k as c}from"./npchandler.Bw6Te69l.js";import"./@react-three.BOv1JqT7.js";import"./@supabase.DH5uoBuY.js";import"./Page.astro_astro_type_script_index_0_lang.COYkzBTz.js";import"./react-dom.D0pYwg_m.js";import"./scheduler.C323NY8X.js";import"./svelte.BG-3nfZ7.js";import"./esm-env.rsSWfq8L.js";import"./dexie.Db70IFYj.js";import"./@nanostores.4Ikc6yb_.js";import"./nanostores.Bo9-_MAV.js";import"./axios.Bw-gCGc_.js";const K=()=>{const[b,u]=r.useState(!1),[p,o]=r.useState(null),[m,h]=r.useState(null),[i,S]=r.useState({email:"",password:""}),[v,l]=r.useState(!1),[w,E]=r.useState(!1),s=r.useRef(null),f=e=>{const{name:n,value:a}=e.target;S(d=>({...d,[n]:a}))};r.useEffect(()=>{const e=document.createElement("script");return e.src="https://hcaptcha.com/1/api.js?onload=hcaptchaOnLoad&render=explicit",e.async=!0,e.defer=!0,document.body.appendChild(e),window.hcaptchaOnLoad=()=>{E(!0)},window.onSuccess=n=>{h(n)},window.onError=()=>{o("Captcha Error: Please try again."),s.current!==null&&window.hcaptcha.reset(s.current)},window.onExpired=()=>{h(null),o("Captcha expired: Please complete the captcha again."),s.current!==null&&window.hcaptcha.reset(s.current)},()=>{window.hcaptchaOnLoad=void 0,window.onSuccess=void 0,window.onError=void 0,window.onExpired=void 0,document.body.removeChild(e),s.current=null}},[]),r.useEffect(()=>{if(w&&window.hcaptcha){const e=window.hcaptcha.render("h-captcha",{sitekey:I.get().hcaptcha,callback:"onSuccess","expired-callback":"onExpired","error-callback":"onError"});s.current=e}},[w]),r.useEffect(()=>{const e=document.getElementById("skeleton");e?(e.style.transition="opacity 0.5s ease-out",e.style.opacity="0",setTimeout(()=>{e.remove(),l(!0)},500)):l(!0)},[]);const N=async()=>{if(o(null),!m){o("Please complete the captcha."),s.current!==null&&window.hcaptcha.reset(s.current);return}const e=await c.createActionULID("loginUser");try{if(await c.loginUser(i.email,i.password,e,m))if(u(!0),window.vuplex)try{const a=await c.getSupabaseClient();if(!a){console.error("Supabase client is not initialized."),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase client not initialized!"}));return}const{data:d,error:g}=await a.auth.refreshSession();if(g){console.error("Failed to refresh session:",g),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase Refresh Session"}));return}const{session:x,user:y}=d;if(!x||!y){console.error("Session or user data is missing."),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from Supabase User Data Missing"}));return}const k=JSON.stringify({type:"sessionUpdate",message:"User session updated successfully.",data:{session:x,user:y}});window.vuplex.postMessage(k),window.vuplex.postMessage(JSON.stringify({type:"confirm",message:"Hello from VuPlex"}))}catch(a){console.error("An error occurred while refreshing the session and sending data to Vuplex:",a),window.vuplex.postMessage(JSON.stringify({type:"error",message:"Error from KBVE Vuplex!"}))}else console.log("No Vuplex Found");else{const a=await c.getDetailedErrorByActionId(e);o(a||"Failed to log in. Please try again."),s.current!==null&&window.hcaptcha.reset(s.current)}}catch(n){console.error("Sign-in failed:",n),o("An error occurred during sign-in. Please try again."),s.current!==null&&window.hcaptcha.reset(s.current)}},j=e=>{e.preventDefault(),N()};return t.jsx("div",{className:"flex flex-col items-center justify-center h-screen p-4",children:b?t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg",children:"You are signed in!"}),t.jsx("button",{className:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition",onClick:()=>{u(!1),l(!0)},children:"Sign Out"})]}):t.jsxs("form",{className:`w-full max-w-sm transition-opacity duration-500 rounded-lg p-4 bg-yellow-50/60 dark:bg-neutral-500  ${v?"opacity-100":"opacity-0"}`,onSubmit:j,children:[t.jsx("h2",{className:"text-xl mb-4",children:"Sign In"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),t.jsx("input",{type:"email",id:"email",name:"email",className:"w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",value:i.email,onChange:f,required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Password"}),t.jsx("input",{type:"password",id:"password",name:"password",className:"w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",value:i.password,onChange:f,required:!0})]}),t.jsx("div",{className:"mb-4",children:t.jsx("div",{id:"h-captcha",className:"my-4"})}),t.jsx("button",{type:"submit",className:"w-full bg-cyan-500 text-white py-2 rounded hover:bg-cyan-600 transition",children:"Sign In"}),p&&t.jsx("p",{className:"text-red-500 mt-4",children:p})]})})};export{K as default};
