const __vite__fileDeps=["_astro/browser.BMICABTD.js","_astro/index.DQ2WTIsS.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as $t}from"./preload-helper.ygWHROA3.js";import{b as Vi,m as pa,p as ma,a as Wi}from"./index.CFX5TIQh.js";import{j as Kr}from"./jsx-runtime.CzgMDNMm.js";import{c as pi,g as ya,R as ga,r as Wn}from"./index.DQ2WTIsS.js";import{t as va}from"./index.BH1EYZ08.js";const mi={hcaptcha:"5ba581fa-b6fc-4bb0-8222-02fcd6a59e35",hcaptcha_api:"https://js.hcaptcha.com/1/api.js",api:"https://supabase.kbve.com",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.ewogICJyb2xlIjogImFub24iLAogICJpc3MiOiAic3VwYWJhc2UiLAogICJpYXQiOiAxNzI0NTM2ODAwLAogICJleHAiOiAxODgyMzAzMjAwCn0._fmEmblm0afeLoPXxt8wP2mYpa9gzU-ufx3v8oRTFGg"},yi={_state:{...mi},get(){return{...this._state}},set(i){this._state={...this._state,...i}},reset(){this._state={...mi}},toString(){return JSON.stringify(this._state,null,2)},getKey(i){return this._state[i]}};function Gi(i,e){return function(){return i.apply(e,arguments)}}const{toString:ba}=Object.prototype,{getPrototypeOf:bs}=Object,Qr=(i=>e=>{const t=ba.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ne=i=>(i=i.toLowerCase(),e=>Qr(e)===i),Zr=i=>e=>typeof e===i,{isArray:Ut}=Array,ur=Zr("undefined");function wa(i){return i!==null&&!ur(i)&&i.constructor!==null&&!ur(i.constructor)&&Te(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Yi=Ne("ArrayBuffer");function _a(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Yi(i.buffer),e}const ka=Zr("string"),Te=Zr("function"),Xi=Zr("number"),en=i=>i!==null&&typeof i=="object",Sa=i=>i===!0||i===!1,Vr=i=>{if(Qr(i)!=="object")return!1;const e=bs(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Ea=Ne("Date"),Pa=Ne("File"),Oa=Ne("Blob"),xa=Ne("FileList"),Ta=i=>en(i)&&Te(i.pipe),Aa=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Te(i.append)&&((e=Qr(i))==="formdata"||e==="object"&&Te(i.toString)&&i.toString()==="[object FormData]"))},Ca=Ne("URLSearchParams"),Ra=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function dr(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let r,a;if(typeof i!="object"&&(i=[i]),Ut(i))for(r=0,a=i.length;r<a;r++)e.call(null,i[r],r,i);else{const o=t?Object.getOwnPropertyNames(i):Object.keys(i),u=o.length;let d;for(r=0;r<u;r++)d=o[r],e.call(null,i[d],d,i)}}function Qi(i,e){e=e.toLowerCase();const t=Object.keys(i);let r=t.length,a;for(;r-- >0;)if(a=t[r],e===a.toLowerCase())return a;return null}const Zi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eo=i=>!ur(i)&&i!==Zi;function is(){const{caseless:i}=eo(this)&&this||{},e={},t=(r,a)=>{const o=i&&Qi(e,a)||a;Vr(e[o])&&Vr(r)?e[o]=is(e[o],r):Vr(r)?e[o]=is({},r):Ut(r)?e[o]=r.slice():e[o]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&dr(arguments[r],t);return e}const ja=(i,e,t,{allOwnKeys:r}={})=>(dr(e,(a,o)=>{t&&Te(a)?i[o]=Gi(a,t):i[o]=a},{allOwnKeys:r}),i),Ia=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Da=(i,e,t,r)=>{i.prototype=Object.create(e.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},$a=(i,e,t,r)=>{let a,o,u;const d={};if(e=e||{},i==null)return e;do{for(a=Object.getOwnPropertyNames(i),o=a.length;o-- >0;)u=a[o],(!r||r(u,i,e))&&!d[u]&&(e[u]=i[u],d[u]=!0);i=t!==!1&&bs(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},Na=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const r=i.indexOf(e,t);return r!==-1&&r===t},La=i=>{if(!i)return null;if(Ut(i))return i;let e=i.length;if(!Xi(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},Ua=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&bs(Uint8Array)),Fa=(i,e)=>{const r=(i&&i[Symbol.iterator]).call(i);let a;for(;(a=r.next())&&!a.done;){const o=a.value;e.call(i,o[0],o[1])}},Ba=(i,e)=>{let t;const r=[];for(;(t=i.exec(e))!==null;)r.push(t);return r},qa=Ne("HTMLFormElement"),Ma=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,a){return r.toUpperCase()+a}),gi=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),Ka=Ne("RegExp"),to=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),r={};dr(t,(a,o)=>{let u;(u=e(a,o,i))!==!1&&(r[o]=u||a)}),Object.defineProperties(i,r)},Ja=i=>{to(i,(e,t)=>{if(Te(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=i[t];if(Te(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},za=(i,e)=>{const t={},r=a=>{a.forEach(o=>{t[o]=!0})};return Ut(i)?r(i):r(String(i).split(e)),t},Ha=()=>{},Va=(i,e)=>(i=+i,Number.isFinite(i)?i:e),Gn="abcdefghijklmnopqrstuvwxyz",vi="0123456789",ro={DIGIT:vi,ALPHA:Gn,ALPHA_DIGIT:Gn+Gn.toUpperCase()+vi},Wa=(i=16,e=ro.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;i--;)t+=e[Math.random()*r|0];return t};function Ga(i){return!!(i&&Te(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const Ya=i=>{const e=new Array(10),t=(r,a)=>{if(en(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[a]=r;const o=Ut(r)?[]:{};return dr(r,(u,d)=>{const p=t(u,a+1);!ur(p)&&(o[d]=p)}),e[a]=void 0,o}}return r};return t(i,0)},Xa=Ne("AsyncFunction"),Qa=i=>i&&(en(i)||Te(i))&&Te(i.then)&&Te(i.catch),I={isArray:Ut,isArrayBuffer:Yi,isBuffer:wa,isFormData:Aa,isArrayBufferView:_a,isString:ka,isNumber:Xi,isBoolean:Sa,isObject:en,isPlainObject:Vr,isUndefined:ur,isDate:Ea,isFile:Pa,isBlob:Oa,isRegExp:Ka,isFunction:Te,isStream:Ta,isURLSearchParams:Ca,isTypedArray:Ua,isFileList:xa,forEach:dr,merge:is,extend:ja,trim:Ra,stripBOM:Ia,inherits:Da,toFlatObject:$a,kindOf:Qr,kindOfTest:Ne,endsWith:Na,toArray:La,forEachEntry:Fa,matchAll:Ba,isHTMLForm:qa,hasOwnProperty:gi,hasOwnProp:gi,reduceDescriptors:to,freezeMethods:Ja,toObjectSet:za,toCamelCase:Ma,noop:Ha,toFiniteNumber:Va,findKey:Qi,global:Zi,isContextDefined:eo,ALPHABET:ro,generateString:Wa,isSpecCompliantForm:Ga,toJSONObject:Ya,isAsyncFn:Xa,isThenable:Qa};function re(i,e,t,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),a&&(this.response=a)}I.inherits(re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const no=re.prototype,so={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{so[i]={value:i}});Object.defineProperties(re,so);Object.defineProperty(no,"isAxiosError",{value:!0});re.from=(i,e,t,r,a,o)=>{const u=Object.create(no);return I.toFlatObject(i,u,function(p){return p!==Error.prototype},d=>d!=="isAxiosError"),re.call(u,i.message,e,t,r,a),u.cause=i,u.name=i.name,o&&Object.assign(u,o),u};const Za=null;function os(i){return I.isPlainObject(i)||I.isArray(i)}function io(i){return I.endsWith(i,"[]")?i.slice(0,-2):i}function bi(i,e,t){return i?i.concat(e).map(function(a,o){return a=io(a),!t&&o?"["+a+"]":a}).join(t?".":""):e}function ec(i){return I.isArray(i)&&!i.some(os)}const tc=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function tn(i,e,t){if(!I.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=I.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,W){return!I.isUndefined(W[U])});const r=t.metaTokens,a=t.visitor||g,o=t.dots,u=t.indexes,p=(t.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function y(N){if(N===null)return"";if(I.isDate(N))return N.toISOString();if(!p&&I.isBlob(N))throw new re("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(N)||I.isTypedArray(N)?p&&typeof Blob=="function"?new Blob([N]):Buffer.from(N):N}function g(N,U,W){let ne=N;if(N&&!W&&typeof N=="object"){if(I.endsWith(U,"{}"))U=r?U:U.slice(0,-2),N=JSON.stringify(N);else if(I.isArray(N)&&ec(N)||(I.isFileList(N)||I.endsWith(U,"[]"))&&(ne=I.toArray(N)))return U=io(U),ne.forEach(function(fe,le){!(I.isUndefined(fe)||fe===null)&&e.append(u===!0?bi([U],le,o):u===null?U:U+"[]",y(fe))}),!1}return os(N)?!0:(e.append(bi(W,U,o),y(N)),!1)}const S=[],$=Object.assign(tc,{defaultVisitor:g,convertValue:y,isVisitable:os});function K(N,U){if(!I.isUndefined(N)){if(S.indexOf(N)!==-1)throw Error("Circular reference detected in "+U.join("."));S.push(N),I.forEach(N,function(ne,de){(!(I.isUndefined(ne)||ne===null)&&a.call(e,ne,I.isString(de)?de.trim():de,U,$))===!0&&K(ne,U?U.concat(de):[de])}),S.pop()}}if(!I.isObject(i))throw new TypeError("data must be an object");return K(i),e}function wi(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ws(i,e){this._pairs=[],i&&tn(i,this,e)}const oo=ws.prototype;oo.append=function(e,t){this._pairs.push([e,t])};oo.toString=function(e){const t=e?function(r){return e.call(this,r,wi)}:wi;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function rc(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ao(i,e,t){if(!e)return i;const r=t&&t.encode||rc,a=t&&t.serialize;let o;if(a?o=a(e,t):o=I.isURLSearchParams(e)?e.toString():new ws(e,t).toString(r),o){const u=i.indexOf("#");u!==-1&&(i=i.slice(0,u)),i+=(i.indexOf("?")===-1?"?":"&")+o}return i}class _i{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(r){r!==null&&e(r)})}}const co={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},nc=typeof URLSearchParams<"u"?URLSearchParams:ws,sc=typeof FormData<"u"?FormData:null,ic=typeof Blob<"u"?Blob:null,oc={isBrowser:!0,classes:{URLSearchParams:nc,FormData:sc,Blob:ic},protocols:["http","https","file","blob","url","data"]},uo=typeof window<"u"&&typeof document<"u",ac=(i=>uo&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),cc=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uc=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:uo,hasStandardBrowserEnv:ac,hasStandardBrowserWebWorkerEnv:cc},Symbol.toStringTag,{value:"Module"})),$e={...uc,...oc};function lc(i,e){return tn(i,new $e.classes.URLSearchParams,Object.assign({visitor:function(t,r,a,o){return $e.isNode&&I.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function hc(i){return I.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function dc(i){const e={},t=Object.keys(i);let r;const a=t.length;let o;for(r=0;r<a;r++)o=t[r],e[o]=i[o];return e}function lo(i){function e(t,r,a,o){let u=t[o++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),p=o>=t.length;return u=!u&&I.isArray(a)?a.length:u,p?(I.hasOwnProp(a,u)?a[u]=[a[u],r]:a[u]=r,!d):((!a[u]||!I.isObject(a[u]))&&(a[u]=[]),e(t,r,a[u],o)&&I.isArray(a[u])&&(a[u]=dc(a[u])),!d)}if(I.isFormData(i)&&I.isFunction(i.entries)){const t={};return I.forEachEntry(i,(r,a)=>{e(hc(r),a,t,0)}),t}return null}function fc(i,e,t){if(I.isString(i))try{return(e||JSON.parse)(i),I.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(i)}const _s={transitional:co,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",a=r.indexOf("application/json")>-1,o=I.isObject(e);if(o&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(lo(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return lc(e,this.formSerializer).toString();if((d=I.isFileList(e))||r.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return tn(d?{"files[]":e}:e,p&&new p,this.formSerializer)}}return o||a?(t.setContentType("application/json",!1),fc(e)):e}],transformResponse:[function(e){const t=this.transitional||_s.transitional,r=t&&t.forcedJSONParsing,a=this.responseType==="json";if(e&&I.isString(e)&&(r&&!this.responseType||a)){const u=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(u)throw d.name==="SyntaxError"?re.from(d,re.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$e.classes.FormData,Blob:$e.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],i=>{_s.headers[i]={}});const ks=_s,pc=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mc=i=>{const e={};let t,r,a;return i&&i.split(`
`).forEach(function(u){a=u.indexOf(":"),t=u.substring(0,a).trim().toLowerCase(),r=u.substring(a+1).trim(),!(!t||e[t]&&pc[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ki=Symbol("internals");function rr(i){return i&&String(i).trim().toLowerCase()}function Wr(i){return i===!1||i==null?i:I.isArray(i)?i.map(Wr):String(i)}function yc(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(i);)e[r[1]]=r[2];return e}const gc=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Yn(i,e,t,r,a){if(I.isFunction(r))return r.call(this,e,t);if(a&&(e=t),!!I.isString(e)){if(I.isString(r))return e.indexOf(r)!==-1;if(I.isRegExp(r))return r.test(e)}}function vc(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function bc(i,e){const t=I.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+t,{value:function(a,o,u){return this[r].call(this,e,a,o,u)},configurable:!0})})}class rn{constructor(e){e&&this.set(e)}set(e,t,r){const a=this;function o(d,p,y){const g=rr(p);if(!g)throw new Error("header name must be a non-empty string");const S=I.findKey(a,g);(!S||a[S]===void 0||y===!0||y===void 0&&a[S]!==!1)&&(a[S||p]=Wr(d))}const u=(d,p)=>I.forEach(d,(y,g)=>o(y,g,p));return I.isPlainObject(e)||e instanceof this.constructor?u(e,t):I.isString(e)&&(e=e.trim())&&!gc(e)?u(mc(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=rr(e),e){const r=I.findKey(this,e);if(r){const a=this[r];if(!t)return a;if(t===!0)return yc(a);if(I.isFunction(t))return t.call(this,a,r);if(I.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=rr(e),e){const r=I.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Yn(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let a=!1;function o(u){if(u=rr(u),u){const d=I.findKey(r,u);d&&(!t||Yn(r,r[d],d,t))&&(delete r[d],a=!0)}}return I.isArray(e)?e.forEach(o):o(e),a}clear(e){const t=Object.keys(this);let r=t.length,a=!1;for(;r--;){const o=t[r];(!e||Yn(this,this[o],o,e,!0))&&(delete this[o],a=!0)}return a}normalize(e){const t=this,r={};return I.forEach(this,(a,o)=>{const u=I.findKey(r,o);if(u){t[u]=Wr(a),delete t[o];return}const d=e?vc(o):String(o).trim();d!==o&&delete t[o],t[d]=Wr(a),r[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return I.forEach(this,(r,a)=>{r!=null&&r!==!1&&(t[a]=e&&I.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(a=>r.set(a)),r}static accessor(e){const r=(this[ki]=this[ki]={accessors:{}}).accessors,a=this.prototype;function o(u){const d=rr(u);r[d]||(bc(a,u),r[d]=!0)}return I.isArray(e)?e.forEach(o):o(e),this}}rn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(rn.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(r){this[t]=r}}});I.freezeMethods(rn);const Me=rn;function Xn(i,e){const t=this||ks,r=e||t,a=Me.from(r.headers);let o=r.data;return I.forEach(i,function(d){o=d.call(t,o,a.normalize(),e?e.status:void 0)}),a.normalize(),o}function ho(i){return!!(i&&i.__CANCEL__)}function fr(i,e,t){re.call(this,i??"canceled",re.ERR_CANCELED,e,t),this.name="CanceledError"}I.inherits(fr,re,{__CANCEL__:!0});function wc(i,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?i(t):e(new re("Request failed with status code "+t.status,[re.ERR_BAD_REQUEST,re.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const _c=$e.hasStandardBrowserEnv?{write(i,e,t,r,a,o){const u=[i+"="+encodeURIComponent(e)];I.isNumber(t)&&u.push("expires="+new Date(t).toGMTString()),I.isString(r)&&u.push("path="+r),I.isString(a)&&u.push("domain="+a),o===!0&&u.push("secure"),document.cookie=u.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function kc(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function Sc(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function fo(i,e){return i&&!kc(e)?Sc(i,e):e}const Ec=$e.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function a(o){let u=o;return e&&(t.setAttribute("href",u),u=t.href),t.setAttribute("href",u),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=a(window.location.href),function(u){const d=I.isString(u)?a(u):u;return d.protocol===r.protocol&&d.host===r.host}}():function(){return function(){return!0}}();function Pc(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function Oc(i,e){i=i||10;const t=new Array(i),r=new Array(i);let a=0,o=0,u;return e=e!==void 0?e:1e3,function(p){const y=Date.now(),g=r[o];u||(u=y),t[a]=p,r[a]=y;let S=o,$=0;for(;S!==a;)$+=t[S++],S=S%i;if(a=(a+1)%i,a===o&&(o=(o+1)%i),y-u<e)return;const K=g&&y-g;return K?Math.round($*1e3/K):void 0}}function Si(i,e){let t=0;const r=Oc(50,250);return a=>{const o=a.loaded,u=a.lengthComputable?a.total:void 0,d=o-t,p=r(d),y=o<=u;t=o;const g={loaded:o,total:u,progress:u?o/u:void 0,bytes:d,rate:p||void 0,estimated:p&&u&&y?(u-o)/p:void 0,event:a};g[e?"download":"upload"]=!0,i(g)}}const xc=typeof XMLHttpRequest<"u",Tc=xc&&function(i){return new Promise(function(t,r){let a=i.data;const o=Me.from(i.headers).normalize();let{responseType:u,withXSRFToken:d}=i,p;function y(){i.cancelToken&&i.cancelToken.unsubscribe(p),i.signal&&i.signal.removeEventListener("abort",p)}let g;if(I.isFormData(a)){if($e.hasStandardBrowserEnv||$e.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((g=o.getContentType())!==!1){const[U,...W]=g?g.split(";").map(ne=>ne.trim()).filter(Boolean):[];o.setContentType([U||"multipart/form-data",...W].join("; "))}}let S=new XMLHttpRequest;if(i.auth){const U=i.auth.username||"",W=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";o.set("Authorization","Basic "+btoa(U+":"+W))}const $=fo(i.baseURL,i.url);S.open(i.method.toUpperCase(),ao($,i.params,i.paramsSerializer),!0),S.timeout=i.timeout;function K(){if(!S)return;const U=Me.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),ne={data:!u||u==="text"||u==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:U,config:i,request:S};wc(function(fe){t(fe),y()},function(fe){r(fe),y()},ne),S=null}if("onloadend"in S?S.onloadend=K:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(K)},S.onabort=function(){S&&(r(new re("Request aborted",re.ECONNABORTED,i,S)),S=null)},S.onerror=function(){r(new re("Network Error",re.ERR_NETWORK,i,S)),S=null},S.ontimeout=function(){let W=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const ne=i.transitional||co;i.timeoutErrorMessage&&(W=i.timeoutErrorMessage),r(new re(W,ne.clarifyTimeoutError?re.ETIMEDOUT:re.ECONNABORTED,i,S)),S=null},$e.hasStandardBrowserEnv&&(d&&I.isFunction(d)&&(d=d(i)),d||d!==!1&&Ec($))){const U=i.xsrfHeaderName&&i.xsrfCookieName&&_c.read(i.xsrfCookieName);U&&o.set(i.xsrfHeaderName,U)}a===void 0&&o.setContentType(null),"setRequestHeader"in S&&I.forEach(o.toJSON(),function(W,ne){S.setRequestHeader(ne,W)}),I.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),u&&u!=="json"&&(S.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&S.addEventListener("progress",Si(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&S.upload&&S.upload.addEventListener("progress",Si(i.onUploadProgress)),(i.cancelToken||i.signal)&&(p=U=>{S&&(r(!U||U.type?new fr(null,i,S):U),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(p),i.signal&&(i.signal.aborted?p():i.signal.addEventListener("abort",p)));const N=Pc($);if(N&&$e.protocols.indexOf(N)===-1){r(new re("Unsupported protocol "+N+":",re.ERR_BAD_REQUEST,i));return}S.send(a||null)})},as={http:Za,xhr:Tc};I.forEach(as,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Ei=i=>`- ${i}`,Ac=i=>I.isFunction(i)||i===null||i===!1,po={getAdapter:i=>{i=I.isArray(i)?i:[i];const{length:e}=i;let t,r;const a={};for(let o=0;o<e;o++){t=i[o];let u;if(r=t,!Ac(t)&&(r=as[(u=String(t)).toLowerCase()],r===void 0))throw new re(`Unknown adapter '${u}'`);if(r)break;a[u||"#"+o]=r}if(!r){const o=Object.entries(a).map(([d,p])=>`adapter ${d} `+(p===!1?"is not supported by the environment":"is not available in the build"));let u=e?o.length>1?`since :
`+o.map(Ei).join(`
`):" "+Ei(o[0]):"as no adapter specified";throw new re("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return r},adapters:as};function Qn(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new fr(null,i)}function Pi(i){return Qn(i),i.headers=Me.from(i.headers),i.data=Xn.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),po.getAdapter(i.adapter||ks.adapter)(i).then(function(r){return Qn(i),r.data=Xn.call(i,i.transformResponse,r),r.headers=Me.from(r.headers),r},function(r){return ho(r)||(Qn(i),r&&r.response&&(r.response.data=Xn.call(i,i.transformResponse,r.response),r.response.headers=Me.from(r.response.headers))),Promise.reject(r)})}const Oi=i=>i instanceof Me?i.toJSON():i;function Nt(i,e){e=e||{};const t={};function r(y,g,S){return I.isPlainObject(y)&&I.isPlainObject(g)?I.merge.call({caseless:S},y,g):I.isPlainObject(g)?I.merge({},g):I.isArray(g)?g.slice():g}function a(y,g,S){if(I.isUndefined(g)){if(!I.isUndefined(y))return r(void 0,y,S)}else return r(y,g,S)}function o(y,g){if(!I.isUndefined(g))return r(void 0,g)}function u(y,g){if(I.isUndefined(g)){if(!I.isUndefined(y))return r(void 0,y)}else return r(void 0,g)}function d(y,g,S){if(S in e)return r(y,g);if(S in i)return r(void 0,y)}const p={url:o,method:o,data:o,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(y,g)=>a(Oi(y),Oi(g),!0)};return I.forEach(Object.keys(Object.assign({},i,e)),function(g){const S=p[g]||a,$=S(i[g],e[g],g);I.isUndefined($)&&S!==d||(t[g]=$)}),t}const mo="1.6.7",Ss={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{Ss[i]=function(r){return typeof r===i||"a"+(e<1?"n ":" ")+i}});const xi={};Ss.transitional=function(e,t,r){function a(o,u){return"[Axios v"+mo+"] Transitional option '"+o+"'"+u+(r?". "+r:"")}return(o,u,d)=>{if(e===!1)throw new re(a(u," has been removed"+(t?" in "+t:"")),re.ERR_DEPRECATED);return t&&!xi[u]&&(xi[u]=!0,console.warn(a(u," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,u,d):!0}};function Cc(i,e,t){if(typeof i!="object")throw new re("options must be an object",re.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let a=r.length;for(;a-- >0;){const o=r[a],u=e[o];if(u){const d=i[o],p=d===void 0||u(d,o,i);if(p!==!0)throw new re("option "+o+" must be "+p,re.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new re("Unknown option "+o,re.ERR_BAD_OPTION)}}const cs={assertOptions:Cc,validators:Ss},Xe=cs.validators;class Yr{constructor(e){this.defaults=e,this.interceptors={request:new _i,response:new _i}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let a;Error.captureStackTrace?Error.captureStackTrace(a={}):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Nt(this.defaults,t);const{transitional:r,paramsSerializer:a,headers:o}=t;r!==void 0&&cs.assertOptions(r,{silentJSONParsing:Xe.transitional(Xe.boolean),forcedJSONParsing:Xe.transitional(Xe.boolean),clarifyTimeoutError:Xe.transitional(Xe.boolean)},!1),a!=null&&(I.isFunction(a)?t.paramsSerializer={serialize:a}:cs.assertOptions(a,{encode:Xe.function,serialize:Xe.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=o&&I.merge(o.common,o[t.method]);o&&I.forEach(["delete","get","head","post","put","patch","common"],N=>{delete o[N]}),t.headers=Me.concat(u,o);const d=[];let p=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(t)===!1||(p=p&&U.synchronous,d.unshift(U.fulfilled,U.rejected))});const y=[];this.interceptors.response.forEach(function(U){y.push(U.fulfilled,U.rejected)});let g,S=0,$;if(!p){const N=[Pi.bind(this),void 0];for(N.unshift.apply(N,d),N.push.apply(N,y),$=N.length,g=Promise.resolve(t);S<$;)g=g.then(N[S++],N[S++]);return g}$=d.length;let K=t;for(S=0;S<$;){const N=d[S++],U=d[S++];try{K=N(K)}catch(W){U.call(this,W);break}}try{g=Pi.call(this,K)}catch(N){return Promise.reject(N)}for(S=0,$=y.length;S<$;)g=g.then(y[S++],y[S++]);return g}getUri(e){e=Nt(this.defaults,e);const t=fo(e.baseURL,e.url);return ao(t,e.params,e.paramsSerializer)}}I.forEach(["delete","get","head","options"],function(e){Yr.prototype[e]=function(t,r){return this.request(Nt(r||{},{method:e,url:t,data:(r||{}).data}))}});I.forEach(["post","put","patch"],function(e){function t(r){return function(o,u,d){return this.request(Nt(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:u}))}}Yr.prototype[e]=t(),Yr.prototype[e+"Form"]=t(!0)});const Gr=Yr;class Es{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const r=this;this.promise.then(a=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](a);r._listeners=null}),this.promise.then=a=>{let o;const u=new Promise(d=>{r.subscribe(d),o=d}).then(a);return u.cancel=function(){r.unsubscribe(o)},u},e(function(o,u,d){r.reason||(r.reason=new fr(o,u,d),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Es(function(a){e=a}),cancel:e}}}const Rc=Es;function jc(i){return function(t){return i.apply(null,t)}}function Ic(i){return I.isObject(i)&&i.isAxiosError===!0}const us={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(us).forEach(([i,e])=>{us[e]=i});const Dc=us;function yo(i){const e=new Gr(i),t=Gi(Gr.prototype.request,e);return I.extend(t,Gr.prototype,e,{allOwnKeys:!0}),I.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return yo(Nt(i,a))},t}const oe=yo(ks);oe.Axios=Gr;oe.CanceledError=fr;oe.CancelToken=Rc;oe.isCancel=ho;oe.VERSION=mo;oe.toFormData=tn;oe.AxiosError=re;oe.Cancel=oe.CanceledError;oe.all=function(e){return Promise.all(e)};oe.spread=jc;oe.isAxiosError=Ic;oe.mergeConfig=Nt;oe.AxiosHeaders=Me;oe.formToJSON=i=>lo(I.isHTMLForm(i)?new FormData(i):i);oe.getAdapter=po.getAdapter;oe.HttpStatusCode=Dc;oe.default=oe;const It="0123456789ABCDEFGHJKMNPQRSTVWXYZ";function $c(i,e,t){for(;i.length<e;)i=t+i;return i}function Nc(){const i=Math.floor(Math.random()*It.length);return It.charAt(i)}function Lc(i){let e="";for(let t=0;t<i;t++)e+=Nc();return e}function Uc(i,e){let t="";for(let r=e-1;r>=0;r--){const a=i%It.length;t=It.charAt(a)+t,i=Math.floor(i/It.length)}return $c(t,e,It[0])}function Ti(){const i=Date.now(),e=Uc(i,10),t=Lc(16),r=e+t;return{toString:()=>r,valueOf:()=>r}}const Fc={id:"",title:"",description:"",journals:[],isComplete:!1,reward:""},Bc={backpack:[],equipment:{head:null,body:null,legs:null,feet:null,hands:null,weapon:null,shield:null,accessory:null}},go={},qc={inCombat:!1,isDead:!1,isResting:!1,activeBoosts:{}},Mc={username:"Guest",health:"100",mana:"100",energy:"100",maxHealth:"100",maxMana:"100",maxEnergy:"100",armour:"0",agility:"0",strength:"0",intelligence:"0",experience:"0",reputation:"0",faith:"0"},Kc={stats:Mc,inventory:Bc,state:qc},Jc={tooltipItem:{id:null,position:{x:0,y:0}},submenuItem:{id:null,position:{x:0,y:0}},tooltipNPC:{id:null,position:{x:0,y:0}},isStatsMenuCollapsed:!1,isSettingsMenuCollapsed:!1,debugMode:!1,textSpeed:40},zc={gamemode:"Idle",action:{type:"ROLL_DICE",diceValues:[],isRolling:!1},textures:{side1:"",side2:"",side3:"",side4:"",side5:"",side6:""}};function gt(i,e){return Vi(i,e,{encode(t){return JSON.stringify(t)},decode(t){try{return JSON.parse(t)}catch{return e}}})}gt("playerData",Kc);gt("quest",Fc);gt("items",go);gt("notifications",[]);gt("itemDB",go);const ls=gt("settings",Jc);gt("minigameState",zc);const Hc=i=>ls.get()[i],vo=(i,e)=>{va(async()=>{const t=ls.get();ls.set({...t,[i]:e})})},Vc=()=>{vo("debugMode",!0)},Wc=()=>{vo("debugMode",!1)},nn=()=>Hc("debugMode"),Xr=i=>typeof i=="string"?i:JSON.stringify(i,null,2),Gc=i=>{nn()&&console.log(`[DEBUG] ${Xr(i)}`)},Yc=i=>{nn()&&console.warn(`[DEBUG] ${Xr(i)}`)},Xc=(i,e)=>{nn()&&(e instanceof Error?console.error(`[DEBUG] ${Xr(i)} - Error: ${e.message}
${e.stack}`):console.error(`[DEBUG] ${Xr(i)}`))},z={enable:Vc,disable:Wc,isEnabled:nn,log:Gc,warn:Yc,error:Xc};class Qc{constructor(){this.events={},this.lastEmitted=new Map}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e]?.push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e]?.filter(r=>r!==t))}emit(e,t,r=0,a){const o=Date.now(),u=this.lastEmitted.get(e)||0;if(o-u>=r){if(!this.events[e])return;this.events[e]?.forEach(d=>d(t)),a&&z.isEnabled()&&z.log(`Event: ${String(e)} - Message: ${a}`),z.isEnabled()&&z.log(`Event Data: ${String(e)} - Data: ${t?JSON.stringify(t):"No data"}`),this.lastEmitted.set(e,o)}}}const nr=new Qc,Zc=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>$t(()=>Promise.resolve().then(()=>pr),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ps extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class eu extends Ps{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class tu extends Ps{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ru extends Ps{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var hs;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(hs||(hs={}));var nu=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class su{constructor(e,{headers:t={},customFetch:r,region:a=hs.Any}={}){this.url=e,this.headers=t,this.region=a,this.fetch=Zc(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return nu(this,void 0,void 0,function*(){try{const{headers:a,method:o,body:u}=t;let d={},{region:p}=t;p||(p=this.region),p&&p!=="any"&&(d["x-region"]=p);let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(d["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(d["Content-Type"]="application/json",y=JSON.stringify(u)));const g=yield this.fetch(`${this.url}/${e}`,{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:y}).catch(N=>{throw new eu(N)}),S=g.headers.get("x-relay-error");if(S&&S==="true")throw new tu(g);if(!g.ok)throw new ru(g);let $=((r=g.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),K;return $==="application/json"?K=yield g.json():$==="application/octet-stream"?K=yield g.blob():$==="text/event-stream"?K=g:$==="multipart/form-data"?K=yield g.formData():K=yield g.text(),{data:K,error:null}}catch(a){return{data:null,error:a}}})}}var iu=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Lt=iu();const ou=Lt.fetch,Os=Lt.fetch.bind(Lt),bo=Lt.Headers,au=Lt.Request,cu=Lt.Response,pr=Object.freeze(Object.defineProperty({__proto__:null,Headers:bo,Request:au,Response:cu,default:Os,fetch:ou},Symbol.toStringTag,{value:"Module"}));class uu extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class lu{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Os:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var u,d,p;let y=null,g=null,S=null,$=o.status,K=o.statusText;if(o.ok){if(this.method!=="HEAD"){const ne=await o.text();ne===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=ne:g=JSON.parse(ne))}const U=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),W=(d=o.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");U&&W&&W.length>1&&(S=parseInt(W[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(y={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,S=null,$=406,K="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const U=await o.text();try{y=JSON.parse(U),Array.isArray(y)&&o.status===404&&(g=[],y=null,$=200,K="OK")}catch{o.status===404&&U===""?($=204,K="No Content"):y={message:U}}if(y&&this.isMaybeSingle&&(!((p=y?.details)===null||p===void 0)&&p.includes("0 rows"))&&(y=null,$=200,K="OK"),y&&this.shouldThrowOnError)throw new uu(y)}return{error:y,data:g,count:S,status:$,statusText:K}});return this.shouldThrowOnError||(a=a.catch(o=>{var u,d,p;return{error:{message:`${(u=o?.name)!==null&&u!==void 0?u:"FetchError"}: ${o?.message}`,details:`${(d=o?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(p=o?.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),a.then(e,t)}}class hu extends lu{select(e){let t=!1;const r=(e??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:a=r}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(u,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const p=[e?"analyze":null,t?"verbose":null,r?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),y=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${y}"; options=${p};`,u==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class jt extends hu{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${u}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class du{constructor(e,{headers:t={},schema:r,fetch:a}){this.url=e,this.headers=t,this.schema=r,this.fetch=a}select(e,{head:t=!1,count:r}={}){const a=t?"HEAD":"GET";let o=!1;const u=(e??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",u),r&&(this.headers.Prefer=`count=${r}`),new jt({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const a="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const u=e.reduce((d,p)=>d.concat(Object.keys(p)),[]);if(u.length>0){const d=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",d.join(","))}}return new jt({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:a,defaultToNull:o=!0}={}){const u="POST",d=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&d.push(this.headers.Prefer),a&&d.push(`count=${a}`),o||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(e)){const p=e.reduce((y,g)=>y.concat(Object.keys(g)),[]);if(p.length>0){const y=[...new Set(p)].map(g=>`"${g}"`);this.url.searchParams.set("columns",y.join(","))}}return new jt({method:u,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),this.headers.Prefer=a.join(","),new jt({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new jt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const fu="1.15.2",pu={"X-Client-Info":`postgrest-js/${fu}`};class xs{constructor(e,{headers:t={},schema:r,fetch:a}={}){this.url=e,this.headers=Object.assign(Object.assign({},pu),t),this.schemaName=r,this.fetch=a}from(e){const t=new URL(`${this.url}/${e}`);return new du(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new xs(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:a=!1,count:o}={}){let u;const d=new URL(`${this.url}/rpc/${e}`);let p;r||a?(u=r?"HEAD":"GET",Object.entries(t).filter(([g,S])=>S!==void 0).map(([g,S])=>[g,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([g,S])=>{d.searchParams.append(g,S)})):(u="POST",p=t);const y=Object.assign({},this.headers);return o&&(y.Prefer=`count=${o}`),new jt({method:u,url:d,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}const mu="2.9.4",yu={"X-Client-Info":`realtime-js/${mu}`},gu="1.0.0",wo=1e4,vu=1e3;var Dt;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Dt||(Dt={}));var Pe;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Pe||(Pe={}));var Re;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Re||(Re={}));var ds;(function(i){i.websocket="websocket"})(ds||(ds={}));var yt;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(yt||(yt={}));class _o{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class bu{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const a=t.getUint8(1),o=t.getUint8(2);let u=this.HEADER_LENGTH+2;const d=r.decode(e.slice(u,u+a));u=u+a;const p=r.decode(e.slice(u,u+o));u=u+o;const y=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:d,event:p,payload:y}}}class Zn{constructor(e,t,r={},a=wo){this.channel=e,this.event=t,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ai;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(Ai||(Ai={}));class ar{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:o,onLeave:u,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ar.syncState(this.state,a,o,u),this.pendingDiffs.forEach(p=>{this.state=ar.syncDiff(this.state,p,o,u)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},a=>{const{onJoin:o,onLeave:u,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=ar.syncDiff(this.state,a,o,u),d())}),this.onJoin((a,o,u)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:u})}),this.onLeave((a,o,u)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,a){const o=this.cloneDeep(e),u=this.transformState(t),d={},p={};return this.map(o,(y,g)=>{u[y]||(p[y]=g)}),this.map(u,(y,g)=>{const S=o[y];if(S){const $=g.map(W=>W.presence_ref),K=S.map(W=>W.presence_ref),N=g.filter(W=>K.indexOf(W.presence_ref)<0),U=S.filter(W=>$.indexOf(W.presence_ref)<0);N.length>0&&(d[y]=N),U.length>0&&(p[y]=U)}else d[y]=g}),this.syncDiff(o,{joins:d,leaves:p},r,a)}static syncDiff(e,t,r,a){const{joins:o,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(o,(d,p)=>{var y;const g=(y=e[d])!==null&&y!==void 0?y:[];if(e[d]=this.cloneDeep(p),g.length>0){const S=e[d].map(K=>K.presence_ref),$=g.filter(K=>S.indexOf(K.presence_ref)<0);e[d].unshift(...$)}r(d,g,p)}),this.map(u,(d,p)=>{let y=e[d];if(!y)return;const g=p.map(S=>S.presence_ref);y=y.filter(S=>g.indexOf(S.presence_ref)<0),e[d]=y,a(d,y,p),y.length===0&&delete e[d]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const a=e[r];return"metas"in a?t[r]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ce;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(ce||(ce={}));const Ci=(i,e,t={})=>{var r;const a=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,u)=>(o[u]=wu(u,i,e,a),o),{})},wu=(i,e,t,r)=>{const a=e.find(d=>d.name===i),o=a?.type,u=t[i];return o&&!r.includes(o)?ko(o,u):fs(u)},ko=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return Eu(e,t)}switch(i){case ce.bool:return _u(e);case ce.float4:case ce.float8:case ce.int2:case ce.int4:case ce.int8:case ce.numeric:case ce.oid:return ku(e);case ce.json:case ce.jsonb:return Su(e);case ce.timestamp:return Pu(e);case ce.abstime:case ce.date:case ce.daterange:case ce.int4range:case ce.int8range:case ce.money:case ce.reltime:case ce.text:case ce.time:case ce.timestamptz:case ce.timetz:case ce.tsrange:case ce.tstzrange:return fs(e);default:return fs(e)}},fs=i=>i,_u=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},ku=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Su=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Eu=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let o;const u=i.slice(1,t);try{o=JSON.parse("["+u+"]")}catch{o=u?u.split(","):[]}return o.map(d=>ko(e,d))}return i},Pu=i=>typeof i=="string"?i.replace(" ","T"):i;var Ri;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(Ri||(Ri={}));var ji;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})(ji||(ji={}));var Ii;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Ii||(Ii={}));class Ts{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Pe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Zn(this,Re.join,this.params,this.timeout),this.rejoinTimer=new _o(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Pe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Pe.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Pe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Pe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Re.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new ar(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,a;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:o,presence:u}}=this.params;this._onError(y=>e&&e("CHANNEL_ERROR",y)),this._onClose(()=>e&&e("CLOSED"));const d={},p={broadcast:o,presence:u,postgres_changes:(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(y=>y.filter))!==null&&a!==void 0?a:[]};this.socket.accessToken&&(d.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:p},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:y})=>{var g;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),y===void 0){e&&e("SUBSCRIBED");return}else{const S=this.bindings.postgres_changes,$=(g=S?.length)!==null&&g!==void 0?g:0,K=[];for(let N=0;N<$;N++){const U=S[N],{filter:{event:W,schema:ne,table:de,filter:fe}}=U,le=y&&y[N];if(le&&le.event===W&&le.schema===ne&&le.table===de&&le.filter===fe)K.push(Object.assign(Object.assign({},U),{id:le.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=K,e&&e("SUBSCRIBED");return}}).receive("error",y=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(y).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:u}=e,d={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:u}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,d,(a=t.timeout)!==null&&a!==void 0?a:this.timeout)).ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var u,d,p;const y=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(d=(u=this.params)===null||u===void 0?void 0:u.config)===null||d===void 0?void 0:d.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),y.receive("ok",()=>o("ok")),y.receive("error",()=>o("error")),y.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Pe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Re.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const a=new Zn(this,Re.leave,{},e);a.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),a.send(),this._canPush()||a.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const a=new AbortController,o=setTimeout(()=>a.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(o),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Zn(this,e,t,r);return this._canPush()?a.send():(a.startTimeout(),this.pushBuffer.push(a)),a}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var a,o;const u=e.toLocaleLowerCase(),{close:d,error:p,leave:y,join:g}=Re;if(r&&[d,p,y,g].indexOf(u)>=0&&r!==this._joinRef())return;let $=this._onMessage(u,t,r);if(t&&!$)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(K=>{var N,U,W;return((N=K.filter)===null||N===void 0?void 0:N.event)==="*"||((W=(U=K.filter)===null||U===void 0?void 0:U.event)===null||W===void 0?void 0:W.toLocaleLowerCase())===u}).map(K=>K.callback($,r)):(o=this.bindings[u])===null||o===void 0||o.filter(K=>{var N,U,W,ne,de,fe;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in K){const le=K.id,tt=(N=K.filter)===null||N===void 0?void 0:N.event;return le&&((U=t.ids)===null||U===void 0?void 0:U.includes(le))&&(tt==="*"||tt?.toLocaleLowerCase()===((W=t.data)===null||W===void 0?void 0:W.type.toLocaleLowerCase()))}else{const le=(de=(ne=K?.filter)===null||ne===void 0?void 0:ne.event)===null||de===void 0?void 0:de.toLocaleLowerCase();return le==="*"||le===((fe=t?.event)===null||fe===void 0?void 0:fe.toLocaleLowerCase())}else return K.type.toLocaleLowerCase()===u}).map(K=>{if(typeof $=="object"&&"ids"in $){const N=$.data,{schema:U,table:W,commit_timestamp:ne,type:de,errors:fe}=N;$=Object.assign(Object.assign({},{schema:U,table:W,commit_timestamp:ne,eventType:de,new:{},old:{},errors:fe}),this._getPayloadRecords(N))}K.callback($,r)})}_isClosed(){return this.state===Pe.closed}_isJoined(){return this.state===Pe.joined}_isJoining(){return this.state===Pe.joining}_isLeaving(){return this.state===Pe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const a=e.toLocaleLowerCase(),o={type:a,filter:t,callback:r};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Ts.isEqual(a.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Re.close,{},e)}_onError(e){this._on(Re.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Pe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ci(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ci(e.columns,e.old_record)),t}}const Ou=()=>{},xu=typeof WebSocket<"u";class Tu{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=yu,this.params={},this.timeout=wo,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ou,this.conn=null,this.sendBuffer=[],this.serializer=new bu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=o=>{let u;return o?u=o:typeof fetch>"u"?u=(...d)=>$t(()=>Promise.resolve().then(()=>pr),void 0).then(({default:p})=>p(...d)):u=fetch,(...d)=>u(...d)},this.endPoint=`${e}/${ds.websocket}`,t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const a=(r=t?.params)===null||r===void 0?void 0:r.apikey;a&&(this.accessToken=a,this.apiKey=a),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t?.encode?t.encode:(o,u)=>u(JSON.stringify(o)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new _o(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(xu){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Au(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),$t(()=>import("./browser.BMICABTD.js").then(e=>e.b),__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Dt.connecting:return yt.Connecting;case Dt.open:return yt.Open;case Dt.closing:return yt.Closing;default:return yt.Closed}}isConnected(){return this.connectionState()===yt.Open}channel(e,t={config:{}}){const r=new Ts(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:a,ref:o}=e,u=()=>{this.encode(e,d=>{var p;(p=this.conn)===null||p===void 0||p.send(d)})};this.log("push",`${t} ${r} (${o})`,a),this.isConnected()?u():this.sendBuffer.push(u)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Re.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:gu}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:a,payload:o,ref:u}=t;(u&&u===this.pendingHeartbeatRef||a===o?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${r} ${a} ${u&&"("+u+")"||""}`,o),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,o,u)),this.stateChangeCallbacks.message.forEach(d=>d(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Re.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return`${e}${r}${a}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(vu,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Au{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Dt.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class As extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function _e(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Cu extends As{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Di extends As{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ru=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const So=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>$t(()=>Promise.resolve().then(()=>pr),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ju=()=>Ru(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $t(()=>Promise.resolve().then(()=>pr),void 0)).Response:Response});var Ft=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const es=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Iu=(i,e)=>Ft(void 0,void 0,void 0,function*(){const t=yield ju();i instanceof t?i.json().then(r=>{e(new Cu(es(r),i.status||500))}).catch(r=>{e(new Di(es(r),r))}):e(new Di(es(i),i))}),Du=(i,e,t,r)=>{const a={method:i,headers:e?.headers||{}};return i==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),t))};function sn(i,e,t,r,a,o){return Ft(this,void 0,void 0,function*(){return new Promise((u,d)=>{i(t,Du(e,r,a,o)).then(p=>{if(!p.ok)throw p;return r?.noResolveJson?p:p.json()}).then(p=>u(p)).catch(p=>Iu(p,d))})})}function ps(i,e,t,r){return Ft(this,void 0,void 0,function*(){return sn(i,"GET",e,t,r)})}function Ze(i,e,t,r,a){return Ft(this,void 0,void 0,function*(){return sn(i,"POST",e,r,a,t)})}function $u(i,e,t,r,a){return Ft(this,void 0,void 0,function*(){return sn(i,"PUT",e,r,a,t)})}function Eo(i,e,t,r,a){return Ft(this,void 0,void 0,function*(){return sn(i,"DELETE",e,r,a,t)})}var xe=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const Nu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$i={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Lu{constructor(e,t={},r,a){this.url=e,this.headers=t,this.bucketId=r,this.fetch=So(a)}uploadOrUpdate(e,t,r,a){return xe(this,void 0,void 0,function*(){try{let o;const u=Object.assign(Object.assign({},$i),a),d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",u.cacheControl),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",u.cacheControl)):(o=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const p=this._removeEmptyFolders(t),y=this._getFinalPath(p),g=yield this.fetch(`${this.url}/object/${y}`,Object.assign({method:e,body:o,headers:d},u?.duplex?{duplex:u.duplex}:{})),S=yield g.json();return g.ok?{data:{path:p,id:S.Id,fullPath:S.Key},error:null}:{data:null,error:S}}catch(o){if(_e(o))return{data:null,error:o};throw o}})}upload(e,t,r){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,a){return xe(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),u=this._getFinalPath(o),d=new URL(this.url+`/object/upload/sign/${u}`);d.searchParams.set("token",t);try{let p;const y=Object.assign({upsert:$i.upsert},a),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",y.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",y.cacheControl)):(p=r,g["cache-control"]=`max-age=${y.cacheControl}`,g["content-type"]=y.contentType);const S=yield this.fetch(d.toString(),{method:"PUT",body:p,headers:g}),$=yield S.json();return S.ok?{data:{path:o,fullPath:$.Key},error:null}:{data:null,error:$}}catch(p){if(_e(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e){return xe(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield Ze(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),a=new URL(this.url+r.url),o=a.searchParams.get("token");if(!o)throw new As("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(t){if(_e(t))return{data:null,error:t};throw t}})}update(e,t,r){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return xe(this,void 0,void 0,function*(){try{return{data:yield Ze(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(_e(r))return{data:null,error:r};throw r}})}copy(e,t){return xe(this,void 0,void 0,function*(){try{return{data:{path:(yield Ze(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(_e(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return xe(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),o=yield Ze(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${u}`)},{data:o,error:null}}catch(a){if(_e(a))return{data:null,error:a};throw a}})}createSignedUrls(e,t,r){return xe(this,void 0,void 0,function*(){try{const a=yield Ze(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${o}`):null})),error:null}}catch(a){if(_e(a))return{data:null,error:a};throw a}})}download(e,t){return xe(this,void 0,void 0,function*(){const a=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"";try{const d=this._getFinalPath(e);return{data:yield(yield ps(this.fetch,`${this.url}/${a}/${d}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(d){if(_e(d))return{data:null,error:d};throw d}})}getPublicUrl(e,t){const r=this._getFinalPath(e),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const d=typeof t?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(t?.transform||{});p!==""&&a.push(p);let y=a.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${y}`)}}}remove(e){return xe(this,void 0,void 0,function*(){try{return{data:yield Eo(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(_e(t))return{data:null,error:t};throw t}})}list(e,t,r){return xe(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},Nu),t),{prefix:e||""});return{data:yield Ze(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(_e(a))return{data:null,error:a};throw a}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Uu="2.5.5",Fu={"X-Client-Info":`storage-js/${Uu}`};var At=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class Bu{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Fu),t),this.fetch=So(r)}listBuckets(){return At(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(_e(e))return{data:null,error:e};throw e}})}getBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(_e(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return At(this,void 0,void 0,function*(){try{return{data:yield Ze(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(_e(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return At(this,void 0,void 0,function*(){try{return{data:yield $u(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(_e(r))return{data:null,error:r};throw r}})}emptyBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield Ze(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(_e(t))return{data:null,error:t};throw t}})}deleteBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield Eo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(_e(t))return{data:null,error:t};throw t}})}}class qu extends Bu{constructor(e,t={},r){super(e,t,r)}from(e){return new Lu(this.url,this.headers,e,this.fetch)}}const Mu="2.42.5";let or="";typeof Deno<"u"?or="deno":typeof document<"u"?or="web":typeof navigator<"u"&&navigator.product==="ReactNative"?or="react-native":or="node";const Ku={"X-Client-Info":`supabase-js-${or}/${Mu}`},Ju={headers:Ku},zu={schema:"public"},Hu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vu={};var Wu=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const Gu=i=>{let e;return i?e=i:typeof fetch>"u"?e=Os:e=fetch,(...t)=>e(...t)},Yu=()=>typeof Headers>"u"?bo:Headers,Xu=(i,e,t)=>{const r=Gu(t),a=Yu();return(o,u)=>Wu(void 0,void 0,void 0,function*(){var d;const p=(d=yield e())!==null&&d!==void 0?d:i;let y=new a(u?.headers);return y.has("apikey")||y.set("apikey",i),y.has("Authorization")||y.set("Authorization",`Bearer ${p}`),r(o,Object.assign(Object.assign({},u),{headers:y}))})};function Qu(i){return i.replace(/\/$/,"")}function Zu(i,e){const{db:t,auth:r,realtime:a,global:o}=i,{db:u,auth:d,realtime:p,global:y}=e;return{db:Object.assign(Object.assign({},u),t),auth:Object.assign(Object.assign({},d),r),realtime:Object.assign(Object.assign({},p),a),global:Object.assign(Object.assign({},y),o)}}const Po="2.63.1",el="http://localhost:9999",tl="supabase.auth.token",rl={"X-Client-Info":`gotrue-js/${Po}`},Ni=10,ms="X-Supabase-Api-Version",Oo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function nl(i){return Math.round(Date.now()/1e3)+i}function sl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const Ce=()=>typeof document<"u",dt={tested:!1,writable:!1},cr=()=>{if(!Ce())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(dt.tested)return dt.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),dt.tested=!0,dt.writable=!0}catch{dt.tested=!0,dt.writable=!1}return dt.writable};function ts(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return t.searchParams.forEach((r,a)=>{e[a]=r}),e}const xo=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>$t(()=>Promise.resolve().then(()=>pr),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},il=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",To=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Jr=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},rs=async(i,e)=>{await i.removeItem(e)};function ol(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,a,o,u,d,p,y,g=0;for(i=i.replace("-","+").replace("_","/");g<i.length;)u=e.indexOf(i.charAt(g++)),d=e.indexOf(i.charAt(g++)),p=e.indexOf(i.charAt(g++)),y=e.indexOf(i.charAt(g++)),r=u<<2|d>>4,a=(d&15)<<4|p>>2,o=(p&3)<<6|y,t=t+String.fromCharCode(r),p!=64&&a!=0&&(t=t+String.fromCharCode(a)),y!=64&&o!=0&&(t=t+String.fromCharCode(o));return t}class on{constructor(){this.promise=new on.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}on.promiseConstructor=Promise;function Li(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ol(r))}async function al(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function cl(i,e){return new Promise((r,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const u=await i(o);if(!e(o,null,u)){r(u);return}}catch(u){if(!e(o,u)){a(u);return}}})()})}function ul(i){return("0"+i.toString(16)).substr(-2)}function ll(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let a="";for(let o=0;o<56;o++)a+=t.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,ul).join("")}async function hl(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),a=new Uint8Array(r);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}function dl(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fl(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await hl(i);return dl(t)}async function Ct(i,e,t=!1){const r=ll();let a=r;t&&(a+="/PASSWORD_RECOVERY"),await To(i,`${e}-code-verifier`,a);const o=await fl(r);return[o,r===o?"plain":"s256"]}const pl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ml(i){const e=i.headers.get(ms);if(!e||!e.match(pl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Cs extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ee(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class yl extends Cs{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function gl(i){return ee(i)&&i.name==="AuthApiError"}class Ao extends Cs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class vt extends Cs{constructor(e,t,r,a){super(e,r,a),this.name=t,this.status=r}}class ft extends vt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ns extends vt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class zr extends vt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Hr extends vt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ui extends vt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ys extends vt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ss(i){return ee(i)&&i.name==="AuthRetryableFetchError"}class Fi extends vt{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var vl=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(i);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(i,r[a])&&(t[r[a]]=i[r[a]]);return t};const mt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),bl=[502,503,504];async function Bi(i){var e;if(!il(i))throw new ys(mt(i),0);if(bl.includes(i.status))throw new ys(mt(i),i.status);let t;try{t=await i.json()}catch(o){throw new Ao(mt(o),o)}let r;const a=ml(i);if(a&&a.getTime()>=Oo["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Fi(mt(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0))throw new Fi(mt(t),i.status,t.weak_password.reasons);throw new yl(mt(t),i.status||500,r)}const wl=(i,e,t,r)=>{const a={method:i,headers:e?.headers||{}};return i==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),t))};async function te(i,e,t,r){var a;const o=Object.assign({},r?.headers);o[ms]||(o[ms]=Oo["2024-01-01"].name),r?.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const u=(a=r?.query)!==null&&a!==void 0?a:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const d=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",p=await _l(i,e,t+d,{headers:o,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(p):{data:Object.assign({},p),error:null}}async function _l(i,e,t,r,a,o){const u=wl(e,r,a,o);let d;try{d=await i(t,Object.assign(Object.assign({},u),{cache:"no-store"}))}catch(p){throw console.error(p),new ys(mt(p),0)}if(d.ok||await Bi(d),r?.noResolveJson)return d;try{return await d.json()}catch(p){await Bi(p)}}function Qe(i){var e;let t=null;Pl(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=nl(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function qi(i){const e=Qe(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function et(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function kl(i){return{data:i,error:null}}function Sl(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:o}=i,u=vl(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:o},p=Object.assign({},u);return{data:{properties:d,user:p},error:null}}function El(i){return i}function Pl(i){return i.access_token&&i.refresh_token&&i.expires_in}var Ol=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(i);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(i,r[a])&&(t[r[a]]=i[r[a]]);return t};class xl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=xo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await te(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ee(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:et})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ol(e,["options"]),a=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(a.new_email=r?.newEmail,delete a.newEmail),await te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Sl,redirectTo:t?.redirectTo})}catch(t){if(ee(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:et})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,a,o,u,d,p;try{const y={nextPage:null,lastPage:0,total:0},g=await te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:El});if(g.error)throw g.error;const S=await g.json(),$=(u=g.headers.get("x-total-count"))!==null&&u!==void 0?u:0,K=(p=(d=g.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return K.length>0&&(K.forEach(N=>{const U=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),W=JSON.parse(N.split(";")[1].split("=")[1]);y[`${W}Page`]=U}),y.total=parseInt($)),{data:Object.assign(Object.assign({},S),y),error:null}}catch(y){if(ee(y))return{data:{users:[]},error:y};throw y}}async getUserById(e){try{return await te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:et})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:et})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:et})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:t,error:r}}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ee(t))return{data:null,error:t};throw t}}}const Tl={getItem:i=>cr()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{cr()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{cr()&&globalThis.localStorage.removeItem(i)}};function Mi(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Al(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Rt={debug:!!(globalThis&&cr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Co extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Cl extends Co{}async function Rl(i,e,t){Rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Rt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){Rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,a.name);try{return await t()}finally{Rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,a.name)}}else{if(e===0)throw Rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Cl(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Rt.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Al();const jl={url:el,storageKey:tl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rl,flowType:"implicit",debug:!1},sr=30*1e3,Ki=3;async function Ji(i,e,t){return await t()}class lr{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=lr.nextInstanceID,lr.nextInstanceID+=1,this.instanceID>0&&Ce()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},jl),e);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new xl({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=xo(a.fetch),this.lock=a.lock||Ji,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,a.lock?this.lock=a.lock:Ce()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Rl:this.lock=Ji,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?a.storage?this.storage=a.storage:cr()?this.storage=Tl:(this.memoryStorage={},this.storage=Mi(this.memoryStorage)):(this.memoryStorage={},this.storage=Mi(this.memoryStorage)),Ce()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Po}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Ce()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),r?.message==="Identity is already linked"||r?.message==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:a,redirectType:o}=t;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ee(e)?{error:e}:{error:new Ao("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,a;try{await this._removeSession();const o=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e?.options)===null||a===void 0?void 0:a.captchaToken}},xform:Qe}),{data:u,error:d}=o;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(o){if(ee(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,a;try{await this._removeSession();let o;if("email"in e){const{email:g,password:S,options:$}=e;let K=null,N=null;this.flowType==="pkce"&&([K,N]=await Ct(this.storage,this.storageKey)),o=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:$?.emailRedirectTo,body:{email:g,password:S,data:(t=$?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:$?.captchaToken},code_challenge:K,code_challenge_method:N},xform:Qe})}else if("phone"in e){const{phone:g,password:S,options:$}=e;o=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:S,data:(r=$?.data)!==null&&r!==void 0?r:{},channel:(a=$?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:$?.captchaToken}},xform:Qe})}else throw new zr("You must provide either an email or phone number and a password");const{data:u,error:d}=o;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(o){if(ee(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:o,password:u,options:d}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:qi})}else if("phone"in e){const{phone:o,password:u,options:d}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:qi})}else throw new zr("You must provide either an email or phone number and a password");const{data:r,error:a}=t;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ns}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,a,o;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Jr(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(t??"").split("/"),{data:o,error:u}=await te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Qe});return await rs(this.storage,`${this.storageKey}-code-verifier`),u?{data:{user:null,session:null,redirectType:null},error:u}:!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new ns}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:u})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:a,access_token:o,nonce:u}=e,d=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:o,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Qe}),{data:p,error:y}=d;return y?{data:{user:null,session:null},error:y}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new ns}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:y})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,a,o,u;try{if(await this._removeSession(),"email"in e){const{email:d,options:p}=e;let y=null,g=null;this.flowType==="pkce"&&([y,g]=await Ct(this.storage,this.storageKey));const{error:S}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(t=p?.data)!==null&&t!==void 0?t:{},create_user:(r=p?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:y,code_challenge_method:g},redirectTo:p?.emailRedirectTo});return{data:{user:null,session:null},error:S}}if("phone"in e){const{phone:d,options:p}=e,{data:y,error:g}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(a=p?.data)!==null&&a!==void 0?a:{},create_user:(o=p?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(u=p?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:y?.message_id},error:g}}throw new zr("You must provide either an email or phone number.")}catch(d){if(ee(d))return{data:{user:null,session:null},error:d};throw d}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let a,o;"options"in e&&(a=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:d}=await te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Qe});if(d)throw d;if(!u)throw new Error("An error occurred on token verification.");const p=u.session,y=u.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(a){if(ee(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var t,r,a;try{await this._removeSession();let o=null,u=null;return this.flowType==="pkce"&&([o,u]=await Ct(this.storage,this.storageKey)),await te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:u}),headers:this.headers,xform:kl})}catch(o){if(ee(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ft;const{error:a}=await te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(ee(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:o}=e,{error:u}=await te(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:a,options:o}=e,{data:u,error:d}=await te(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new zr("You must provide either an email or phone number and a type")}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Jr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return this.storage.isServer&&(e=new Proxy(e,{get(d,p,y){return p==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(d,p,y)}})),{data:{session:e},error:null};const{session:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:et}):await this._useSession(async t=>{var r,a,o;const{data:u,error:d}=t;if(d)throw d;return!((r=u.session)===null||r===void 0)&&r.access_token?await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:et}):{data:{user:null},error:new ft}})}catch(t){if(ee(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:a,error:o}=r;if(o)throw o;if(!a.session)throw new ft;const u=a.session;let d=null,p=null;this.flowType==="pkce"&&e.email!=null&&([d,p]=await Ct(this.storage,this.storageKey));const{data:y,error:g}=await te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:p}),jwt:u.access_token,xform:et});if(g)throw g;return u.user=y.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Li(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ft;const t=Date.now()/1e3;let r=t,a=!0,o=null;const u=Li(e.access_token);if(u.exp&&(r=u.exp,a=r<=t),a){const{session:d,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!d)return{data:{user:null,session:null},error:null};o=d}else{const{data:d,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(ee(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:d}=t;if(d)throw d;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new ft;const{session:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Ce())throw new Hr("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Hr("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Ui("Not a valid PKCE flow url.");const t=ts(window.location.href);if(e){if(!t.code)throw new Ui("No code detected.");const{data:de,error:fe}=await this._exchangeCodeForSession(t.code);if(fe)throw fe;const le=new URL(window.location.href);return le.searchParams.delete("code"),window.history.replaceState(window.history.state,"",le.toString()),{data:{session:de.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Hr(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:a,access_token:o,refresh_token:u,expires_in:d,expires_at:p,token_type:y}=t;if(!o||!d||!u||!y)throw new Hr("No session defined in URL");const g=Math.round(Date.now()/1e3),S=parseInt(d);let $=g+S;p&&($=parseInt(p));const K=$-g;K*1e3<=sr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${K}s, should have been closer to ${S}s`);const N=$-S;g-N>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",N,$,g):g-N<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",N,$,g);const{data:U,error:W}=await this._getUser(o);if(W)throw W;const ne={provider_token:r,provider_refresh_token:a,access_token:o,expires_in:S,expires_at:$,refresh_token:u,token_type:y,user:U.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ne,redirectType:t.type},error:null}}catch(t){if(ee(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=ts(window.location.href);return!!(Ce()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=ts(window.location.href),t=await Jr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:a,error:o}=t;if(o)return{error:o};const u=(r=a.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:d}=await this.admin.signOut(u,e);if(d&&!(gl(d)&&(d.status===404||d.status===401)))return{error:d}}return e!=="others"&&(await this._removeSession(),await rs(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=sl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,a;try{const{data:{session:o},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await Ct(this.storage,this.storageKey,!0));try{return await te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(ee(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ee(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:a}=await this._useSession(async o=>{var u,d,p,y,g;const{data:S,error:$}=o;if($)throw $;const K=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await te(this.fetch,"GET",K,{headers:this.headers,jwt:(g=(y=S.session)===null||y===void 0?void 0:y.access_token)!==null&&g!==void 0?g:void 0})});if(a)throw a;return Ce()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ee(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,a;const{data:o,error:u}=t;if(u)throw u;return await te(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await cl(async a=>(a>0&&await al(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Qe})),(a,o)=>{const u=200*Math.pow(2,a);return o&&ss(o)&&Date.now()+u-r<sr})}catch(r){if(this._debug(t,"error",r),ee(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Ce()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Jr(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const a=Math.round(Date.now()/1e3),o=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<a+Ni;if(this._debug(t,`session has${o?"":" not"} expired with margin of ${Ni}s`),o){if(this.autoRefreshToken&&r.refresh_token){const{error:u}=await this._callRefreshToken(r.refresh_token);u&&(console.error(u),ss(u)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ft;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new on;const{data:o,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!o.session)throw new ft;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const d={session:o.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(o){if(this._debug(a,"error",o),ee(o)){const u={session:null,error:o};return ss(o)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],u=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,t)}catch(p){o.push(p)}});if(await Promise.all(u),o.length>0){for(let d=0;d<o.length;d+=1)console.error(o[d]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await To(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await rs(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ce()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),sr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/sr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${sr}ms, refresh threshold is ${Ki} ticks`),a<=Ki&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Co)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ce()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const a=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,u]=await Ct(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(u)}`});a.push(d.toString())}if(r?.queryParams){const o=new URLSearchParams(r.queryParams);a.push(o.toString())}return r?.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;return o?{data:null,error:o}:await te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,a;const{data:o,error:u}=t;if(u)return{data:null,error:u};const{data:d,error:p}=await te(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return p?{data:null,error:p}:(!((a=d?.totp)===null||a===void 0)&&a.qr_code&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),{data:d,error:null})})}catch(t){if(ee(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;if(o)return{data:null,error:o};const{data:u,error:d}=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:d})})}catch(t){if(ee(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;return o?{data:null,error:o}:await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ee(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],a=r.filter(o=>o.factor_type==="totp"&&o.status==="verified");return{data:{all:r,totp:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:a},error:o}=e;if(o)return{data:null,error:o};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=this._decodeJWT(a.access_token);let d=null;u.aal&&(d=u.aal);let p=d;((r=(t=a.user.factors)===null||t===void 0?void 0:t.filter(S=>S.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(p="aal2");const g=u.amr||[];return{data:{currentLevel:d,nextLevel:p,currentAuthenticationMethods:g},error:null}}))}}lr.nextInstanceID=0;const Il=lr;class Dl extends Il{constructor(e){super(e)}}var $l=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(S){u(S)}}function p(g){try{y(r.throw(g))}catch(S){u(S)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class Nl{constructor(e,t,r){var a,o,u,d,p,y,g,S;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const $=Qu(e);this.realtimeUrl=`${$}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${$}/auth/v1`,this.storageUrl=`${$}/storage/v1`,this.functionsUrl=`${$}/functions/v1`;const K=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,N={db:zu,realtime:Vu,auth:Object.assign(Object.assign({},Hu),{storageKey:K}),global:Ju},U=Zu(r??{},N);this.storageKey=(o=(a=U.auth)===null||a===void 0?void 0:a.storageKey)!==null&&o!==void 0?o:"",this.headers=(d=(u=U.global)===null||u===void 0?void 0:u.headers)!==null&&d!==void 0?d:{},this.auth=this._initSupabaseAuthClient((p=U.auth)!==null&&p!==void 0?p:{},this.headers,(y=U.global)===null||y===void 0?void 0:y.fetch),this.fetch=Xu(t,this._getAccessToken.bind(this),(g=U.global)===null||g===void 0?void 0:g.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},U.realtime)),this.rest=new xs(`${$}/rest/v1`,{headers:this.headers,schema:(S=U.db)===null||S===void 0?void 0:S.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new su(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new qu(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return $l(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,storageKey:o,flowType:u,debug:d},p,y){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Dl({url:this.authUrl,headers:Object.assign(Object.assign({},g),p),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,flowType:u,debug:d,fetch:y})}_initRealtimeClient(e){return new Tu(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ll=(i,e,t)=>new Nl(i,e,t);var Ro={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(pi,function(){var t=function(n,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(c[h]=l[h])})(n,s)},r=function(){return(r=Object.assign||function(n){for(var s,c=1,l=arguments.length;c<l;c++)for(var h in s=arguments[c])Object.prototype.hasOwnProperty.call(s,h)&&(n[h]=s[h]);return n}).apply(this,arguments)};function a(n,s,c){if(c||arguments.length===2)for(var l,h=0,f=s.length;h<f;h++)!l&&h in s||((l=l||Array.prototype.slice.call(s,0,h))[h]=s[h]);return n.concat(l||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:pi,u=Object.keys,d=Array.isArray;function p(n,s){return typeof s!="object"||u(s).forEach(function(c){n[c]=s[c]}),n}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var y=Object.getPrototypeOf,g={}.hasOwnProperty;function S(n,s){return g.call(n,s)}function $(n,s){typeof s=="function"&&(s=s(y(n))),(typeof Reflect>"u"?u:Reflect.ownKeys)(s).forEach(function(c){N(n,c,s[c])})}var K=Object.defineProperty;function N(n,s,c,l){K(n,s,p(c&&S(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},l))}function U(n){return{from:function(s){return n.prototype=Object.create(s.prototype),N(n.prototype,"constructor",n),{extend:$.bind(null,n.prototype)}}}}var W=Object.getOwnPropertyDescriptor,ne=[].slice;function de(n,s,c){return ne.call(n,s,c)}function fe(n,s){return s(n)}function le(n){if(!n)throw new Error("Assertion Failed")}function tt(n){o.setImmediate?setImmediate(n):setTimeout(n,0)}function Le(n,s){if(typeof s=="string"&&S(n,s))return n[s];if(!s)return n;if(typeof s!="string"){for(var c=[],l=0,h=s.length;l<h;++l){var f=Le(n,s[l]);c.push(f)}return c}var m=s.indexOf(".");if(m!==-1){var v=n[s.substr(0,m)];return v==null?void 0:Le(v,s.substr(m+1))}}function Se(n,s,c){if(n&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof s!="string"&&"length"in s){le(typeof c!="string"&&"length"in c);for(var l=0,h=s.length;l<h;++l)Se(n,s[l],c[l])}else{var f,m,v=s.indexOf(".");v!==-1?(f=s.substr(0,v),(m=s.substr(v+1))===""?c===void 0?d(n)&&!isNaN(parseInt(f))?n.splice(f,1):delete n[f]:n[f]=c:Se(v=!(v=n[f])||!S(n,f)?n[f]={}:v,m,c)):c===void 0?d(n)&&!isNaN(parseInt(s))?n.splice(s,1):delete n[s]:n[s]=c}}function Rs(n){var s,c={};for(s in n)S(n,s)&&(c[s]=n[s]);return c}var Io=[].concat;function js(n){return Io.apply([],n)}var Be="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(js([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(s){return s+n+"Array"})}))).filter(function(n){return o[n]}),Is=new Set(Be.map(function(n){return o[n]})),Bt=null;function Ke(n){return Bt=new WeakMap,n=function s(c){if(!c||typeof c!="object")return c;var l=Bt.get(c);if(l)return l;if(d(c)){l=[],Bt.set(c,l);for(var h=0,f=c.length;h<f;++h)l.push(s(c[h]))}else if(Is.has(c.constructor))l=c;else{var m,v=y(c);for(m in l=v===Object.prototype?{}:Object.create(v),Bt.set(c,l),c)S(c,m)&&(l[m]=s(c[m]))}return l}(n),Bt=null,n}var Do={}.toString;function an(n){return Do.call(n).slice(8,-1)}var cn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",$o=typeof cn=="symbol"?function(n){var s;return n!=null&&(s=n[cn])&&s.apply(n)}:function(){return null};function rt(n,s){return s=n.indexOf(s),0<=s&&n.splice(s,1),0<=s}var bt={};function Ue(n){var s,c,l,h;if(arguments.length===1){if(d(n))return n.slice();if(this===bt&&typeof n=="string")return[n];if(h=$o(n)){for(c=[];!(l=h.next()).done;)c.push(l.value);return c}if(n==null)return[n];if(typeof(s=n.length)!="number")return[n];for(c=new Array(s);s--;)c[s]=n[s];return c}for(s=arguments.length,c=new Array(s);s--;)c[s]=arguments[s];return c}var un=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Kt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Oe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Kt),No={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function wt(n,s){this.name=n,this.message=s}function Ds(n,s){return n+". Errors: "+Object.keys(s).map(function(c){return s[c].toString()}).filter(function(c,l,h){return h.indexOf(c)===l}).join(`
`)}function mr(n,s,c,l){this.failures=s,this.failedKeys=l,this.successCount=c,this.message=Ds(n,s)}function _t(n,s){this.name="BulkError",this.failures=Object.keys(s).map(function(c){return s[c]}),this.failuresByPos=s,this.message=Ds(n,this.failures)}U(wt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),U(mr).from(wt),U(_t).from(wt);var ln=Oe.reduce(function(n,s){return n[s]=s+"Error",n},{}),Lo=wt,V=Oe.reduce(function(n,s){var c=s+"Error";function l(h,f){this.name=c,h?typeof h=="string"?(this.message="".concat(h).concat(f?`
 `+f:""),this.inner=f||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=No[s]||c,this.inner=null)}return U(l).from(Lo),n[s]=l,n},{});V.Syntax=SyntaxError,V.Type=TypeError,V.Range=RangeError;var $s=Kt.reduce(function(n,s){return n[s+"Error"]=V[s],n},{}),yr=Oe.reduce(function(n,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(n[s+"Error"]=V[s]),n},{});function ae(){}function qt(n){return n}function Uo(n,s){return n==null||n===qt?s:function(c){return s(n(c))}}function nt(n,s){return function(){n.apply(this,arguments),s.apply(this,arguments)}}function Fo(n,s){return n===ae?s:function(){var c=n.apply(this,arguments);c!==void 0&&(arguments[0]=c);var l=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var f=s.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?nt(l,this.onsuccess):l),h&&(this.onerror=this.onerror?nt(h,this.onerror):h),f!==void 0?f:c}}function Bo(n,s){return n===ae?s:function(){n.apply(this,arguments);var c=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?nt(c,this.onsuccess):c),l&&(this.onerror=this.onerror?nt(l,this.onerror):l)}}function qo(n,s){return n===ae?s:function(c){var l=n.apply(this,arguments);p(c,l);var h=this.onsuccess,f=this.onerror;return this.onsuccess=null,this.onerror=null,c=s.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?nt(h,this.onsuccess):h),f&&(this.onerror=this.onerror?nt(f,this.onerror):f),l===void 0?c===void 0?void 0:c:p(l,c)}}function Mo(n,s){return n===ae?s:function(){return s.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function hn(n,s){return n===ae?s:function(){var c=n.apply(this,arguments);if(c&&typeof c.then=="function"){for(var l=this,h=arguments.length,f=new Array(h);h--;)f[h]=arguments[h];return c.then(function(){return s.apply(l,f)})}return s.apply(this,arguments)}}yr.ModifyError=mr,yr.DexieError=wt,yr.BulkError=_t;var je=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ns(n){je=n}var Mt={},Ls=100,Be=typeof Promise>"u"?[]:function(){var n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,y(n),n];var s=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[s,y(s),n]}(),Kt=Be[0],Oe=Be[1],Be=Be[2],Oe=Oe&&Oe.then,Jt=Kt&&Kt.constructor,dn=!!Be,zt=function(n,s){Ht.push([n,s]),gr&&(queueMicrotask(Jo),gr=!1)},fn=!0,gr=!0,st=[],vr=[],pn=qt,Je={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ae,pgp:!1,env:{},finalize:ae},H=Je,Ht=[],it=0,br=[];function J(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=H;if(typeof n!="function"){if(n!==Mt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&yn(this,this._value))}this._state=null,this._value=null,++s.ref,function c(l,h){try{h(function(f){if(l._state===null){if(f===l)throw new TypeError("A promise cannot be resolved with itself.");var m=l._lib&&kt();f&&typeof f.then=="function"?c(l,function(v,k){f instanceof J?f._then(v,k):f.then(v,k)}):(l._state=!0,l._value=f,Fs(l)),m&&St()}},yn.bind(null,l))}catch(f){yn(l,f)}}(this,n)}var mn={get:function(){var n=H,s=Sr;function c(l,h){var f=this,m=!n.global&&(n!==H||s!==Sr),v=m&&!He(),k=new J(function(w,O){gn(f,new Us(qs(l,n,m,v),qs(h,n,m,v),w,O,n))});return this._consoleTask&&(k._consoleTask=this._consoleTask),k}return c.prototype=Mt,c},set:function(n){N(this,"then",n&&n.prototype===Mt?mn:{get:function(){return n},set:mn.set})}};function Us(n,s,c,l,h){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof s=="function"?s:null,this.resolve=c,this.reject=l,this.psd=h}function yn(n,s){var c,l;vr.push(s),n._state===null&&(c=n._lib&&kt(),s=pn(s),n._state=!1,n._value=s,l=n,st.some(function(h){return h._value===l._value})||st.push(l),Fs(n),c&&St())}function Fs(n){var s=n._listeners;n._listeners=[];for(var c=0,l=s.length;c<l;++c)gn(n,s[c]);var h=n._PSD;--h.ref||h.finalize(),it===0&&(++it,zt(function(){--it==0&&vn()},[]))}function gn(n,s){if(n._state!==null){var c=n._state?s.onFulfilled:s.onRejected;if(c===null)return(n._state?s.resolve:s.reject)(n._value);++s.psd.ref,++it,zt(Ko,[c,n,s])}else n._listeners.push(s)}function Ko(n,s,c){try{var l,h=s._value;!s._state&&vr.length&&(vr=[]),l=je&&s._consoleTask?s._consoleTask.run(function(){return n(h)}):n(h),s._state||vr.indexOf(h)!==-1||function(f){for(var m=st.length;m;)if(st[--m]._value===f._value)return st.splice(m,1)}(s),c.resolve(l)}catch(f){c.reject(f)}finally{--it==0&&vn(),--c.psd.ref||c.psd.finalize()}}function Jo(){ot(Je,function(){kt()&&St()})}function kt(){var n=fn;return gr=fn=!1,n}function St(){var n,s,c;do for(;0<Ht.length;)for(n=Ht,Ht=[],c=n.length,s=0;s<c;++s){var l=n[s];l[0].apply(null,l[1])}while(0<Ht.length);gr=fn=!0}function vn(){var n=st;st=[],n.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var s=br.slice(0),c=s.length;c;)s[--c]()}function wr(n){return new J(Mt,!1,n)}function he(n,s){var c=H;return function(){var l=kt(),h=H;try{return Ve(c,!0),n.apply(this,arguments)}catch(f){s&&s(f)}finally{Ve(h,!1),l&&St()}}}$(J.prototype,{then:mn,_then:function(n,s){gn(this,new Us(null,null,n,s,H))},catch:function(n){if(arguments.length===1)return this.then(null,n);var s=n,c=arguments[1];return typeof s=="function"?this.then(null,function(l){return(l instanceof s?c:wr)(l)}):this.then(null,function(l){return(l&&l.name===s?c:wr)(l)})},finally:function(n){return this.then(function(s){return J.resolve(n()).then(function(){return s})},function(s){return J.resolve(n()).then(function(){return wr(s)})})},timeout:function(n,s){var c=this;return n<1/0?new J(function(l,h){var f=setTimeout(function(){return h(new V.Timeout(s))},n);c.then(l,h).finally(clearTimeout.bind(null,f))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&N(J.prototype,Symbol.toStringTag,"Dexie.Promise"),Je.env=Bs(),$(J,{all:function(){var n=Ue.apply(null,arguments).map(Er);return new J(function(s,c){n.length===0&&s([]);var l=n.length;n.forEach(function(h,f){return J.resolve(h).then(function(m){n[f]=m,--l||s(n)},c)})})},resolve:function(n){return n instanceof J?n:n&&typeof n.then=="function"?new J(function(s,c){n.then(s,c)}):new J(Mt,!0,n)},reject:wr,race:function(){var n=Ue.apply(null,arguments).map(Er);return new J(function(s,c){n.map(function(l){return J.resolve(l).then(s,c)})})},PSD:{get:function(){return H},set:function(n){return H=n}},totalEchoes:{get:function(){return Sr}},newPSD:ze,usePSD:ot,scheduler:{get:function(){return zt},set:function(n){zt=n}},rejectionMapper:{get:function(){return pn},set:function(n){pn=n}},follow:function(n,s){return new J(function(c,l){return ze(function(h,f){var m=H;m.unhandleds=[],m.onunhandled=f,m.finalize=nt(function(){var v,k=this;v=function(){k.unhandleds.length===0?h():f(k.unhandleds[0])},br.push(function w(){v(),br.splice(br.indexOf(w),1)}),++it,zt(function(){--it==0&&vn()},[])},m.finalize),n()},s,c,l)})}}),Jt&&(Jt.allSettled&&N(J,"allSettled",function(){var n=Ue.apply(null,arguments).map(Er);return new J(function(s){n.length===0&&s([]);var c=n.length,l=new Array(c);n.forEach(function(h,f){return J.resolve(h).then(function(m){return l[f]={status:"fulfilled",value:m}},function(m){return l[f]={status:"rejected",reason:m}}).then(function(){return--c||s(l)})})})}),Jt.any&&typeof AggregateError<"u"&&N(J,"any",function(){var n=Ue.apply(null,arguments).map(Er);return new J(function(s,c){n.length===0&&c(new AggregateError([]));var l=n.length,h=new Array(l);n.forEach(function(f,m){return J.resolve(f).then(function(v){return s(v)},function(v){h[m]=v,--l||c(new AggregateError(h))})})})}));var ye={awaits:0,echoes:0,id:0},zo=0,_r=[],kr=0,Sr=0,Ho=0;function ze(n,s,c,l){var h=H,f=Object.create(h);return f.parent=h,f.ref=0,f.global=!1,f.id=++Ho,Je.env,f.env=dn?{Promise:J,PromiseProp:{value:J,configurable:!0,writable:!0},all:J.all,race:J.race,allSettled:J.allSettled,any:J.any,resolve:J.resolve,reject:J.reject}:{},s&&p(f,s),++h.ref,f.finalize=function(){--this.parent.ref||this.parent.finalize()},l=ot(f,n,c,l),f.ref===0&&f.finalize(),l}function Et(){return ye.id||(ye.id=++zo),++ye.awaits,ye.echoes+=Ls,ye.id}function He(){return!!ye.awaits&&(--ye.awaits==0&&(ye.id=0),ye.echoes=ye.awaits*Ls,!0)}function Er(n){return ye.echoes&&n&&n.constructor===Jt?(Et(),n.then(function(s){return He(),s},function(s){return He(),pe(s)})):n}function Vo(){var n=_r[_r.length-1];_r.pop(),Ve(n,!1)}function Ve(n,s){var c,l=H;(s?!ye.echoes||kr++&&n===H:!kr||--kr&&n===H)||queueMicrotask(s?function(h){++Sr,ye.echoes&&--ye.echoes!=0||(ye.echoes=ye.awaits=ye.id=0),_r.push(H),Ve(h,!0)}.bind(null,n):Vo),n!==H&&(H=n,l===Je&&(Je.env=Bs()),dn&&(c=Je.env.Promise,s=n.env,(l.global||n.global)&&(Object.defineProperty(o,"Promise",s.PromiseProp),c.all=s.all,c.race=s.race,c.resolve=s.resolve,c.reject=s.reject,s.allSettled&&(c.allSettled=s.allSettled),s.any&&(c.any=s.any))))}function Bs(){var n=o.Promise;return dn?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function ot(n,s,c,l,h){var f=H;try{return Ve(n,!0),s(c,l,h)}finally{Ve(f,!1)}}function qs(n,s,c,l){return typeof n!="function"?n:function(){var h=H;c&&Et(),Ve(s,!0);try{return n.apply(this,arguments)}finally{Ve(h,!1),l&&queueMicrotask(He)}}}function bn(n){Promise===Jt&&ye.echoes===0?kr===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+Oe).indexOf("[native code]")===-1&&(Et=He=ae);var pe=J.reject,at="",Fe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ms="String expected.",Pt=[],Pr="__dbnames",wn="readonly",_n="readwrite";function ct(n,s){return n?s?function(){return n.apply(this,arguments)&&s.apply(this,arguments)}:n:s}var Ks={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Or(n){return typeof n!="string"||/\./.test(n)?function(s){return s}:function(s){return s[n]===void 0&&n in s&&delete(s=Ke(s))[n],s}}function Js(){throw V.Type()}function ie(n,s){try{var c=zs(n),l=zs(s);if(c!==l)return c==="Array"?1:l==="Array"?-1:c==="binary"?1:l==="binary"?-1:c==="string"?1:l==="string"?-1:c==="Date"?1:l!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return s<n?1:n<s?-1:0;case"binary":return function(h,f){for(var m=h.length,v=f.length,k=m<v?m:v,w=0;w<k;++w)if(h[w]!==f[w])return h[w]<f[w]?-1:1;return m===v?0:m<v?-1:1}(Hs(n),Hs(s));case"Array":return function(h,f){for(var m=h.length,v=f.length,k=m<v?m:v,w=0;w<k;++w){var O=ie(h[w],f[w]);if(O!==0)return O}return m===v?0:m<v?-1:1}(n,s)}}catch{}return NaN}function zs(n){var s=typeof n;return s!="object"?s:ArrayBuffer.isView(n)?"binary":(n=an(n),n==="ArrayBuffer"?"binary":n)}function Hs(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var Vs=(ue.prototype._trans=function(n,s,c){var l=this._tx||H.trans,h=this.name,f=je&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function m(w,O,b){if(!b.schema[h])throw new V.NotFound("Table "+h+" not part of transaction");return s(b.idbtrans,b)}var v=kt();try{var k=l&&l.db._novip===this.db._novip?l===H.trans?l._promise(n,m,c):ze(function(){return l._promise(n,m,c)},{trans:l,transless:H.transless||H}):function w(O,b,x,_){if(O.idbdb&&(O._state.openComplete||H.letThrough||O._vip)){var P=O._createTransaction(b,x,O._dbSchema);try{P.create(),O._state.PR1398_maxLoop=3}catch(T){return T.name===ln.InvalidState&&O.isOpen()&&0<--O._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),O.close({disableAutoOpen:!1}),O.open().then(function(){return w(O,b,x,_)})):pe(T)}return P._promise(b,function(T,E){return ze(function(){return H.trans=P,_(T,E,P)})}).then(function(T){if(b==="readwrite")try{P.idbtrans.commit()}catch{}return b==="readonly"?T:P._completion.then(function(){return T})})}if(O._state.openComplete)return pe(new V.DatabaseClosed(O._state.dbOpenError));if(!O._state.isBeingOpened){if(!O._state.autoOpen)return pe(new V.DatabaseClosed);O.open().catch(ae)}return O._state.dbReadyPromise.then(function(){return w(O,b,x,_)})}(this.db,n,[this.name],m);return f&&(k._consoleTask=f,k=k.catch(function(w){return console.trace(w),pe(w)})),k}finally{v&&St()}},ue.prototype.get=function(n,s){var c=this;return n&&n.constructor===Object?this.where(n).first(s):n==null?pe(new V.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return c.core.get({trans:l,key:n}).then(function(h){return c.hook.reading.fire(h)})}).then(s)},ue.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(d(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var s=u(n);if(s.length===1)return this.where(s[0]).equals(n[s[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(k){if(k.compound&&s.every(function(O){return 0<=k.keyPath.indexOf(O)})){for(var w=0;w<s.length;++w)if(s.indexOf(k.keyPath[w])===-1)return!1;return!0}return!1}).sort(function(k,w){return k.keyPath.length-w.keyPath.length})[0];if(c&&this.db._maxKey!==at){var m=c.keyPath.slice(0,s.length);return this.where(m).equals(m.map(function(w){return n[w]}))}!c&&je&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var l=this.schema.idxByName,h=this.db._deps.indexedDB;function f(k,w){return h.cmp(k,w)===0}var v=s.reduce(function(x,w){var O=x[0],b=x[1],x=l[w],_=n[w];return[O||x,O||!x?ct(b,x&&x.multi?function(P){return P=Le(P,w),d(P)&&P.some(function(T){return f(_,T)})}:function(P){return f(_,Le(P,w))}):b]},[null,null]),m=v[0],v=v[1];return m?this.where(m.name).equals(n[m.keyPath]).filter(v):c?this.filter(v):this.where(s).equals("")},ue.prototype.filter=function(n){return this.toCollection().and(n)},ue.prototype.count=function(n){return this.toCollection().count(n)},ue.prototype.offset=function(n){return this.toCollection().offset(n)},ue.prototype.limit=function(n){return this.toCollection().limit(n)},ue.prototype.each=function(n){return this.toCollection().each(n)},ue.prototype.toArray=function(n){return this.toCollection().toArray(n)},ue.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ue.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,d(n)?"[".concat(n.join("+"),"]"):n))},ue.prototype.reverse=function(){return this.toCollection().reverse()},ue.prototype.mapToClass=function(n){var s,c=this.db,l=this.name;function h(){return s!==null&&s.apply(this,arguments)||this}(this.schema.mappedClass=n).prototype instanceof Js&&(function(k,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function O(){this.constructor=k}t(k,w),k.prototype=w===null?Object.create(w):(O.prototype=w.prototype,new O)}(h,s=n),Object.defineProperty(h.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),h.prototype.table=function(){return l},n=h);for(var f=new Set,m=n.prototype;m;m=y(m))Object.getOwnPropertyNames(m).forEach(function(k){return f.add(k)});function v(k){if(!k)return k;var w,O=Object.create(n.prototype);for(w in k)if(!f.has(w))try{O[w]=k[w]}catch{}return O}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),n},ue.prototype.defineClass=function(){return this.mapToClass(function(n){p(this,n)})},ue.prototype.add=function(n,s){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=Or(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"add",keys:s!=null?[s]:null,values:[m]})}).then(function(v){return v.numFailures?J.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{Se(n,f,v)}catch{}return v})},ue.prototype.update=function(n,s){return typeof n!="object"||d(n)?this.where(":id").equals(n).modify(s):(n=Le(n,this.schema.primKey.keyPath),n===void 0?pe(new V.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(s))},ue.prototype.put=function(n,s){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=Or(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"put",values:[m],keys:s!=null?[s]:null})}).then(function(v){return v.numFailures?J.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{Se(n,f,v)}catch{}return v})},ue.prototype.delete=function(n){var s=this;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:[n]})}).then(function(c){return c.numFailures?J.reject(c.failures[0]):void 0})},ue.prototype.clear=function(){var n=this;return this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"deleteRange",range:Ks})}).then(function(s){return s.numFailures?J.reject(s.failures[0]):void 0})},ue.prototype.bulkGet=function(n){var s=this;return this._trans("readonly",function(c){return s.core.getMany({keys:n,trans:c}).then(function(l){return l.map(function(h){return s.hook.reading.fire(h)})})})},ue.prototype.bulkAdd=function(n,s,c){var l=this,h=Array.isArray(s)?s:void 0,f=(c=c||(h?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(m){var w=l.schema.primKey,v=w.auto,w=w.keyPath;if(w&&h)throw new V.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");var k=n.length,w=w&&v?n.map(Or(w)):n;return l.core.mutate({trans:m,type:"add",keys:h,values:w,wantResults:f}).then(function(P){var b=P.numFailures,x=P.results,_=P.lastResult,P=P.failures;if(b===0)return f?x:_;throw new _t("".concat(l.name,".bulkAdd(): ").concat(b," of ").concat(k," operations failed"),P)})})},ue.prototype.bulkPut=function(n,s,c){var l=this,h=Array.isArray(s)?s:void 0,f=(c=c||(h?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(m){var w=l.schema.primKey,v=w.auto,w=w.keyPath;if(w&&h)throw new V.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");var k=n.length,w=w&&v?n.map(Or(w)):n;return l.core.mutate({trans:m,type:"put",keys:h,values:w,wantResults:f}).then(function(P){var b=P.numFailures,x=P.results,_=P.lastResult,P=P.failures;if(b===0)return f?x:_;throw new _t("".concat(l.name,".bulkPut(): ").concat(b," of ").concat(k," operations failed"),P)})})},ue.prototype.bulkUpdate=function(n){var s=this,c=this.core,l=n.map(function(m){return m.key}),h=n.map(function(m){return m.changes}),f=[];return this._trans("readwrite",function(m){return c.getMany({trans:m,keys:l,cache:"clone"}).then(function(v){var k=[],w=[];n.forEach(function(b,x){var _=b.key,P=b.changes,T=v[x];if(T){for(var E=0,A=Object.keys(P);E<A.length;E++){var C=A[E],R=P[C];if(C===s.schema.primKey.keyPath){if(ie(R,_)!==0)throw new V.Constraint("Cannot update primary key in bulkUpdate()")}else Se(T,C,R)}f.push(x),k.push(_),w.push(T)}});var O=k.length;return c.mutate({trans:m,type:"put",keys:k,values:w,updates:{keys:l,changeSpecs:h}}).then(function(b){var x=b.numFailures,_=b.failures;if(x===0)return O;for(var P=0,T=Object.keys(_);P<T.length;P++){var E,A=T[P],C=f[Number(A)];C!=null&&(E=_[A],delete _[A],_[C]=E)}throw new _t("".concat(s.name,".bulkUpdate(): ").concat(x," of ").concat(O," operations failed"),_)})})})},ue.prototype.bulkDelete=function(n){var s=this,c=n.length;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:n})}).then(function(m){var h=m.numFailures,f=m.lastResult,m=m.failures;if(h===0)return f;throw new _t("".concat(s.name,".bulkDelete(): ").concat(h," of ").concat(c," operations failed"),m)})},ue);function ue(){}function Vt(n){function s(m,v){if(v){for(var k=arguments.length,w=new Array(k-1);--k;)w[k-1]=arguments[k];return c[m].subscribe.apply(null,w),n}if(typeof m=="string")return c[m]}var c={};s.addEventType=f;for(var l=1,h=arguments.length;l<h;++l)f(arguments[l]);return s;function f(m,v,k){if(typeof m!="object"){var w;v=v||Mo;var O={subscribers:[],fire:k=k||ae,subscribe:function(b){O.subscribers.indexOf(b)===-1&&(O.subscribers.push(b),O.fire=v(O.fire,b))},unsubscribe:function(b){O.subscribers=O.subscribers.filter(function(x){return x!==b}),O.fire=O.subscribers.reduce(v,k)}};return c[m]=s[m]=O}u(w=m).forEach(function(b){var x=w[b];if(d(x))f(b,w[b][0],w[b][1]);else{if(x!=="asap")throw new V.InvalidArgument("Invalid event config");var _=f(b,qt,function(){for(var P=arguments.length,T=new Array(P);P--;)T[P]=arguments[P];_.subscribers.forEach(function(E){tt(function(){E.apply(null,T)})})})}})}}function Wt(n,s){return U(s).from({prototype:n}),s}function Ot(n,s){return!(n.filter||n.algorithm||n.or)&&(s?n.justLimit:!n.replayFilter)}function kn(n,s){n.filter=ct(n.filter,s)}function Sn(n,s,c){var l=n.replayFilter;n.replayFilter=l?function(){return ct(l(),s())}:s,n.justLimit=c&&!l}function xr(n,s){if(n.isPrimKey)return s.primaryKey;var c=s.getIndexByKeyPath(n.index);if(!c)throw new V.Schema("KeyPath "+n.index+" on object store "+s.name+" is not indexed");return c}function Ws(n,s,c){var l=xr(n,s.schema);return s.openCursor({trans:c,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:l,range:n.range}})}function Tr(n,s,c,l){var h=n.replayFilter?ct(n.filter,n.replayFilter()):n.filter;if(n.or){var f={},m=function(v,k,w){var O,b;h&&!h(k,w,function(x){return k.stop(x)},function(x){return k.fail(x)})||((b=""+(O=k.primaryKey))=="[object ArrayBuffer]"&&(b=""+new Uint8Array(O)),S(f,b)||(f[b]=!0,s(v,k,w)))};return Promise.all([n.or._iterate(m,c),Gs(Ws(n,l,c),n.algorithm,m,!n.keysOnly&&n.valueMapper)])}return Gs(Ws(n,l,c),ct(n.algorithm,h),s,!n.keysOnly&&n.valueMapper)}function Gs(n,s,c,l){var h=he(l?function(f,m,v){return c(l(f),m,v)}:c);return n.then(function(f){if(f)return f.start(function(){var m=function(){return f.continue()};s&&!s(f,function(v){return m=v},function(v){f.stop(v),m=ae},function(v){f.fail(v),m=ae})||h(f.value,f,function(v){return m=v}),m()})})}var Be=Symbol(),Gt=(Ys.prototype.execute=function(n){if(this.add!==void 0){var s=this.add;if(d(s))return a(a([],d(n)?n:[],!0),s,!0).sort();if(typeof s=="number")return(Number(n)||0)+s;if(typeof s=="bigint")try{return BigInt(n)+s}catch{return BigInt(0)+s}throw new TypeError("Invalid term ".concat(s))}if(this.remove!==void 0){var c=this.remove;if(d(c))return d(n)?n.filter(function(l){return!c.includes(l)}).sort():[];if(typeof c=="number")return Number(n)-c;if(typeof c=="bigint")try{return BigInt(n)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return s=(s=this.replacePrefix)===null||s===void 0?void 0:s[0],s&&typeof n=="string"&&n.startsWith(s)?this.replacePrefix[1]+n.substring(s.length):n},Ys);function Ys(n){Object.assign(this,n)}var Wo=(se.prototype._read=function(n,s){var c=this._ctx;return c.error?c.table._trans(null,pe.bind(null,c.error)):c.table._trans("readonly",n).then(s)},se.prototype._write=function(n){var s=this._ctx;return s.error?s.table._trans(null,pe.bind(null,s.error)):s.table._trans("readwrite",n,"locked")},se.prototype._addAlgorithm=function(n){var s=this._ctx;s.algorithm=ct(s.algorithm,n)},se.prototype._iterate=function(n,s){return Tr(this._ctx,n,s,this._ctx.table.core)},se.prototype.clone=function(n){var s=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return n&&p(c,n),s._ctx=c,s},se.prototype.raw=function(){return this._ctx.valueMapper=null,this},se.prototype.each=function(n){var s=this._ctx;return this._read(function(c){return Tr(s,n,c,s.table.core)})},se.prototype.count=function(n){var s=this;return this._read(function(c){var l=s._ctx,h=l.table.core;if(Ot(l,!0))return h.count({trans:c,query:{index:xr(l,h.schema),range:l.range}}).then(function(m){return Math.min(m,l.limit)});var f=0;return Tr(l,function(){return++f,!1},c,h).then(function(){return f})}).then(n)},se.prototype.sortBy=function(n,s){var c=n.split(".").reverse(),l=c[0],h=c.length-1;function f(k,w){return w?f(k[c[w]],w-1):k[l]}var m=this._ctx.dir==="next"?1:-1;function v(k,w){return k=f(k,h),w=f(w,h),k<w?-m:w<k?m:0}return this.toArray(function(k){return k.sort(v)}).then(s)},se.prototype.toArray=function(n){var s=this;return this._read(function(c){var l=s._ctx;if(l.dir==="next"&&Ot(l,!0)&&0<l.limit){var h=l.valueMapper,f=xr(l,l.table.core.schema);return l.table.core.query({trans:c,limit:l.limit,values:!0,query:{index:f,range:l.range}}).then(function(v){return v=v.result,h?v.map(h):v})}var m=[];return Tr(l,function(v){return m.push(v)},c,l.table.core).then(function(){return m})},n)},se.prototype.offset=function(n){var s=this._ctx;return n<=0||(s.offset+=n,Ot(s)?Sn(s,function(){var c=n;return function(l,h){return c===0||(c===1?--c:h(function(){l.advance(c),c=0}),!1)}}):Sn(s,function(){var c=n;return function(){return--c<0}})),this},se.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),Sn(this._ctx,function(){var s=n;return function(c,l,h){return--s<=0&&l(h),0<=s}},!0),this},se.prototype.until=function(n,s){return kn(this._ctx,function(c,l,h){return!n(c.value)||(l(h),s)}),this},se.prototype.first=function(n){return this.limit(1).toArray(function(s){return s[0]}).then(n)},se.prototype.last=function(n){return this.reverse().first(n)},se.prototype.filter=function(n){var s;return kn(this._ctx,function(c){return n(c.value)}),(s=this._ctx).isMatch=ct(s.isMatch,n),this},se.prototype.and=function(n){return this.filter(n)},se.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},se.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},se.prototype.desc=function(){return this.reverse()},se.prototype.eachKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,l){n(l.key,l)})},se.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},se.prototype.eachPrimaryKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,l){n(l.primaryKey,l)})},se.prototype.keys=function(n){var s=this._ctx;s.keysOnly=!s.isMatch;var c=[];return this.each(function(l,h){c.push(h.key)}).then(function(){return c}).then(n)},se.prototype.primaryKeys=function(n){var s=this._ctx;if(s.dir==="next"&&Ot(s,!0)&&0<s.limit)return this._read(function(l){var h=xr(s,s.table.core.schema);return s.table.core.query({trans:l,values:!1,limit:s.limit,query:{index:h,range:s.range}})}).then(function(l){return l.result}).then(n);s.keysOnly=!s.isMatch;var c=[];return this.each(function(l,h){c.push(h.primaryKey)}).then(function(){return c}).then(n)},se.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},se.prototype.firstKey=function(n){return this.limit(1).keys(function(s){return s[0]}).then(n)},se.prototype.lastKey=function(n){return this.reverse().firstKey(n)},se.prototype.distinct=function(){var n=this._ctx,n=n.index&&n.table.schema.idxByName[n.index];if(!n||!n.multi)return this;var s={};return kn(this._ctx,function(h){var l=h.primaryKey.toString(),h=S(s,l);return s[l]=!0,!h}),this},se.prototype.modify=function(n){var s=this,c=this._ctx;return this._write(function(l){var h,f,m;m=typeof n=="function"?n:(h=u(n),f=h.length,function(E){for(var A=!1,C=0;C<f;++C){var R=h[C],j=n[R],D=Le(E,R);j instanceof Gt?(Se(E,R,j.execute(D)),A=!0):D!==j&&(Se(E,R,j),A=!0)}return A});function v(E,R){var C=R.failures,R=R.numFailures;P+=E-R;for(var j=0,D=u(C);j<D.length;j++){var q=D[j];_.push(C[q])}}var k=c.table.core,w=k.schema.primaryKey,O=w.outbound,b=w.extractKey,x=s.db._options.modifyChunkSize||200,_=[],P=0,T=[];return s.clone().primaryKeys().then(function(E){function A(R){var j=Math.min(x,E.length-R);return k.getMany({trans:l,keys:E.slice(R,R+j),cache:"immutable"}).then(function(D){for(var q=[],L=[],B=O?[]:null,M=[],F=0;F<j;++F){var G=D[F],Y={value:Ke(G),primKey:E[R+F]};m.call(Y,Y.value,Y)!==!1&&(Y.value==null?M.push(E[R+F]):O||ie(b(G),b(Y.value))===0?(L.push(Y.value),O&&B.push(E[R+F])):(M.push(E[R+F]),q.push(Y.value)))}return Promise.resolve(0<q.length&&k.mutate({trans:l,type:"add",values:q}).then(function(Z){for(var X in Z.failures)M.splice(parseInt(X),1);v(q.length,Z)})).then(function(){return(0<L.length||C&&typeof n=="object")&&k.mutate({trans:l,type:"put",keys:B,values:L,criteria:C,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<R}).then(function(Z){return v(L.length,Z)})}).then(function(){return(0<M.length||C&&n===En)&&k.mutate({trans:l,type:"delete",keys:M,criteria:C,isAdditionalChunk:0<R}).then(function(Z){return v(M.length,Z)})}).then(function(){return E.length>R+j&&A(R+x)})})}var C=Ot(c)&&c.limit===1/0&&(typeof n!="function"||n===En)&&{index:c.index,range:c.range};return A(0).then(function(){if(0<_.length)throw new mr("Error modifying one or more objects",_,P,T);return E.length})})})},se.prototype.delete=function(){var n=this._ctx,s=n.range;return Ot(n)&&(n.isPrimKey||s.type===3)?this._write(function(c){var l=n.table.core.schema.primaryKey,h=s;return n.table.core.count({trans:c,query:{index:l,range:h}}).then(function(f){return n.table.core.mutate({trans:c,type:"deleteRange",range:h}).then(function(m){var v=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new mr("Could not delete some values",Object.keys(v).map(function(k){return v[k]}),f-m);return f-m})})}):this.modify(En)},se);function se(){}var En=function(n,s){return s.value=null};function Go(n,s){return n<s?-1:n===s?0:1}function Yo(n,s){return s<n?-1:n===s?0:1}function Ee(n,s,c){return n=n instanceof Qs?new n.Collection(n):n,n._ctx.error=new(c||TypeError)(s),n}function xt(n){return new n.Collection(n,function(){return Xs("")}).limit(0)}function Ar(n,s,c,l){var h,f,m,v,k,w,O,b=c.length;if(!c.every(function(P){return typeof P=="string"}))return Ee(n,Ms);function x(P){h=P==="next"?function(E){return E.toUpperCase()}:function(E){return E.toLowerCase()},f=P==="next"?function(E){return E.toLowerCase()}:function(E){return E.toUpperCase()},m=P==="next"?Go:Yo;var T=c.map(function(E){return{lower:f(E),upper:h(E)}}).sort(function(E,A){return m(E.lower,A.lower)});v=T.map(function(E){return E.upper}),k=T.map(function(E){return E.lower}),O=(w=P)==="next"?"":l}x("next"),n=new n.Collection(n,function(){return We(v[0],k[b-1]+l)}),n._ondirectionchange=function(P){x(P)};var _=0;return n._addAlgorithm(function(P,T,E){var A=P.key;if(typeof A!="string")return!1;var C=f(A);if(s(C,k,_))return!0;for(var R=null,j=_;j<b;++j){var D=function(q,L,B,M,F,G){for(var Y=Math.min(q.length,M.length),Z=-1,X=0;X<Y;++X){var Ae=L[X];if(Ae!==M[X])return F(q[X],B[X])<0?q.substr(0,X)+B[X]+B.substr(X+1):F(q[X],M[X])<0?q.substr(0,X)+M[X]+B.substr(X+1):0<=Z?q.substr(0,Z)+L[Z]+B.substr(Z+1):null;F(q[X],Ae)<0&&(Z=X)}return Y<M.length&&G==="next"?q+B.substr(q.length):Y<q.length&&G==="prev"?q.substr(0,B.length):Z<0?null:q.substr(0,Z)+M[Z]+B.substr(Z+1)}(A,C,v[j],k[j],m,w);D===null&&R===null?_=j+1:(R===null||0<m(R,D))&&(R=D)}return T(R!==null?function(){P.continue(R+O)}:E),!1}),n}function We(n,s,c,l){return{type:2,lower:n,upper:s,lowerOpen:c,upperOpen:l}}function Xs(n){return{type:1,lower:n,upper:n}}var Qs=(Object.defineProperty(ge.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ge.prototype.between=function(n,s,c,l){c=c!==!1,l=l===!0;try{return 0<this._cmp(n,s)||this._cmp(n,s)===0&&(c||l)&&(!c||!l)?xt(this):new this.Collection(this,function(){return We(n,s,!c,!l)})}catch{return Ee(this,Fe)}},ge.prototype.equals=function(n){return n==null?Ee(this,Fe):new this.Collection(this,function(){return Xs(n)})},ge.prototype.above=function(n){return n==null?Ee(this,Fe):new this.Collection(this,function(){return We(n,void 0,!0)})},ge.prototype.aboveOrEqual=function(n){return n==null?Ee(this,Fe):new this.Collection(this,function(){return We(n,void 0,!1)})},ge.prototype.below=function(n){return n==null?Ee(this,Fe):new this.Collection(this,function(){return We(void 0,n,!1,!0)})},ge.prototype.belowOrEqual=function(n){return n==null?Ee(this,Fe):new this.Collection(this,function(){return We(void 0,n)})},ge.prototype.startsWith=function(n){return typeof n!="string"?Ee(this,Ms):this.between(n,n+at,!0,!0)},ge.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):Ar(this,function(s,c){return s.indexOf(c[0])===0},[n],at)},ge.prototype.equalsIgnoreCase=function(n){return Ar(this,function(s,c){return s===c[0]},[n],"")},ge.prototype.anyOfIgnoreCase=function(){var n=Ue.apply(bt,arguments);return n.length===0?xt(this):Ar(this,function(s,c){return c.indexOf(s)!==-1},n,"")},ge.prototype.startsWithAnyOfIgnoreCase=function(){var n=Ue.apply(bt,arguments);return n.length===0?xt(this):Ar(this,function(s,c){return c.some(function(l){return s.indexOf(l)===0})},n,at)},ge.prototype.anyOf=function(){var n=this,s=Ue.apply(bt,arguments),c=this._cmp;try{s.sort(c)}catch{return Ee(this,Fe)}if(s.length===0)return xt(this);var l=new this.Collection(this,function(){return We(s[0],s[s.length-1])});l._ondirectionchange=function(f){c=f==="next"?n._ascending:n._descending,s.sort(c)};var h=0;return l._addAlgorithm(function(f,m,v){for(var k=f.key;0<c(k,s[h]);)if(++h===s.length)return m(v),!1;return c(k,s[h])===0||(m(function(){f.continue(s[h])}),!1)}),l},ge.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ge.prototype.noneOf=function(){var n=Ue.apply(bt,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return Ee(this,Fe)}var s=n.reduce(function(c,l){return c?c.concat([[c[c.length-1][1],l]]):[[-1/0,l]]},null);return s.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},ge.prototype.inAnyRange=function(A,s){var c=this,l=this._cmp,h=this._ascending,f=this._descending,m=this._min,v=this._max;if(A.length===0)return xt(this);if(!A.every(function(C){return C[0]!==void 0&&C[1]!==void 0&&h(C[0],C[1])<=0}))return Ee(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",V.InvalidArgument);var k=!s||s.includeLowers!==!1,w=s&&s.includeUppers===!0,O,b=h;function x(C,R){return b(C[0],R[0])}try{(O=A.reduce(function(C,R){for(var j=0,D=C.length;j<D;++j){var q=C[j];if(l(R[0],q[1])<0&&0<l(R[1],q[0])){q[0]=m(q[0],R[0]),q[1]=v(q[1],R[1]);break}}return j===D&&C.push(R),C},[])).sort(x)}catch{return Ee(this,Fe)}var _=0,P=w?function(C){return 0<h(C,O[_][1])}:function(C){return 0<=h(C,O[_][1])},T=k?function(C){return 0<f(C,O[_][0])}:function(C){return 0<=f(C,O[_][0])},E=P,A=new this.Collection(this,function(){return We(O[0][0],O[O.length-1][1],!k,!w)});return A._ondirectionchange=function(C){b=C==="next"?(E=P,h):(E=T,f),O.sort(x)},A._addAlgorithm(function(C,R,j){for(var D,q=C.key;E(q);)if(++_===O.length)return R(j),!1;return!P(D=q)&&!T(D)||(c._cmp(q,O[_][1])===0||c._cmp(q,O[_][0])===0||R(function(){b===h?C.continue(O[_][0]):C.continue(O[_][1])}),!1)}),A},ge.prototype.startsWithAnyOf=function(){var n=Ue.apply(bt,arguments);return n.every(function(s){return typeof s=="string"})?n.length===0?xt(this):this.inAnyRange(n.map(function(s){return[s,s+at]})):Ee(this,"startsWithAnyOf() only works with strings")},ge);function ge(){}function Ie(n){return he(function(s){return Yt(s),n(s.target.error),!1})}function Yt(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Xt="storagemutated",Pn="x-storagemutated-1",Ge=Vt(null,Xt),Xo=(De.prototype._lock=function(){return le(!H.global),++this._reculock,this._reculock!==1||H.global||(H.lockOwnerFor=this),this},De.prototype._unlock=function(){if(le(!H.global),--this._reculock==0)for(H.global||(H.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{ot(n[1],n[0])}catch{}}return this},De.prototype._locked=function(){return this._reculock&&H.lockOwnerFor!==this},De.prototype.create=function(n){var s=this;if(!this.mode)return this;var c=this.db.idbdb,l=this.db._state.dbOpenError;if(le(!this.idbtrans),!n&&!c)switch(l&&l.name){case"DatabaseClosedError":throw new V.DatabaseClosed(l);case"MissingAPIError":throw new V.MissingAPI(l.message,l);default:throw new V.OpenFailed(l)}if(!this.active)throw new V.TransactionInactive;return le(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=he(function(h){Yt(h),s._reject(n.error)}),n.onabort=he(function(h){Yt(h),s.active&&s._reject(new V.Abort(n.error)),s.active=!1,s.on("abort").fire(h)}),n.oncomplete=he(function(){s.active=!1,s._resolve(),"mutatedParts"in n&&Ge.storagemutated.fire(n.mutatedParts)}),this},De.prototype._promise=function(n,s,c){var l=this;if(n==="readwrite"&&this.mode!=="readwrite")return pe(new V.ReadOnly("Transaction is readonly"));if(!this.active)return pe(new V.TransactionInactive);if(this._locked())return new J(function(f,m){l._blockedFuncs.push([function(){l._promise(n,s,c).then(f,m)},H])});if(c)return ze(function(){var f=new J(function(m,v){l._lock();var k=s(m,v,l);k&&k.then&&k.then(m,v)});return f.finally(function(){return l._unlock()}),f._lib=!0,f});var h=new J(function(f,m){var v=s(f,m,l);v&&v.then&&v.then(f,m)});return h._lib=!0,h},De.prototype._root=function(){return this.parent?this.parent._root():this},De.prototype.waitFor=function(n){var s,c=this._root(),l=J.resolve(n);c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return l}):(c._waitingFor=l,c._waitingQueue=[],s=c.idbtrans.objectStore(c.storeNames[0]),function f(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(s.get(-1/0).onsuccess=f)}());var h=c._waitingFor;return new J(function(f,m){l.then(function(v){return c._waitingQueue.push(he(f.bind(null,v)))},function(v){return c._waitingQueue.push(he(m.bind(null,v)))}).finally(function(){c._waitingFor===h&&(c._waitingFor=null)})})},De.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new V.Abort))},De.prototype.table=function(n){var s=this._memoizedTables||(this._memoizedTables={});if(S(s,n))return s[n];var c=this.schema[n];if(!c)throw new V.NotFound("Table "+n+" not part of transaction");return c=new this.db.Table(n,c,this),c.core=this.db.core.table(n),s[n]=c},De);function De(){}function On(n,s,c,l,h,f,m){return{name:n,keyPath:s,unique:c,multi:l,auto:h,compound:f,src:(c&&!m?"&":"")+(l?"*":"")+(h?"++":"")+Zs(s)}}function Zs(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function xn(n,s,c){return{name:n,primKey:s,indexes:c,mappedClass:null,idxByName:(l=function(h){return[h.name,h]},c.reduce(function(h,f,m){return m=l(f,m),m&&(h[m[0]]=m[1]),h},{}))};var l}var Qt=function(n){try{return n.only([[]]),Qt=function(){return[[]]},[[]]}catch{return Qt=function(){return at},at}};function Tn(n){return n==null?function(){}:typeof n=="string"?(s=n).split(".").length===1?function(c){return c[s]}:function(c){return Le(c,s)}:function(c){return Le(c,n)};var s}function ei(n){return[].slice.call(n)}var Qo=0;function Zt(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function Zo(n,s,k){function l(E){if(E.type===3)return null;if(E.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var _=E.lower,P=E.upper,T=E.lowerOpen,E=E.upperOpen;return _===void 0?P===void 0?null:s.upperBound(P,!!E):P===void 0?s.lowerBound(_,!!T):s.bound(_,P,!!T,!!E)}function h(x){var _,P=x.name;return{name:P,schema:x,mutate:function(T){var E=T.trans,A=T.type,C=T.keys,R=T.values,j=T.range;return new Promise(function(D,q){D=he(D);var L=E.objectStore(P),B=L.keyPath==null,M=A==="put"||A==="add";if(!M&&A!=="delete"&&A!=="deleteRange")throw new Error("Invalid operation type: "+A);var F,G=(C||R||{length:1}).length;if(C&&R&&C.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(G===0)return D({numFailures:0,failures:{},results:[],lastResult:void 0});function Y(ke){++Ae,Yt(ke)}var Z=[],X=[],Ae=0;if(A==="deleteRange"){if(j.type===4)return D({numFailures:Ae,failures:X,results:[],lastResult:void 0});j.type===3?Z.push(F=L.clear()):Z.push(F=L.delete(l(j)))}else{var B=M?B?[R,C]:[R,null]:[C,null],Q=B[0],be=B[1];if(M)for(var we=0;we<G;++we)Z.push(F=be&&be[we]!==void 0?L[A](Q[we],be[we]):L[A](Q[we])),F.onerror=Y;else for(we=0;we<G;++we)Z.push(F=L[A](Q[we])),F.onerror=Y}function Mr(ke){ke=ke.target.result,Z.forEach(function(ht,Vn){return ht.error!=null&&(X[Vn]=ht.error)}),D({numFailures:Ae,failures:X,results:A==="delete"?C:Z.map(function(ht){return ht.result}),lastResult:ke})}F.onerror=function(ke){Y(ke),Mr(ke)},F.onsuccess=Mr})},getMany:function(T){var E=T.trans,A=T.keys;return new Promise(function(C,R){C=he(C);for(var j,D=E.objectStore(P),q=A.length,L=new Array(q),B=0,M=0,F=function(Z){Z=Z.target,L[Z._pos]=Z.result,++M===B&&C(L)},G=Ie(R),Y=0;Y<q;++Y)A[Y]!=null&&((j=D.get(A[Y]))._pos=Y,j.onsuccess=F,j.onerror=G,++B);B===0&&C(L)})},get:function(T){var E=T.trans,A=T.key;return new Promise(function(C,R){C=he(C);var j=E.objectStore(P).get(A);j.onsuccess=function(D){return C(D.target.result)},j.onerror=Ie(R)})},query:(_=w,function(T){return new Promise(function(E,A){E=he(E);var C,R,j,B=T.trans,D=T.values,q=T.limit,F=T.query,L=q===1/0?void 0:q,M=F.index,F=F.range,B=B.objectStore(P),M=M.isPrimaryKey?B:B.index(M.name),F=l(F);if(q===0)return E({result:[]});_?((L=D?M.getAll(F,L):M.getAllKeys(F,L)).onsuccess=function(G){return E({result:G.target.result})},L.onerror=Ie(A)):(C=0,R=!D&&"openKeyCursor"in M?M.openKeyCursor(F):M.openCursor(F),j=[],R.onsuccess=function(G){var Y=R.result;return Y?(j.push(D?Y.value:Y.primaryKey),++C===q?E({result:j}):void Y.continue()):E({result:j})},R.onerror=Ie(A))})}),openCursor:function(T){var E=T.trans,A=T.values,C=T.query,R=T.reverse,j=T.unique;return new Promise(function(D,q){D=he(D);var M=C.index,L=C.range,B=E.objectStore(P),B=M.isPrimaryKey?B:B.index(M.name),M=R?j?"prevunique":"prev":j?"nextunique":"next",F=!A&&"openKeyCursor"in B?B.openKeyCursor(l(L),M):B.openCursor(l(L),M);F.onerror=Ie(q),F.onsuccess=he(function(G){var Y,Z,X,Ae,Q=F.result;Q?(Q.___id=++Qo,Q.done=!1,Y=Q.continue.bind(Q),Z=(Z=Q.continuePrimaryKey)&&Z.bind(Q),X=Q.advance.bind(Q),Ae=function(){throw new Error("Cursor not stopped")},Q.trans=E,Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=function(){throw new Error("Cursor not started")},Q.fail=he(q),Q.next=function(){var be=this,we=1;return this.start(function(){return we--?be.continue():be.stop()}).then(function(){return be})},Q.start=function(be){function we(){if(F.result)try{be()}catch(ke){Q.fail(ke)}else Q.done=!0,Q.start=function(){throw new Error("Cursor behind last entry")},Q.stop()}var Mr=new Promise(function(ke,ht){ke=he(ke),F.onerror=Ie(ht),Q.fail=ht,Q.stop=function(Vn){Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=Ae,ke(Vn)}});return F.onsuccess=he(function(ke){F.onsuccess=we,we()}),Q.continue=Y,Q.continuePrimaryKey=Z,Q.advance=X,we(),Mr},D(Q)):D(null)},q)})},count:function(T){var E=T.query,A=T.trans,C=E.index,R=E.range;return new Promise(function(j,D){var q=A.objectStore(P),L=C.isPrimaryKey?q:q.index(C.name),q=l(R),L=q?L.count(q):L.count();L.onsuccess=he(function(B){return j(B.target.result)}),L.onerror=Ie(D)})}}}var f,m,v,O=(m=k,v=ei((f=n).objectStoreNames),{schema:{name:f.name,tables:v.map(function(x){return m.objectStore(x)}).map(function(x){var _=x.keyPath,E=x.autoIncrement,P=d(_),T={},E={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:_==null,compound:P,keyPath:_,autoIncrement:E,unique:!0,extractKey:Tn(_)},indexes:ei(x.indexNames).map(function(A){return x.index(A)}).map(function(j){var C=j.name,R=j.unique,D=j.multiEntry,j=j.keyPath,D={name:C,compound:d(j),keyPath:j,unique:R,multiEntry:D,extractKey:Tn(j)};return T[Zt(j)]=D}),getIndexByKeyPath:function(A){return T[Zt(A)]}};return T[":id"]=E.primaryKey,_!=null&&(T[Zt(_)]=E.primaryKey),E})},hasGetAll:0<v.length&&"getAll"in m.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),k=O.schema,w=O.hasGetAll,O=k.tables.map(h),b={};return O.forEach(function(x){return b[x.name]=x}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(x){if(!b[x])throw new Error("Table '".concat(x,"' not found"));return b[x]},MIN_KEY:-1/0,MAX_KEY:Qt(s),schema:k}}function ea(n,s,c,l){var h=c.IDBKeyRange;return c.indexedDB,{dbcore:(l=Zo(s,h,l),n.dbcore.reduce(function(f,m){return m=m.create,r(r({},f),m(f))},l))}}function Cr(n,l){var c=l.db,l=ea(n._middlewares,c,n._deps,l);n.core=l.dbcore,n.tables.forEach(function(h){var f=h.name;n.core.schema.tables.some(function(m){return m.name===f})&&(h.core=n.core.table(f),n[f]instanceof n.Table&&(n[f].core=h.core))})}function Rr(n,s,c,l){c.forEach(function(h){var f=l[h];s.forEach(function(m){var v=function k(w,O){return W(w,O)||(w=y(w))&&k(w,O)}(m,h);(!v||"value"in v&&v.value===void 0)&&(m===n.Transaction.prototype||m instanceof n.Transaction?N(m,h,{get:function(){return this.table(h)},set:function(k){K(this,h,{value:k,writable:!0,configurable:!0,enumerable:!0})}}):m[h]=new n.Table(h,f))})})}function An(n,s){s.forEach(function(c){for(var l in c)c[l]instanceof n.Table&&delete c[l]})}function ta(n,s){return n._cfg.version-s._cfg.version}function ra(n,s,c,l){var h=n._dbSchema;c.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=xn("$meta",ri("")[0],[]),n._storeNames.push("$meta"));var f=n._createTransaction("readwrite",n._storeNames,h);f.create(c),f._completion.catch(l);var m=f._reject.bind(f),v=H.transless||H;ze(function(){return H.trans=f,H.transless=v,s!==0?(Cr(n,c),w=s,((k=f).storeNames.includes("$meta")?k.table("$meta").get("version").then(function(O){return O??w}):J.resolve(w)).then(function(O){return x=O,_=f,P=c,T=[],O=(b=n)._versions,E=b._dbSchema=Ir(0,b.idbdb,P),(O=O.filter(function(A){return A._cfg.version>=x})).length!==0?(O.forEach(function(A){T.push(function(){var C=E,R=A._cfg.dbschema;Dr(b,C,P),Dr(b,R,P),E=b._dbSchema=R;var j=Cn(C,R);j.add.forEach(function(M){Rn(P,M[0],M[1].primKey,M[1].indexes)}),j.change.forEach(function(M){if(M.recreate)throw new V.Upgrade("Not yet support for changing primary key");var F=P.objectStore(M.name);M.add.forEach(function(G){return jr(F,G)}),M.change.forEach(function(G){F.deleteIndex(G.name),jr(F,G)}),M.del.forEach(function(G){return F.deleteIndex(G)})});var D=A._cfg.contentUpgrade;if(D&&A._cfg.version>x){Cr(b,P),_._memoizedTables={};var q=Rs(R);j.del.forEach(function(M){q[M]=C[M]}),An(b,[b.Transaction.prototype]),Rr(b,[b.Transaction.prototype],u(q),q),_.schema=q;var L,B=un(D);return B&&Et(),j=J.follow(function(){var M;(L=D(_))&&B&&(M=He.bind(null,null),L.then(M,M))}),L&&typeof L.then=="function"?J.resolve(L):j.then(function(){return L})}}),T.push(function(C){var R,j,D=A._cfg.dbschema;R=D,j=C,[].slice.call(j.db.objectStoreNames).forEach(function(q){return R[q]==null&&j.db.deleteObjectStore(q)}),An(b,[b.Transaction.prototype]),Rr(b,[b.Transaction.prototype],b._storeNames,b._dbSchema),_.schema=b._dbSchema}),T.push(function(C){b.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(b.idbdb.version/10)===A._cfg.version?(b.idbdb.deleteObjectStore("$meta"),delete b._dbSchema.$meta,b._storeNames=b._storeNames.filter(function(R){return R!=="$meta"})):C.objectStore("$meta").put(A._cfg.version,"version"))})}),function A(){return T.length?J.resolve(T.shift()(_.idbtrans)).then(A):J.resolve()}().then(function(){ti(E,P)})):J.resolve();var b,x,_,P,T,E}).catch(m)):(u(h).forEach(function(O){Rn(c,O,h[O].primKey,h[O].indexes)}),Cr(n,c),void J.follow(function(){return n.on.populate.fire(f)}).catch(m));var k,w})}function na(n,s){ti(n._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var c=Ir(0,n.idbdb,s);Dr(n,n._dbSchema,s);for(var l=0,h=Cn(c,n._dbSchema).change;l<h.length;l++){var f=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=s.objectStore(m.name);m.add.forEach(function(k){je&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(k.src)),jr(v,k)})}(h[l]);if(typeof f=="object")return f.value}}function Cn(n,s){var c,l={del:[],add:[],change:[]};for(c in n)s[c]||l.del.push(c);for(c in s){var h=n[c],f=s[c];if(h){var m={name:c,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(f.primKey.keyPath||"")||h.primKey.auto!==f.primKey.auto)m.recreate=!0,l.change.push(m);else{var v=h.idxByName,k=f.idxByName,w=void 0;for(w in v)k[w]||m.del.push(w);for(w in k){var O=v[w],b=k[w];O?O.src!==b.src&&m.change.push(b):m.add.push(b)}(0<m.del.length||0<m.add.length||0<m.change.length)&&l.change.push(m)}}else l.add.push([c,f])}return l}function Rn(n,s,c,l){var h=n.db.createObjectStore(s,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});return l.forEach(function(f){return jr(h,f)}),h}function ti(n,s){u(n).forEach(function(c){s.db.objectStoreNames.contains(c)||(je&&console.debug("Dexie: Creating missing table",c),Rn(s,c,n[c].primKey,n[c].indexes))})}function jr(n,s){n.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function Ir(n,s,c){var l={};return de(s.objectStoreNames,0).forEach(function(h){for(var f=c.objectStore(h),m=On(Zs(w=f.keyPath),w||"",!0,!1,!!f.autoIncrement,w&&typeof w!="string",!0),v=[],k=0;k<f.indexNames.length;++k){var O=f.index(f.indexNames[k]),w=O.keyPath,O=On(O.name,w,!!O.unique,!!O.multiEntry,!1,w&&typeof w!="string",!1);v.push(O)}l[h]=xn(h,m,v)}),l}function Dr(n,s,c){for(var l=c.db.objectStoreNames,h=0;h<l.length;++h){var f=l[h],m=c.objectStore(f);n._hasGetAll="getAll"in m;for(var v=0;v<m.indexNames.length;++v){var k=m.indexNames[v],w=m.index(k).keyPath,O=typeof w=="string"?w:"["+de(w).join("+")+"]";!s[f]||(w=s[f].idxByName[O])&&(w.name=k,delete s[f].idxByName[O],s[f].idxByName[k]=w)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function ri(n){return n.split(",").map(function(s,c){var l=(s=s.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return On(l,h||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),d(h),c===0)})}var sa=($r.prototype._parseStoresSpec=function(n,s){u(n).forEach(function(c){if(n[c]!==null){var l=ri(n[c]),h=l.shift();if(h.unique=!0,h.multi)throw new V.Schema("Primary key cannot be multi-valued");l.forEach(function(f){if(f.auto)throw new V.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new V.Schema("Index must have a name and cannot be an empty string")}),s[c]=xn(c,h,l)}})},$r.prototype.stores=function(c){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,c):c;var c=s._versions,l={},h={};return c.forEach(function(f){p(l,f._cfg.storesSource),h=f._cfg.dbschema={},f._parseStoresSpec(l,h)}),s._dbSchema=h,An(s,[s._allTables,s,s.Transaction.prototype]),Rr(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],u(h),h),s._storeNames=u(h),this},$r.prototype.upgrade=function(n){return this._cfg.contentUpgrade=hn(this._cfg.contentUpgrade||ae,n),this},$r);function $r(){}function jn(n,s){var c=n._dbNamesDB;return c||(c=n._dbNamesDB=new qe(Pr,{addons:[],indexedDB:n,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function In(n){return n&&typeof n.databases=="function"}function Dn(n){return ze(function(){return H.letThrough=!0,n()})}function $n(n){return!("from"in n)}var ve=function(n,s){if(!this){var c=new ve;return n&&"d"in n&&p(c,n),c}p(this,arguments.length?{d:1,from:n,to:1<arguments.length?s:n}:{d:0})};function er(n,s,c){var l=ie(s,c);if(!isNaN(l)){if(0<l)throw RangeError();if($n(n))return p(n,{from:s,to:c,d:1});var h=n.l,l=n.r;if(ie(c,n.from)<0)return h?er(h,s,c):n.l={from:s,to:c,d:1,l:null,r:null},ni(n);if(0<ie(s,n.to))return l?er(l,s,c):n.r={from:s,to:c,d:1,l:null,r:null},ni(n);ie(s,n.from)<0&&(n.from=s,n.l=null,n.d=l?l.d+1:1),0<ie(c,n.to)&&(n.to=c,n.r=null,n.d=n.l?n.l.d+1:1),c=!n.r,h&&!n.l&&tr(n,h),l&&c&&tr(n,l)}}function tr(n,s){$n(s)||function c(l,k){var f=k.from,m=k.to,v=k.l,k=k.r;er(l,f,m),v&&c(l,v),k&&c(l,k)}(n,s)}function Nr(n,s){var c=Nn(s),l=c.next();if(l.done)return!1;for(var h=l.value,f=Nn(n),m=f.next(h.from),v=m.value;!l.done&&!m.done;){if(ie(v.from,h.to)<=0&&0<=ie(v.to,h.from))return!0;ie(h.from,v.from)<0?h=(l=c.next(v.from)).value:v=(m=f.next(h.from)).value}return!1}function Nn(n){var s=$n(n)?null:{s:0,n};return{next:function(c){for(var l=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,l)for(;s.n.l&&ie(c,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!l||ie(c,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function ni(n){var s,c,l=(((s=n.r)===null||s===void 0?void 0:s.d)||0)-(((c=n.l)===null||c===void 0?void 0:c.d)||0),h=1<l?"r":l<-1?"l":"";h&&(s=h=="r"?"l":"r",c=r({},n),l=n[h],n.from=l.from,n.to=l.to,n[h]=l[h],c[h]=l[s],(n[s]=c).d=si(c)),n.d=si(n)}function si(c){var s=c.r,c=c.l;return(s?c?Math.max(s.d,c.d):s.d:c?c.d:0)+1}function Lr(n,s){return u(s).forEach(function(c){n[c]?tr(n[c],s[c]):n[c]=function l(h){var f,m,v={};for(f in h)S(h,f)&&(m=h[f],v[f]=!m||typeof m!="object"||Is.has(m.constructor)?m:l(m));return v}(s[c])}),n}function Ln(n,s){return n.all||s.all||Object.keys(n).some(function(c){return s[c]&&Nr(s[c],n[c])})}$(ve.prototype,((Oe={add:function(n){return tr(this,n),this},addKey:function(n){return er(this,n,n),this},addKeys:function(n){var s=this;return n.forEach(function(c){return er(s,c,c)}),this}})[cn]=function(){return Nn(this)},Oe));var ut={},Un={},Fn=!1;function Ur(n){Lr(Un,n),Fn||(Fn=!0,setTimeout(function(){Fn=!1,Bn(Un,!(Un={}))},0))}function Bn(n,s){s===void 0&&(s=!1);var c=new Set;if(n.all)for(var l=0,h=Object.values(ut);l<h.length;l++)ii(m=h[l],n,c,s);else for(var f in n){var m,v=/^idb\:\/\/(.*)\/(.*)\//.exec(f);v&&(f=v[1],v=v[2],(m=ut["idb://".concat(f,"/").concat(v)])&&ii(m,n,c,s))}c.forEach(function(k){return k()})}function ii(n,s,c,l){for(var h=[],f=0,m=Object.entries(n.queries.query);f<m.length;f++){for(var v=m[f],k=v[0],w=[],O=0,b=v[1];O<b.length;O++){var x=b[O];Ln(s,x.obsSet)?x.subscribers.forEach(function(E){return c.add(E)}):l&&w.push(x)}l&&h.push([k,w])}if(l)for(var _=0,P=h;_<P.length;_++){var T=P[_],k=T[0],w=T[1];n.queries.query[k]=w}}function ia(n){var s=n._state,c=n._deps.indexedDB;if(s.isBeingOpened||n.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?pe(s.dbOpenError):n});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var l=s.openCanceller,h=Math.round(10*n.verno),f=!1;function m(){if(s.openCanceller!==l)throw new V.DatabaseClosed("db.open() was cancelled")}function v(){return new J(function(x,_){if(m(),!c)throw new V.MissingAPI;var P=n.name,T=s.autoSchema||!h?c.open(P):c.open(P,h);if(!T)throw new V.MissingAPI;T.onerror=Ie(_),T.onblocked=he(n._fireOnBlocked),T.onupgradeneeded=he(function(E){var A;O=T.transaction,s.autoSchema&&!n._options.allowEmptyDB?(T.onerror=Yt,O.abort(),T.result.close(),(A=c.deleteDatabase(P)).onsuccess=A.onerror=he(function(){_(new V.NoSuchDatabase("Database ".concat(P," doesnt exist")))})):(O.onerror=Ie(_),E=E.oldVersion>Math.pow(2,62)?0:E.oldVersion,b=E<1,n.idbdb=T.result,f&&na(n,O),ra(n,E/10,O,_))},_),T.onsuccess=he(function(){O=null;var E,A,C,R,j,D=n.idbdb=T.result,q=de(D.objectStoreNames);if(0<q.length)try{var L=D.transaction((R=q).length===1?R[0]:R,"readonly");if(s.autoSchema)A=D,C=L,(E=n).verno=A.version/10,C=E._dbSchema=Ir(0,A,C),E._storeNames=de(A.objectStoreNames,0),Rr(E,[E._allTables],u(C),C);else if(Dr(n,n._dbSchema,L),((j=Cn(Ir(0,(j=n).idbdb,L),j._dbSchema)).add.length||j.change.some(function(B){return B.add.length||B.change.length}))&&!f)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),D.close(),h=D.version+1,f=!0,x(v());Cr(n,L)}catch{}Pt.push(n),D.onversionchange=he(function(B){s.vcFired=!0,n.on("versionchange").fire(B)}),D.onclose=he(function(B){n.on("close").fire(B)}),b&&(j=n._deps,L=P,D=j.indexedDB,j=j.IDBKeyRange,In(D)||L===Pr||jn(D,j).put({name:L}).catch(ae)),x()},_)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<h)return h=0,v()}return J.reject(x)})}var k,w=s.dbReadyResolve,O=null,b=!1;return J.race([l,(typeof navigator>"u"?J.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function _(){return indexedDB.databases().finally(x)}k=setInterval(_,100),_()}).finally(function(){return clearInterval(k)}):Promise.resolve()).then(v)]).then(function(){return m(),s.onReadyBeingFired=[],J.resolve(Dn(function(){return n.on.ready.fire(n.vip)})).then(function x(){if(0<s.onReadyBeingFired.length){var _=s.onReadyBeingFired.reduce(hn,ae);return s.onReadyBeingFired=[],J.resolve(Dn(function(){return _(n.vip)})).then(x)}})}).finally(function(){s.openCanceller===l&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(x){s.dbOpenError=x;try{O&&O.abort()}catch{}return l===s.openCanceller&&n._close(),pe(x)}).finally(function(){s.openComplete=!0,w()}).then(function(){var x;return b&&(x={},n.tables.forEach(function(_){_.schema.indexes.forEach(function(P){P.name&&(x["idb://".concat(n.name,"/").concat(_.name,"/").concat(P.name)]=new ve(-1/0,[[[]]]))}),x["idb://".concat(n.name,"/").concat(_.name,"/")]=x["idb://".concat(n.name,"/").concat(_.name,"/:dels")]=new ve(-1/0,[[[]]])}),Ge(Xt).fire(x),Bn(x,!0)),n})}function qn(n){function s(f){return n.next(f)}var c=h(s),l=h(function(f){return n.throw(f)});function h(f){return function(k){var v=f(k),k=v.value;return v.done?k:k&&typeof k.then=="function"?k.then(c,l):d(k)?Promise.all(k).then(c,l):c(k)}}return h(s)()}function Fr(n,s,c){for(var l=d(n)?n.slice():[n],h=0;h<c;++h)l.push(s);return l}var oa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return r(r({},n),{table:function(s){var c=n.table(s),l=c.schema,h={},f=[];function m(b,x,_){var P=Zt(b),T=h[P]=h[P]||[],E=b==null?0:typeof b=="string"?1:b.length,A=0<x,A=r(r({},_),{name:A?"".concat(P,"(virtual-from:").concat(_.name,")"):_.name,lowLevelIndex:_,isVirtual:A,keyTail:x,keyLength:E,extractKey:Tn(b),unique:!A&&_.unique});return T.push(A),A.isPrimaryKey||f.push(A),1<E&&m(E===2?b[0]:b.slice(0,E-1),x+1,_),T.sort(function(C,R){return C.keyTail-R.keyTail}),A}s=m(l.primaryKey.keyPath,0,l.primaryKey),h[":id"]=[s];for(var v=0,k=l.indexes;v<k.length;v++){var w=k[v];m(w.keyPath,0,w)}function O(b){var x,_=b.query.index;return _.isVirtual?r(r({},b),{query:{index:_.lowLevelIndex,range:(x=b.query.range,_=_.keyTail,{type:x.type===1?2:x.type,lower:Fr(x.lower,x.lowerOpen?n.MAX_KEY:n.MIN_KEY,_),lowerOpen:!0,upper:Fr(x.upper,x.upperOpen?n.MIN_KEY:n.MAX_KEY,_),upperOpen:!0})}}):b}return r(r({},c),{schema:r(r({},l),{primaryKey:s,indexes:f,getIndexByKeyPath:function(b){return(b=h[Zt(b)])&&b[0]}}),count:function(b){return c.count(O(b))},query:function(b){return c.query(O(b))},openCursor:function(b){var x=b.query.index,_=x.keyTail,P=x.isVirtual,T=x.keyLength;return P?c.openCursor(O(b)).then(function(A){return A&&E(A)}):c.openCursor(b);function E(A){return Object.create(A,{continue:{value:function(C){C!=null?A.continue(Fr(C,b.reverse?n.MAX_KEY:n.MIN_KEY,_)):b.unique?A.continue(A.key.slice(0,T).concat(b.reverse?n.MIN_KEY:n.MAX_KEY,_)):A.continue()}},continuePrimaryKey:{value:function(C,R){A.continuePrimaryKey(Fr(C,n.MAX_KEY,_),R)}},primaryKey:{get:function(){return A.primaryKey}},key:{get:function(){var C=A.key;return T===1?C[0]:C.slice(0,T)}},value:{get:function(){return A.value}}})}}})}})}};function Mn(n,s,c,l){return c=c||{},l=l||"",u(n).forEach(function(h){var f,m,v;S(s,h)?(f=n[h],m=s[h],typeof f=="object"&&typeof m=="object"&&f&&m?(v=an(f))!==an(m)?c[l+h]=s[h]:v==="Object"?Mn(f,m,c,l+h+"."):f!==m&&(c[l+h]=s[h]):f!==m&&(c[l+h]=s[h])):c[l+h]=void 0}),u(s).forEach(function(h){S(n,h)||(c[l+h]=s[h])}),c}function Kn(n,s){return s.type==="delete"?s.keys:s.keys||s.values.map(n.extractKey)}var aa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return r(r({},n),{table:function(s){var c=n.table(s),l=c.schema.primaryKey;return r(r({},c),{mutate:function(h){var f=H.trans,m=f.table(s).hook,v=m.deleting,k=m.creating,w=m.updating;switch(h.type){case"add":if(k.fire===ae)break;return f._promise("readwrite",function(){return O(h)},!0);case"put":if(k.fire===ae&&w.fire===ae)break;return f._promise("readwrite",function(){return O(h)},!0);case"delete":if(v.fire===ae)break;return f._promise("readwrite",function(){return O(h)},!0);case"deleteRange":if(v.fire===ae)break;return f._promise("readwrite",function(){return function b(x,_,P){return c.query({trans:x,values:!1,query:{index:l,range:_},limit:P}).then(function(T){var E=T.result;return O({type:"delete",keys:E,trans:x}).then(function(A){return 0<A.numFailures?Promise.reject(A.failures[0]):E.length<P?{failures:[],numFailures:0,lastResult:void 0}:b(x,r(r({},_),{lower:E[E.length-1],lowerOpen:!0}),P)})})}(h.trans,h.range,1e4)},!0)}return c.mutate(h);function O(b){var x,_,P,T=H.trans,E=b.keys||Kn(l,b);if(!E)throw new Error("Keys missing");return(b=b.type==="add"||b.type==="put"?r(r({},b),{keys:E}):r({},b)).type!=="delete"&&(b.values=a([],b.values,!0)),b.keys&&(b.keys=a([],b.keys,!0)),x=c,P=E,((_=b).type==="add"?Promise.resolve([]):x.getMany({trans:_.trans,keys:P,cache:"immutable"})).then(function(A){var C=E.map(function(R,j){var D,q,L,B=A[j],M={onerror:null,onsuccess:null};return b.type==="delete"?v.fire.call(M,R,B,T):b.type==="add"||B===void 0?(D=k.fire.call(M,R,b.values[j],T),R==null&&D!=null&&(b.keys[j]=R=D,l.outbound||Se(b.values[j],l.keyPath,R))):(D=Mn(B,b.values[j]),(q=w.fire.call(M,D,R,B,T))&&(L=b.values[j],Object.keys(q).forEach(function(F){S(L,F)?L[F]=q[F]:Se(L,F,q[F])}))),M});return c.mutate(b).then(function(R){for(var j=R.failures,D=R.results,q=R.numFailures,R=R.lastResult,L=0;L<E.length;++L){var B=(D||E)[L],M=C[L];B==null?M.onerror&&M.onerror(j[L]):M.onsuccess&&M.onsuccess(b.type==="put"&&A[L]?b.values[L]:B)}return{failures:j,results:D,numFailures:q,lastResult:R}}).catch(function(R){return C.forEach(function(j){return j.onerror&&j.onerror(R)}),Promise.reject(R)})})}}})}})}};function oi(n,s,c){try{if(!s||s.keys.length<n.length)return null;for(var l=[],h=0,f=0;h<s.keys.length&&f<n.length;++h)ie(s.keys[h],n[f])===0&&(l.push(c?Ke(s.values[h]):s.values[h]),++f);return l.length===n.length?l:null}catch{return null}}var ca={stack:"dbcore",level:-1,create:function(n){return{table:function(s){var c=n.table(s);return r(r({},c),{getMany:function(l){if(!l.cache)return c.getMany(l);var h=oi(l.keys,l.trans._cache,l.cache==="clone");return h?J.resolve(h):c.getMany(l).then(function(f){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?Ke(f):f},f})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),c.mutate(l)}})}}}};function ai(n,s){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function ci(n,s){switch(n){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ua={stack:"dbcore",level:0,name:"Observability",create:function(n){var s=n.schema.name,c=new ve(n.MIN_KEY,n.MAX_KEY);return r(r({},n),{transaction:function(l,h,f){if(H.subscr&&h!=="readonly")throw new V.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(H.querier));return n.transaction(l,h,f)},table:function(l){var h=n.table(l),f=h.schema,m=f.primaryKey,b=f.indexes,v=m.extractKey,k=m.outbound,w=m.autoIncrement&&b.filter(function(_){return _.compound&&_.keyPath.includes(m.keyPath)}),O=r(r({},h),{mutate:function(_){function P(F){return F="idb://".concat(s,"/").concat(l,"/").concat(F),R[F]||(R[F]=new ve)}var T,E,A,C=_.trans,R=_.mutatedParts||(_.mutatedParts={}),j=P(""),D=P(":dels"),q=_.type,M=_.type==="deleteRange"?[_.range]:_.type==="delete"?[_.keys]:_.values.length<50?[Kn(m,_).filter(function(F){return F}),_.values]:[],L=M[0],B=M[1],M=_.trans._cache;return d(L)?(j.addKeys(L),(M=q==="delete"||L.length===B.length?oi(L,M):null)||D.addKeys(L),(M||B)&&(T=P,E=M,A=B,f.indexes.forEach(function(F){var G=T(F.name||"");function Y(X){return X!=null?F.extractKey(X):null}function Z(X){return F.multiEntry&&d(X)?X.forEach(function(Ae){return G.addKey(Ae)}):G.addKey(X)}(E||A).forEach(function(X,be){var Q=E&&Y(E[be]),be=A&&Y(A[be]);ie(Q,be)!==0&&(Q!=null&&Z(Q),be!=null&&Z(be))})}))):L?(B={from:L.lower,to:L.upper},D.add(B),j.add(B)):(j.add(c),D.add(c),f.indexes.forEach(function(F){return P(F.name).add(c)})),h.mutate(_).then(function(F){return!L||_.type!=="add"&&_.type!=="put"||(j.addKeys(F.results),w&&w.forEach(function(G){var Y=_.values.map(function(X){return G.extractKey(X)}),Z=G.keyPath.findIndex(function(X){return X===m.keyPath});F.results.forEach(function(X){return Y[Z]=X}),P(G.name).addKeys(Y)})),C.mutatedParts=Lr(C.mutatedParts||{},R),F})}}),b=function(P){var T=P.query,P=T.index,T=T.range;return[P,new ve((P=T.lower)!==null&&P!==void 0?P:n.MIN_KEY,(T=T.upper)!==null&&T!==void 0?T:n.MAX_KEY)]},x={get:function(_){return[m,new ve(_.key)]},getMany:function(_){return[m,new ve().addKeys(_.keys)]},count:b,query:b,openCursor:b};return u(x).forEach(function(_){O[_]=function(P){var T=H.subscr,E=!!T,A=ai(H,h)&&ci(_,P)?P.obsSet={}:T;if(E){var C=function(B){return B="idb://".concat(s,"/").concat(l,"/").concat(B),A[B]||(A[B]=new ve)},R=C(""),j=C(":dels"),T=x[_](P),E=T[0],T=T[1];if((_==="query"&&E.isPrimaryKey&&!P.values?j:C(E.name||"")).add(T),!E.isPrimaryKey){if(_!=="count"){var D=_==="query"&&k&&P.values&&h.query(r(r({},P),{values:!1}));return h[_].apply(this,arguments).then(function(B){if(_==="query"){if(k&&P.values)return D.then(function(Y){return Y=Y.result,R.addKeys(Y),B});var M=P.values?B.result.map(v):B.result;(P.values?R:j).addKeys(M)}else if(_==="openCursor"){var F=B,G=P.values;return F&&Object.create(F,{key:{get:function(){return j.addKey(F.primaryKey),F.key}},primaryKey:{get:function(){var Y=F.primaryKey;return j.addKey(Y),Y}},value:{get:function(){return G&&R.addKey(F.primaryKey),F.value}}})}return B})}j.add(c)}}return h[_].apply(this,arguments)}}),O}})}};function ui(n,s,c){if(c.numFailures===0)return s;if(s.type==="deleteRange")return null;var l=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1;return c.numFailures===l?null:(s=r({},s),d(s.keys)&&(s.keys=s.keys.filter(function(h,f){return!(f in c.failures)})),"values"in s&&d(s.values)&&(s.values=s.values.filter(function(h,f){return!(f in c.failures)})),s)}function Jn(n,s){return c=n,((l=s).lower===void 0||(l.lowerOpen?0<ie(c,l.lower):0<=ie(c,l.lower)))&&(n=n,(s=s).upper===void 0||(s.upperOpen?ie(n,s.upper)<0:ie(n,s.upper)<=0));var c,l}function li(n,s,x,l,h,f){if(!x||x.length===0)return n;var m=s.query.index,v=m.multiEntry,k=s.query.range,w=l.schema.primaryKey.extractKey,O=m.extractKey,b=(m.lowLevelIndex||m).extractKey,x=x.reduce(function(_,P){var T=_,E=P.type==="add"||P.type==="put"?P.values.filter(function(j){return j=O(j),v&&d(j)?j.some(function(D){return Jn(D,k)}):Jn(j,k)}).map(function(j){return j=Ke(j),f&&Object.freeze(j),j}):[];switch(P.type){case"add":T=_.concat(s.values?E:E.map(function(D){return w(D)}));break;case"put":var A=new ve().addKeys(P.values.map(function(D){return w(D)})),T=_.filter(function(D){return D=s.values?w(D):D,!Nr(new ve(D),A)}).concat(s.values?E:E.map(function(D){return w(D)}));break;case"delete":var C=new ve().addKeys(P.keys);T=_.filter(function(D){return D=s.values?w(D):D,!Nr(new ve(D),C)});break;case"deleteRange":var R=P.range;T=_.filter(function(D){return!Jn(w(D),R)})}return T},n);return x===n?n:(x.sort(function(_,P){return ie(b(_),b(P))||ie(w(_),w(P))}),s.limit&&s.limit<1/0&&(x.length>s.limit?x.length=s.limit:n.length===s.limit&&x.length<s.limit&&(h.dirty=!0)),f?Object.freeze(x):x)}function hi(n,s){return ie(n.lower,s.lower)===0&&ie(n.upper,s.upper)===0&&!!n.lowerOpen==!!s.lowerOpen&&!!n.upperOpen==!!s.upperOpen}function la(n,s){return function(c,l,h,f){if(c===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=ie(c,l))===0){if(h&&f)return 0;if(h)return 1;if(f)return-1}return l}(n.lower,s.lower,n.lowerOpen,s.lowerOpen)<=0&&0<=function(c,l,h,f){if(c===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=ie(c,l))===0){if(h&&f)return 0;if(h)return-1;if(f)return 1}return l}(n.upper,s.upper,n.upperOpen,s.upperOpen)}function ha(n,s,c,l){n.subscribers.add(c),l.addEventListener("abort",function(){var h,f;n.subscribers.delete(c),n.subscribers.size===0&&(h=n,f=s,setTimeout(function(){h.subscribers.size===0&&rt(f,h)},3e3))})}var da={stack:"dbcore",level:0,name:"Cache",create:function(n){var s=n.schema.name;return r(r({},n),{transaction:function(c,l,h){var f,m,v=n.transaction(c,l,h);return l==="readwrite"&&(m=(f=new AbortController).signal,h=function(k){return function(){if(f.abort(),l==="readwrite"){for(var w=new Set,O=0,b=c;O<b.length;O++){var x=b[O],_=ut["idb://".concat(s,"/").concat(x)];if(_){var P=n.table(x),T=_.optimisticOps.filter(function(G){return G.trans===v});if(v._explicit&&k&&v.mutatedParts)for(var E=0,A=Object.values(_.queries.query);E<A.length;E++)for(var C=0,R=(q=A[E]).slice();C<R.length;C++)Ln((L=R[C]).obsSet,v.mutatedParts)&&(rt(q,L),L.subscribers.forEach(function(G){return w.add(G)}));else if(0<T.length){_.optimisticOps=_.optimisticOps.filter(function(G){return G.trans!==v});for(var j=0,D=Object.values(_.queries.query);j<D.length;j++)for(var q,L,B,M=0,F=(q=D[j]).slice();M<F.length;M++)(L=F[M]).res!=null&&v.mutatedParts&&(k&&!L.dirty?(B=Object.isFrozen(L.res),B=li(L.res,L.req,T,P,L,B),L.dirty?(rt(q,L),L.subscribers.forEach(function(G){return w.add(G)})):B!==L.res&&(L.res=B,L.promise=J.resolve({result:B}))):(L.dirty&&rt(q,L),L.subscribers.forEach(function(G){return w.add(G)})))}}}w.forEach(function(G){return G()})}}},v.addEventListener("abort",h(!1),{signal:m}),v.addEventListener("error",h(!1),{signal:m}),v.addEventListener("complete",h(!0),{signal:m})),v},table:function(c){var l=n.table(c),h=l.schema.primaryKey;return r(r({},l),{mutate:function(f){var m=H.trans;if(h.outbound||m.db._options.cache==="disabled"||m.explicit)return l.mutate(f);var v=ut["idb://".concat(s,"/").concat(c)];return v?(m=l.mutate(f),f.type!=="add"&&f.type!=="put"||!(50<=f.values.length||Kn(h,f).some(function(k){return k==null}))?(v.optimisticOps.push(f),f.mutatedParts&&Ur(f.mutatedParts),m.then(function(k){0<k.numFailures&&(rt(v.optimisticOps,f),(k=ui(0,f,k))&&v.optimisticOps.push(k),f.mutatedParts&&Ur(f.mutatedParts))}),m.catch(function(){rt(v.optimisticOps,f),f.mutatedParts&&Ur(f.mutatedParts)})):m.then(function(k){var w=ui(0,r(r({},f),{values:f.values.map(function(_,b){var x,_=(x=h.keyPath)!==null&&x!==void 0&&x.includes(".")?Ke(_):r({},_);return Se(_,h.keyPath,k.results[b]),_})}),k);v.optimisticOps.push(w),queueMicrotask(function(){return f.mutatedParts&&Ur(f.mutatedParts)})}),m):l.mutate(f)},query:function(f){if(!ai(H,l)||!ci("query",f))return l.query(f);var m=((w=H.trans)===null||w===void 0?void 0:w.db._options.cache)==="immutable",b=H,v=b.requery,k=b.signal,w=function(P,T,E,A){var C=ut["idb://".concat(P,"/").concat(T)];if(!C)return[];if(!(T=C.queries[E]))return[null,!1,C,null];var R=T[(A.query?A.query.index.name:null)||""];if(!R)return[null,!1,C,null];switch(E){case"query":var j=R.find(function(D){return D.req.limit===A.limit&&D.req.values===A.values&&hi(D.req.query.range,A.query.range)});return j?[j,!0,C,R]:[R.find(function(D){return("limit"in D.req?D.req.limit:1/0)>=A.limit&&(!A.values||D.req.values)&&la(D.req.query.range,A.query.range)}),!1,C,R];case"count":return j=R.find(function(D){return hi(D.req.query.range,A.query.range)}),[j,!!j,C,R]}}(s,c,"query",f),O=w[0],b=w[1],x=w[2],_=w[3];return O&&b?O.obsSet=f.obsSet:(b=l.query(f).then(function(P){var T=P.result;if(O&&(O.res=T),m){for(var E=0,A=T.length;E<A;++E)Object.freeze(T[E]);Object.freeze(T)}else P.result=Ke(T);return P}).catch(function(P){return _&&O&&rt(_,O),Promise.reject(P)}),O={obsSet:f.obsSet,promise:b,subscribers:new Set,type:"query",req:f,dirty:!1},_?_.push(O):(_=[O],(x=x||(ut["idb://".concat(s,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[f.query.index.name||""]=_)),ha(O,_,v,k),O.promise.then(function(P){return{result:li(P.result,f,x?.optimisticOps,l,O,m)}})}})}})}};function Br(n,s){return new Proxy(n,{get:function(c,l,h){return l==="db"?s:Reflect.get(c,l,h)}})}var qe=(me.prototype.version=function(n){if(isNaN(n)||n<.1)throw new V.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new V.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var s=this._versions,c=s.filter(function(l){return l._cfg.version===n})[0];return c||(c=new this.Version(n),s.push(c),s.sort(ta),c.stores({}),this._state.autoSchema=!1,c)},me.prototype._whenReady=function(n){var s=this;return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?n():new J(function(c,l){if(s._state.openComplete)return l(new V.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void l(new V.DatabaseClosed);s.open().catch(ae)}s._state.dbReadyPromise.then(c,l)}).then(n)},me.prototype.use=function(n){var s=n.stack,c=n.create,l=n.level,h=n.name;return h&&this.unuse({stack:s,name:h}),n=this._middlewares[s]||(this._middlewares[s]=[]),n.push({stack:s,create:c,level:l??10,name:h}),n.sort(function(f,m){return f.level-m.level}),this},me.prototype.unuse=function(n){var s=n.stack,c=n.name,l=n.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(h){return l?h.create!==l:!!c&&h.name!==c})),this},me.prototype.open=function(){var n=this;return ot(Je,function(){return ia(n)})},me.prototype._close=function(){var n=this._state,s=Pt.indexOf(this);if(0<=s&&Pt.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new J(function(c){n.dbReadyResolve=c}),n.openCanceller=new J(function(c,l){n.cancelOpen=l}))},me.prototype.close=function(c){var s=(c===void 0?{disableAutoOpen:!0}:c).disableAutoOpen,c=this._state;s?(c.isBeingOpened&&c.cancelOpen(new V.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new V.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},me.prototype.delete=function(n){var s=this;n===void 0&&(n={disableAutoOpen:!0});var c=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new J(function(h,f){function m(){s.close(n);var v=s._deps.indexedDB.deleteDatabase(s.name);v.onsuccess=he(function(){var k,w,O;k=s._deps,w=s.name,O=k.indexedDB,k=k.IDBKeyRange,In(O)||w===Pr||jn(O,k).delete(w).catch(ae),h()}),v.onerror=Ie(f),v.onblocked=s._fireOnBlocked}if(c)throw new V.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(m):m()})},me.prototype.backendDB=function(){return this.idbdb},me.prototype.isOpen=function(){return this.idbdb!==null},me.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},me.prototype.hasFailed=function(){return this._state.dbOpenError!==null},me.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(me.prototype,"tables",{get:function(){var n=this;return u(this._allTables).map(function(s){return n._allTables[s]})},enumerable:!1,configurable:!0}),me.prototype.transaction=function(){var n=function(s,c,l){var h=arguments.length;if(h<2)throw new V.InvalidArgument("Too few arguments");for(var f=new Array(h-1);--h;)f[h-1]=arguments[h];return l=f.pop(),[s,js(f),l]}.apply(this,arguments);return this._transaction.apply(this,n)},me.prototype._transaction=function(n,s,c){var l=this,h=H.trans;h&&h.db===this&&n.indexOf("!")===-1||(h=null);var f,m,v=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");try{if(m=s.map(function(w){if(w=w instanceof l.Table?w.name:w,typeof w!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return w}),n=="r"||n===wn)f=wn;else{if(n!="rw"&&n!=_n)throw new V.InvalidArgument("Invalid transaction mode: "+n);f=_n}if(h){if(h.mode===wn&&f===_n){if(!v)throw new V.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&m.forEach(function(w){if(h&&h.storeNames.indexOf(w)===-1){if(!v)throw new V.SubTransaction("Table "+w+" not included in parent transaction.");h=null}}),v&&h&&!h.active&&(h=null)}}catch(w){return h?h._promise(null,function(O,b){b(w)}):pe(w)}var k=function w(O,b,x,_,P){return J.resolve().then(function(){var T=H.transless||H,E=O._createTransaction(b,x,O._dbSchema,_);if(E.explicit=!0,T={trans:E,transless:T},_)E.idbtrans=_.idbtrans;else try{E.create(),E.idbtrans._explicit=!0,O._state.PR1398_maxLoop=3}catch(R){return R.name===ln.InvalidState&&O.isOpen()&&0<--O._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),O.close({disableAutoOpen:!1}),O.open().then(function(){return w(O,b,x,null,P)})):pe(R)}var A,C=un(P);return C&&Et(),T=J.follow(function(){var R;(A=P.call(E,E))&&(C?(R=He.bind(null,null),A.then(R,R)):typeof A.next=="function"&&typeof A.throw=="function"&&(A=qn(A)))},T),(A&&typeof A.then=="function"?J.resolve(A).then(function(R){return E.active?R:pe(new V.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):T.then(function(){return A})).then(function(R){return _&&E._resolve(),E._completion.then(function(){return R})}).catch(function(R){return E._reject(R),pe(R)})})}.bind(null,this,f,m,h,c);return h?h._promise(f,k,"lock"):H.trans?ot(H.transless,function(){return l._whenReady(k)}):this._whenReady(k)},me.prototype.table=function(n){if(!S(this._allTables,n))throw new V.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},me);function me(n,s){var c=this;this._middlewares={},this.verno=0;var l=me.dependencies;this._options=s=r({addons:me.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},l=s.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,f,m,v,k,w={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ae,dbReadyPromise:null,cancelOpen:ae,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};w.dbReadyPromise=new J(function(b){w.dbReadyResolve=b}),w.openCanceller=new J(function(b,x){w.cancelOpen=x}),this._state=w,this.name=n,this.on=Vt(this,"populate","blocked","versionchange","close",{ready:[hn,ae]}),this.on.ready.subscribe=fe(this.on.ready.subscribe,function(b){return function(x,_){me.vip(function(){var P,T=c._state;T.openComplete?(T.dbOpenError||J.resolve().then(x),_&&b(x)):T.onReadyBeingFired?(T.onReadyBeingFired.push(x),_&&b(x)):(b(x),P=c,_||b(function E(){P.on.ready.unsubscribe(x),P.on.ready.unsubscribe(E)}))})}}),this.Collection=(h=this,Wt(Wo.prototype,function(A,E){this.db=h;var _=Ks,P=null;if(E)try{_=E()}catch(C){P=C}var T=A._ctx,E=T.table,A=E.hook.reading.fire;this._ctx={table:E,index:T.index,isPrimKey:!T.index||E.schema.primKey.keyPath&&T.index===E.schema.primKey.name,range:_,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:P,or:T.or,valueMapper:A!==qt?A:null}})),this.Table=(f=this,Wt(Vs.prototype,function(b,x,_){this.db=f,this._tx=_,this.name=b,this.schema=x,this.hook=f._allTables[b]?f._allTables[b].hook:Vt(null,{creating:[Fo,ae],reading:[Uo,qt],updating:[qo,ae],deleting:[Bo,ae]})})),this.Transaction=(m=this,Wt(Xo.prototype,function(b,x,_,P,T){var E=this;this.db=m,this.mode=b,this.storeNames=x,this.schema=_,this.chromeTransactionDurability=P,this.idbtrans=null,this.on=Vt(this,"complete","error","abort"),this.parent=T||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new J(function(A,C){E._resolve=A,E._reject=C}),this._completion.then(function(){E.active=!1,E.on.complete.fire()},function(A){var C=E.active;return E.active=!1,E.on.error.fire(A),E.parent?E.parent._reject(A):C&&E.idbtrans&&E.idbtrans.abort(),pe(A)})})),this.Version=(v=this,Wt(sa.prototype,function(b){this.db=v,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,Wt(Qs.prototype,function(b,x,_){if(this.db=k,this._ctx={table:b,index:x===":id"?null:x,or:_},this._cmp=this._ascending=ie,this._descending=function(P,T){return ie(T,P)},this._max=function(P,T){return 0<ie(P,T)?P:T},this._min=function(P,T){return ie(P,T)<0?P:T},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new V.MissingAPI})),this.on("versionchange",function(b){0<b.newVersion?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(b){!b.newVersion||b.newVersion<b.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(b.oldVersion/10))}),this._maxKey=Qt(s.IDBKeyRange),this._createTransaction=function(b,x,_,P){return new c.Transaction(b,x,_,c._options.chromeTransactionDurability,P)},this._fireOnBlocked=function(b){c.on("blocked").fire(b),Pt.filter(function(x){return x.name===c.name&&x!==c&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(b)})},this.use(ca),this.use(da),this.use(ua),this.use(oa),this.use(aa);var O=new Proxy(this,{get:function(b,x,_){if(x==="_vip")return!0;if(x==="table")return function(T){return Br(c.table(T),O)};var P=Reflect.get(b,x,_);return P instanceof Vs?Br(P,O):x==="tables"?P.map(function(T){return Br(T,O)}):x==="_createTransaction"?function(){return Br(P.apply(this,arguments),O)}:P}});this.vip=O,l.forEach(function(b){return b(c)})}var qr,Oe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",fa=(zn.prototype.subscribe=function(n,s,c){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:s,complete:c})},zn.prototype[Oe]=function(){return this},zn);function zn(n){this._subscribe=n}try{qr={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{qr={indexedDB:null,IDBKeyRange:null}}function di(n){var s,c=!1,l=new fa(function(h){var f=un(n),m,v=!1,k={},w={},O={get closed(){return v},unsubscribe:function(){v||(v=!0,m&&m.abort(),b&&Ge.storagemutated.unsubscribe(_))}};h.start&&h.start(O);var b=!1,x=function(){return bn(P)},_=function(T){Lr(k,T),Ln(w,k)&&x()},P=function(){var T,E,A;!v&&qr.indexedDB&&(k={},T={},m&&m.abort(),m=new AbortController,A=function(C){var R=kt();try{f&&Et();var j=ze(n,C);return j=f?j.finally(He):j}finally{R&&St()}}(E={subscr:T,signal:m.signal,requery:x,querier:n,trans:null}),Promise.resolve(A).then(function(C){c=!0,s=C,v||E.signal.aborted||(k={},function(R){for(var j in R)if(S(R,j))return;return 1}(w=T)||b||(Ge(Xt,_),b=!0),bn(function(){return!v&&h.next&&h.next(C)}))},function(C){c=!1,["DatabaseClosedError","AbortError"].includes(C?.name)||v||bn(function(){v||h.error&&h.error(C)})}))};return setTimeout(x,0),O});return l.hasValue=function(){return c},l.getValue=function(){return s},l}var lt=qe;function Hn(n){var s=Ye;try{Ye=!0,Ge.storagemutated.fire(n),Bn(n,!0)}finally{Ye=s}}$(lt,r(r({},yr),{delete:function(n){return new lt(n,{addons:[]}).delete()},exists:function(n){return new lt(n,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return s=lt.dependencies,c=s.indexedDB,s=s.IDBKeyRange,(In(c)?Promise.resolve(c.databases()).then(function(l){return l.map(function(h){return h.name}).filter(function(h){return h!==Pr})}):jn(c,s).toCollection().primaryKeys()).then(n)}catch{return pe(new V.MissingAPI)}var s,c},defineClass:function(){return function(n){p(this,n)}},ignoreTransaction:function(n){return H.trans?ot(H.transless,n):n()},vip:Dn,async:function(n){return function(){try{var s=qn(n.apply(this,arguments));return s&&typeof s.then=="function"?s:J.resolve(s)}catch(c){return pe(c)}}},spawn:function(n,s,c){try{var l=qn(n.apply(c,s||[]));return l&&typeof l.then=="function"?l:J.resolve(l)}catch(h){return pe(h)}},currentTransaction:{get:function(){return H.trans||null}},waitFor:function(n,s){return s=J.resolve(typeof n=="function"?lt.ignoreTransaction(n):n).timeout(s||6e4),H.trans?H.trans.waitFor(s):s},Promise:J,debug:{get:function(){return je},set:function(n){Ns(n)}},derive:U,extend:p,props:$,override:fe,Events:Vt,on:Ge,liveQuery:di,extendObservabilitySet:Lr,getByKeyPath:Le,setByKeyPath:Se,delByKeyPath:function(n,s){typeof s=="string"?Se(n,s,void 0):"length"in s&&[].map.call(s,function(c){Se(n,c,void 0)})},shallowClone:Rs,deepClone:Ke,getObjectDiff:Mn,cmp:ie,asap:tt,minKey:-1/0,addons:[],connections:Pt,errnames:ln,dependencies:qr,cache:ut,semVer:"4.0.7",version:"4.0.7".split(".").map(function(n){return parseInt(n)}).reduce(function(n,s,c){return n+s/Math.pow(10,2*c)})})),lt.maxKey=Qt(lt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ge(Xt,function(n){Ye||(n=new CustomEvent(Pn,{detail:n}),Ye=!0,dispatchEvent(n),Ye=!1)}),addEventListener(Pn,function(n){n=n.detail,Ye||Hn(n)}));var Tt,Ye=!1,fi=function(){};return typeof BroadcastChannel<"u"&&((fi=function(){(Tt=new BroadcastChannel(Pn)).onmessage=function(n){return n.data&&Hn(n.data)}})(),typeof Tt.unref=="function"&&Tt.unref(),Ge(Xt,function(n){Ye||Tt.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!qe.disableBfCache&&n.persisted){je&&console.debug("Dexie: handling persisted pagehide"),Tt?.close();for(var s=0,c=Pt;s<c.length;s++)c[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!qe.disableBfCache&&n.persisted&&(je&&console.debug("Dexie: handling persisted pageshow"),fi(),Hn({all:new ve(-1/0,[[]])}))})),J.rejectionMapper=function(n,s){return!n||n instanceof wt||n instanceof TypeError||n instanceof SyntaxError||!n.name||!$s[n.name]?n:(s=new $s[n.name](s||n.message,n),"stack"in n&&N(s,"stack",{get:function(){return this.inner.stack}}),s)},Ns(je),r(qe,Object.freeze({__proto__:null,Dexie:qe,liveQuery:di,Entity:Js,cmp:ie,PropModSymbol:Be,PropModification:Gt,replacePrefix:function(n,s){return new Gt({replacePrefix:[n,s]})},add:function(n){return new Gt({add:n})},remove:function(n){return new Gt({remove:n})},default:qe,RangeSet:ve,mergeRanges:tr,rangesOverlap:Nr}),{default:qe}),qe})})(Ro);var Ul=Ro.exports;const gs=ya(Ul),zi=Symbol.for("Dexie"),hr=globalThis[zi]||(globalThis[zi]=gs);if(gs.semVer!==hr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${gs.semVer} and ${hr.semVer}`);const vs={id:"",email:"",updatedAt:new Date,fullName:"Guest",username:"Guest"},pt=pa(vs),Hi=Wi(!1),ir=Wi(null);class jo extends hr{constructor(){super("KilobaseDB"),this.supabase=null,this.profileKey="userProfile",this.version(1).stores({keyValueStore:"key",profiles:"&id, email",errorLogs:"++id, actionId, message, timestamp",actionULID:"&id, action, timestamp, status, errorId"}),this.profiles=this.table("profiles"),this.errorLogs=this.table("errorLogs"),this.actionULID=this.table("actionULID"),this.supabase=this.initializeSupabaseClient()}initializeSupabaseClient(){if(typeof window<"u"&&window.supabase&&(console.log("Using global Supabase client instance:",window.supabase),this.supabase=window.supabase),!this.supabase)try{this.supabase=Ll(yi.get().api,yi.get().anonKey),console.log("Supabase client instance created:",this.supabase),typeof window<"u"&&(window.supabase=this.supabase)}catch(e){throw console.error("Error creating Supabase client:",e),e}return this.supabase}getSupabaseClient(){return this.supabase}async registerUser(e,t,r,a,o,u){const d=this.getSupabaseClient();if(!d)return null;try{if(t!==r)return await this.handleAuthError({message:"Password and confirm password do not match."},a),null;const{data:p,error:y}=await d.auth.signUp({email:e,password:t,options:{captchaToken:u,data:{username:o,full_name:o}}});if(y)return await this.handleAuthError(y,a),null;if(p?.user){const g={id:p.user.id,email:p.user.email||"",username:p.user.user_metadata?.username||void 0,fullName:p.user.user_metadata?.full_name||void 0,updatedAt:new Date(p.user.updated_at||Date.now())};return await this.saveProfile(g),await this.updateActionStatus(a,"completed"),g}}catch(p){return await this.handleAuthError(p,a),null}return null}async createActionULID(e){const t=Ti().toString(),r={id:t,action:e,timestamp:new Date,status:"pending"};return await this.actionULID.add(r),t}async handleAuthError(e,t){let r="An unknown error occurred. Please try again.",a={...e},o="";e?.message&&(r=e.message),e?.code&&(o+=`Error Code: ${e.code}. `),e?.status&&(o+=`Status: ${e.status}. `),e?.supabaseCode&&(o+=`Supabase Code: ${e.supabaseCode}. `),e?.details&&(o+=`Details: ${JSON.stringify(e.details)}. `),o&&(r=`${r} (${o.trim()})`);const u={invalid_grant:"Invalid credentials provided.",invalid_request:"The request is missing a required parameter.",expired_token:"The token has expired. Please log in again.",invalid_token:"The token provided is invalid. Please try again.",email_already_exists:"The email address is already in use.",user_already_exists:"A user with this identifier already exists. Please log in instead.",invalid_password:"The password provided is incorrect."};switch(e?.code&&u[e.code]&&(r=u[e.code]),e?.status){case 400:r="Bad request. Please check the input fields.";break;case 401:r="Unauthorized. Please check your credentials.";break;case 403:r="Forbidden. You do not have permission to perform this action.";break;case 404:r="Resource not found. Please try again.";break;case 422:r="Unprocessable entity. Please check the provided data.";break;case 500:r="Internal server error. Please try again later.";break;default:r=r||"An unknown error occurred. Please try again.";break}throw await this.logError(r,{...a,supabaseCode:e?.code,statusCode:e?.status},t),console.error("Authentication Error:",r),new Error(r)}async saveProfile(e){try{await this.table("keyValueStore").put({key:this.profileKey,value:e}),e.username&&ir.set(e.username),pt.set(e),console.log("Profile saved locally:",e)}catch(t){console.error("Failed to save profile locally:",t)}}async loadProfile(){try{const e=await this.table("keyValueStore").get(this.profileKey);if(e?.value){pt.set(e.value),console.log("Profile loaded from local storage:",e.value);return}await this.loadProfileFromSupabase()}catch(e){console.error("Failed to load profile:",e)}}async loadProfileFromSupabase(){const e=this.getSupabaseClient();if(e)try{Hi.set(!0);const{data:t,error:r}=await e.from("profiles").select("*").eq("id",pt.get().id).single();if(r){console.error("Failed to load profile from Supabase:",r),await this.logError("Failed to load profile from Supabase",r);return}if(t){const a={id:t.id,email:t.email,username:t.username||void 0,fullName:t.full_name||void 0,updatedAt:new Date(t.updated_at)};await this.saveProfile(a),console.log("Profile loaded and saved from Supabase:",a)}}finally{Hi.set(!1)}}async removeProfile(){const e=this.getSupabaseClient();if(e)try{const t=pt.get();await this.table("keyValueStore").delete(this.profileKey),await this.profiles.delete(t.id),pt.set(vs),console.log(`Profile ${t.id} removed locally and store reset`),ir.set(null);const{error:r}=await e.auth.signOut();r?(await this.logError("Failed to log out user from Supabase",r),console.error("Failed to log out user from Supabase:",r)):console.log("User logged out successfully from Supabase.")}catch(t){await this.logError("Failed to remove profile",t),console.error("Failed to remove profile:",t)}}async getProfile(){const e=pt.get();if(e.id!=="")return e;try{const t=await this.table("keyValueStore").get(this.profileKey);if(t?.value){const r=t.value;return pt.set(r),r}}catch(t){console.error("Failed to get profile from Dexie:",t)}return vs}async createAction(e){const r={id:Ti().toString(),action:e,timestamp:new Date,status:"pending"};return await this.actionULID.add(r),r}async updateActionStatus(e,t,r){await this.actionULID.update(e,{status:t,errorId:r})}async logError(e,t,r){try{let a=null;if(r&&(a=await this.errorLogs.where("actionId").equals(r).first()),a){console.warn(`Error already exists for actionId: ${r}. Skipping new error log.`);return}const o={message:e,details:t,actionId:r,timestamp:new Date},u=await this.errorLogs.add(o);console.log("Error logged to Dexie:",o),r&&await this.updateActionStatus(r,"failed",u)}catch(a){console.error("Failed to log error:",a)}}async extractAuthErrorDetails(e){if(!e)return"Unknown error occurred. No error details available.";let t=e.message||"Unknown error occurred",r="";return e?.code&&(r+=`Error Code: ${e.code}. `),e?.status&&(r+=`Status: ${e.status}. `),e?.supabaseCode&&(r+=`Supabase Code: ${e.supabaseCode}. `),e?.details&&(r+=`Details: ${JSON.stringify(e.details)}. `),r&&(t=`${t} (${r.trim()})`),t}async getDetailedErrorByActionId(e){try{const t=await this.errorLogs.where("actionId").equals(e).last();return t?this.extractAuthErrorDetails(t):null}catch(t){return console.error(`Failed to retrieve detailed error for actionId: ${e}`,t),null}}async getErrorByActionId(e){try{const t=await this.errorLogs.where("actionId").equals(e).last();return t?t.message:null}catch(t){return console.error(`Failed to retrieve error for actionId: ${e}`,t),null}}async loginUser(e,t,r,a){const o=this.getSupabaseClient();if(!o)return null;try{const{data:u,error:d}=await o.auth.signInWithPassword({email:e,password:t,options:{captchaToken:a}});if(d)return await this.handleAuthError(d,r),null;if(u?.user){const p={id:u.user.id,email:u.user.email||"",username:u.user.user_metadata?.username||void 0,fullName:u.user.user_metadata?.full_name||void 0,updatedAt:new Date(u.user.updated_at||Date.now())};return await this.saveProfile(p),console.log("User logged in successfully:",p),p}}catch(u){return await this.handleAuthError(u,r),null}return null}async getSession(){const e=this.getSupabaseClient();if(!e)return null;try{const{data:t,error:r}=await e.auth.getSession();return r?(console.error("Failed to retrieve session:",r),null):t.session||null}catch(t){return console.error("Error getting session:",t),null}}async getUsername(){if(ir.get())return ir.get();try{const e=await this.table("keyValueStore").get(this.profileKey);if(e?.value?.username)return ir.set(e.value.username),e.value.username}catch(e){console.error("Failed to get username from Dexie:",e)}return null}static createPersistentAtom(e,t){return Vi(e,t,{encode:JSON.stringify,decode:JSON.parse})}createPersistentMap(e,t){return ma(e,t,{encode:JSON.stringify,decode:JSON.parse})}updateAtomField(e,t,r){e.set({...e.get(),[t]:r})}updateMapField(e,t,r){const o={...e.get(),[t]:r};e.set(o)}removeMapField(e,t){const r=e.get(),{[t]:a,...o}=r;e.set(o)}removeAtomField(e,t){const r=e.get(),{[t]:a,...o}=r;e.set(o)}resetState(e,t){e.set(t)}getPersistentAtom(e){return e.get()}}jo.createPersistentAtom("atlas",{plugin:[]});const Xl=new jo;class Fl extends hr{constructor(){super("MapDatabase"),this.version(1).stores({maps:"tilemapKey",jsonFiles:"tilemapKey",tilesetImages:"tilemapKey"}),this.maps=this.table("maps"),this.jsonFiles=this.table("jsonFiles"),this.tilesetImages=this.table("tilesetImages")}async initializeMapDatabase(){const e="/api/mapdb.json",t="https://kbve.com/api/mapdb.json";let r;try{r=(await oe.get(e)).data,z.log(`Map database loaded from ${e}`)}catch{z.warn(`Failed to load map database from ${e}, trying fallback URL.`);try{r=(await oe.get(t)).data,z.log(`Map database loaded from ${t}`)}catch{z.error(`Failed to load map database from both ${e} and ${t}`);return}}if(r&&r.key){for(const a in r.key)if(Object.prototype.hasOwnProperty.call(r.key,a)){const o=r.key[a];await this.addMap(o),await this.addJsonData(a,o.jsonDataUrl);const u=await this.fetchTilesetImage(o.tilesetImageUrl);u&&await this.addTilesetImage(a,u)}z.log("Map database initialized and data loaded.")}else z.error("Invalid map database format.")}async addMap(e){await this.maps.put(e)}async getMap(e){return await this.maps.get(e)}async addJsonData(e,t){await this.jsonFiles.put({tilemapKey:e,jsonData:t})}async getJsonData(e){return(await this.jsonFiles.get(e))?.jsonData}async addTilesetImage(e,t){await this.tilesetImages.put({tilemapKey:e,imageData:t})}async getTilesetImage(e){return(await this.tilesetImages.get(e))?.imageData}async getBounds(e){return(await this.maps.get(e))?.bounds}async getNpcsFromTilesetKey(e){const t=await Bl.getMap(e);if(!t){z.error(`No map data found for tilesetKey: ${e}`);return}return t.npcs}async fetchMapData(e){try{return(await oe.get(e)).data}catch(t){z.error(`Failed to fetch map data from ${e}:`,t);return}}async fetchJsonData(e){try{return(await oe.get(e)).data}catch(t){z.error(`Failed to fetch JSON data from ${e}:`,t);return}}async fetchTilesetImage(e){try{return(await oe.get(e,{responseType:"blob"})).data}catch(t){z.error(`Failed to fetch tileset image from ${e}:`,t);return}}async initializeMap(e,t,r,a){try{const o=await this.fetchMapData(t);if(o){await this.addMap(o);const u=await this.fetchJsonData(r);u&&await this.addJsonData(e,u);const d=await this.fetchTilesetImage(a);d&&await this.addTilesetImage(e,d)}}catch(o){z.error("Failed to initialize map database:",o)}}async loadMapIntoScene(e,t){const r=await this.getMap(t);if(!r){z.error(`Map with key ${t} not found`);return}const a=await this.getJsonData(t);if(!a){z.error(`JSON data for map ${t} not found`);return}const o=await this.getTilesetImage(t);if(!o){z.error(`Tileset image for map ${t} not found`);return}let u=null;try{u=URL.createObjectURL(o)}catch(d){z.error(`Failed to create object URL for tileset image: ${d}`);return}if(!u){z.error(`Tileset image URL for map ${t} could not be created.`);return}e.load.tilemapTiledJSON(t,a),e.load.image(r.tilesetKey,u),e.load.once("complete",()=>{const d=e.make.tilemap({key:t}),p=d.addTilesetImage(r.tilesetName,r.tilesetKey);if(p)for(let y=0;y<d.layers.length;y++){const g=d.createLayer(y,p,0,0);g?g.scale=r.scale:z.error(`Layer ${y} could not be created.`)}else z.error(`Tileset ${r.tilesetName} could not be created.`)}),e.load.start()}async loadMap(e,t){const r=await this.getMap(t);if(!r)throw new Error(`Map with key ${t} not found`);const a=await this.getJsonData(t);if(!a)throw new Error(`JSON data for map ${t} not found`);const o=await this.getTilesetImage(t);if(!o)throw new Error(`Tileset image for map ${t} not found`);let u=null;try{u=URL.createObjectURL(o)}catch(d){throw new Error(`Failed to create object URL for tileset image: ${d}`)}if(!u)throw new Error(`Tileset image URL for map ${t} could not be created.`);return e.load.tilemapTiledJSON(t,a),e.load.image(r.tilesetKey,u),new Promise(d=>{e.load.once("complete",()=>{const p=e.make.tilemap({key:t});if(p.addTilesetImage(r.tilesetName,r.tilesetKey)){for(let g=0;g<p.layers.length;g++){const S=p.createLayer(g,r.tilesetName,0,0);S?S.scale=r.scale:console.error(`Layer ${g} could not be created.`)}d(p)}else console.error(`Tileset ${r.tilesetName} could not be created.`),d(null)}),e.load.start()})}}const Bl=new Fl,ql=({text:i,speed:e=80,onComplete:t})=>{const[r,a]=Wn.useState([]),o=Wn.useRef([]);return Wn.useEffect(()=>{let u,d=0;const p=i.split(/(<\/?span[^>]*>)/g).filter(Boolean),y=[];p.forEach((S,$)=>{if(S.startsWith("<span")||S.startsWith("</span")){const K=S.match(/<span class="([^"]*)">/);if(K){const N=K[1];y.push(Kr.jsx("span",{className:N},`span-${$}`))}else y.push(Kr.jsx("span",{},`span-${$}`))}else S.split("").forEach((K,N)=>{y.push(Kr.jsx("span",{children:K},`char-${$}-${N}`))})}),d=0;const g=()=>{d<y.length?(o.current=[...o.current,y[d]],a([...o.current]),d++,u=window.setTimeout(g,e)):t&&t()};return o.current=[],a([]),g(),()=>{window.clearTimeout(u)}},[i,e,t]),Kr.jsx("div",{children:r})};ga.memo(ql);class Ml extends hr{constructor(){super("NPCDatabase"),this.version(3).stores({npcs:"id,name",sprites:"id",avatars:"id",dialogues:"id"}),this.npcs=this.table("npcs"),this.sprites=this.table("sprites"),this.avatars=this.table("avatars"),this.dialogues=this.table("dialogues")}async addNPC(e){await this.npcs.put(e)}async getNPC(e){return await this.npcs.get(e)}async getNPCByName(e){return await this.npcs.where("name").equals(e).first()}async getAllNPCs(){return await this.npcs.toArray()}async exportNPCs(){const e=await this.getAllNPCs();return JSON.stringify(e,null,2)}async importNPCs(e){const t=JSON.parse(e);await this.npcs.bulkPut(t)}async fetchNPCData(e){try{return(await oe.get(e)).data}catch(t){z.error(`Failed to fetch NPC data from ${e}:`,t);return}}async addSprite(e){await this.sprites.put(e)}async getSprite(e){return await this.sprites.get(e)}async getAllSprites(){return await this.sprites.toArray()}async addAvatar(e){await this.avatars.put(e)}async getAvatar(e){return await this.avatars.get(e)}async getAllAvatars(){return await this.avatars.toArray()}async urlToBlob(e){try{return(await oe.get(e,{responseType:"blob"})).data}catch(t){z.error(`Failed to fetch blob from ${e}:`,t);return}}async addNewSprite(e,t){const r=await this.urlToBlob(e);if(r){const a={...t,spriteData:r};return await this.addSprite(a),a.id}}async addNewNPC(e,t,r){const a={...e,spriteImageId:t,avatarImageId:r};await this.addNPC(a)}async addNewAvatar(e,t){const r=await this.urlToBlob(e);if(r){const a={...t,avatarData:r};return await this.addAvatar(a),a.id}}async fetchAvatars(e){try{const r=(await oe.get(e)).data.key;for(const a in r){const o=r[a];let u=await this.urlToBlob(o.avatarLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${o.avatarLocation}`)),u){const d={id:o.id,avatarName:o.avatarName,avatarLocation:o.avatarLocation,avatarData:u,slug:o.slug};await this.addAvatar(d)}}}catch(t){z.error(`Failed to fetch avatars from ${e}:`,t)}}async fetchSprites(e){try{const r=(await oe.get(e)).data.key;for(const a in r){const o=r[a];let u=await this.urlToBlob(o.assetLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${o.assetLocation}`)),u){const d={id:o.id,spriteName:o.spriteName,assetLocation:o.assetLocation,frameWidth:o.frameWidth,frameHeight:o.frameHeight,scale:o.scale,slug:o.slug,spriteData:u};await this.addSprite(d)}}}catch(t){z.error(`Failed to fetch sprites from ${e}:`,t)}}async fetchNPCs(e){try{const r=(await oe.get(e)).data.key;for(const a in r){const o=r[a],u={id:o.id,name:o.name,spriteKey:o.spriteKey,walkingAnimationMapping:o.walkingAnimationMapping,startPosition:o.startPosition,speed:o.speed,scale:o.scale,slug:o.slug,actions:o.actions,effects:o.effects,stats:o.stats,spriteImageId:o.spriteImageId,avatarImageId:o.avatarImageId,dialogues:o.dialogues||[]};await this.addNPC(u)}}catch(t){z.error(`Failed to fetch NPCs from ${e}:`,t)}}async initializeDatabase(e="https://kbve.com"){await this.fetchAvatars(`${e}/api/avatardb.json`),await this.fetchSprites(`${e}/api/spritedb.json`),await this.fetchNPCs(`${e}/api/npcdb.json`),await this.fetchDialogues(`${e}/api/dialogue.json`)}async loadNPC(e,t,r,a){try{z.log(`Loading NPC with name: ${t}`);const o=await this.getNPCByName(t);if(!o)throw new Error(`NPC with name ${t} not found`);z.log(`NPC Data: ${JSON.stringify(o)}`),await this.loadCharacter(e,o.id,r,a)}catch(o){o instanceof Error?z.error(`Failed to load NPC: ${o.message}`):z.error("Failed to load NPC:",o)}}async loadCharacter(e,t,r,a){try{z.log(`Loading NPC with ID: ${t}`);const o=await this.getNPC(t);if(!o)throw new Error(`NPC with ID ${t} not found`);z.log(`NPC Data: ${JSON.stringify(o)}`);const u=o.spriteKey;if(e.textures.exists(u))z.log(`Texture with key ${u} already loaded.`),this.addNPCToScene(e,o,r,a);else{z.log(`Texture with key ${u} not found, attempting to load.`);const d=await this.getSprite(o.spriteImageId);if(d&&d.spriteData){z.log(`Sprite Data: ${JSON.stringify(d)}`);const p=URL.createObjectURL(d.spriteData);e.load.spritesheet(u,p,{frameWidth:d.frameWidth,frameHeight:d.frameHeight}),e.load.once("complete",()=>{z.log(`Texture ${u} loaded successfully.`),this.addNPCToScene(e,o,r,a)}),e.load.start()}else throw new Error(`Sprite with ID ${o.spriteImageId} not found`)}}catch(o){o instanceof Error?z.error(`Failed to load NPC: ${o.message}`):z.error("Failed to load NPC:",o)}}addNPCToScene(e,t,r,a){try{z.log(`Adding NPC to scene: ${JSON.stringify(t)}`),z.log(`Using sprite key: ${t.spriteKey}`);const o=e.add.sprite(0,0,t.spriteKey);o.scale=t.scale||1.5,o.name=t.id||"Error Missing Name",z.log(`NPC Sprite created with texture key ${t.spriteKey} at position (${t.startPosition.x}, ${t.startPosition.y})`);const u={id:t.id,sprite:o,walkingAnimationMapping:t.walkingAnimationMapping,startPosition:{x:r??t.startPosition.x,y:a??t.startPosition.y},speed:t.speed};if(z.log(`Grid engine config: ${JSON.stringify(u)}`),!e.textures.exists(t.spriteKey))throw new Error(`Texture with key ${t.spriteKey} does not exist in the scene`);e.gridEngine.addCharacter(u),z.log(`NPC added to grid engine with ID ${t.id}`),((p,y,g)=>{const S=e.gridEngine.getPosition(p.name);z.log(`Attaching NPC events to ${y} at position: ${JSON.stringify(S)}`),zl.attachNPCEvent(p,y,g,{coords:S})})(o,t.name,t.actions.map(p=>({label:p}))),z.log(`NPC ${t.name} added to scene successfully`)}catch(o){o instanceof Error?z.error(`Error adding NPC to scene from addNPCToScene: ${o.message}`):z.error("Error adding NPC to scene:",o)}}async addDialogue(e){await this.dialogues.put(e)}async getDialogue(e){return await this.dialogues.get(e)}async getAllDialogues(){return await this.dialogues.toArray()}async getDialoguesForNPC(e){const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);return(await Promise.all((t.dialogues||[]).map(a=>this.getDialogue(a.dialogueId)))).filter(a=>a!==void 0)}async markDialogueAsRead(e,t){const r=await this.getNPC(e);if(!r)throw new Error(`NPC with ID ${e} not found`);const a=r.dialogues?.find(o=>o.dialogueId===t);a&&(a.read=!0,await this.addNPC(r))}async fetchDialogues(e){try{const r=(await oe.get(e)).data.key,a=Object.values(r).map(o=>({...o}));await this.dialogues.bulkPut(a)}catch(t){z.error(`Failed to fetch dialogues from ${e}:`,t)}}async getPrioritizedDialoguesForNPC(e){try{const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);const a=(await Promise.all((t.dialogues||[]).map(async o=>{const u=await this.getDialogue(o.dialogueId);return u?{...u,priority:o.priority,read:o.read}:null}))).filter(o=>o!==null);return a.sort((o,u)=>u.priority-o.priority),a}catch(t){return z.error(`Failed to get prioritized dialogues for NPC with ID ${e}:`,t),[]}}async getNPCNameById(e){return(await this.getNPC(e))?.name}async getNPCAvatarById(e){const t=await this.getNPC(e);if(t?.avatarImageId)return(await this.getAvatar(t.avatarImageId))?.avatarData}async getNPCSlugById(e){return(await this.getNPC(e))?.slug}async getNPCHealthById(e){try{return(await this.getNPC(e))?.stats?.health}catch(t){z.error(`Failed to get health for NPC with ID ${e}:`,t);return}}async getNPCManaById(e){try{return(await this.getNPC(e))?.stats?.mana}catch(t){z.error(`Failed to get mana for NPC with ID ${e}:`,t);return}}async createNPCSession(e,t){try{const r=this.getNPCNameById(t),a=this.getNPCSlugById(t),o=this.getNPCAvatarById(t),u=this.getNPCHealthById(t),d=this.getNPCManaById(t),[p,y,g,S,$]=await Promise.all([r,a,o,u,d]),K={...e.get(),[`${t}_name`]:p||"Unknown",[`${t}_slug`]:y||"Unknown",[`${t}_avatar`]:g?URL.createObjectURL(g):"Unknown",[`${t}_health`]:S||"100",[`${t}_mana`]:$||"100"};e.set(K)}catch{const a={...e.get(),[`${t}_name`]:"Unknown",[`${t}_slug`]:"Unknown",[`${t}_avatar`]:"Unknown",[`${t}_hp`]:"100",[`${t}_mana`]:"100"};e.set(a)}}async getNPCDialogueOptionsByULID(e){try{const t=await this.getDialogue(e);if(!t||!t.options)return"[]";const r=await Promise.all(t.options.map(async a=>this.getDialogue(a)));return JSON.stringify(r.filter(a=>a!==void 0))}catch(t){return z.error(`Failed to get dialogue options for ID ${e}:`,t),"[]"}}async getAllDialogueOptions(e){const t=[],r=new Set,a=async o=>{if(r.has(o))return;r.add(o);const u=await this.getDialogue(o);if(u&&(t.push(u),u.options&&u.options.length>0))for(const d of u.options)await a(d)};return await a(e),t}async createDialogueSession(e,t){try{const r=await this.getNPCDialogueOptionsByULID(t),a={...e.get(),[`${t}_options`]:r||"[]"};e.set(a)}catch{const a={...e.get(),[`${t}_options`]:"[]"};e.set(a)}}}const Kl=new Ml;class Jl{constructor(){this.actionHandlers={talk:this.talkToNPC.bind(this),quest:this.questWithNPC.bind(this),trade:this.tradeWithNPC.bind(this),combat:this.startCombat.bind(this),heal:this.healNPC.bind(this),steal:this.stealFromNPC.bind(this),lore:this.loreFromNPC.bind(this)}}getActionHandler(e){return this.actionHandlers[e]}loreFromNPC(e){z.log(`Pulling up the lore of the NPC with ID: ${e.npcId}`)}questWithNPC(e){z.log(`Starting quest with NPC with ID: ${e.npcId}`)}healNPC(e){z.log(`Healing NPC with ID: ${e.npcId}`)}oathFromNPC(e){z.log(`Oath from NPC with ID: ${e.npcId}`)}async talkToNPC(e){try{z.log(`Talking to NPC with ID: ${e.npcId}`);const t=await Kl.getPrioritizedDialoguesForNPC(e.npcId);if(z.log(t),t.length>0){const r=t[0];nr.emit("npcDialogue",{npcId:e.npcId,dialogue:r},1e3)}else z.log("No dialogues available for this NPC.")}catch(t){z.error(`Failed to fetch dialogues for NPC with ID ${e.npcId}:`,t)}}tradeWithNPC(e){z.log(`Trading with NPC with ID: ${e.npcId}`)}moveToNPC(e){const r=e.data?.coords||{x:10,y:15};nr.emit("playerMove",r)}stealFromNPC(e){z.log(`Attempting to steal from NPC with ID: ${e.npcId}`);const t={npcId:e.npcId,npcName:e.npcName,data:e.data};nr.emit("playerSteal",t)}startCombat(e){z.log(`Starting combat with NPC with ID: ${e.npcId}`)}checkFish(e){z.log(`Checking fish for NPC with ID: ${e.npcId}`)}attachNPCEvent(e,t,r,a){e.setInteractive(),e.on("pointerover",o=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:a||{},coords:{x:o.x,y:o.y}};nr.emit("npcInteraction",u),e.setTint(65280)}),e.on("pointerout",()=>{e.clearTint()}),e.on("pointerdown",o=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:a||{},coords:{x:o.x,y:o.y}};z.log(`Click Registered at X: ${u.coords.x} Y: ${u.coords.y}`),nr.emit("npcInteractionClick",u,1e3)})}}const zl=new Jl;export{z as D,yi as K,jo as a,nr as e,Xl as k};
