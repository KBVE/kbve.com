import{a as Pe,w as Te,x as h,o as je,y as Fe,z as Oe,A as Ue,i as Ke,t as w,B as qe,C,D as ne,E as Re,F as E,d as I,G as de,v as a,H as Ne,f as u,I as R,g as Ge,s as v,J as d,b as o,j as s,k as _,K as He,L as ce,M as Je,N as ue,r as l,O as Ve,P as S,q as M}from"./svelte.BG-3nfZ7.js";import{r as We,C as Qe}from"./loader.a1m5Rqtc.js";import{K as ve,k as z}from"./npchandler.BSw-qpjL.js";import"./react.C2V1wh_4.js";import"./esm-env.rsSWfq8L.js";import"./@supabase.CVkg5Wqw.js";import"./@react-three.BOv1JqT7.js";import"./Page.astro_astro_type_script_index_0_lang.COYkzBTz.js";import"./react-dom.D0pYwg_m.js";import"./scheduler.C323NY8X.js";import"./dexie.Db70IFYj.js";import"./@nanostores.4Ikc6yb_.js";import"./nanostores.Bo9-_MAV.js";import"./axios.Bw-gCGc_.js";var Xe=Je("<script async defer><\/script><!---->",1),Ye=w('<div class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100" role="alert" tabindex="-1" aria-labelledby="hs-toast-normal-example-label"><div class="flex p-4"><div class="shrink-0"><svg class="shrink-0 size-4 text-blue-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg></div> <div class="ms-3"><p id="hs-toast-normal-example-label" class="text-sm text-gray-700 dark:text-neutral-400">Processing...</p></div></div></div>'),Ze=w('<div class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100" role="alert" tabindex="-1" aria-labelledby="hs-toast-error-example-label"><div class="flex p-4"><div class="shrink-0"><svg class="shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path></svg></div> <div class="ms-3"><p id="hs-toast-error-example-label" class="text-sm text-gray-700 dark:text-neutral-400"> </p></div></div></div>'),$e=w('<div class="flex"><span class="text-lg text-cyan-600 dark:text-cyan-300"> </span></div>'),ea=w('<div class="inline-flex items-center"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span> <div class="px-2 text-gray-600 dark:text-neutral-400 text-wrap w-1/2"> </div></div>'),aa=w('<div class="inline-flex items-center"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span></span> <span class="px-2 text-gray-600 dark:text-neutral-400 font-bold">Online</span></div>'),ta=w('<div><div class="py-16 opacity-0 transition-opacity duration-500" id="formulation_form"><div class="px-16 flex flex-row justify-center items-center lg:justify-between"><div class="relative"><h3 class="text-blue-400 mb-1">Login!</h3> <h1 class="page-title text-white font-bold text-3xl mb-5 lg:text-3xl xl:text-4xl 2xl:text-5xl">KBVE Authentication Portal</h1> <!> <!> <!> <form id="loginForm" class="opacity-0 transition-opacity duration-500" action="#"><div class="grid gap-y-2 md:gap-y-4"><div><label for="login-email" class="mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Email Address</label> <div><input type="email" id="login-email" name="email" autocomplete="email" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="login-email"></div></div> <div><div class="flex items-center justify-between"><label for="login-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Password</label></div> <div><input type="password" id="login-password" name="password" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="login-password"></div></div> <div><div class="flex justify-center scale-75 md:scale-100"></div></div> <button type="submit"> </button></div></form></div> <div class="flex flex-col w-1/2"><div><!></div> <dotlottie-player></dotlottie-player></div></div></div></div>',2);function xa(me,n){Pe(n,!1);const m=Te(),p=()=>{v(x,!1),d(t,a(t).successful_message=""),a(f)&&a(g)&&a(y)&&hcaptcha.reset(a(y))},N=e=>{if(a(f)&&a(g)&&a(y))return hcaptcha.execute(a(y),e)},D=async()=>{if(v(x,!0),k=await z.createActionULID("loginUser"),!k){d(t,a(t).error_message="Failed to create action!"),p();return}try{const e=await z.loginUser(a(t).email,a(t).password,k,a(t).captchaToken);if(e){d(t,a(t).successful_message=`Welcome, ${e.username||e.email}! Login successful. Redirecting in 1 second`),console.log("User logined and profile saved:",e);const r=await z.getSupabaseClient()?.auth.getSession();r?(console.log("User is already logged in after registration:",r),setTimeout(()=>{window.location.href="/dashboard"},1e3)):setTimeout(()=>{window.location.href="/login#offline"},1e3);return}await G(k)}catch(e){console.error("Login failed:",e),await G(k),p()}finally{v(x,!1),p()}},G=async e=>{const r=await z.getErrorByActionId(e);r?d(t,a(t).error_message=r):d(t,a(t).error_message="An unexpected error occurred. Please try again.");const i=await z.getDetailedErrorByActionId(e);i?v(P,i):d(t,a(t).error_message="An unexpected error occurred. Please try again.")};let f=_(!1),g=_(!1),x=_(!1),pe="/holydance.lottie",y=_(),k,P=_(),H=h(n,"hl",8,""),J=h(n,"sitekey",24,()=>ve.get().hcaptcha),fe=h(n,"apihost",24,()=>ve.get().hcaptcha_api),ge=h(n,"reCaptchaCompat",8,!0),V=h(n,"theme",24,()=>Qe.DARK),W=h(n,"size",8,"compact"),t=_({email:"",password:"",captchaToken:"",actionId:"",error_message:"",successful_message:""});const xe=new URLSearchParams({recaptchacompat:ge()?"on":"off",onload:"hcaptchaOnLoad",render:"explicit"}),be=`${fe()}?${xe.toString()}`,Q=Math.floor(Math.random()*100),he="inline-flex w-full items-center justify-center gap-x-2 rounded-lg px-4 py-1 text-sm font-normal text-blue-400 focus-visible:ring outline-none transition duration-300 py-3",_e="border border-transparent",we="bg-blue-100 dark:focus:outline-none",ye="hover:bg-blue-400 hover:text-white",ke="2xl:text-base",Le="disabled:pointer-events-none disabled:opacity-50 disabled:animate-pulse",Ce="ring-zinc-500 dark:ring-zinc-200";je(()=>{We({elementIdOrName:"skeleton_login_loader",duration:500}),document.getElementById("astro_error_message")&&document.getElementById("astro_error_message");const e=document.getElementById("formulation_form");e&&setTimeout(()=>{e.classList.replace("opacity-0","opacity-100")},200);const r=document.getElementById("loginForm");r&&setTimeout(()=>{r.classList.replace("opacity-0","opacity-100")},500),window.hcaptchaOnLoad=()=>{m("load"),v(g,!0)},window.onSuccess=i=>{m("success",{token:i}),d(t,a(t).captchaToken=i)},window.onError=()=>{m("error")},window.onClose=()=>{m("close")},window.onExpired=()=>{m("expired"),p()},m("mount"),v(f,!0)}),Fe(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,a(g)&&(hcaptcha=null)}),Oe(()=>(a(f),a(g),S(J()),S(H()),S(V()),S(W())),()=>{a(f)&&a(g)&&v(y,hcaptcha.render(`h-captcha-${Q}`,{sitekey:J(),hl:H(),theme:V(),callback:"onSuccess","error-callback":"onError","close-callback":"onClose","expired-callback":"onExpired",size:W()}))}),Ue(),Ke();var T=ta();qe(e=>{var r=He(),i=ce(r);{var c=b=>{var B=Xe(),oe=ce(B);ne(oe,"src",be),o(oe),u(b,B)};C(i,b=>{a(f)&&!window?.hcaptcha&&b(c)})}u(e,r)});var X=s(T),Y=s(X),j=s(Y),Z=o(s(j),4);{var Ee=e=>{var r=Ye();u(e,r)};C(Z,e=>{a(x)&&e(Ee)})}var $=o(Z,2);{var ze=e=>{var r=Ze(),i=s(r),c=o(s(i),2),b=s(c),B=s(b,!0);l(b),l(c),l(i),l(r),I(()=>M(B,a(t).error_message)),u(e,r)};C($,e=>{a(t).error_message&&e(ze)})}var ee=o($,2);{var Ae=e=>{var r=$e(),i=s(r),c=s(i,!0);l(i),l(r),I(()=>M(c,a(t).successful_message)),u(e,r)};C(ee,e=>{a(t).successful_message&&e(Ae)})}var F=o(ee,2),ae=s(F),O=s(ae),te=o(s(O),2),re=s(te);ue(re),l(te),l(O);var U=o(O,2),se=o(s(U),2),le=s(se);ue(le),l(se),l(U);var K=o(U,2),Be=s(K);ne(Be,"id",`h-captcha-${Q??""}`),l(K);var A=o(K,2);Re(A,`${he} ${_e} ${we} ${ye} ${ke} ${Le} ${Ce}`);var Ie=s(A,!0);l(A),l(ae),l(F),l(j);var ie=o(j,2),q=s(ie),Se=s(q);{var Me=e=>{var r=ea(),i=o(s(r),2),c=s(i,!0);l(i),l(r),I(()=>M(c,a(P))),u(e,r)},De=e=>{var r=aa();u(e,r)};C(Se,e=>{a(P)?e(Me):e(De,!1)})}l(q);var L=o(q,2);return E(L,"autoplay",!0),E(L,"loop",!0),E(L,"class","hidden md:block md:w-full"),E(L,"mode","normal"),E(L,"src",`/assets/lottie/${pe}`),l(ie),l(Y),l(X),l(T),I(()=>{A.disabled=a(x),M(Ie,a(x)?"Loading...":"Login")}),de(re,()=>a(t).email,e=>d(t,a(t).email=e)),de(le,()=>a(t).password,e=>d(t,a(t).password=e)),Ne("submit",F,Ve(D)),u(me,T),R(n,"reset",p),R(n,"execute",N),R(n,"handleLogin",D),Ge({reset:p,execute:N,handleLogin:D})}export{xa as default};
