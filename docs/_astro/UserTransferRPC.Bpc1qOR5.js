import{r as u,j as e}from"./react.CvslfkeK.js";import{u as N}from"./react-hook-form.D5LhBzNo.js";import{t as w}from"./@hookform.DFFlZybA.js";import{z as n}from"./zod.D6aOmuMC.js";import{b as v,u as _,a as C}from"./userstate.YbDzCwxV.js";import{u as p}from"./@nanostores.BsSnFId4.js";import{t as d}from"./tailwind-merge.B9ugUrge.js";import"./@react-three.B-wTPXHf.js";import"./@supabase.d6fxE5ud.js";import"./Page.astro_astro_type_script_index_0_lang.Db7LHE3J.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";import"./nanostores.Bo9-_MAV.js";const f=n.object({to_user:n.string().uuid(),kind:n.enum(["credit","khash"]),amount:n.number().positive().max(1e6),reason:n.string().min(3).max(100),meta:n.record(n.any()).optional()});async function S(x){const a=f.safeParse(x);if(!a.success)return{error:a.error,data:null};const{to_user:t,kind:m,amount:s,reason:c,meta:o}=a.data,{data:b,error:l}=await v.rpc("transfer_balance_proxy",{p_to_user:t,p_kind:m,p_amount:s,p_reason:c,p_meta:o??{}});return{data:b,error:l}}const K=()=>{p(_),p(C);const[x,a]=u.useState(!1),[t,m]=u.useState(null),[s,c]=u.useState(""),[o,b]=u.useState(null),{register:l,handleSubmit:h,formState:{errors:r,isSubmitting:g},reset:k}=N({resolver:w(f),defaultValues:{kind:"credit"}}),y=i=>{m(i),a(!0)},j=async()=>{if(t&&s==="CONFIRM"){const i=await S(t);b(i),a(!1),c(""),k()}};return e.jsxs("div",{className:"max-w-md mx-auto p-6 rounded-2xl shadow-xl bg-gradient-to-br from-cyan-50/80 to-purple-50/60 dark:from-cyan-900/40 dark:to-purple-900/30 border border-cyan-200 dark:border-zinc-800 backdrop-blur-md bg-white/60 dark:bg-zinc-900/60",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-cyan-700 dark:text-cyan-200 drop-shadow",children:"Transfer Balance"}),e.jsxs("form",{onSubmit:h(y),className:"flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700 dark:text-neutral-200 mb-1",children:"Recipient User UUID"}),e.jsx("input",{...l("to_user"),placeholder:"Recipient User UUID",className:d("input input-bordered w-full bg-white/80 dark:bg-zinc-800/70 text-neutral-900 dark:text-neutral-100 border-cyan-300 dark:border-cyan-700 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 placeholder:text-neutral-400 dark:placeholder:text-neutral-500 px-4 py-2",r.to_user&&"border-red-400 focus:border-red-500")}),r.to_user&&e.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:r.to_user.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700 dark:text-neutral-200 mb-1",children:"Asset Type"}),e.jsxs("select",{...l("kind"),className:d("input input-bordered w-full bg-white/80 dark:bg-zinc-800/70 text-neutral-900 dark:text-neutral-100 border-cyan-300 dark:border-cyan-700 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 px-4 py-2",r.kind&&"border-red-400 focus:border-red-500"),children:[e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"khash",children:"KHash"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700 dark:text-neutral-200 mb-1",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",...l("amount",{valueAsNumber:!0}),placeholder:"Amount",className:d("input input-bordered w-full bg-white/80 dark:bg-zinc-800/70 text-neutral-900 dark:text-neutral-100 border-cyan-300 dark:border-cyan-700 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 placeholder:text-neutral-400 dark:placeholder:text-neutral-500 px-4 py-2",r.amount&&"border-red-400 focus:border-red-500")}),r.amount&&e.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:r.amount.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700 dark:text-neutral-200 mb-1",children:"Reason"}),e.jsx("input",{...l("reason"),placeholder:"Reason for transfer",className:d("input input-bordered w-full bg-white/80 dark:bg-zinc-800/70 text-neutral-900 dark:text-neutral-100 border-cyan-300 dark:border-cyan-700 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 placeholder:text-neutral-400 dark:placeholder:text-neutral-500 px-4 py-2",r.reason&&"border-red-400 focus:border-red-500")}),r.reason&&e.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:r.reason.message})]}),e.jsx("button",{type:"submit",className:d("btn btn-primary bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold py-2 rounded-lg shadow hover:from-cyan-600 hover:to-purple-600 transition-colors duration-200",g&&"opacity-50"),children:"Submit"})]}),o&&e.jsx("div",{className:"mt-4",children:o.error?e.jsxs("div",{className:"text-red-600 font-semibold bg-red-100 dark:bg-red-900/40 rounded-lg px-4 py-2",children:["Error: ",o.error.message||String(o.error)]}):e.jsx("div",{className:"text-green-700 font-semibold bg-green-100 dark:bg-green-900/40 rounded-lg px-4 py-2",children:"Transfer successful!"})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white/70 dark:bg-zinc-900/70 rounded-2xl p-8 shadow-2xl w-full max-w-sm flex flex-col items-center gap-5 border border-cyan-200 dark:border-zinc-800 backdrop-blur-lg",children:[e.jsx("h4",{className:"text-xl font-bold text-cyan-700 dark:text-cyan-200 mb-2",children:"Confirm Transfer"}),e.jsxs("div",{className:"text-base text-neutral-700 dark:text-neutral-200 mb-2 text-center",children:["Are you sure you want to send ",e.jsx("b",{className:"text-cyan-600 dark:text-cyan-300",children:t?.amount.toFixed(2)})," ",e.jsx("span",{className:"uppercase",children:t?.kind})," to ",e.jsx("b",{className:"text-purple-600 dark:text-purple-300",children:t?.to_user}),"?",e.jsx("br",{}),e.jsxs("span",{className:"italic text-sm text-neutral-500 dark:text-neutral-400",children:["Reason: ",t?.reason]})]}),e.jsx("input",{type:"text",placeholder:"Type CONFIRM to proceed",value:s,onChange:i=>c(i.target.value),className:"input input-bordered w-full text-center font-mono tracking-widest text-lg bg-white/80 dark:bg-zinc-800/70 text-neutral-900 dark:text-neutral-100 border-cyan-300 dark:border-cyan-700 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 placeholder:text-neutral-400 dark:placeholder:text-neutral-500 px-4 py-2"}),e.jsxs("div",{className:"flex gap-2 w-full mt-2",children:[e.jsx("button",{className:d("btn btn-primary flex-1 bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold py-2 rounded-lg shadow",s!=="CONFIRM"&&"opacity-50 pointer-events-none"),onClick:j,disabled:s!=="CONFIRM",children:"Confirm"}),e.jsx("button",{className:"btn btn-secondary flex-1 bg-neutral-200 dark:bg-zinc-800 text-neutral-700 dark:text-neutral-200 rounded-lg",onClick:()=>{a(!1),c("")},children:"Cancel"})]})]})})]})};export{K as default};
