import{i as j}from"./d3-transition.BipLP9ld.js";import{d as et}from"./d3-dispatch.kxCwF96_.js";import{e as nt}from"./d3-interpolate.SIV6RuuQ.js";import{s as X,p as x}from"./d3-selection.DSeOx27A.js";import{d as it,y as ot}from"./d3-drag.DP3CZ3aB.js";const P=t=>()=>t;function ut(t,{sourceEvent:n,target:e,transform:o,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function T(t,n,e){this.k=t,this.x=n,this.y=e}T.prototype={constructor:T,scale:function(t){return 1===t?this:new T(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new T(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var J=new T(1,0,0);function A(t){t.stopImmediatePropagation()}function I(t){t.preventDefault(),t.stopImmediatePropagation()}function rt(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function st(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function O(){return this.__zoom||J}function at(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ht(){return navigator.maxTouchPoints||"ontouchstart"in this}function ct(t,n,e){var o=t.invertX(n[0][0])-e[0][0],i=t.invertX(n[1][0])-e[1][0],u=t.invertY(n[0][1])-e[0][1],r=t.invertY(n[1][1])-e[1][1];return t.translate(i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i),r>u?(u+r)/2:Math.min(0,u)||Math.max(0,r))}function dt(){var t,n,e,o=rt,i=st,u=ct,r=at,s=ht,h=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],c=250,l=nt,f=et("start","zoom","end"),m=0,p=10;function v(t){t.property("__zoom",O).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",b).on("dblclick.zoom",M).filter(s).on("touchstart.zoom",E).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,n){return(n=Math.max(h[0],Math.min(h[1],n)))===t.k?t:new T(n,t.x,t.y)}function d(t,n,e){var o=n[0]-e[0]*t.k,i=n[1]-e[1]*t.k;return o===t.x&&i===t.y?t:new T(t.k,o,i)}function g(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function z(t,n,e,o){t.on("start.zoom",(function(){_(this,arguments).event(o).start()})).on("interrupt.zoom end.zoom",(function(){_(this,arguments).event(o).end()})).tween("zoom",(function(){var t=this,u=arguments,r=_(t,u).event(o),s=i.apply(t,u),h=null==e?g(s):"function"==typeof e?e.apply(t,u):e,a=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=t.__zoom,f="function"==typeof n?n.apply(t,u):n,m=l(c.invert(h).concat(a/c.k),f.invert(h).concat(a/f.k));return function(t){if(1===t)t=f;else{var n=m(t),e=a/n[2];t=new T(e,h[0]-n[0]*e,h[1]-n[1]*e)}r.zoom(null,t)}}))}function _(t,n,e){return!e&&t.__zooming||new k(t,n)}function k(t,n){this.that=t,this.args=n,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,n),this.taps=0}function w(t,...n){if(o.apply(this,arguments)){var e=_(this,n).event(t),i=this.__zoom,s=Math.max(h[0],Math.min(h[1],i.k*Math.pow(2,r.apply(this,arguments)))),c=x(t);if(e.wheel)(e.mouse[0][0]!==c[0]||e.mouse[0][1]!==c[1])&&(e.mouse[1]=i.invert(e.mouse[0]=c)),clearTimeout(e.wheel);else{if(i.k===s)return;e.mouse=[c,i.invert(c)],j(this),e.start()}I(t),e.wheel=setTimeout((function(){e.wheel=null,e.end()}),150),e.zoom("mouse",u(d(y(i,s),e.mouse[0],e.mouse[1]),e.extent,a))}}function b(t,...n){if(!e&&o.apply(this,arguments)){var i=t.currentTarget,r=_(this,n,!0).event(t),s=X(t.view).on("mousemove.zoom",(function(t){if(I(t),!r.moved){var n=t.clientX-c,e=t.clientY-l;r.moved=n*n+e*e>m}r.event(t).zoom("mouse",u(d(r.that.__zoom,r.mouse[0]=x(t,i),r.mouse[1]),r.extent,a))}),!0).on("mouseup.zoom",(function(t){s.on("mousemove.zoom mouseup.zoom",null),ot(t.view,r.moved),I(t),r.event(t).end()}),!0),h=x(t,i),c=t.clientX,l=t.clientY;it(t.view),A(t),r.mouse=[h,this.__zoom.invert(h)],j(this),r.start()}}function M(t,...n){if(o.apply(this,arguments)){var e=this.__zoom,r=x(t.changedTouches?t.changedTouches[0]:t,this),s=e.invert(r),h=e.k*(t.shiftKey?.5:2),l=u(d(y(e,h),r,s),i.apply(this,n),a);I(t),c>0?X(this).transition().duration(c).call(z,l,r,t):X(this).call(v.transform,l,r,t)}}function E(e,...i){if(o.apply(this,arguments)){var u,r,s,h,a=e.touches,c=a.length,l=_(this,i,e.changedTouches.length===c).event(e);for(A(e),r=0;r<c;++r)s=a[r],h=[h=x(s,this),this.__zoom.invert(h),s.identifier],l.touch0?!l.touch1&&l.touch0[2]!==h[2]&&(l.touch1=h,l.taps=0):(l.touch0=h,u=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),u&&(l.taps<2&&(n=h[0],t=setTimeout((function(){t=null}),500)),j(this),l.start())}}function Y(t,...n){if(this.__zooming){var e,o,i,r,s=_(this,n).event(t),h=t.changedTouches,c=h.length;for(I(t),e=0;e<c;++e)o=h[e],i=x(o,this),s.touch0&&s.touch0[2]===o.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===o.identifier&&(s.touch1[0]=i);if(o=s.that.__zoom,s.touch1){var l=s.touch0[0],f=s.touch0[1],m=s.touch1[0],p=s.touch1[1],v=(v=m[0]-l[0])*v+(v=m[1]-l[1])*v,g=(g=p[0]-f[0])*g+(g=p[1]-f[1])*g;o=y(o,Math.sqrt(v/g)),i=[(l[0]+m[0])/2,(l[1]+m[1])/2],r=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],r=s.touch0[1]}s.zoom("touch",u(d(o,i,r),s.extent,a))}}function B(t,...o){if(this.__zooming){var i,u,r=_(this,o).event(t),s=t.changedTouches,h=s.length;for(A(t),e&&clearTimeout(e),e=setTimeout((function(){e=null}),500),i=0;i<h;++i)u=s[i],r.touch0&&r.touch0[2]===u.identifier?delete r.touch0:r.touch1&&r.touch1[2]===u.identifier&&delete r.touch1;if(r.touch1&&!r.touch0&&(r.touch0=r.touch1,delete r.touch1),r.touch0)r.touch0[1]=this.__zoom.invert(r.touch0[0]);else if(r.end(),2===r.taps&&(u=x(u,this),Math.hypot(n[0]-u[0],n[1]-u[1])<p)){var a=X(this).on("dblclick.zoom");a&&a.apply(this,arguments)}}}return v.transform=function(t,n,e,o){var i=t.selection?t.selection():t;i.property("__zoom",O),t!==i?z(t,n,e,o):i.interrupt().each((function(){_(this,arguments).event(o).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()}))},v.scaleBy=function(t,n,e,o){v.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof n?n.apply(this,arguments):n)}),e,o)},v.scaleTo=function(t,n,e,o){v.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,r=null==e?g(t):"function"==typeof e?e.apply(this,arguments):e,s=o.invert(r),h="function"==typeof n?n.apply(this,arguments):n;return u(d(y(o,h),r,s),t,a)}),e,o)},v.translateBy=function(t,n,e,o){v.transform(t,(function(){return u(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof e?e.apply(this,arguments):e),i.apply(this,arguments),a)}),null,o)},v.translateTo=function(t,n,e,o,r){v.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,s=null==o?g(t):"function"==typeof o?o.apply(this,arguments):o;return u(J.translate(s[0],s[1]).scale(r.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof e?-e.apply(this,arguments):-e),t,a)}),o,r)},k.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var n=X(this.that).datum();f.call(t,this.that,new ut(t,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:f}),n)}},v.wheelDelta=function(t){return arguments.length?(r="function"==typeof t?t:P(+t),v):r},v.filter=function(t){return arguments.length?(o="function"==typeof t?t:P(!!t),v):o},v.touchable=function(t){return arguments.length?(s="function"==typeof t?t:P(!!t),v):s},v.extent=function(t){return arguments.length?(i="function"==typeof t?t:P([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),v):i},v.scaleExtent=function(t){return arguments.length?(h[0]=+t[0],h[1]=+t[1],v):[h[0],h[1]]},v.translateExtent=function(t){return arguments.length?(a[0][0]=+t[0][0],a[1][0]=+t[1][0],a[0][1]=+t[0][1],a[1][1]=+t[1][1],v):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},v.constrain=function(t){return arguments.length?(u=t,v):u},v.duration=function(t){return arguments.length?(c=+t,v):c},v.interpolate=function(t){return arguments.length?(l=t,v):l},v.on=function(){var t=f.on.apply(f,arguments);return t===f?v:t},v.clickDistance=function(t){return arguments.length?(m=(t=+t)*t,v):Math.sqrt(m)},v.tapDistance=function(t){return arguments.length?(p=+t,v):p},v}T.prototype;export{T,J as i,dt as z};