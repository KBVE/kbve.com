import{j as e}from"./jsx-runtime.CzgMDNMm.js";import{r as n}from"./index.DQ2WTIsS.js";import{e as u,$ as _,k as c}from"./npchandler.CsnXuAhR.js";import{u as E}from"./index.9YVhM4q0.js";import{t as v}from"./bundle-mjs.moIDn3jv.js";import{c as F}from"./clsx.B-dksMZM.js";import"./preload-helper.ygWHROA3.js";import"./index.CFX5TIQh.js";import"./index.BH1EYZ08.js";const z=()=>{const a=E(_),[h,o]=n.useState(!0),[m,s]=n.useState(null),[g,x]=n.useState(!1),[l,f]=n.useState({bio:a.bio||"",avatar_url:a.avatar_url||""});n.useEffect(()=>{f({bio:a.bio||"",avatar_url:a.avatar_url||""})},[a]);const j=/^[a-zA-Z0-9.!? ]*$/,N=/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,y=[{label:"Full Name:",value:a.fullName||"N/A"},{label:"Username:",value:a.username||"N/A"},{label:"Email:",value:a.email||"N/A"},{label:"User ID:",value:a.id||"N/A"},{label:"Last Updated:",value:a.updatedAt?a.updatedAt.toLocaleString():"N/A"},{label:"Bio:",value:a.bio||"No bio available"},{label:"Avatar URL:",value:a.avatar_url||"No avatar URL"}];n.useEffect(()=>{(async()=>{try{o(!0),await c.loadProfileFromSupabase()}catch(r){console.error("Failed to load profile:",r),s("Failed to load profile. Please try again later.")}finally{o(!1)}})()},[]),n.useEffect(()=>{const t=()=>{x(!0)};return u.on("openModal",t),()=>{u.off("openModal",t)}},[]);const k=()=>{u.emit("openModal",{message:"Edit Profile"})},b=()=>{x(!1)},p=t=>{const{name:r,value:i}=t.target;f(d=>({...d,[r]:i}))},w=()=>j.test(l.bio)?l.avatar_url&&!N.test(l.avatar_url)?(s("Invalid Avatar URL. Please enter a valid URL."),!1):(s(null),!0):(s("Bio contains invalid characters. Only letters, numbers, spaces, periods, !, and ? are allowed."),!1),U=async t=>{if(t.preventDefault(),o(!0),!w()){o(!1);return}try{const r=c.getSupabaseClient();if(!r){s("Failed to get a valid Supabase client instance.");return}const{data:i,error:d}=await r.from("user_profiles").update(l).eq("id",a.id).select();if(d||!i){s("Failed to update profile."),console.error("Error updating profile:",d);return}const P={actionId:await c.createActionULID("updateUserProfile"),updatedFields:{bio:l.bio,avatar_url:l.avatar_url},timestamp:new Date};await c.loadProfileFromSupabase(),console.log(`Profile updated successfully: ${JSON.stringify(i)}`)}catch(r){console.error("Failed to update profile:",r),s("Failed to update profile. Please try again later.")}finally{o(!1),b()}};return h?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("p",{className:"text-lg text-neutral-600 dark:text-neutral-200",children:"Loading profile..."})}):m?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("p",{className:"text-lg text-red-500 dark:text-red-400",children:m})}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-yellow-50/60 dark:bg-neutral-800 p-5",children:[e.jsxs("div",{className:v("bg-yellow-50 dark:bg-neutral-900 rounded-lg shadow-lg p-8 max-w-md w-full"),children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"User Avatar",className:v("w-24 h-24 rounded-full shadow-lg",F({"border-2 border-cyan-500":a.avatar_url}))}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 dark:bg-neutral-700 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-neutral-600 dark:text-neutral-200",children:"U"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-700 dark:text-neutral-100 mb-2",children:a.username||"Unknown User"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300 mb-4",children:a.email||"No email available"})]}),e.jsx("div",{className:"text-center",children:y.map((t,r)=>e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"font-bold text-neutral-600 dark:text-neutral-200",children:t.label})," ",e.jsx("span",{className:"text-neutral-800 dark:text-neutral-300",children:t.value})]},r))}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{className:"px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600 focus:outline-none",onClick:k,children:"Edit Profile"})})]}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-lg p-6 max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 dark:text-neutral-300 hover:text-gray-800 dark:hover:text-neutral-100",onClick:b,children:"Ã—"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-neutral-800 dark:text-neutral-200",children:"Edit Profile"}),e.jsx("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Update your profile details below."})]}),e.jsx("div",{className:"mt-5",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-neutral-600 dark:text-neutral-300",children:"Bio"}),e.jsx("textarea",{id:"bio",name:"bio",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-neutral-700 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 sm:text-sm dark:bg-neutral-900 dark:text-neutral-400",placeholder:"Tell us about yourself...",value:l.bio,onChange:p})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"avatar_url",className:"block text-sm font-medium text-neutral-600 dark:text-neutral-300",children:"Avatar URL"}),e.jsx("input",{id:"avatar_url",name:"avatar_url",type:"text",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-neutral-700 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 sm:text-sm dark:bg-neutral-900 dark:text-neutral-400",placeholder:"Enter a valid avatar URL",value:l.avatar_url,onChange:p})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"submit",className:"w-full py-2 px-4 bg-cyan-500 text-white rounded hover:bg-cyan-600 focus:outline-none",children:"Save Changes"})})]})})]})})]})};export{z as default};
