import{R as c,j as e}from"./react.CvslfkeK.js";import{u as w}from"./react-hook-form.xQQCzVAN.js";import{u as x}from"./@nanostores.J-Z5GVtw.js";import{s as j,u as N,a as p}from"./userstate.BmxGXF_9.js";import{s as U}from"./supabaseClient.DTT8oXd_.js";import"./@react-three.B-wTPXHf.js";import"./nanostores.Bo9-_MAV.js";import"./@supabase.BP5o7ebi.js";import"./Page.astro_astro_type_script_index_0_lang.DR_ybMHL.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";const b=/^[a-zA-Z0-9_-]{3,30}$/,O=()=>{const s=x(N),g=x(p),{register:f,handleSubmit:h,formState:{errors:n,isSubmitting:t},setError:o,setValue:S}=w(),[m,i]=c.useState(null);c.useEffect(()=>{j()},[]);const y=async a=>{if(i(null),!s){o("username",{type:"manual",message:"User not logged in."});return}try{const{data:v,error:u}=await U.functions.invoke("register-user",{body:{username:a.username}});u?o("username",{type:"manual",message:u.message||"Registration failed."}):(i("Username registered successfully!"),p.set(a.username))}catch{o("username",{type:"manual",message:"Network error."})}},d=a=>typeof a=="string"&&b.test(a),r=d(g)||d(s?.user_metadata?.username),l=s?.user_metadata?.avatar_url||s?.user_metadata?.picture||null;return e.jsxs("div",{className:"onboarding-card flex flex-col items-center gap-6 p-6 max-w-md mx-auto bg-white/80 dark:bg-zinc-900/80 border border-cyan-100 dark:border-zinc-800 shadow-xl rounded-2xl",children:[s&&e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&e.jsx("img",{src:l,alt:"User Avatar",className:"w-20 h-20 rounded-full border-4 border-cyan-400 shadow-md mb-2 bg-white object-cover"}),e.jsx("div",{className:"text-lg font-semibold text-zinc-800 dark:text-zinc-100",children:s.user_metadata?.display_name||s.email})]}),e.jsx("h2",{className:"text-2xl font-bold text-cyan-600 dark:text-cyan-300 mb-2 drop-shadow",children:r?"Update your username":"Choose your username"}),e.jsxs("form",{onSubmit:h(y),className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"text",...f("username",{required:"Username is required",pattern:{value:b,message:"3-30 chars, letters, numbers, _ or -"}}),placeholder:"Username",className:"border-2 border-cyan-200 dark:border-cyan-700 rounded-lg px-4 py-3 text-lg bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 shadow-sm transition",disabled:t||r}),n.username&&e.jsx("div",{className:"text-red-500 text-xs font-medium",children:n.username.message}),e.jsx("button",{type:"submit",className:"bg-gradient-to-br from-cyan-500 to-purple-500 text-white px-6 py-2 rounded-full font-bold shadow hover:from-cyan-400 hover:to-purple-400 hover:shadow-lg transition disabled:opacity-50 text-lg",disabled:t||r,children:r?"Username Set":t?"Registering...":"Register"})]}),m&&e.jsx("div",{className:"text-green-500 text-sm font-semibold",children:m}),r&&e.jsx("div",{className:"text-cyan-600 text-xs font-medium",children:"You are already onboarded."})]})};export{O as default};
