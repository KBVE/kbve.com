import{r as c,j as e}from"./react.CvslfkeK.js";import{u as n}from"./@nanostores.vmeSb_hF.js";import{b as j}from"./userstate.D-HOx8OE.js";import{supabase as g}from"./supabaseClient.BwbbkKqX.js";import{a as o}from"./nanostores.Bo9-_MAV.js";import{R as k,S as f,I as p,M as v}from"./lucide-react.BVhOvk1k.js";import"./@react-three.B-wTPXHf.js";import"./@supabase.aKZxS6oP.js";import"./Page.astro_astro_type_script_index_0_lang.CHoS6oJr.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";const l=o([]),d=o(!1),i=o(null),N=o(null);async function u(){d.set(!0),i.set(null);try{const{data:s,error:r}=await g.rpc("proxy_fetch_user_messages");r?(i.set(r.message||"Failed to fetch messages"),l.set([])):(l.set(s||[]),N.set(Date.now()))}catch(s){i.set(s.message||"Unknown error"),l.set([])}finally{d.set(!1)}}const w=[{key:"all",label:"All",icon:e.jsx(v,{size:18})},{key:"sent",label:"Sent",icon:e.jsx(f,{size:18})},{key:"received",label:"Received",icon:e.jsx(p,{size:18})}],D=()=>{const s=n(j),r=n(l),b=n(d),x=n(i),[a,h]=c.useState("all");c.useEffect(()=>{u()},[]);const m=c.useMemo(()=>a==="all"?r:a==="sent"?r.filter(t=>t.sender===s):a==="received"?r.filter(t=>t.receiver===s):r,[r,a,s]);return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[w.map(t=>e.jsxs("button",{className:`flex items-center gap-1 px-4 py-2 rounded-lg font-medium border transition ${a===t.key?"bg-cyan-600 text-white border-cyan-700":"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-200 border-neutral-300 dark:border-neutral-700 hover:bg-cyan-100 dark:hover:bg-cyan-900"}`,onClick:()=>h(t.key),children:[t.icon," ",t.label]},t.key)),e.jsx("button",{className:"ml-auto flex items-center gap-1 px-3 py-2 rounded-lg border border-cyan-400 text-cyan-700 dark:text-cyan-200 bg-cyan-50 dark:bg-cyan-900 hover:bg-cyan-100 dark:hover:bg-cyan-800 transition",onClick:u,title:"Refresh",children:e.jsx(k,{size:16})})]}),e.jsx("div",{className:"bg-white/80 dark:bg-neutral-900/80 rounded-xl shadow border border-neutral-200 dark:border-neutral-800 p-4 min-h-[300px] flex-1 overflow-y-auto",children:b?e.jsx("div",{className:"text-center text-neutral-500 dark:text-neutral-400 py-12",children:"Loading messages..."}):x?e.jsx("div",{className:"text-center text-red-500 py-12",children:x}):m.length===0?e.jsx("div",{className:"text-center text-neutral-500 dark:text-neutral-400 py-12",children:"No messages found."}):e.jsx("ul",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:m.map((t,y)=>e.jsxs("li",{className:"py-4 flex items-start gap-4",children:[e.jsx("span",{className:`mt-1 ${t.sender===s?"text-cyan-500":"text-yellow-500"}`,children:t.sender===s?e.jsx(f,{size:20}):e.jsx(p,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-neutral-800 dark:text-neutral-100",children:t.title}),e.jsx("span",{className:"text-xs text-neutral-400",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 mt-1",children:t.message}),e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:t.sender===s?e.jsxs(e.Fragment,{children:["To: ",e.jsx("span",{className:"font-medium",children:t.receiver_username||t.receiver})]}):e.jsxs(e.Fragment,{children:["From: ",e.jsx("span",{className:"font-medium",children:t.sender_username||t.sender})]})})]})]},t.id||y))})})]})};export{D as Mailbox};
