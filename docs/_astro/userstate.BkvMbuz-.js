import{p as a}from"./@nanostores.vmeSb_hF.js";import{supabase as r}from"./supabaseClient.DHLuOuBJ.js";import{a as o}from"./nanostores.Bo9-_MAV.js";const u=o(null),c=o(null),l=a("user:id",void 0),m=a("user:email",void 0),d=a("user:username",void 0),U=o(!0),b=o("");function f(e){return e?JSON.stringify(e):""}function g(e){return e?JSON.parse(e):void 0}const n=a("user:balance",void 0,{encode:f,decode:g});async function v(){const{data:e}=await r.auth.getUser();if(typeof window<"u"&&localStorage.getItem("isMember")===null&&localStorage.setItem("isMember","false"),e?.user){u.set(e.user),l.set(e.user.id??void 0),m.set(e.user.email??void 0);let t;if(t=e.user.user_metadata?.username,!t&&e.user.user_metadata?.custom_claims){const s=e.user.user_metadata.custom_claims;s.chain==="solana"&&s.address&&(t=s.address)}c.set(t??null),d.set(t),typeof window<"u"&&localStorage.setItem("isMember","true")}else u.set(null),l.set(void 0),m.set(void 0),c.set(null),d.set(void 0),typeof window<"u"&&localStorage.setItem("isMember","false")}async function w(e,t=!0){if(!e){n.set(void 0);return}const{data:s,error:i}=await r.rpc("get_user_balance_context",{p_identifier:e,use_cache:t});s&&s.length>0&&!i?n.set(s[0]):(console.error("[syncUserBalance] Failed to fetch balance:",i?.message),n.set(void 0))}async function A(e){const{data:t,error:s}=await r.rpc("proxy_get_username",{p_user_id:e});return s?(console.error("[getUsernameByUuid] Failed to fetch username:",s.message),null):t}async function B(e){const{data:t,error:s}=await r.rpc("proxy_get_uuid",{p_username:e});return s?(console.error("[getUuidByUsername] Failed to fetch UUID:",s.message),null):t}export{l as a,n as b,w as c,B as d,c as e,U as f,A as g,b as h,v as s,u};
