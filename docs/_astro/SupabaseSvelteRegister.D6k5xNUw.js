import{a as Oe,w as Fe,x,o as Ke,y as Ne,z as Ge,A as He,i as Je,t as _,B as Ve,C,D as ge,E as We,F as E,d as B,G as I,v as t,H as Qe,f as u,I as J,g as Xe,s as m,J as n,k as h,K as Ye,L as be,b as l,j as s,M as Ze,N as M,r as i,O as $e,P as R,q as P}from"./svelte.jL6egXml.js";import{C as et,r as tt}from"./loader.BzOCa5xs.js";import{K as xe,k as z}from"./npchandler.UIyRYcCY.js";import"./react.C2V1wh_4.js";import"./esm-env.rsSWfq8L.js";import"./@supabase.Bwp_VmKO.js";import"./@react-three.BOv1JqT7.js";import"./Page.astro_astro_type_script_index_0_lang.B3mxYo9S.js";import"./react-dom.BQuvmPqq.js";import"./scheduler.C323NY8X.js";import"./dexie.Db70IFYj.js";import"./@nanostores.4Ikc6yb_.js";import"./nanostores.Bo9-_MAV.js";import"./axios.Bw-gCGc_.js";var at=Ze("<script async defer><\/script><!---->",1),rt=_('<div class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100" role="alert" tabindex="-1" aria-labelledby="hs-toast-normal-example-label"><div class="flex p-4"><div class="shrink-0"><svg class="shrink-0 size-4 text-blue-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg></div> <div class="ms-3"><p id="hs-toast-normal-example-label" class="text-sm text-gray-700 dark:text-neutral-400">Processing...</p></div></div></div>'),st=_('<div class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100" role="alert" tabindex="-1" aria-labelledby="hs-toast-error-example-label"><div class="flex p-4"><div class="shrink-0"><svg class="shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path></svg></div> <div class="ms-3"><p id="hs-toast-error-example-label" class="text-sm text-gray-700 dark:text-neutral-400"> </p></div></div></div>'),it=_('<div class="flex"><span class="text-lg text-cyan-600 dark:text-cyan-300"> </span></div>'),lt=_('<div class="inline-flex items-center"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span> <div class="px-2 text-gray-600 dark:text-neutral-400 text-wrap w-1/2"> </div></div>'),ot=_('<div class="inline-flex items-center"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span></span> <span class="px-2 text-gray-600 dark:text-neutral-400 font-bold">Online</span></div>'),nt=_('<div><div class="py-16 opacity-0 transition-opacity duration-500" id="formulation_form"><div class="px-16 flex flex-row justify-center items-center lg:justify-between"><div class="relative"><h3 class="text-blue-400 mb-1">Sign up</h3> <h1 class="page-title text-white font-bold text-3xl mb-5 lg:text-3xl xl:text-4xl 2xl:text-5xl">KBVE Authentication Portal</h1> <!> <!> <!> <form id="registerForm" class="opacity-0 transition-opacity duration-500" action="#"><div class="grid gap-y-2 md:gap-y-4"><div><label for="login-username" class="mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Username</label> <div><input type="text" id="register-username" name="username" autocomplete="username" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="register-username"></div></div> <div><label for="register-email" class="mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Email Address</label> <div><input type="email" id="register-email" name="email" autocomplete="email" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="register-email"></div></div> <div><div class="flex items-center justify-between"><label for="register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Password</label></div> <div><input type="password" id="register-password" name="password" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="register-password"></div></div> <div><div class="flex items-center justify-between"><label for="confirm-register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Confirm Password</label></div> <div><input type="password" id="confirm-register-password" name="password" class="block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1" required aria-describedby="confirm-register-password"></div></div> <div><div class="flex justify-center scale-75 md:scale-100"></div></div> <button type="submit"> </button></div></form></div> <div class="flex flex-col w-1/2"><div><!></div> <dotlottie-player></dotlottie-player></div></div></div></div>',2);function kt(he,d){Oe(d,!1);const v=Fe(),L=()=>{m(g,!1),n(a,t(a).successful_message=""),t(p)&&t(f)&&t(w)&&hcaptcha.reset(t(w))},V=e=>{if(t(p)&&t(f)&&t(w))return hcaptcha.execute(t(w),e)},D=async()=>{if(m(g,!0),y=await z.createActionULID("registerUser"),!y){n(a,t(a).svelte_internal_message="Failed to create action!"),L();return}try{const e=await z.registerUser(t(a).email,t(a).password,t(a).confirm,y,t(a).username,t(a).captchaToken);if(e){n(a,t(a).successful_message=`Welcome, ${e.username||e.email}! Registration successful. Redirecting in 2 Seconds`),console.log("User registered and profile saved:",e);const r=await z.getSession();r?(console.log("User is already logged in after registration:",r),setTimeout(()=>{window.location.href="/dashboard"},1500)):setTimeout(()=>{window.location.href="/login"},1500);return}await W(y)}catch(e){console.error("Registration failed:",e),await W(y)}finally{m(g,!1)}},W=async e=>{const r=await z.getErrorByActionId(e);r?n(a,t(a).svelte_internal_message=r):n(a,t(a).svelte_internal_message="An unexpected error occurred. Please try again.");const o=await z.getDetailedErrorByActionId(e);o?m(T,o):n(a,t(a).svelte_internal_message="An unexpected error occurred. Please try again.")};let p=h(!1),f=h(!1),g=h(!1),_e="/robot.lottie",w=h(),y,T=h(),Q=x(d,"hl",8,""),X=x(d,"sitekey",24,()=>xe.get().hcaptcha),we=x(d,"apihost",24,()=>xe.get().hcaptcha_api),ye=x(d,"reCaptchaCompat",8,!0),Y=x(d,"theme",24,()=>et.DARK),Z=x(d,"size",8,"compact"),a=h({email:"",password:"",confirm:"",username:"",captchaToken:"",svelte_internal_message:"",successful_message:""});const ke=new URLSearchParams({recaptchacompat:ye()?"on":"off",onload:"hcaptchaOnLoad",render:"explicit"}),Ce=`${we()}?${ke.toString()}`,$=Math.floor(Math.random()*100),Ee="inline-flex w-full items-center justify-center gap-x-2 rounded-lg px-4 py-1 text-sm font-normal text-blue-400 focus-visible:ring outline-none transition duration-300 py-3",ze="border border-transparent",Le="bg-blue-100 dark:focus:outline-none",Se="hover:bg-blue-400 hover:text-white",Ae="2xl:text-base",Be="disabled:pointer-events-none disabled:opacity-50 disabled:animate-pulse",Ie="ring-zinc-500 dark:ring-zinc-200";Ke(()=>{tt({elementIdOrName:"skeleton_login_loader",duration:500}),document.getElementById("astro_error_message")&&document.getElementById("astro_error_message");const e=document.getElementById("formulation_form");e&&setTimeout(()=>{e.classList.replace("opacity-0","opacity-100")},200);const r=document.getElementById("registerForm");r&&setTimeout(()=>{r.classList.replace("opacity-0","opacity-100")},500),window.hcaptchaOnLoad=()=>{v("load"),m(f,!0)},window.onSuccess=o=>{v("success",{token:o}),n(a,t(a).captchaToken=o)},window.onError=()=>{v("error")},window.onClose=()=>{v("close")},window.onExpired=()=>{v("expired"),L()},v("mount"),m(p,!0)}),Ne(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,t(f)&&(hcaptcha=null)}),Ge(()=>(t(p),t(f),R(X()),R(Q()),R(Y()),R(Z())),()=>{t(p)&&t(f)&&m(w,hcaptcha.render(`h-captcha-${$}`,{sitekey:X(),hl:Q(),theme:Y(),callback:"onSuccess","error-callback":"onError","close-callback":"onClose","expired-callback":"onExpired",size:Z()}))}),He(),Je();var j=nt();Ve(e=>{var r=Ye(),o=be(r);{var c=b=>{var A=at(),fe=be(A);ge(fe,"src",Ce),l(fe),u(b,A)};C(o,b=>{t(p)&&!window?.hcaptcha&&b(c)})}u(e,r)});var ee=s(j),te=s(ee),U=s(te),ae=l(s(U),4);{var Me=e=>{var r=rt();u(e,r)};C(ae,e=>{t(g)&&e(Me)})}var re=l(ae,2);{var Re=e=>{var r=st(),o=s(r),c=l(s(o),2),b=s(c),A=s(b,!0);i(b),i(c),i(o),i(r),B(()=>P(A,t(a).svelte_internal_message)),u(e,r)};C(re,e=>{t(a).svelte_internal_message&&e(Re)})}var se=l(re,2);{var Pe=e=>{var r=it(),o=s(r),c=s(o,!0);i(o),i(r),B(()=>P(c,t(a).successful_message)),u(e,r)};C(se,e=>{t(a).successful_message&&e(Pe)})}var q=l(se,2),ie=s(q),O=s(ie),le=l(s(O),2),oe=s(le);M(oe),i(le),i(O);var F=l(O,2),ne=l(s(F),2),de=s(ne);M(de),i(ne),i(F);var K=l(F,2),ce=l(s(K),2),ue=s(ce);M(ue),i(ce),i(K);var N=l(K,2),me=l(s(N),2),ve=s(me);M(ve),i(me),i(N);var G=l(N,2),De=s(G);ge(De,"id",`h-captcha-${$??""}`),i(G);var S=l(G,2);We(S,`${Ee} ${ze} ${Le} ${Se} ${Ae} ${Be} ${Ie}`);var Te=s(S,!0);i(S),i(ie),i(q),i(U);var pe=l(U,2),H=s(pe),je=s(H);{var Ue=e=>{var r=lt(),o=l(s(r),2),c=s(o,!0);i(o),i(r),B(()=>P(c,t(T))),u(e,r)},qe=e=>{var r=ot();u(e,r)};C(je,e=>{t(T)?e(Ue):e(qe,!1)})}i(H);var k=l(H,2);return E(k,"autoplay",!0),E(k,"loop",!0),E(k,"class","hidden md:block md:w-full"),E(k,"mode","normal"),E(k,"src",`/assets/lottie/${_e}`),i(pe),i(te),i(ee),i(j),B(()=>{S.disabled=t(g),P(Te,t(g)?"Loading...":"Register")}),I(oe,()=>t(a).username,e=>n(a,t(a).username=e)),I(de,()=>t(a).email,e=>n(a,t(a).email=e)),I(ue,()=>t(a).password,e=>n(a,t(a).password=e)),I(ve,()=>t(a).confirm,e=>n(a,t(a).confirm=e)),Qe("submit",q,$e(D)),u(he,j),J(d,"reset",L),J(d,"execute",V),J(d,"handleRegister",D),Xe({reset:L,execute:V,handleRegister:D})}export{kt as default};
