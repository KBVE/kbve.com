import{r as y}from"./react.CvslfkeK.js";import{l as w,o as g,a as m,m as K}from"./nanostores.Bo9-_MAV.js";let L=(e,r)=>s=>{e.current!==s&&(e.current=s,r())};function M(e,{keys:r,deps:s=[e,r]}={}){let f=y.useRef();f.current=e.get();let c=y.useCallback(o=>(L(f,o)(e.value),r?.length>0?w(e,r,L(f,o)):e.listen(L(f,o))),s),n=()=>f.current;return y.useSyncExternalStore(c,n,n)}let E=e=>e,u={},d={addEventListener(){},removeEventListener(){}};function h(){try{return typeof localStorage<"u"}catch{return!1}}h()&&(u=localStorage);let S={addEventListener(e,r,s){window.addEventListener("storage",r),window.addEventListener("pageshow",s)},removeEventListener(e,r,s){window.removeEventListener("storage",r),window.removeEventListener("pageshow",s)}};typeof window<"u"&&(d=S);function W(e,r=void 0,s={}){let f=s.encode||E,c=s.decode||E,n=m(r),o=n.set;n.set=i=>{typeof i>"u"?delete u[e]:u[e]=f(i),o(i)};function v(i){i.key===e?i.newValue===null?o(void 0):o(c(i.newValue)):u[e]||o(void 0)}function a(){n.set(u[e]?c(u[e]):r)}return g(n,()=>{if(a(),s.listen!==!1)return d.addEventListener(e,v,a),()=>{d.removeEventListener(e,v,a)}}),n}function b(e,r={},s={}){let f=s.encode||E,c=s.decode||E,n=K(),o=n.setKey;n.setKey=(t,l)=>{typeof l>"u"?(s.listen!==!1&&d.perKey&&d.removeEventListener(e+t,a,i),delete u[e+t]):(s.listen!==!1&&d.perKey&&!(t in n.value)&&d.addEventListener(e+t,a,i),u[e+t]=f(l)),o(t,l)};let v=n.set;n.set=function(t){for(let l in t)n.setKey(l,t[l]);for(let l in n.value)l in t||n.setKey(l)};function a(t){t.key?t.key.startsWith(e)&&(t.newValue===null?o(t.key.slice(e.length),void 0):o(t.key.slice(e.length),c(t.newValue))):v({})}function i(){let t={...r};for(let l in u)l.startsWith(e)&&(t[l.slice(e.length)]=c(u[l]));n.set(t)}return g(n,()=>{if(i(),s.listen!==!1)return d.addEventListener(e,a,i),()=>{d.removeEventListener(e,a,i);for(let t in n.value)d.removeEventListener(e+t,a,i)}}),n}export{b as a,W as p,M as u};
