import{R as V,j as e,r as s}from"./react.CvslfkeK.js";import{H as _}from"./@hcaptcha.BS9qM8Gp.js";import{u as m}from"./@nanostores.vmeSb_hF.js";import{u as O}from"./react-hook-form.D5LhBzNo.js";import{t as K}from"./tailwind-merge.B9ugUrge.js";import{c as z}from"./clsx.B-dksMZM.js";import{a as h}from"./nanostores.Bo9-_MAV.js";import{supabase as U}from"./supabaseClient.DHLuOuBJ.js";import{s as Y,a as $,S as J}from"./OAuthSignIn.BZDZQpeu.js";import"./@react-three.B-wTPXHf.js";import"./@babel.iCE8PrbV.js";import"./@supabase.BaC4PoEe.js";import"./Page.astro_astro_type_script_index_0_lang.CN1x5Qj8.js";import"./react-dom.DDrfKqI3.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";const S=h(""),E=h(""),f=h(""),w=h(""),j=h(!1),I=h(null);async function Q(){const n=S.get(),i=E.get(),o=I.get();if(f.set(""),w.set(""),!n||!i){f.set("Email and password are required.");return}if(!o){f.set("Please complete the hCaptcha challenge.");return}j.set(!0);try{const{data:a,error:l}=await U.auth.signInWithPassword({email:n,password:i,options:{captchaToken:o}});if(l)throw l;w.set("Login successful! Redirecting..."),setTimeout(()=>{window.location.href="https://kbve.com/profile/"},1500)}catch(a){f.set(a.message||"Login failed.")}finally{j.set(!1)}}const X="e19cf4a6-2168-49a2-88fe-716e97569e88",ee=()=>{const n=document.querySelector('[data-skeleton="login"]');n&&(n.style.display="none")},te=V.memo(({open:n,loading:i,error:o,success:a,onClose:l})=>n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:`bg-neutral-900 text-white rounded-xl shadow-lg p-8 max-w-sm w-full flex flex-col items-center relative
        border border-neutral-700/50 backdrop-blur-md`,children:[i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-cyan-400 mb-4"}),e.jsx("div",{className:"text-lg font-semibold mb-2",children:"Logging inâ€¦"})]}),!i&&(o||a)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:z("text-lg font-semibold mb-2",o?"text-red-400":"text-green-400"),children:o||a}),e.jsx("button",{onClick:l,className:`mt-4 px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white font-bold shadow-lg
                transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2`,children:"Close"})]})]})}):null),be=()=>{const n=m(S),i=m(E),o=m(f),a=m(w),l=m(j),r=m(I),T=t=>S.set(t),A=t=>E.set(t),p=t=>f.set(t),M=t=>w.set(t),v=t=>j.set(t),x=t=>I.set(t),{handleSubmit:L,register:P,formState:{errors:d},setValue:g}=O({defaultValues:{email:n,password:i}}),[F,y]=s.useState(!1),[b,N]=s.useState(!1),[C,k]=s.useState(null),u=s.useRef(null);s.useEffect(()=>{ee()},[]);const R=s.useCallback(async t=>{if(p(""),M(""),y(!0),!r){p("Please complete the hCaptcha challenge."),y(!1);return}v(!0);try{await Q(),u.current&&(u.current.resetCaptcha(),x(null))}catch(c){p(c.message||"Login failed."),u.current&&(u.current.resetCaptcha(),x(null))}finally{v(!1)}},[r,p,M,v,x]),q=s.useCallback(()=>{y(!1)},[]),H=s.useCallback(()=>{Y()},[]),D=s.useCallback(()=>{$()},[]),W=s.useCallback(t=>{const c=t.target.value;T(c),g("email",c)},[T,g]),Z=s.useCallback(t=>{const c=t.target.value;A(c),g("password",c)},[A,g]),B=s.useCallback(()=>{r||(N(!0),C&&(clearTimeout(C),k(null)))},[r,C]),G=s.useCallback(()=>{if(!r){const t=setTimeout(()=>{N(!1)},1e3);k(t)}},[r,b]);return s.useEffect(()=>{if(r&&b){const t=setTimeout(()=>{N(!1)},1500);return k(t),()=>{clearTimeout(t)}}},[r,b]),e.jsxs(e.Fragment,{children:[e.jsx(te,{open:F,loading:l,error:o,success:a,onClose:q}),e.jsxs("div",{className:"flex flex-col gap-3 mb-8",children:[e.jsxs("button",{onClick:H,className:`flex items-center justify-center gap-3 w-full py-3 px-4 rounded-xl 
            bg-zinc-900 hover:bg-zinc-800 text-white font-semibold shadow-lg 
            border border-zinc-700/50 hover:border-zinc-600/50
            transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2`,children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 .5C5.73.5.5 5.74.5 12.02c0 5.1 3.29 9.43 7.86 10.96.58.11.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.53-1.34-1.3-1.7-1.3-1.7-1.06-.72.08-.71.08-.71 1.17.08 1.78 1.2 1.78 1.2 1.04 1.78 2.73 1.27 3.4.97.11-.75.41-1.27.74-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.29 1.19-3.1-.12-.29-.52-1.46.11-3.05 0 0 .97-.31 3.18 1.18a11.1 11.1 0 0 1 2.9-.39c.98 0 1.97.13 2.9.39 2.2-1.49 3.17-1.18 3.17-1.18.63 1.59.23 2.76.11 3.05.74.81 1.19 1.84 1.19 3.1 0 4.43-2.69 5.41-5.25 5.7.42.36.79 1.09.79 2.2 0 1.59-.01 2.87-.01 3.26 0 .31.21.68.8.56C20.71 21.45 24 17.12 24 12.02 24 5.74 18.27.5 12 .5z"})}),"Continue with GitHub"]}),e.jsxs("button",{onClick:D,className:`flex items-center justify-center gap-3 w-full py-3 px-4 rounded-xl 
            bg-[#5865F2] hover:bg-[#4752c4] text-white font-semibold shadow-lg 
            border border-[#5865F2]/50 hover:border-[#4752c4]/50
            transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#5865F2] focus:ring-offset-2`,children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20.317 4.3698a19.7913 19.7913 0 0 0-4.8851-1.5152.0741.0741 0 0 0-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 0 0-.0785-.037 19.7363 19.7363 0 0 0-4.8852 1.515.0699.0699 0 0 0-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 0 0 .0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 0 0 .0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 0 0-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 0 1-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 0 1 .0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 0 1 .0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 0 1-.0066.1276c-.598.3428-1.2205.6447-1.8733.8923a.0766.0766 0 0 0-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 0 0 .0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 0 0 .0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 0 0-.0312-.0286zM8.02 15.3312c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"})}),"Continue with Discord"]}),e.jsx(J,{captchaToken:r,captchaRef:u})]}),e.jsxs("div",{className:"flex items-center my-8",children:[e.jsx("div",{className:"flex-1 h-px bg-zinc-600"}),e.jsx("span",{className:"px-4 text-sm text-zinc-400 font-medium",children:"or"}),e.jsx("div",{className:"flex-1 h-px bg-zinc-600"})]}),e.jsxs("form",{onSubmit:L(R),className:"login-form flex flex-col gap-5",style:{maxWidth:400,margin:"0 auto"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Sign in with Email"}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Enter your credentials to access your account"})]}),o&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-center text-sm",children:o}),a&&e.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-400 text-center text-sm",children:a}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300",children:"Email Address"}),e.jsx("input",{type:"email",...P("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),value:n,onChange:W,className:z("block w-full rounded-lg border px-4 py-3 bg-zinc-800/50 text-white placeholder-zinc-400","focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent","transition-all duration-200",d.email?"border-red-500 focus:ring-red-500":"border-zinc-600 hover:border-zinc-500"),placeholder:"Enter your email"}),d.email&&e.jsx("span",{className:"text-red-400 text-sm",children:d.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300",children:"Password"}),e.jsx("input",{type:"password",...P("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),value:i,onChange:Z,className:z("block w-full rounded-lg border px-4 py-3 bg-zinc-800/50 text-white placeholder-zinc-400","focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent","transition-all duration-200",d.password?"border-red-500 focus:ring-red-500":"border-zinc-600 hover:border-zinc-500"),placeholder:"Enter your password"}),d.password&&e.jsx("span",{className:"text-red-400 text-sm",children:d.password.message})]}),e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(_,{ref:u,sitekey:X,onVerify:x,onExpire:()=>x(null),theme:"dark"})}),e.jsxs("div",{className:"relative",onMouseEnter:B,onMouseLeave:G,children:[e.jsx("button",{type:"submit",disabled:l||!r,className:K("w-full py-3 px-4 rounded-lg font-semibold text-white shadow-lg","bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-400 hover:to-purple-400","focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2","transition-all duration-200 transform active:scale-[0.98]",(l||!r)&&"opacity-60 cursor-not-allowed hover:from-cyan-500 hover:to-purple-500"),children:l?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Signing in..."]}):"Sign In"}),b&&!r&&e.jsxs("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 
              bg-red-600 text-white text-sm rounded-lg shadow-lg z-50 whitespace-nowrap
              pointer-events-none`,children:["Please complete the captcha to continue",e.jsx("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 
                border-l-4 border-r-4 border-t-4 border-transparent border-t-red-600`})]})]}),e.jsxs("div",{className:"text-center space-y-2 pt-4 border-t border-zinc-700/50",children:[e.jsxs("p",{className:"text-zinc-400 text-sm",children:["Don't have an account?"," ",e.jsx("a",{href:"/register",className:"text-cyan-400 hover:text-cyan-300 font-medium transition-colors duration-200",children:"Create one here"})]}),e.jsx("p",{className:"text-zinc-500 text-sm",children:e.jsx("a",{href:"/reset",className:"hover:text-zinc-400 transition-colors duration-200",children:"Forgot your password?"})})]})]})]})};export{be as Login};
