import{S as X,i as Z,s as ee,e as g,a as S,t as A,A as te,b,f as d,c as x,g as H,d as C,h as F,j as p,l as k,k as _,n as L,q,C as oe,r as se,u as Y,w as ae,B as ie,D as z,o as le}from"./index.DZiq8zhp.js";import{g as ne}from"./globals.D0QH3NT1.js";import{e as K}from"./each.-gASlQSi.js";import{t as B,m as G,u as ce}from"./khashvault.6hCPxH2k.js";import"./index.B59itue1.js";import"./index.BH1EYZ08.js";const{document:Q}=ne;function R(s,a,r){const i=s.slice();return i[19]=a[r],i}function W(s){let a,r=s[19]+"",i,m,h,f;function y(){return s[5](s[19])}return{c(){a=g("button"),i=A(r),m=S(),this.h()},l(n){a=b(n,"BUTTON",{class:!0});var l=C(a);i=F(l,r),m=x(l),l.forEach(d),this.h()},h(){p(a,"class","px-3 py-1 text-sm font-medium rounded-md"),z(a,"opacity-100",s[2][s[19]]),z(a,"opacity-50",!s[2][s[19]])},m(n,l){_(n,a,l),k(a,i),k(a,m),h||(f=L(a,"click",y),h=!0)},p(n,l){s=n,l&4&&r!==(r=s[19]+"")&&le(i,r),l&4&&z(a,"opacity-100",s[2][s[19]]),l&4&&z(a,"opacity-50",!s[2][s[19]])},d(n){n&&d(a),h=!1,f()}}}function re(s){let a,r,i,m="Sync",h,f,y,n,l,O,w,D,v,T,j,V,u,I=`<p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a
		web browser that
		<a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>`,P,N,E=K(Object.keys(s[2])),e=[];for(let t=0;t<E.length;t+=1)e[t]=W(R(s,E,t));return{c(){a=g("link"),r=S(),i=g("button"),i.textContent=m,h=S(),f=g("div");for(let t=0;t<e.length;t+=1)e[t].c();y=S(),n=g("div"),l=g("button"),O=A("Play Tracks"),D=S(),v=g("button"),T=A("Play Sets"),V=S(),u=g("video"),u.innerHTML=I,this.h()},l(t){const o=te("svelte-1mim58",Q.head);a=b(o,"LINK",{href:!0,rel:!0}),o.forEach(d),r=x(t),i=b(t,"BUTTON",{class:!0,"data-svelte-h":!0}),H(i)!=="svelte-7o0nad"&&(i.textContent=m),h=x(t),f=b(t,"DIV",{class:!0});var c=C(f);for(let $=0;$<e.length;$+=1)e[$].l(c);c.forEach(d),y=x(t),n=b(t,"DIV",{class:!0});var M=C(n);l=b(M,"BUTTON",{class:!0});var J=C(l);O=F(J,"Play Tracks"),J.forEach(d),D=x(M),v=b(M,"BUTTON",{class:!0});var U=C(v);T=F(U,"Play Sets"),U.forEach(d),M.forEach(d),V=x(t),u=b(t,"VIDEO",{id:!0,class:!0,preload:!0,width:!0,height:!0,"data-svelte-h":!0}),H(u)!=="svelte-1ovdrwl"&&(u.innerHTML=I),this.h()},h(){p(a,"href","https://unpkg.com/video.js/dist/video-js.min.css"),p(a,"rel","stylesheet"),p(i,"class","px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"),p(f,"class","space-x-2"),p(l,"class",w="px-3 py-1 text-sm font-medium rounded-md "+(s[0]?"opacity-100":"opacity-50")),p(v,"class",j="px-3 py-1 text-sm font-medium rounded-md "+(s[1]?"opacity-100":"opacity-50")),p(n,"class","space-x-2 my-4"),p(u,"id","video-js"),p(u,"class","video-js vjs-default-skin w-full aspect-video"),u.controls=!0,p(u,"preload","auto"),p(u,"width","640"),p(u,"height","264")},m(t,o){k(Q.head,a),_(t,r,o),_(t,i,o),_(t,h,o),_(t,f,o);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(f,null);_(t,y,o),_(t,n,o),k(n,l),k(l,O),k(n,D),k(n,v),k(v,T),_(t,V,o),_(t,u,o),P||(N=[L(i,"click",s[4]),L(l,"click",s[6]),L(v,"click",s[7])],P=!0)},p(t,[o]){if(o&12){E=K(Object.keys(t[2]));let c;for(c=0;c<E.length;c+=1){const M=R(t,E,c);e[c]?e[c].p(M,o):(e[c]=W(M),e[c].c(),e[c].m(f,null))}for(;c<e.length;c+=1)e[c].d(1);e.length=E.length}o&1&&w!==(w="px-3 py-1 text-sm font-medium rounded-md "+(t[0]?"opacity-100":"opacity-50"))&&p(l,"class",w),o&2&&j!==(j="px-3 py-1 text-sm font-medium rounded-md "+(t[1]?"opacity-100":"opacity-50"))&&p(v,"class",j)},i:q,o:q,d(t){t&&(d(r),d(i),d(h),d(f),d(y),d(n),d(V),d(u)),d(a),oe(e,t),P=!1,se(N)}}}function ue(s,a,r){let i,m;Y(s,B,e=>r(2,i=e)),Y(s,G,e=>r(11,m=e));let h,f=!1,y=!1,n=!0,l=!1;ae(()=>{y=!0,console.log("Mounted"),O().then(()=>{y&&f&&v()})}),ie(()=>{y=!1,h&&h.dispose()});async function O(){try{await new Promise((e,t)=>{const o=document.createElement("script");o.src="https://unpkg.com/video.js/dist/video.min.js",o.onload=e,o.onerror=()=>t(new Error("Failed to load Video.js")),document.head.appendChild(o)}),await new Promise((e,t)=>{const o=document.createElement("script");o.src="https://unpkg.com/videojs-youtube/dist/Youtube.min.js",o.onload=e,o.onerror=()=>t(new Error("Failed to load YouTube plugin")),document.head.appendChild(o)}),f=!0}catch(e){console.error("Error loading scripts:",e)}}async function w(){ce.then(()=>{console.log("Music data has been successfully updated.")}).catch(e=>{console.error("Error updating music data:",e)})}function D(){const e={};m.items.forEach(t=>{t.tags.forEach(o=>{o!=="music"&&(e[o]=!0)})}),B.set(e)}async function v(){if(m.items.length===0)try{await w(),console.log("Music Data Loaded:",m.items)}catch(e){console.error("Failed to fetch music data:",e);return}Object.keys(i).length===0?(console.log("Initializing tags from music data..."),D()):console.log("Tags already initialized:",i),T()}function T(){if(typeof videojs<"u"&&videojs.getTech("youtube")){const e=j();if(e.length===0)return;const t=Math.floor(Math.random()*e.length),o=e[t];h=videojs("video-js",{techOrder:["youtube"],sources:[{type:"video/youtube",src:`https://www.youtube.com/watch?v=${o}`}],youtube:{iv_load_policy:3},controls:!0,autoplay:!0,preload:"auto"}),h.on("ended",V)}else setTimeout(T,100)}function j(){let e=[];return m.items.forEach(t=>{t.tags.some(c=>i[c]===!0)&&(n&&(e=e.concat(t.ytTracks)),l&&(e=e.concat(t.ytSets)))}),e}function V(){const e=j();if(e.length===0)return;const t=e[Math.floor(Math.random()*e.length)];h.src({type:"video/youtube",src:`https://www.youtube.com/watch?v=${t}`}),h.play()}function u(e){const t={...i,[e]:!i[e]};B.set(t)}async function I(){G.set({items:[]}),B.set({});try{await w(),D(),T(),console.log("Data and tags have been synchronized.")}catch(e){console.error("Error during synchronization:",e)}}return[n,l,i,u,I,e=>u(e),()=>r(0,n=!n),()=>r(1,l=!l)]}class ve extends X{constructor(a){super(),Z(this,a,ue,re,ee,{})}}export{ve as default};
