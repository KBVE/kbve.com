import{a as se,I as ie,J as re,i as ne,t as D,K as ce,L as de,e as le,d as K,g as r,k as E,n as ue,o as pe,q as n,z as H,j as a,E as v,M as g,A as J,r as M,w as b,y as fe,s as Q,F as d}from"./svelte.CmoN8JrY.js";import{p as x,a as ye}from"./@nanostores.CPtJN9Fh.js";import{t as me}from"./nanostores.qAfxXu-z.js";import"./esm-env.rsSWfq8L.js";import"./react.Yb-Yb6pG.js";import"./@react-three.HOJu3ppJ.js";x("atlas",{plugin:[]},{encode:JSON.stringify,decode:JSON.parse});const V=x("musicData",{items:[]},{encode:JSON.stringify,decode:JSON.parse}),w=x("tagSettings",{},{encode:JSON.stringify,decode:JSON.parse}),he=me(async()=>{const l=await fetch("/api/music.json");if(!l.ok)throw new Error("Failed to fetch music data");const u=await l.json();return V.set(u),u}),ve=[{i:"a",x:0,y:0,w:4,h:16,moved:!1,static:!0},{i:"b",x:4,y:0,w:4,h:16,moved:!1,static:!0},{i:"c",x:8,y:0,w:4,h:16,moved:!1,static:!0},{i:"d",x:4,y:16,w:4,h:4,moved:!1,static:!1},{i:"e",x:4,y:8,w:4,h:4,moved:!1,static:!1},{i:"f",x:8,y:16,w:4,h:4,moved:!1,static:!1},{i:"g",x:4,y:12,w:4,h:4,moved:!1,static:!1},{i:"h",x:8,y:12,w:4,h:4,moved:!1,static:!1},{i:"i",x:0,y:16,w:4,h:4,moved:!1,static:!1},{i:"j",x:8,y:0,w:4,h:16,moved:!1,static:!1}];x("layoutKey",ve,{encode:JSON.stringify,decode:JSON.parse});ye("kbve:");var ge=D('<link href="https://unpkg.com/video.js/dist/video-js.min.css" rel="stylesheet">'),be=D("<button> </button>"),we=D(`<div class="space-x-2 my-4"><button>Play Tracks</button> <button>Play Sets</button> <button class="px-4 py-2 bg-blue-500 border text-white rounded hover:scale-110 ease-in-out duration-500">Sync</button> <button class="px-4 py-2 bg-red-500 text-white rounded hover:scale-110 ease-in-out duration-500">Skip</button> <button> </button></div> <div class="space-x-2"></div> <video id="video-js" class="video-js vjs-default-skin w-full aspect-video" controls preload="auto" width="640" height="264"><p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web
    browser that <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p></video> <strong>Currently Playing Video ID:</strong> `,3);function Pe(l,u){se(u,!1);const[O,R]=pe(),p=()=>Q(V,"$musicData$",O),s=()=>Q(w,"$tagSetting$",O);let i,z=!1,k=!1,_=v(""),c=v(!1),f=v(!0),y=v(!1);function U(e){return new URLSearchParams(window.location.search).get(e)}function N(e){return/^[a-zA-Z0-9_-]{11}$/.test(e)}ie(()=>{k=!0,console.log("Mounted"),Z().then(()=>{k&&z&&G()})}),re(()=>{k=!1,i&&i.dispose()});async function Z(){try{await new Promise((e,t)=>{const o=document.createElement("script");o.src="https://unpkg.com/video.js/dist/video.min.js",o.onload=e,o.onerror=()=>t(new Error("Failed to load Video.js")),document.head.appendChild(o)}),await new Promise((e,t)=>{const o=document.createElement("script");o.src="https://unpkg.com/videojs-youtube/dist/Youtube.min.js",o.onload=e,o.onerror=()=>t(new Error("Failed to load YouTube plugin")),document.head.appendChild(o)}),z=!0}catch(e){console.error("Error loading scripts:",e)}}async function F(){he.then(()=>{console.log("Music data has been successfully updated.")}).catch(e=>{console.error("Error updating music data:",e)})}function I(){const e={};p().items.forEach(t=>{t.tags.forEach(o=>{o!=="music"&&(e[o]=!0)})}),w.set(e)}async function G(){if(p().items.length===0)try{await F(),console.log("Music Data Loaded:",p().items)}catch(e){console.error("Failed to fetch music data:",e);return}Object.keys(s()).length===0?(console.log("Initializing tags from music data..."),I()):console.log("Tags already initialized:",s()),j()}function j(){if(typeof videojs<"u"&&videojs.getTech("youtube")){const e=U("yt"),t=A();if(t.length===0&&(!e||!N(e)))return;const o=e&&N(e)?e:t[Math.floor(Math.random()*t.length)];i=videojs("video-js",{techOrder:["youtube"],sources:[{type:"video/youtube",src:`https://www.youtube.com/watch?v=${o}`}],youtube:{iv_load_policy:3},controls:!0,autoplay:!0,preload:"auto"}),i.on("pause",()=>{}),i.on("ended",L),d(_,o)}else setTimeout(j,100)}function A(){let e=[];return p().items.forEach(t=>{t.tags.some(h=>s()[h]===!0)&&(a(f)&&(e=e.concat(t.ytTracks)),a(y)&&(e=e.concat(t.ytSets)))}),e}function L(){const e=A();if(e.length===0)return;const t=e[Math.floor(Math.random()*e.length)];i.src({type:"video/youtube",src:`https://www.youtube.com/watch?v=${t}`}),i.play(),d(_,t)}function W(e){const t={...s(),[e]:!s()[e]};w.set(t)}async function X(){V.set({items:[]}),w.set({});try{await F(),I(),j(),console.log("Data and tags have been synchronized."),window.location.reload()}catch(e){console.error("Error during synchronization:",e)}}ne();var q=we();ce(e=>{var t=ge();E(e,t)});var $=de(q),S=M($),P=n(S,2),C=n(P,2),Y=n(C,2),m=n(Y,2);let B;var ee=M(m,!0);b(m),b($);var T=n($,2);le(T,5,()=>Object.keys(s()),fe,(e,t)=>{var o=be();let h;var oe=M(o,!0);b(o),K(ae=>{h=g(o,1,"relative z-1 px-3 py-1 text-sm font-medium border rounded-md hover:scale-110 ease-in-out duration-500",null,h,ae),J(oe,a(t))},[()=>({"opacity-100":s()[a(t)],"opacity-50":!s()[a(t)]})],H),r("click",o,()=>W(a(t))),E(e,o)}),b(T);var te=n(T,5);K(e=>{g(S,1,`px-3 py-1 text-sm font-medium border rounded-md hover:scale-110 ease-in-out duration-500 ${(a(f)?"opacity-100":"opacity-50")??""}`),g(P,1,`px-3 py-1 text-sm font-medium border rounded-md hover:scale-110 ease-in-out duration-500 ${(a(y)?"opacity-100":"opacity-50")??""}`),B=g(m,1,"px-4 py-2 bg-cyan-600 border text-white rounded hover:scale-110 ease-in-out duration-500",null,B,e),J(ee,a(c)?"Disable Force Play":"Enable Force Play"),J(te,` ${a(_)??""}`)},[()=>({"opacity-100":a(c),"opacity-50":!a(c)})],H),r("click",S,()=>d(f,!a(f))),r("click",P,()=>d(y,!a(y))),r("click",C,X),r("click",Y,L),r("click",m,()=>d(c,!a(c))),E(l,q),ue(),R()}export{Pe as default};
