const __vite__fileDeps=["_astro/browser.BMICABTD.js","_astro/index.DQ2WTIsS.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{S as Aa,i as Ra,s as ja,B as Bi,a as qe,e as pe,t as Ws,h as Ia,d as ye,b as Me,c as me,f as Se,j as wr,g as Gs,k as ee,m as Q,n as Fn,y as Pt,o as jn,z as Da,p as Ys,q as Ds,u as Na,A as $a,w as La,x as Ua,C as Xs,D as st}from"./index.D49SYJia.js";import{g as Fa}from"./globals.D0QH3NT1.js";import{_ as hn}from"./preload-helper.ygWHROA3.js";import{p as Ba}from"./index.CgBe15gE.js";import{t as qa}from"./index.BH1EYZ08.js";import{j as _r}from"./jsx-runtime.CzgMDNMm.js";import{c as qi,g as Ma,R as Ka,r as ks}from"./index.DQ2WTIsS.js";const za=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>hn(()=>Promise.resolve().then(()=>Mn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Qs extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ja extends Qs{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ha extends Qs{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Va extends Qs{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ns;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(Ns||(Ns={}));var Wa=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class Ga{constructor(e,{headers:t={},customFetch:r,region:a=Ns.Any}={}){this.url=e,this.headers=t,this.region=a,this.fetch=za(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Wa(this,void 0,void 0,function*(){try{const{headers:a,method:o,body:u}=t;let d={},{region:p}=t;p||(p=this.region),p&&p!=="any"&&(d["x-region"]=p);let y;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",y=u):typeof u=="string"?(d["Content-Type"]="text/plain",y=u):typeof FormData<"u"&&u instanceof FormData?y=u:(d["Content-Type"]="application/json",y=JSON.stringify(u)));const g=yield this.fetch(`${this.url}/${e}`,{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:y}).catch(L=>{throw new Ja(L)}),w=g.headers.get("x-relay-error");if(w&&w==="true")throw new Ha(g);if(!g.ok)throw new Va(g);let N=((r=g.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),$;return N==="application/json"?$=yield g.json():N==="application/octet-stream"?$=yield g.blob():N==="text/event-stream"?$=g:N==="multipart/form-data"?$=yield g.formData():$=yield g.text(),{data:$,error:null}}catch(a){return{data:null,error:a}}})}}var Ya=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},dn=Ya();const Xa=dn.fetch,Zs=dn.fetch.bind(dn),_o=dn.Headers,Qa=dn.Request,Za=dn.Response,Mn=Object.freeze(Object.defineProperty({__proto__:null,Headers:_o,Request:Qa,Response:Za,default:Zs,fetch:Xa},Symbol.toStringTag,{value:"Module"}));class ec extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class tc{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Zs:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var u,d,p;let y=null,g=null,w=null,N=o.status,$=o.statusText;if(o.ok){if(this.method!=="HEAD"){const se=await o.text();se===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=se:g=JSON.parse(se))}const U=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),V=(d=o.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");U&&V&&V.length>1&&(w=parseInt(V[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(y={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,w=null,N=406,$="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const U=await o.text();try{y=JSON.parse(U),Array.isArray(y)&&o.status===404&&(g=[],y=null,N=200,$="OK")}catch{o.status===404&&U===""?(N=204,$="No Content"):y={message:U}}if(y&&this.isMaybeSingle&&(!((p=y?.details)===null||p===void 0)&&p.includes("0 rows"))&&(y=null,N=200,$="OK"),y&&this.shouldThrowOnError)throw new ec(y)}return{error:y,data:g,count:w,status:N,statusText:$}});return this.shouldThrowOnError||(a=a.catch(o=>{var u,d,p;return{error:{message:`${(u=o?.name)!==null&&u!==void 0?u:"FetchError"}: ${o?.message}`,details:`${(d=o?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(p=o?.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),a.then(e,t)}}class nc extends tc{select(e){let t=!1;const r=(e??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:a=r}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(u,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const p=[e?"analyze":null,t?"verbose":null,r?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),y=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${y}"; options=${p};`,u==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class un extends nc{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${u}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class rc{constructor(e,{headers:t={},schema:r,fetch:a}){this.url=e,this.headers=t,this.schema=r,this.fetch=a}select(e,{head:t=!1,count:r}={}){const a=t?"HEAD":"GET";let o=!1;const u=(e??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",u),r&&(this.headers.Prefer=`count=${r}`),new un({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const a="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const u=e.reduce((d,p)=>d.concat(Object.keys(p)),[]);if(u.length>0){const d=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",d.join(","))}}return new un({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:a,defaultToNull:o=!0}={}){const u="POST",d=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&d.push(this.headers.Prefer),a&&d.push(`count=${a}`),o||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(e)){const p=e.reduce((y,g)=>y.concat(Object.keys(g)),[]);if(p.length>0){const y=[...new Set(p)].map(g=>`"${g}"`);this.url.searchParams.set("columns",y.join(","))}}return new un({method:u,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),this.headers.Prefer=a.join(","),new un({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new un({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const sc="1.15.2",ic={"X-Client-Info":`postgrest-js/${sc}`};class ei{constructor(e,{headers:t={},schema:r,fetch:a}={}){this.url=e,this.headers=Object.assign(Object.assign({},ic),t),this.schemaName=r,this.fetch=a}from(e){const t=new URL(`${this.url}/${e}`);return new rc(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new ei(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:a=!1,count:o}={}){let u;const d=new URL(`${this.url}/rpc/${e}`);let p;r||a?(u=r?"HEAD":"GET",Object.entries(t).filter(([g,w])=>w!==void 0).map(([g,w])=>[g,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([g,w])=>{d.searchParams.append(g,w)})):(u="POST",p=t);const y=Object.assign({},this.headers);return o&&(y.Prefer=`count=${o}`),new un({method:u,url:d,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}const oc="2.9.4",ac={"X-Client-Info":`realtime-js/${oc}`},cc="1.0.0",ko=1e4,uc=1e3;var ln;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(ln||(ln={}));var Je;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Je||(Je={}));var Qe;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Qe||(Qe={}));var $s;(function(i){i.websocket="websocket"})($s||($s={}));var Jt;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Jt||(Jt={}));class Eo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class lc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const a=t.getUint8(1),o=t.getUint8(2);let u=this.HEADER_LENGTH+2;const d=r.decode(e.slice(u,u+a));u=u+a;const p=r.decode(e.slice(u,u+o));u=u+o;const y=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:d,event:p,payload:y}}}class Es{constructor(e,t,r={},a=ko){this.channel=e,this.event=t,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Mi;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(Mi||(Mi={}));class Ln{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:o,onLeave:u,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ln.syncState(this.state,a,o,u),this.pendingDiffs.forEach(p=>{this.state=Ln.syncDiff(this.state,p,o,u)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},a=>{const{onJoin:o,onLeave:u,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ln.syncDiff(this.state,a,o,u),d())}),this.onJoin((a,o,u)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:u})}),this.onLeave((a,o,u)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,a){const o=this.cloneDeep(e),u=this.transformState(t),d={},p={};return this.map(o,(y,g)=>{u[y]||(p[y]=g)}),this.map(u,(y,g)=>{const w=o[y];if(w){const N=g.map(V=>V.presence_ref),$=w.map(V=>V.presence_ref),L=g.filter(V=>$.indexOf(V.presence_ref)<0),U=w.filter(V=>N.indexOf(V.presence_ref)<0);L.length>0&&(d[y]=L),U.length>0&&(p[y]=U)}else d[y]=g}),this.syncDiff(o,{joins:d,leaves:p},r,a)}static syncDiff(e,t,r,a){const{joins:o,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(o,(d,p)=>{var y;const g=(y=e[d])!==null&&y!==void 0?y:[];if(e[d]=this.cloneDeep(p),g.length>0){const w=e[d].map($=>$.presence_ref),N=g.filter($=>w.indexOf($.presence_ref)<0);e[d].unshift(...N)}r(d,g,p)}),this.map(u,(d,p)=>{let y=e[d];if(!y)return;const g=p.map(w=>w.presence_ref);y=y.filter(w=>g.indexOf(w.presence_ref)<0),e[d]=y,a(d,y,p),y.length===0&&delete e[d]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const a=e[r];return"metas"in a?t[r]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ge;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(ge||(ge={}));const Ki=(i,e,t={})=>{var r;const a=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,u)=>(o[u]=hc(u,i,e,a),o),{})},hc=(i,e,t,r)=>{const a=e.find(d=>d.name===i),o=a?.type,u=t[i];return o&&!r.includes(o)?So(o,u):Ls(u)},So=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return mc(e,t)}switch(i){case ge.bool:return dc(e);case ge.float4:case ge.float8:case ge.int2:case ge.int4:case ge.int8:case ge.numeric:case ge.oid:return fc(e);case ge.json:case ge.jsonb:return pc(e);case ge.timestamp:return yc(e);case ge.abstime:case ge.date:case ge.daterange:case ge.int4range:case ge.int8range:case ge.money:case ge.reltime:case ge.text:case ge.time:case ge.timestamptz:case ge.timetz:case ge.tsrange:case ge.tstzrange:return Ls(e);default:return Ls(e)}},Ls=i=>i,dc=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},fc=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},pc=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},mc=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let o;const u=i.slice(1,t);try{o=JSON.parse("["+u+"]")}catch{o=u?u.split(","):[]}return o.map(d=>So(e,d))}return i},yc=i=>typeof i=="string"?i.replace(" ","T"):i;var zi;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(zi||(zi={}));var Ji;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})(Ji||(Ji={}));var Hi;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Hi||(Hi={}));class ti{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Je.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Es(this,Qe.join,this.params,this.timeout),this.rejoinTimer=new Eo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Je.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Je.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Je.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Je.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qe.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new Ln(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,a;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:o,presence:u}}=this.params;this._onError(y=>e&&e("CHANNEL_ERROR",y)),this._onClose(()=>e&&e("CLOSED"));const d={},p={broadcast:o,presence:u,postgres_changes:(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(y=>y.filter))!==null&&a!==void 0?a:[]};this.socket.accessToken&&(d.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:p},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:y})=>{var g;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),y===void 0){e&&e("SUBSCRIBED");return}else{const w=this.bindings.postgres_changes,N=(g=w?.length)!==null&&g!==void 0?g:0,$=[];for(let L=0;L<N;L++){const U=w[L],{filter:{event:V,schema:se,table:fe,filter:he}}=U,Z=y&&y[L];if(Z&&Z.event===V&&Z.schema===se&&Z.table===fe&&Z.filter===he)$.push(Object.assign(Object.assign({},U),{id:Z.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=$,e&&e("SUBSCRIBED");return}}).receive("error",y=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(y).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:u}=e,d={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:u}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,d,(a=t.timeout)!==null&&a!==void 0?a:this.timeout)).ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var u,d,p;const y=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(d=(u=this.params)===null||u===void 0?void 0:u.config)===null||d===void 0?void 0:d.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),y.receive("ok",()=>o("ok")),y.receive("error",()=>o("error")),y.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Je.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qe.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const a=new Es(this,Qe.leave,{},e);a.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),a.send(),this._canPush()||a.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const a=new AbortController,o=setTimeout(()=>a.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(o),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Es(this,e,t,r);return this._canPush()?a.send():(a.startTimeout(),this.pushBuffer.push(a)),a}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var a,o;const u=e.toLocaleLowerCase(),{close:d,error:p,leave:y,join:g}=Qe;if(r&&[d,p,y,g].indexOf(u)>=0&&r!==this._joinRef())return;let N=this._onMessage(u,t,r);if(t&&!N)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter($=>{var L,U,V;return((L=$.filter)===null||L===void 0?void 0:L.event)==="*"||((V=(U=$.filter)===null||U===void 0?void 0:U.event)===null||V===void 0?void 0:V.toLocaleLowerCase())===u}).map($=>$.callback(N,r)):(o=this.bindings[u])===null||o===void 0||o.filter($=>{var L,U,V,se,fe,he;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in $){const Z=$.id,Oe=(L=$.filter)===null||L===void 0?void 0:L.event;return Z&&((U=t.ids)===null||U===void 0?void 0:U.includes(Z))&&(Oe==="*"||Oe?.toLocaleLowerCase()===((V=t.data)===null||V===void 0?void 0:V.type.toLocaleLowerCase()))}else{const Z=(fe=(se=$?.filter)===null||se===void 0?void 0:se.event)===null||fe===void 0?void 0:fe.toLocaleLowerCase();return Z==="*"||Z===((he=t?.event)===null||he===void 0?void 0:he.toLocaleLowerCase())}else return $.type.toLocaleLowerCase()===u}).map($=>{if(typeof N=="object"&&"ids"in N){const L=N.data,{schema:U,table:V,commit_timestamp:se,type:fe,errors:he}=L;N=Object.assign(Object.assign({},{schema:U,table:V,commit_timestamp:se,eventType:fe,new:{},old:{},errors:he}),this._getPayloadRecords(L))}$.callback(N,r)})}_isClosed(){return this.state===Je.closed}_isJoined(){return this.state===Je.joined}_isJoining(){return this.state===Je.joining}_isLeaving(){return this.state===Je.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const a=e.toLocaleLowerCase(),o={type:a,filter:t,callback:r};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&ti.isEqual(a.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Qe.close,{},e)}_onError(e){this._on(Qe.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Je.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ki(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ki(e.columns,e.old_record)),t}}const gc=()=>{},vc=typeof WebSocket<"u";class bc{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=ac,this.params={},this.timeout=ko,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=gc,this.conn=null,this.sendBuffer=[],this.serializer=new lc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=o=>{let u;return o?u=o:typeof fetch>"u"?u=(...d)=>hn(()=>Promise.resolve().then(()=>Mn),void 0).then(({default:p})=>p(...d)):u=fetch,(...d)=>u(...d)},this.endPoint=`${e}/${$s.websocket}`,t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const a=(r=t?.params)===null||r===void 0?void 0:r.apikey;a&&(this.accessToken=a,this.apiKey=a),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t?.encode?t.encode:(o,u)=>u(JSON.stringify(o)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Eo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(vc){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new wc(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),hn(()=>import("./browser.BMICABTD.js").then(e=>e.b),__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ln.connecting:return Jt.Connecting;case ln.open:return Jt.Open;case ln.closing:return Jt.Closing;default:return Jt.Closed}}isConnected(){return this.connectionState()===Jt.Open}channel(e,t={config:{}}){const r=new ti(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:a,ref:o}=e,u=()=>{this.encode(e,d=>{var p;(p=this.conn)===null||p===void 0||p.send(d)})};this.log("push",`${t} ${r} (${o})`,a),this.isConnected()?u():this.sendBuffer.push(u)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Qe.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:cc}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:a,payload:o,ref:u}=t;(u&&u===this.pendingHeartbeatRef||a===o?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${r} ${a} ${u&&"("+u+")"||""}`,o),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,o,u)),this.stateChangeCallbacks.message.forEach(d=>d(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Qe.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return`${e}${r}${a}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(uc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class wc{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ln.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class ni extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ue(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class _c extends ni{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Vi extends ni{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var kc=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const Oo=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>hn(()=>Promise.resolve().then(()=>Mn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ec=()=>kc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield hn(()=>Promise.resolve().then(()=>Mn),void 0)).Response:Response});var pn=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const Ss=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Sc=(i,e)=>pn(void 0,void 0,void 0,function*(){const t=yield Ec();i instanceof t?i.json().then(r=>{e(new _c(Ss(r),i.status||500))}).catch(r=>{e(new Vi(Ss(r),r))}):e(new Vi(Ss(i),i))}),Oc=(i,e,t,r)=>{const a={method:i,headers:e?.headers||{}};return i==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),t))};function jr(i,e,t,r,a,o){return pn(this,void 0,void 0,function*(){return new Promise((u,d)=>{i(t,Oc(e,r,a,o)).then(p=>{if(!p.ok)throw p;return r?.noResolveJson?p:p.json()}).then(p=>u(p)).catch(p=>Sc(p,d))})})}function Us(i,e,t,r){return pn(this,void 0,void 0,function*(){return jr(i,"GET",e,t,r)})}function Ct(i,e,t,r,a){return pn(this,void 0,void 0,function*(){return jr(i,"POST",e,r,a,t)})}function Pc(i,e,t,r,a){return pn(this,void 0,void 0,function*(){return jr(i,"PUT",e,r,a,t)})}function Po(i,e,t,r,a){return pn(this,void 0,void 0,function*(){return jr(i,"DELETE",e,r,a,t)})}var We=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const xc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Wi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Tc{constructor(e,t={},r,a){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Oo(a)}uploadOrUpdate(e,t,r,a){return We(this,void 0,void 0,function*(){try{let o;const u=Object.assign(Object.assign({},Wi),a),d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",u.cacheControl),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",u.cacheControl)):(o=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const p=this._removeEmptyFolders(t),y=this._getFinalPath(p),g=yield this.fetch(`${this.url}/object/${y}`,Object.assign({method:e,body:o,headers:d},u?.duplex?{duplex:u.duplex}:{})),w=yield g.json();return g.ok?{data:{path:p,id:w.Id,fullPath:w.Key},error:null}:{data:null,error:w}}catch(o){if(Ue(o))return{data:null,error:o};throw o}})}upload(e,t,r){return We(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,a){return We(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),u=this._getFinalPath(o),d=new URL(this.url+`/object/upload/sign/${u}`);d.searchParams.set("token",t);try{let p;const y=Object.assign({upsert:Wi.upsert},a),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",y.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",y.cacheControl)):(p=r,g["cache-control"]=`max-age=${y.cacheControl}`,g["content-type"]=y.contentType);const w=yield this.fetch(d.toString(),{method:"PUT",body:p,headers:g}),N=yield w.json();return w.ok?{data:{path:o,fullPath:N.Key},error:null}:{data:null,error:N}}catch(p){if(Ue(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e){return We(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield Ct(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),a=new URL(this.url+r.url),o=a.searchParams.get("token");if(!o)throw new ni("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}update(e,t,r){return We(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return We(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}copy(e,t){return We(this,void 0,void 0,function*(){try{return{data:{path:(yield Ct(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return We(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),o=yield Ct(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${u}`)},{data:o,error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}createSignedUrls(e,t,r){return We(this,void 0,void 0,function*(){try{const a=yield Ct(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${o}`):null})),error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}download(e,t){return We(this,void 0,void 0,function*(){const a=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"";try{const d=this._getFinalPath(e);return{data:yield(yield Us(this.fetch,`${this.url}/${a}/${d}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(d){if(Ue(d))return{data:null,error:d};throw d}})}getPublicUrl(e,t){const r=this._getFinalPath(e),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const d=typeof t?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(t?.transform||{});p!==""&&a.push(p);let y=a.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${y}`)}}}remove(e){return We(this,void 0,void 0,function*(){try{return{data:yield Po(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}list(e,t,r){return We(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},xc),t),{prefix:e||""});return{data:yield Ct(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Cc="2.5.5",Ac={"X-Client-Info":`storage-js/${Cc}`};var on=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class Rc{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Ac),t),this.fetch=Oo(r)}listBuckets(){return on(this,void 0,void 0,function*(){try{return{data:yield Us(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ue(e))return{data:null,error:e};throw e}})}getBucket(e){return on(this,void 0,void 0,function*(){try{return{data:yield Us(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return on(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return on(this,void 0,void 0,function*(){try{return{data:yield Pc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}emptyBucket(e){return on(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}deleteBucket(e){return on(this,void 0,void 0,function*(){try{return{data:yield Po(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}}class jc extends Rc{constructor(e,t={},r){super(e,t,r)}from(e){return new Tc(this.url,this.headers,e,this.fetch)}}const Ic="2.42.5";let $n="";typeof Deno<"u"?$n="deno":typeof document<"u"?$n="web":typeof navigator<"u"&&navigator.product==="ReactNative"?$n="react-native":$n="node";const Dc={"X-Client-Info":`supabase-js-${$n}/${Ic}`},Nc={headers:Dc},$c={schema:"public"},Lc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Uc={};var Fc=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};const Bc=i=>{let e;return i?e=i:typeof fetch>"u"?e=Zs:e=fetch,(...t)=>e(...t)},qc=()=>typeof Headers>"u"?_o:Headers,Mc=(i,e,t)=>{const r=Bc(t),a=qc();return(o,u)=>Fc(void 0,void 0,void 0,function*(){var d;const p=(d=yield e())!==null&&d!==void 0?d:i;let y=new a(u?.headers);return y.has("apikey")||y.set("apikey",i),y.has("Authorization")||y.set("Authorization",`Bearer ${p}`),r(o,Object.assign(Object.assign({},u),{headers:y}))})};function Kc(i){return i.replace(/\/$/,"")}function zc(i,e){const{db:t,auth:r,realtime:a,global:o}=i,{db:u,auth:d,realtime:p,global:y}=e;return{db:Object.assign(Object.assign({},u),t),auth:Object.assign(Object.assign({},d),r),realtime:Object.assign(Object.assign({},p),a),global:Object.assign(Object.assign({},y),o)}}const xo="2.63.1",Jc="http://localhost:9999",Hc="supabase.auth.token",Vc={"X-Client-Info":`gotrue-js/${xo}`},Gi=10,Fs="X-Supabase-Api-Version",To={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Wc(i){return Math.round(Date.now()/1e3)+i}function Gc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const Xe=()=>typeof document<"u",Mt={tested:!1,writable:!1},Un=()=>{if(!Xe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mt.tested)return Mt.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Mt.tested=!0,Mt.writable=!0}catch{Mt.tested=!0,Mt.writable=!1}return Mt.writable};function Os(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return t.searchParams.forEach((r,a)=>{e[a]=r}),e}const Co=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>hn(()=>Promise.resolve().then(()=>Mn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Yc=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Ao=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},kr=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ps=async(i,e)=>{await i.removeItem(e)};function Xc(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,a,o,u,d,p,y,g=0;for(i=i.replace("-","+").replace("_","/");g<i.length;)u=e.indexOf(i.charAt(g++)),d=e.indexOf(i.charAt(g++)),p=e.indexOf(i.charAt(g++)),y=e.indexOf(i.charAt(g++)),r=u<<2|d>>4,a=(d&15)<<4|p>>2,o=(p&3)<<6|y,t=t+String.fromCharCode(r),p!=64&&a!=0&&(t=t+String.fromCharCode(a)),y!=64&&o!=0&&(t=t+String.fromCharCode(o));return t}class Ir{constructor(){this.promise=new Ir.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ir.promiseConstructor=Promise;function Yi(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Xc(r))}async function Qc(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function Zc(i,e){return new Promise((r,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const u=await i(o);if(!e(o,null,u)){r(u);return}}catch(u){if(!e(o,u)){a(u);return}}})()})}function eu(i){return("0"+i.toString(16)).substr(-2)}function tu(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let a="";for(let o=0;o<56;o++)a+=t.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,eu).join("")}async function nu(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),a=new Uint8Array(r);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}function ru(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function su(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await nu(i);return ru(t)}async function an(i,e,t=!1){const r=tu();let a=r;t&&(a+="/PASSWORD_RECOVERY"),await Ao(i,`${e}-code-verifier`,a);const o=await su(r);return[o,r===o?"plain":"s256"]}const iu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ou(i){const e=i.headers.get(Fs);if(!e||!e.match(iu))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class ri extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ie(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class au extends ri{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function cu(i){return ie(i)&&i.name==="AuthApiError"}class Ro extends ri{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ht extends ri{constructor(e,t,r,a){super(e,r,a),this.name=t,this.status=r}}class Kt extends Ht{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class xs extends Ht{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Er extends Ht{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Sr extends Ht{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xi extends Ht{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Bs extends Ht{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ts(i){return ie(i)&&i.name==="AuthRetryableFetchError"}class Qi extends Ht{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var uu=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(i);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(i,r[a])&&(t[r[a]]=i[r[a]]);return t};const zt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),lu=[502,503,504];async function Zi(i){var e;if(!Yc(i))throw new Bs(zt(i),0);if(lu.includes(i.status))throw new Bs(zt(i),i.status);let t;try{t=await i.json()}catch(o){throw new Ro(zt(o),o)}let r;const a=ou(i);if(a&&a.getTime()>=To["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Qi(zt(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0))throw new Qi(zt(t),i.status,t.weak_password.reasons);throw new au(zt(t),i.status||500,r)}const hu=(i,e,t,r)=>{const a={method:i,headers:e?.headers||{}};return i==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),t))};async function oe(i,e,t,r){var a;const o=Object.assign({},r?.headers);o[Fs]||(o[Fs]=To["2024-01-01"].name),r?.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const u=(a=r?.query)!==null&&a!==void 0?a:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const d=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",p=await du(i,e,t+d,{headers:o,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(p):{data:Object.assign({},p),error:null}}async function du(i,e,t,r,a,o){const u=hu(e,r,a,o);let d;try{d=await i(t,Object.assign(Object.assign({},u),{cache:"no-store"}))}catch(p){throw console.error(p),new Bs(zt(p),0)}if(d.ok||await Zi(d),r?.noResolveJson)return d;try{return await d.json()}catch(p){await Zi(p)}}function Tt(i){var e;let t=null;yu(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=Wc(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function eo(i){const e=Tt(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function At(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function fu(i){return{data:i,error:null}}function pu(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:o}=i,u=uu(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:o},p=Object.assign({},u);return{data:{properties:d,user:p},error:null}}function mu(i){return i}function yu(i){return i.access_token&&i.refresh_token&&i.expires_in}var gu=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(i);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(i,r[a])&&(t[r[a]]=i[r[a]]);return t};class vu{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Co(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await oe(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ie(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await oe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:At})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=gu(e,["options"]),a=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(a.new_email=r?.newEmail,delete a.newEmail),await oe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:pu,redirectTo:t?.redirectTo})}catch(t){if(ie(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await oe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:At})}catch(t){if(ie(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,a,o,u,d,p;try{const y={nextPage:null,lastPage:0,total:0},g=await oe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:mu});if(g.error)throw g.error;const w=await g.json(),N=(u=g.headers.get("x-total-count"))!==null&&u!==void 0?u:0,$=(p=(d=g.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return $.length>0&&($.forEach(L=>{const U=parseInt(L.split(";")[0].split("=")[1].substring(0,1)),V=JSON.parse(L.split(";")[1].split("=")[1]);y[`${V}Page`]=U}),y.total=parseInt(N)),{data:Object.assign(Object.assign({},w),y),error:null}}catch(y){if(ie(y))return{data:{users:[]},error:y};throw y}}async getUserById(e){try{return await oe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:At})}catch(t){if(ie(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await oe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:At})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:At})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await oe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:t,error:r}}catch(t){if(ie(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ie(t))return{data:null,error:t};throw t}}}const bu={getItem:i=>Un()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Un()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Un()&&globalThis.localStorage.removeItem(i)}};function to(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function wu(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const cn={debug:!!(globalThis&&Un()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class jo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _u extends jo{}async function ku(i,e,t){cn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),cn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){cn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,a.name);try{return await t()}finally{cn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,a.name)}}else{if(e===0)throw cn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new _u(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(cn.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}wu();const Eu={url:Jc,storageKey:Hc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vc,flowType:"implicit",debug:!1},In=30*1e3,no=3;async function ro(i,e,t){return await t()}class Bn{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Bn.nextInstanceID,Bn.nextInstanceID+=1,this.instanceID>0&&Xe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Eu),e);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new vu({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Co(a.fetch),this.lock=a.lock||ro,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,a.lock?this.lock=a.lock:Xe()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=ku:this.lock=ro,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?a.storage?this.storage=a.storage:Un()?this.storage=bu:(this.memoryStorage={},this.storage=to(this.memoryStorage)):(this.memoryStorage={},this.storage=to(this.memoryStorage)),Xe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xo}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Xe()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),r?.message==="Identity is already linked"||r?.message==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:a,redirectType:o}=t;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ie(e)?{error:e}:{error:new Ro("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,a;try{await this._removeSession();const o=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e?.options)===null||a===void 0?void 0:a.captchaToken}},xform:Tt}),{data:u,error:d}=o;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,a;try{await this._removeSession();let o;if("email"in e){const{email:g,password:w,options:N}=e;let $=null,L=null;this.flowType==="pkce"&&([$,L]=await an(this.storage,this.storageKey)),o=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:N?.emailRedirectTo,body:{email:g,password:w,data:(t=N?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:N?.captchaToken},code_challenge:$,code_challenge_method:L},xform:Tt})}else if("phone"in e){const{phone:g,password:w,options:N}=e;o=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:w,data:(r=N?.data)!==null&&r!==void 0?r:{},channel:(a=N?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:N?.captchaToken}},xform:Tt})}else throw new Er("You must provide either an email or phone number and a password");const{data:u,error:d}=o;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:o,password:u,options:d}=e;t=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:eo})}else if("phone"in e){const{phone:o,password:u,options:d}=e;t=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:eo})}else throw new Er("You must provide either an email or phone number and a password");const{data:r,error:a}=t;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new xs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(t){if(ie(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,a,o;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await kr(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(t??"").split("/"),{data:o,error:u}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Tt});return await Ps(this.storage,`${this.storageKey}-code-verifier`),u?{data:{user:null,session:null,redirectType:null},error:u}:!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new xs}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:u})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:a,access_token:o,nonce:u}=e,d=await oe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:o,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Tt}),{data:p,error:y}=d;return y?{data:{user:null,session:null},error:y}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new xs}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:y})}catch(t){if(ie(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,a,o,u;try{if(await this._removeSession(),"email"in e){const{email:d,options:p}=e;let y=null,g=null;this.flowType==="pkce"&&([y,g]=await an(this.storage,this.storageKey));const{error:w}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(t=p?.data)!==null&&t!==void 0?t:{},create_user:(r=p?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:y,code_challenge_method:g},redirectTo:p?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:d,options:p}=e,{data:y,error:g}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(a=p?.data)!==null&&a!==void 0?a:{},create_user:(o=p?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(u=p?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:y?.message_id},error:g}}throw new Er("You must provide either an email or phone number.")}catch(d){if(ie(d))return{data:{user:null,session:null},error:d};throw d}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let a,o;"options"in e&&(a=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:d}=await oe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Tt});if(d)throw d;if(!u)throw new Error("An error occurred on token verification.");const p=u.session,y=u.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:y,session:p},error:null}}catch(a){if(ie(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var t,r,a;try{await this._removeSession();let o=null,u=null;return this.flowType==="pkce"&&([o,u]=await an(this.storage,this.storageKey)),await oe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:u}),headers:this.headers,xform:fu})}catch(o){if(ie(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Kt;const{error:a}=await oe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(ie(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:o}=e,{error:u}=await oe(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:a,options:o}=e,{data:u,error:d}=await oe(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Er("You must provide either an email or phone number and a type")}catch(t){if(ie(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await kr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return this.storage.isServer&&(e=new Proxy(e,{get(d,p,y){return p==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(d,p,y)}})),{data:{session:e},error:null};const{session:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:At}):await this._useSession(async t=>{var r,a,o;const{data:u,error:d}=t;if(d)throw d;return!((r=u.session)===null||r===void 0)&&r.access_token?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:At}):{data:{user:null},error:new Kt}})}catch(t){if(ie(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:a,error:o}=r;if(o)throw o;if(!a.session)throw new Kt;const u=a.session;let d=null,p=null;this.flowType==="pkce"&&e.email!=null&&([d,p]=await an(this.storage,this.storageKey));const{data:y,error:g}=await oe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:p}),jwt:u.access_token,xform:At});if(g)throw g;return u.user=y.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Yi(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Kt;const t=Date.now()/1e3;let r=t,a=!0,o=null;const u=Yi(e.access_token);if(u.exp&&(r=u.exp,a=r<=t),a){const{session:d,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!d)return{data:{user:null,session:null},error:null};o=d}else{const{data:d,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(ie(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:d}=t;if(d)throw d;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Kt;const{session:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ie(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Xe())throw new Sr("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Sr("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Xi("Not a valid PKCE flow url.");const t=Os(window.location.href);if(e){if(!t.code)throw new Xi("No code detected.");const{data:fe,error:he}=await this._exchangeCodeForSession(t.code);if(he)throw he;const Z=new URL(window.location.href);return Z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Z.toString()),{data:{session:fe.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Sr(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:a,access_token:o,refresh_token:u,expires_in:d,expires_at:p,token_type:y}=t;if(!o||!d||!u||!y)throw new Sr("No session defined in URL");const g=Math.round(Date.now()/1e3),w=parseInt(d);let N=g+w;p&&(N=parseInt(p));const $=N-g;$*1e3<=In&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${$}s, should have been closer to ${w}s`);const L=N-w;g-L>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",L,N,g):g-L<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",L,N,g);const{data:U,error:V}=await this._getUser(o);if(V)throw V;const se={provider_token:r,provider_refresh_token:a,access_token:o,expires_in:w,expires_at:N,refresh_token:u,token_type:y,user:U.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:se,redirectType:t.type},error:null}}catch(t){if(ie(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Os(window.location.href);return!!(Xe()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Os(window.location.href),t=await kr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:a,error:o}=t;if(o)return{error:o};const u=(r=a.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:d}=await this.admin.signOut(u,e);if(d&&!(cu(d)&&(d.status===404||d.status===401)))return{error:d}}return e!=="others"&&(await this._removeSession(),await Ps(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Gc(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,a;try{const{data:{session:o},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await an(this.storage,this.storageKey,!0));try{return await oe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(ie(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ie(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:a}=await this._useSession(async o=>{var u,d,p,y,g;const{data:w,error:N}=o;if(N)throw N;const $=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await oe(this.fetch,"GET",$,{headers:this.headers,jwt:(g=(y=w.session)===null||y===void 0?void 0:y.access_token)!==null&&g!==void 0?g:void 0})});if(a)throw a;return Xe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ie(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,a;const{data:o,error:u}=t;if(u)throw u;return await oe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(t){if(ie(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Zc(async a=>(a>0&&await Qc(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await oe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Tt})),(a,o)=>{const u=200*Math.pow(2,a);return o&&Ts(o)&&Date.now()+u-r<In})}catch(r){if(this._debug(t,"error",r),ie(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Xe()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await kr(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const a=Math.round(Date.now()/1e3),o=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<a+Gi;if(this._debug(t,`session has${o?"":" not"} expired with margin of ${Gi}s`),o){if(this.autoRefreshToken&&r.refresh_token){const{error:u}=await this._callRefreshToken(r.refresh_token);u&&(console.error(u),Ts(u)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Kt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Ir;const{data:o,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!o.session)throw new Kt;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const d={session:o.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(o){if(this._debug(a,"error",o),ie(o)){const u={session:null,error:o};return Ts(o)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],u=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,t)}catch(p){o.push(p)}});if(await Promise.all(u),o.length>0){for(let d=0;d<o.length;d+=1)console.error(o[d]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Ao(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ps(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Xe()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),In);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/In);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${In}ms, refresh threshold is ${no} ticks`),a<=no&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof jo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Xe()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const a=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,u]=await an(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(u)}`});a.push(d.toString())}if(r?.queryParams){const o=new URLSearchParams(r.queryParams);a.push(o.toString())}return r?.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;return o?{data:null,error:o}:await oe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ie(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,a;const{data:o,error:u}=t;if(u)return{data:null,error:u};const{data:d,error:p}=await oe(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return p?{data:null,error:p}:(!((a=d?.totp)===null||a===void 0)&&a.qr_code&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),{data:d,error:null})})}catch(t){if(ie(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;if(o)return{data:null,error:o};const{data:u,error:d}=await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:d})})}catch(t){if(ie(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:o}=t;return o?{data:null,error:o}:await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ie(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],a=r.filter(o=>o.factor_type==="totp"&&o.status==="verified");return{data:{all:r,totp:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:a},error:o}=e;if(o)return{data:null,error:o};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=this._decodeJWT(a.access_token);let d=null;u.aal&&(d=u.aal);let p=d;((r=(t=a.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(p="aal2");const g=u.amr||[];return{data:{currentLevel:d,nextLevel:p,currentAuthenticationMethods:g},error:null}}))}}Bn.nextInstanceID=0;const Su=Bn;class Ou extends Su{constructor(e){super(e)}}var Pu=function(i,e,t,r){function a(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function d(g){try{y(r.next(g))}catch(w){u(w)}}function p(g){try{y(r.throw(g))}catch(w){u(w)}}function y(g){g.done?o(g.value):a(g.value).then(d,p)}y((r=r.apply(i,e||[])).next())})};class xu{constructor(e,t,r){var a,o,u,d,p,y,g,w;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const N=Kc(e);this.realtimeUrl=`${N}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${N}/auth/v1`,this.storageUrl=`${N}/storage/v1`,this.functionsUrl=`${N}/functions/v1`;const $=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,L={db:$c,realtime:Uc,auth:Object.assign(Object.assign({},Lc),{storageKey:$}),global:Nc},U=zc(r??{},L);this.storageKey=(o=(a=U.auth)===null||a===void 0?void 0:a.storageKey)!==null&&o!==void 0?o:"",this.headers=(d=(u=U.global)===null||u===void 0?void 0:u.headers)!==null&&d!==void 0?d:{},this.auth=this._initSupabaseAuthClient((p=U.auth)!==null&&p!==void 0?p:{},this.headers,(y=U.global)===null||y===void 0?void 0:y.fetch),this.fetch=Mc(t,this._getAccessToken.bind(this),(g=U.global)===null||g===void 0?void 0:g.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},U.realtime)),this.rest=new ei(`${N}/rest/v1`,{headers:this.headers,schema:(w=U.db)===null||w===void 0?void 0:w.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Ga(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new jc(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Pu(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,storageKey:o,flowType:u,debug:d},p,y){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ou({url:this.authUrl,headers:Object.assign(Object.assign({},g),p),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,flowType:u,debug:d,fetch:y})}_initRealtimeClient(e){return new bc(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Tu=(i,e,t)=>new xu(i,e,t);var Io=(i=>(i.DARK="dark",i.LIGHT="light",i))(Io||{});const so={hcaptcha:"5ba581fa-b6fc-4bb0-8222-02fcd6a59e35",hcaptcha_api:"https://js.hcaptcha.com/1/api.js",api:"https://supabase.kbve.com",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.ewogICJyb2xlIjogImFub24iLAogICJpc3MiOiAic3VwYWJhc2UiLAogICJpYXQiOiAxNzI0NTM2ODAwLAogICJleHAiOiAxODgyMzAzMjAwCn0._fmEmblm0afeLoPXxt8wP2mYpa9gzU-ufx3v8oRTFGg"},Or={_state:{...so},get(){return{...this._state}},set(i){this._state={...this._state,...i}},reset(){this._state={...so}},toString(){return JSON.stringify(this._state,null,2)},getKey(i){return this._state[i]}};function Do(i,e){return function(){return i.apply(e,arguments)}}const{toString:Cu}=Object.prototype,{getPrototypeOf:si}=Object,Dr=(i=>e=>{const t=Cu.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ot=i=>(i=i.toLowerCase(),e=>Dr(e)===i),Nr=i=>e=>typeof e===i,{isArray:mn}=Array,qn=Nr("undefined");function Au(i){return i!==null&&!qn(i)&&i.constructor!==null&&!qn(i.constructor)&&Ge(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const No=ot("ArrayBuffer");function Ru(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&No(i.buffer),e}const ju=Nr("string"),Ge=Nr("function"),$o=Nr("number"),$r=i=>i!==null&&typeof i=="object",Iu=i=>i===!0||i===!1,Pr=i=>{if(Dr(i)!=="object")return!1;const e=si(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Du=ot("Date"),Nu=ot("File"),$u=ot("Blob"),Lu=ot("FileList"),Uu=i=>$r(i)&&Ge(i.pipe),Fu=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Ge(i.append)&&((e=Dr(i))==="formdata"||e==="object"&&Ge(i.toString)&&i.toString()==="[object FormData]"))},Bu=ot("URLSearchParams"),qu=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Kn(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let r,a;if(typeof i!="object"&&(i=[i]),mn(i))for(r=0,a=i.length;r<a;r++)e.call(null,i[r],r,i);else{const o=t?Object.getOwnPropertyNames(i):Object.keys(i),u=o.length;let d;for(r=0;r<u;r++)d=o[r],e.call(null,i[d],d,i)}}function Lo(i,e){e=e.toLowerCase();const t=Object.keys(i);let r=t.length,a;for(;r-- >0;)if(a=t[r],e===a.toLowerCase())return a;return null}const Uo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Fo=i=>!qn(i)&&i!==Uo;function qs(){const{caseless:i}=Fo(this)&&this||{},e={},t=(r,a)=>{const o=i&&Lo(e,a)||a;Pr(e[o])&&Pr(r)?e[o]=qs(e[o],r):Pr(r)?e[o]=qs({},r):mn(r)?e[o]=r.slice():e[o]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&Kn(arguments[r],t);return e}const Mu=(i,e,t,{allOwnKeys:r}={})=>(Kn(e,(a,o)=>{t&&Ge(a)?i[o]=Do(a,t):i[o]=a},{allOwnKeys:r}),i),Ku=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),zu=(i,e,t,r)=>{i.prototype=Object.create(e.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},Ju=(i,e,t,r)=>{let a,o,u;const d={};if(e=e||{},i==null)return e;do{for(a=Object.getOwnPropertyNames(i),o=a.length;o-- >0;)u=a[o],(!r||r(u,i,e))&&!d[u]&&(e[u]=i[u],d[u]=!0);i=t!==!1&&si(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},Hu=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const r=i.indexOf(e,t);return r!==-1&&r===t},Vu=i=>{if(!i)return null;if(mn(i))return i;let e=i.length;if(!$o(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},Wu=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&si(Uint8Array)),Gu=(i,e)=>{const r=(i&&i[Symbol.iterator]).call(i);let a;for(;(a=r.next())&&!a.done;){const o=a.value;e.call(i,o[0],o[1])}},Yu=(i,e)=>{let t;const r=[];for(;(t=i.exec(e))!==null;)r.push(t);return r},Xu=ot("HTMLFormElement"),Qu=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,a){return r.toUpperCase()+a}),io=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),Zu=ot("RegExp"),Bo=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),r={};Kn(t,(a,o)=>{let u;(u=e(a,o,i))!==!1&&(r[o]=u||a)}),Object.defineProperties(i,r)},el=i=>{Bo(i,(e,t)=>{if(Ge(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=i[t];if(Ge(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},tl=(i,e)=>{const t={},r=a=>{a.forEach(o=>{t[o]=!0})};return mn(i)?r(i):r(String(i).split(e)),t},nl=()=>{},rl=(i,e)=>(i=+i,Number.isFinite(i)?i:e),Cs="abcdefghijklmnopqrstuvwxyz",oo="0123456789",qo={DIGIT:oo,ALPHA:Cs,ALPHA_DIGIT:Cs+Cs.toUpperCase()+oo},sl=(i=16,e=qo.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;i--;)t+=e[Math.random()*r|0];return t};function il(i){return!!(i&&Ge(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const ol=i=>{const e=new Array(10),t=(r,a)=>{if($r(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[a]=r;const o=mn(r)?[]:{};return Kn(r,(u,d)=>{const p=t(u,a+1);!qn(p)&&(o[d]=p)}),e[a]=void 0,o}}return r};return t(i,0)},al=ot("AsyncFunction"),cl=i=>i&&($r(i)||Ge(i))&&Ge(i.then)&&Ge(i.catch),I={isArray:mn,isArrayBuffer:No,isBuffer:Au,isFormData:Fu,isArrayBufferView:Ru,isString:ju,isNumber:$o,isBoolean:Iu,isObject:$r,isPlainObject:Pr,isUndefined:qn,isDate:Du,isFile:Nu,isBlob:$u,isRegExp:Zu,isFunction:Ge,isStream:Uu,isURLSearchParams:Bu,isTypedArray:Wu,isFileList:Lu,forEach:Kn,merge:qs,extend:Mu,trim:qu,stripBOM:Ku,inherits:zu,toFlatObject:Ju,kindOf:Dr,kindOfTest:ot,endsWith:Hu,toArray:Vu,forEachEntry:Gu,matchAll:Yu,isHTMLForm:Xu,hasOwnProperty:io,hasOwnProp:io,reduceDescriptors:Bo,freezeMethods:el,toObjectSet:tl,toCamelCase:Qu,noop:nl,toFiniteNumber:rl,findKey:Lo,global:Uo,isContextDefined:Fo,ALPHABET:qo,generateString:sl,isSpecCompliantForm:il,toJSONObject:ol,isAsyncFn:al,isThenable:cl};function ae(i,e,t,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),a&&(this.response=a)}I.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Mo=ae.prototype,Ko={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Ko[i]={value:i}});Object.defineProperties(ae,Ko);Object.defineProperty(Mo,"isAxiosError",{value:!0});ae.from=(i,e,t,r,a,o)=>{const u=Object.create(Mo);return I.toFlatObject(i,u,function(p){return p!==Error.prototype},d=>d!=="isAxiosError"),ae.call(u,i.message,e,t,r,a),u.cause=i,u.name=i.name,o&&Object.assign(u,o),u};const ul=null;function Ms(i){return I.isPlainObject(i)||I.isArray(i)}function zo(i){return I.endsWith(i,"[]")?i.slice(0,-2):i}function ao(i,e,t){return i?i.concat(e).map(function(a,o){return a=zo(a),!t&&o?"["+a+"]":a}).join(t?".":""):e}function ll(i){return I.isArray(i)&&!i.some(Ms)}const hl=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function Lr(i,e,t){if(!I.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=I.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,V){return!I.isUndefined(V[U])});const r=t.metaTokens,a=t.visitor||g,o=t.dots,u=t.indexes,p=(t.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function y(L){if(L===null)return"";if(I.isDate(L))return L.toISOString();if(!p&&I.isBlob(L))throw new ae("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(L)||I.isTypedArray(L)?p&&typeof Blob=="function"?new Blob([L]):Buffer.from(L):L}function g(L,U,V){let se=L;if(L&&!V&&typeof L=="object"){if(I.endsWith(U,"{}"))U=r?U:U.slice(0,-2),L=JSON.stringify(L);else if(I.isArray(L)&&ll(L)||(I.isFileList(L)||I.endsWith(U,"[]"))&&(se=I.toArray(L)))return U=zo(U),se.forEach(function(he,Z){!(I.isUndefined(he)||he===null)&&e.append(u===!0?ao([U],Z,o):u===null?U:U+"[]",y(he))}),!1}return Ms(L)?!0:(e.append(ao(V,U,o),y(L)),!1)}const w=[],N=Object.assign(hl,{defaultVisitor:g,convertValue:y,isVisitable:Ms});function $(L,U){if(!I.isUndefined(L)){if(w.indexOf(L)!==-1)throw Error("Circular reference detected in "+U.join("."));w.push(L),I.forEach(L,function(se,fe){(!(I.isUndefined(se)||se===null)&&a.call(e,se,I.isString(fe)?fe.trim():fe,U,N))===!0&&$(se,U?U.concat(fe):[fe])}),w.pop()}}if(!I.isObject(i))throw new TypeError("data must be an object");return $(i),e}function co(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ii(i,e){this._pairs=[],i&&Lr(i,this,e)}const Jo=ii.prototype;Jo.append=function(e,t){this._pairs.push([e,t])};Jo.toString=function(e){const t=e?function(r){return e.call(this,r,co)}:co;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function dl(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ho(i,e,t){if(!e)return i;const r=t&&t.encode||dl,a=t&&t.serialize;let o;if(a?o=a(e,t):o=I.isURLSearchParams(e)?e.toString():new ii(e,t).toString(r),o){const u=i.indexOf("#");u!==-1&&(i=i.slice(0,u)),i+=(i.indexOf("?")===-1?"?":"&")+o}return i}class uo{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Vo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fl=typeof URLSearchParams<"u"?URLSearchParams:ii,pl=typeof FormData<"u"?FormData:null,ml=typeof Blob<"u"?Blob:null,yl={isBrowser:!0,classes:{URLSearchParams:fl,FormData:pl,Blob:ml},protocols:["http","https","file","blob","url","data"]},Wo=typeof window<"u"&&typeof document<"u",gl=(i=>Wo&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),vl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",bl=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Wo,hasStandardBrowserEnv:gl,hasStandardBrowserWebWorkerEnv:vl},Symbol.toStringTag,{value:"Module"})),it={...bl,...yl};function wl(i,e){return Lr(i,new it.classes.URLSearchParams,Object.assign({visitor:function(t,r,a,o){return it.isNode&&I.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function _l(i){return I.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function kl(i){const e={},t=Object.keys(i);let r;const a=t.length;let o;for(r=0;r<a;r++)o=t[r],e[o]=i[o];return e}function Go(i){function e(t,r,a,o){let u=t[o++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),p=o>=t.length;return u=!u&&I.isArray(a)?a.length:u,p?(I.hasOwnProp(a,u)?a[u]=[a[u],r]:a[u]=r,!d):((!a[u]||!I.isObject(a[u]))&&(a[u]=[]),e(t,r,a[u],o)&&I.isArray(a[u])&&(a[u]=kl(a[u])),!d)}if(I.isFormData(i)&&I.isFunction(i.entries)){const t={};return I.forEachEntry(i,(r,a)=>{e(_l(r),a,t,0)}),t}return null}function El(i,e,t){if(I.isString(i))try{return(e||JSON.parse)(i),I.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(i)}const oi={transitional:Vo,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",a=r.indexOf("application/json")>-1,o=I.isObject(e);if(o&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(Go(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return wl(e,this.formSerializer).toString();if((d=I.isFileList(e))||r.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return Lr(d?{"files[]":e}:e,p&&new p,this.formSerializer)}}return o||a?(t.setContentType("application/json",!1),El(e)):e}],transformResponse:[function(e){const t=this.transitional||oi.transitional,r=t&&t.forcedJSONParsing,a=this.responseType==="json";if(e&&I.isString(e)&&(r&&!this.responseType||a)){const u=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(u)throw d.name==="SyntaxError"?ae.from(d,ae.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:it.classes.FormData,Blob:it.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],i=>{oi.headers[i]={}});const ai=oi,Sl=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ol=i=>{const e={};let t,r,a;return i&&i.split(`
`).forEach(function(u){a=u.indexOf(":"),t=u.substring(0,a).trim().toLowerCase(),r=u.substring(a+1).trim(),!(!t||e[t]&&Sl[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},lo=Symbol("internals");function Dn(i){return i&&String(i).trim().toLowerCase()}function xr(i){return i===!1||i==null?i:I.isArray(i)?i.map(xr):String(i)}function Pl(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(i);)e[r[1]]=r[2];return e}const xl=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function As(i,e,t,r,a){if(I.isFunction(r))return r.call(this,e,t);if(a&&(e=t),!!I.isString(e)){if(I.isString(r))return e.indexOf(r)!==-1;if(I.isRegExp(r))return r.test(e)}}function Tl(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Cl(i,e){const t=I.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+t,{value:function(a,o,u){return this[r].call(this,e,a,o,u)},configurable:!0})})}class Ur{constructor(e){e&&this.set(e)}set(e,t,r){const a=this;function o(d,p,y){const g=Dn(p);if(!g)throw new Error("header name must be a non-empty string");const w=I.findKey(a,g);(!w||a[w]===void 0||y===!0||y===void 0&&a[w]!==!1)&&(a[w||p]=xr(d))}const u=(d,p)=>I.forEach(d,(y,g)=>o(y,g,p));return I.isPlainObject(e)||e instanceof this.constructor?u(e,t):I.isString(e)&&(e=e.trim())&&!xl(e)?u(Ol(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=Dn(e),e){const r=I.findKey(this,e);if(r){const a=this[r];if(!t)return a;if(t===!0)return Pl(a);if(I.isFunction(t))return t.call(this,a,r);if(I.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Dn(e),e){const r=I.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||As(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let a=!1;function o(u){if(u=Dn(u),u){const d=I.findKey(r,u);d&&(!t||As(r,r[d],d,t))&&(delete r[d],a=!0)}}return I.isArray(e)?e.forEach(o):o(e),a}clear(e){const t=Object.keys(this);let r=t.length,a=!1;for(;r--;){const o=t[r];(!e||As(this,this[o],o,e,!0))&&(delete this[o],a=!0)}return a}normalize(e){const t=this,r={};return I.forEach(this,(a,o)=>{const u=I.findKey(r,o);if(u){t[u]=xr(a),delete t[o];return}const d=e?Tl(o):String(o).trim();d!==o&&delete t[o],t[d]=xr(a),r[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return I.forEach(this,(r,a)=>{r!=null&&r!==!1&&(t[a]=e&&I.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(a=>r.set(a)),r}static accessor(e){const r=(this[lo]=this[lo]={accessors:{}}).accessors,a=this.prototype;function o(u){const d=Dn(u);r[d]||(Cl(a,u),r[d]=!0)}return I.isArray(e)?e.forEach(o):o(e),this}}Ur.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Ur.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(r){this[t]=r}}});I.freezeMethods(Ur);const ft=Ur;function Rs(i,e){const t=this||ai,r=e||t,a=ft.from(r.headers);let o=r.data;return I.forEach(i,function(d){o=d.call(t,o,a.normalize(),e?e.status:void 0)}),a.normalize(),o}function Yo(i){return!!(i&&i.__CANCEL__)}function zn(i,e,t){ae.call(this,i??"canceled",ae.ERR_CANCELED,e,t),this.name="CanceledError"}I.inherits(zn,ae,{__CANCEL__:!0});function Al(i,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?i(t):e(new ae("Request failed with status code "+t.status,[ae.ERR_BAD_REQUEST,ae.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Rl=it.hasStandardBrowserEnv?{write(i,e,t,r,a,o){const u=[i+"="+encodeURIComponent(e)];I.isNumber(t)&&u.push("expires="+new Date(t).toGMTString()),I.isString(r)&&u.push("path="+r),I.isString(a)&&u.push("domain="+a),o===!0&&u.push("secure"),document.cookie=u.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function jl(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function Il(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function Xo(i,e){return i&&!jl(e)?Il(i,e):e}const Dl=it.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function a(o){let u=o;return e&&(t.setAttribute("href",u),u=t.href),t.setAttribute("href",u),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=a(window.location.href),function(u){const d=I.isString(u)?a(u):u;return d.protocol===r.protocol&&d.host===r.host}}():function(){return function(){return!0}}();function Nl(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function $l(i,e){i=i||10;const t=new Array(i),r=new Array(i);let a=0,o=0,u;return e=e!==void 0?e:1e3,function(p){const y=Date.now(),g=r[o];u||(u=y),t[a]=p,r[a]=y;let w=o,N=0;for(;w!==a;)N+=t[w++],w=w%i;if(a=(a+1)%i,a===o&&(o=(o+1)%i),y-u<e)return;const $=g&&y-g;return $?Math.round(N*1e3/$):void 0}}function ho(i,e){let t=0;const r=$l(50,250);return a=>{const o=a.loaded,u=a.lengthComputable?a.total:void 0,d=o-t,p=r(d),y=o<=u;t=o;const g={loaded:o,total:u,progress:u?o/u:void 0,bytes:d,rate:p||void 0,estimated:p&&u&&y?(u-o)/p:void 0,event:a};g[e?"download":"upload"]=!0,i(g)}}const Ll=typeof XMLHttpRequest<"u",Ul=Ll&&function(i){return new Promise(function(t,r){let a=i.data;const o=ft.from(i.headers).normalize();let{responseType:u,withXSRFToken:d}=i,p;function y(){i.cancelToken&&i.cancelToken.unsubscribe(p),i.signal&&i.signal.removeEventListener("abort",p)}let g;if(I.isFormData(a)){if(it.hasStandardBrowserEnv||it.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((g=o.getContentType())!==!1){const[U,...V]=g?g.split(";").map(se=>se.trim()).filter(Boolean):[];o.setContentType([U||"multipart/form-data",...V].join("; "))}}let w=new XMLHttpRequest;if(i.auth){const U=i.auth.username||"",V=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";o.set("Authorization","Basic "+btoa(U+":"+V))}const N=Xo(i.baseURL,i.url);w.open(i.method.toUpperCase(),Ho(N,i.params,i.paramsSerializer),!0),w.timeout=i.timeout;function $(){if(!w)return;const U=ft.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),se={data:!u||u==="text"||u==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:U,config:i,request:w};Al(function(he){t(he),y()},function(he){r(he),y()},se),w=null}if("onloadend"in w?w.onloadend=$:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout($)},w.onabort=function(){w&&(r(new ae("Request aborted",ae.ECONNABORTED,i,w)),w=null)},w.onerror=function(){r(new ae("Network Error",ae.ERR_NETWORK,i,w)),w=null},w.ontimeout=function(){let V=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const se=i.transitional||Vo;i.timeoutErrorMessage&&(V=i.timeoutErrorMessage),r(new ae(V,se.clarifyTimeoutError?ae.ETIMEDOUT:ae.ECONNABORTED,i,w)),w=null},it.hasStandardBrowserEnv&&(d&&I.isFunction(d)&&(d=d(i)),d||d!==!1&&Dl(N))){const U=i.xsrfHeaderName&&i.xsrfCookieName&&Rl.read(i.xsrfCookieName);U&&o.set(i.xsrfHeaderName,U)}a===void 0&&o.setContentType(null),"setRequestHeader"in w&&I.forEach(o.toJSON(),function(V,se){w.setRequestHeader(se,V)}),I.isUndefined(i.withCredentials)||(w.withCredentials=!!i.withCredentials),u&&u!=="json"&&(w.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&w.addEventListener("progress",ho(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&w.upload&&w.upload.addEventListener("progress",ho(i.onUploadProgress)),(i.cancelToken||i.signal)&&(p=U=>{w&&(r(!U||U.type?new zn(null,i,w):U),w.abort(),w=null)},i.cancelToken&&i.cancelToken.subscribe(p),i.signal&&(i.signal.aborted?p():i.signal.addEventListener("abort",p)));const L=Nl(N);if(L&&it.protocols.indexOf(L)===-1){r(new ae("Unsupported protocol "+L+":",ae.ERR_BAD_REQUEST,i));return}w.send(a||null)})},Ks={http:ul,xhr:Ul};I.forEach(Ks,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const fo=i=>`- ${i}`,Fl=i=>I.isFunction(i)||i===null||i===!1,Qo={getAdapter:i=>{i=I.isArray(i)?i:[i];const{length:e}=i;let t,r;const a={};for(let o=0;o<e;o++){t=i[o];let u;if(r=t,!Fl(t)&&(r=Ks[(u=String(t)).toLowerCase()],r===void 0))throw new ae(`Unknown adapter '${u}'`);if(r)break;a[u||"#"+o]=r}if(!r){const o=Object.entries(a).map(([d,p])=>`adapter ${d} `+(p===!1?"is not supported by the environment":"is not available in the build"));let u=e?o.length>1?`since :
`+o.map(fo).join(`
`):" "+fo(o[0]):"as no adapter specified";throw new ae("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return r},adapters:Ks};function js(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new zn(null,i)}function po(i){return js(i),i.headers=ft.from(i.headers),i.data=Rs.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Qo.getAdapter(i.adapter||ai.adapter)(i).then(function(r){return js(i),r.data=Rs.call(i,i.transformResponse,r),r.headers=ft.from(r.headers),r},function(r){return Yo(r)||(js(i),r&&r.response&&(r.response.data=Rs.call(i,i.transformResponse,r.response),r.response.headers=ft.from(r.response.headers))),Promise.reject(r)})}const mo=i=>i instanceof ft?i.toJSON():i;function fn(i,e){e=e||{};const t={};function r(y,g,w){return I.isPlainObject(y)&&I.isPlainObject(g)?I.merge.call({caseless:w},y,g):I.isPlainObject(g)?I.merge({},g):I.isArray(g)?g.slice():g}function a(y,g,w){if(I.isUndefined(g)){if(!I.isUndefined(y))return r(void 0,y,w)}else return r(y,g,w)}function o(y,g){if(!I.isUndefined(g))return r(void 0,g)}function u(y,g){if(I.isUndefined(g)){if(!I.isUndefined(y))return r(void 0,y)}else return r(void 0,g)}function d(y,g,w){if(w in e)return r(y,g);if(w in i)return r(void 0,y)}const p={url:o,method:o,data:o,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(y,g)=>a(mo(y),mo(g),!0)};return I.forEach(Object.keys(Object.assign({},i,e)),function(g){const w=p[g]||a,N=w(i[g],e[g],g);I.isUndefined(N)&&w!==d||(t[g]=N)}),t}const Zo="1.6.7",ci={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{ci[i]=function(r){return typeof r===i||"a"+(e<1?"n ":" ")+i}});const yo={};ci.transitional=function(e,t,r){function a(o,u){return"[Axios v"+Zo+"] Transitional option '"+o+"'"+u+(r?". "+r:"")}return(o,u,d)=>{if(e===!1)throw new ae(a(u," has been removed"+(t?" in "+t:"")),ae.ERR_DEPRECATED);return t&&!yo[u]&&(yo[u]=!0,console.warn(a(u," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,u,d):!0}};function Bl(i,e,t){if(typeof i!="object")throw new ae("options must be an object",ae.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let a=r.length;for(;a-- >0;){const o=r[a],u=e[o];if(u){const d=i[o],p=d===void 0||u(d,o,i);if(p!==!0)throw new ae("option "+o+" must be "+p,ae.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ae("Unknown option "+o,ae.ERR_BAD_OPTION)}}const zs={assertOptions:Bl,validators:ci},xt=zs.validators;class Cr{constructor(e){this.defaults=e,this.interceptors={request:new uo,response:new uo}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let a;Error.captureStackTrace?Error.captureStackTrace(a={}):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=fn(this.defaults,t);const{transitional:r,paramsSerializer:a,headers:o}=t;r!==void 0&&zs.assertOptions(r,{silentJSONParsing:xt.transitional(xt.boolean),forcedJSONParsing:xt.transitional(xt.boolean),clarifyTimeoutError:xt.transitional(xt.boolean)},!1),a!=null&&(I.isFunction(a)?t.paramsSerializer={serialize:a}:zs.assertOptions(a,{encode:xt.function,serialize:xt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=o&&I.merge(o.common,o[t.method]);o&&I.forEach(["delete","get","head","post","put","patch","common"],L=>{delete o[L]}),t.headers=ft.concat(u,o);const d=[];let p=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(t)===!1||(p=p&&U.synchronous,d.unshift(U.fulfilled,U.rejected))});const y=[];this.interceptors.response.forEach(function(U){y.push(U.fulfilled,U.rejected)});let g,w=0,N;if(!p){const L=[po.bind(this),void 0];for(L.unshift.apply(L,d),L.push.apply(L,y),N=L.length,g=Promise.resolve(t);w<N;)g=g.then(L[w++],L[w++]);return g}N=d.length;let $=t;for(w=0;w<N;){const L=d[w++],U=d[w++];try{$=L($)}catch(V){U.call(this,V);break}}try{g=po.call(this,$)}catch(L){return Promise.reject(L)}for(w=0,N=y.length;w<N;)g=g.then(y[w++],y[w++]);return g}getUri(e){e=fn(this.defaults,e);const t=Xo(e.baseURL,e.url);return Ho(t,e.params,e.paramsSerializer)}}I.forEach(["delete","get","head","options"],function(e){Cr.prototype[e]=function(t,r){return this.request(fn(r||{},{method:e,url:t,data:(r||{}).data}))}});I.forEach(["post","put","patch"],function(e){function t(r){return function(o,u,d){return this.request(fn(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:u}))}}Cr.prototype[e]=t(),Cr.prototype[e+"Form"]=t(!0)});const Tr=Cr;class ui{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const r=this;this.promise.then(a=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](a);r._listeners=null}),this.promise.then=a=>{let o;const u=new Promise(d=>{r.subscribe(d),o=d}).then(a);return u.cancel=function(){r.unsubscribe(o)},u},e(function(o,u,d){r.reason||(r.reason=new zn(o,u,d),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new ui(function(a){e=a}),cancel:e}}}const ql=ui;function Ml(i){return function(t){return i.apply(null,t)}}function Kl(i){return I.isObject(i)&&i.isAxiosError===!0}const Js={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Js).forEach(([i,e])=>{Js[e]=i});const zl=Js;function ea(i){const e=new Tr(i),t=Do(Tr.prototype.request,e);return I.extend(t,Tr.prototype,e,{allOwnKeys:!0}),I.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return ea(fn(i,a))},t}const de=ea(ai);de.Axios=Tr;de.CanceledError=zn;de.CancelToken=ql;de.isCancel=Yo;de.VERSION=Zo;de.toFormData=Lr;de.AxiosError=ae;de.Cancel=de.CanceledError;de.all=function(e){return Promise.all(e)};de.spread=Ml;de.isAxiosError=Kl;de.mergeConfig=fn;de.AxiosHeaders=ft;de.formToJSON=i=>Go(I.isHTMLForm(i)?new FormData(i):i);de.getAdapter=Qo.getAdapter;de.HttpStatusCode=zl;de.default=de;const Jl={id:"",title:"",description:"",journals:[],isComplete:!1,reward:""},Hl={backpack:[],equipment:{head:null,body:null,legs:null,feet:null,hands:null,weapon:null,shield:null,accessory:null}},ta={},Vl={inCombat:!1,isDead:!1,isResting:!1,activeBoosts:{}},Wl={username:"Guest",health:"100",mana:"100",energy:"100",maxHealth:"100",maxMana:"100",maxEnergy:"100",armour:"0",agility:"0",strength:"0",intelligence:"0",experience:"0",reputation:"0",faith:"0"},Gl={stats:Wl,inventory:Hl,state:Vl},Yl={tooltipItem:{id:null,position:{x:0,y:0}},submenuItem:{id:null,position:{x:0,y:0}},tooltipNPC:{id:null,position:{x:0,y:0}},isStatsMenuCollapsed:!1,isSettingsMenuCollapsed:!1,debugMode:!1,textSpeed:40},Xl={gamemode:"Idle",action:{type:"ROLL_DICE",diceValues:[],isRolling:!1},textures:{side1:"",side2:"",side3:"",side4:"",side5:"",side6:""}};function Vt(i,e){return Ba(i,e,{encode(t){return JSON.stringify(t)},decode(t){try{return JSON.parse(t)}catch{return e}}})}Vt("playerData",Gl);Vt("quest",Jl);Vt("items",ta);Vt("notifications",[]);Vt("itemDB",ta);const Hs=Vt("settings",Yl);Vt("minigameState",Xl);const Ql=i=>Hs.get()[i],na=(i,e)=>{qa(async()=>{const t=Hs.get();Hs.set({...t,[i]:e})})},Zl=()=>{na("debugMode",!0)},eh=()=>{na("debugMode",!1)},Fr=()=>Ql("debugMode"),Ar=i=>typeof i=="string"?i:JSON.stringify(i,null,2),th=i=>{Fr()&&console.log(`[DEBUG] ${Ar(i)}`)},nh=i=>{Fr()&&console.warn(`[DEBUG] ${Ar(i)}`)},rh=(i,e)=>{Fr()&&(e instanceof Error?console.error(`[DEBUG] ${Ar(i)} - Error: ${e.message}
${e.stack}`):console.error(`[DEBUG] ${Ar(i)}`))},H={enable:Zl,disable:eh,isEnabled:Fr,log:th,warn:nh,error:rh};class sh{constructor(){this.events={},this.lastEmitted=new Map}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e]?.push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e]?.filter(r=>r!==t))}emit(e,t,r=0,a){const o=Date.now(),u=this.lastEmitted.get(e)||0;if(o-u>=r){if(!this.events[e])return;this.events[e]?.forEach(d=>d(t)),a&&H.isEnabled()&&H.log(`Event: ${String(e)} - Message: ${a}`),H.isEnabled()&&H.log(`Event Data: ${String(e)} - Data: ${t?JSON.stringify(t):"No data"}`),this.lastEmitted.set(e,o)}}}const Nn=new sh;function ih(i){const{elementIdOrName:e,duration:t=500,onComplete:r}=i;let a=null;if(a=document.getElementById(e),!a){const o=document.getElementsByName(e);o.length>0&&(a=o[0])}if(!a){H.error(`Loader element with ID or name "${e}" not found.`);return}if(!(a instanceof HTMLElement)){H.error(`Element found by "${e}" is not an HTMLElement.`);return}H.log(`Removing loader element with ID or name "${e}" with duration ${t}ms.`),a.classList.add("opacity-0","transition-opacity",`duration-${t}`),setTimeout(()=>{a.style.display="none",H.log(`Loader element with ID or name "${e}" has been hidden.`),r&&r()},t)}var ra={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(qi,function(){var t=function(n,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(c[h]=l[h])})(n,s)},r=function(){return(r=Object.assign||function(n){for(var s,c=1,l=arguments.length;c<l;c++)for(var h in s=arguments[c])Object.prototype.hasOwnProperty.call(s,h)&&(n[h]=s[h]);return n}).apply(this,arguments)};function a(n,s,c){if(c||arguments.length===2)for(var l,h=0,f=s.length;h<f;h++)!l&&h in s||((l=l||Array.prototype.slice.call(s,0,h))[h]=s[h]);return n.concat(l||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:qi,u=Object.keys,d=Array.isArray;function p(n,s){return typeof s!="object"||u(s).forEach(function(c){n[c]=s[c]}),n}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var y=Object.getPrototypeOf,g={}.hasOwnProperty;function w(n,s){return g.call(n,s)}function N(n,s){typeof s=="function"&&(s=s(y(n))),(typeof Reflect>"u"?u:Reflect.ownKeys)(s).forEach(function(c){L(n,c,s[c])})}var $=Object.defineProperty;function L(n,s,c,l){$(n,s,p(c&&w(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},l))}function U(n){return{from:function(s){return n.prototype=Object.create(s.prototype),L(n.prototype,"constructor",n),{extend:N.bind(null,n.prototype)}}}}var V=Object.getOwnPropertyDescriptor,se=[].slice;function fe(n,s,c){return se.call(n,s,c)}function he(n,s){return s(n)}function Z(n){if(!n)throw new Error("Assertion Failed")}function Oe(n){o.setImmediate?setImmediate(n):setTimeout(n,0)}function xe(n,s){if(typeof s=="string"&&w(n,s))return n[s];if(!s)return n;if(typeof s!="string"){for(var c=[],l=0,h=s.length;l<h;++l){var f=xe(n,s[l]);c.push(f)}return c}var m=s.indexOf(".");if(m!==-1){var v=n[s.substr(0,m)];return v==null?void 0:xe(v,s.substr(m+1))}}function we(n,s,c){if(n&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof s!="string"&&"length"in s){Z(typeof c!="string"&&"length"in c);for(var l=0,h=s.length;l<h;++l)we(n,s[l],c[l])}else{var f,m,v=s.indexOf(".");v!==-1?(f=s.substr(0,v),(m=s.substr(v+1))===""?c===void 0?d(n)&&!isNaN(parseInt(f))?n.splice(f,1):delete n[f]:n[f]=c:we(v=!(v=n[f])||!w(n,f)?n[f]={}:v,m,c)):c===void 0?d(n)&&!isNaN(parseInt(s))?n.splice(s,1):delete n[s]:n[s]=c}}function yn(n){var s,c={};for(s in n)w(n,s)&&(c[s]=n[s]);return c}var gn=[].concat;function pt(n){return gn.apply([],n)}var ht="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(pt([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(s){return s+n+"Array"})}))).filter(function(n){return o[n]}),je=new Set(ht.map(function(n){return o[n]})),at=null;function Ie(n){return at=new WeakMap,n=function s(c){if(!c||typeof c!="object")return c;var l=at.get(c);if(l)return l;if(d(c)){l=[],at.set(c,l);for(var h=0,f=c.length;h<f;++h)l.push(s(c[h]))}else if(je.has(c.constructor))l=c;else{var m,v=y(c);for(m in l=v===Object.prototype?{}:Object.create(v),at.set(c,l),c)w(c,m)&&(l[m]=s(c[m]))}return l}(n),at=null,n}var ct={}.toString;function Wt(n){return ct.call(n).slice(8,-1)}var Rt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",jt=typeof Rt=="symbol"?function(n){var s;return n!=null&&(s=n[Rt])&&s.apply(n)}:function(){return null};function _e(n,s){return s=n.indexOf(s),0<=s&&n.splice(s,1),0<=s}var Ze={};function Fe(n){var s,c,l,h;if(arguments.length===1){if(d(n))return n.slice();if(this===Ze&&typeof n=="string")return[n];if(h=jt(n)){for(c=[];!(l=h.next()).done;)c.push(l.value);return c}if(n==null)return[n];if(typeof(s=n.length)!="number")return[n];for(c=new Array(s);s--;)c[s]=n[s];return c}for(s=arguments.length,c=new Array(s);s--;)c[s]=arguments[s];return c}var et=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},vt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(vt),vn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function De(n,s){this.name=n,this.message=s}function mt(n,s){return n+". Errors: "+Object.keys(s).map(function(c){return s[c].toString()}).filter(function(c,l,h){return h.indexOf(c)===l}).join(`
`)}function ut(n,s,c,l){this.failures=s,this.failedKeys=l,this.successCount=c,this.message=mt(n,s)}function tt(n,s){this.name="BulkError",this.failures=Object.keys(s).map(function(c){return s[c]}),this.failuresByPos=s,this.message=mt(n,this.failures)}U(De).from(Error).extend({toString:function(){return this.name+": "+this.message}}),U(ut).from(De),U(tt).from(De);var Gt=Ve.reduce(function(n,s){return n[s]=s+"Error",n},{}),Ce=De,J=Ve.reduce(function(n,s){var c=s+"Error";function l(h,f){this.name=c,h?typeof h=="string"?(this.message="".concat(h).concat(f?`
 `+f:""),this.inner=f||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=vn[s]||c,this.inner=null)}return U(l).from(Ce),n[s]=l,n},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var Te=vt.reduce(function(n,s){return n[s+"Error"]=J[s],n},{}),ce=Ve.reduce(function(n,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(n[s+"Error"]=J[s]),n},{});function G(){}function He(n){return n}function Jn(n,s){return n==null||n===He?s:function(c){return s(n(c))}}function Pe(n,s){return function(){n.apply(this,arguments),s.apply(this,arguments)}}function Yt(n,s){return n===G?s:function(){var c=n.apply(this,arguments);c!==void 0&&(arguments[0]=c);var l=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var f=s.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?Pe(l,this.onsuccess):l),h&&(this.onerror=this.onerror?Pe(h,this.onerror):h),f!==void 0?f:c}}function Hn(n,s){return n===G?s:function(){n.apply(this,arguments);var c=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?Pe(c,this.onsuccess):c),l&&(this.onerror=this.onerror?Pe(l,this.onerror):l)}}function Xt(n,s){return n===G?s:function(c){var l=n.apply(this,arguments);p(c,l);var h=this.onsuccess,f=this.onerror;return this.onsuccess=null,this.onerror=null,c=s.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?Pe(h,this.onsuccess):h),f&&(this.onerror=this.onerror?Pe(f,this.onerror):f),l===void 0?c===void 0?void 0:c:p(l,c)}}function Vn(n,s){return n===G?s:function(){return s.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function yt(n,s){return n===G?s:function(){var c=n.apply(this,arguments);if(c&&typeof c.then=="function"){for(var l=this,h=arguments.length,f=new Array(h);h--;)f[h]=arguments[h];return c.then(function(){return s.apply(l,f)})}return s.apply(this,arguments)}}ce.ModifyError=ut,ce.DexieError=De,ce.BulkError=tt;var Ke=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function It(n){Ke=n}var gt={},bn=100,ht=typeof Promise>"u"?[]:function(){var n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,y(n),n];var s=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[s,y(s),n]}(),vt=ht[0],Ve=ht[1],ht=ht[2],Ve=Ve&&Ve.then,wn=vt&&vt.constructor,Br=!!ht,_n=function(n,s){kn.push([n,s]),Wn&&(queueMicrotask(oa),Wn=!1)},qr=!0,Wn=!0,Dt=[],Gn=[],Mr=He,bt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:G,pgp:!1,env:{},finalize:G},W=bt,kn=[],Nt=0,Yn=[];function z(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=W;if(typeof n!="function"){if(n!==gt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&zr(this,this._value))}this._state=null,this._value=null,++s.ref,function c(l,h){try{h(function(f){if(l._state===null){if(f===l)throw new TypeError("A promise cannot be resolved with itself.");var m=l._lib&&Qt();f&&typeof f.then=="function"?c(l,function(v,E){f instanceof z?f._then(v,E):f.then(v,E)}):(l._state=!0,l._value=f,hi(l)),m&&Zt()}},zr.bind(null,l))}catch(f){zr(l,f)}}(this,n)}var Kr={get:function(){var n=W,s=er;function c(l,h){var f=this,m=!n.global&&(n!==W||s!==er),v=m&&!_t(),E=new z(function(_,P){Jr(f,new li(fi(l,n,m,v),fi(h,n,m,v),_,P,n))});return this._consoleTask&&(E._consoleTask=this._consoleTask),E}return c.prototype=gt,c},set:function(n){L(this,"then",n&&n.prototype===gt?Kr:{get:function(){return n},set:Kr.set})}};function li(n,s,c,l,h){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof s=="function"?s:null,this.resolve=c,this.reject=l,this.psd=h}function zr(n,s){var c,l;Gn.push(s),n._state===null&&(c=n._lib&&Qt(),s=Mr(s),n._state=!1,n._value=s,l=n,Dt.some(function(h){return h._value===l._value})||Dt.push(l),hi(n),c&&Zt())}function hi(n){var s=n._listeners;n._listeners=[];for(var c=0,l=s.length;c<l;++c)Jr(n,s[c]);var h=n._PSD;--h.ref||h.finalize(),Nt===0&&(++Nt,_n(function(){--Nt==0&&Hr()},[]))}function Jr(n,s){if(n._state!==null){var c=n._state?s.onFulfilled:s.onRejected;if(c===null)return(n._state?s.resolve:s.reject)(n._value);++s.psd.ref,++Nt,_n(ia,[c,n,s])}else n._listeners.push(s)}function ia(n,s,c){try{var l,h=s._value;!s._state&&Gn.length&&(Gn=[]),l=Ke&&s._consoleTask?s._consoleTask.run(function(){return n(h)}):n(h),s._state||Gn.indexOf(h)!==-1||function(f){for(var m=Dt.length;m;)if(Dt[--m]._value===f._value)return Dt.splice(m,1)}(s),c.resolve(l)}catch(f){c.reject(f)}finally{--Nt==0&&Hr(),--c.psd.ref||c.psd.finalize()}}function oa(){$t(bt,function(){Qt()&&Zt()})}function Qt(){var n=qr;return Wn=qr=!1,n}function Zt(){var n,s,c;do for(;0<kn.length;)for(n=kn,kn=[],c=n.length,s=0;s<c;++s){var l=n[s];l[0].apply(null,l[1])}while(0<kn.length);Wn=qr=!0}function Hr(){var n=Dt;Dt=[],n.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var s=Yn.slice(0),c=s.length;c;)s[--c]()}function Xn(n){return new z(gt,!1,n)}function be(n,s){var c=W;return function(){var l=Qt(),h=W;try{return kt(c,!0),n.apply(this,arguments)}catch(f){s&&s(f)}finally{kt(h,!1),l&&Zt()}}}N(z.prototype,{then:Kr,_then:function(n,s){Jr(this,new li(null,null,n,s,W))},catch:function(n){if(arguments.length===1)return this.then(null,n);var s=n,c=arguments[1];return typeof s=="function"?this.then(null,function(l){return(l instanceof s?c:Xn)(l)}):this.then(null,function(l){return(l&&l.name===s?c:Xn)(l)})},finally:function(n){return this.then(function(s){return z.resolve(n()).then(function(){return s})},function(s){return z.resolve(n()).then(function(){return Xn(s)})})},timeout:function(n,s){var c=this;return n<1/0?new z(function(l,h){var f=setTimeout(function(){return h(new J.Timeout(s))},n);c.then(l,h).finally(clearTimeout.bind(null,f))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(z.prototype,Symbol.toStringTag,"Dexie.Promise"),bt.env=di(),N(z,{all:function(){var n=Fe.apply(null,arguments).map(tr);return new z(function(s,c){n.length===0&&s([]);var l=n.length;n.forEach(function(h,f){return z.resolve(h).then(function(m){n[f]=m,--l||s(n)},c)})})},resolve:function(n){return n instanceof z?n:n&&typeof n.then=="function"?new z(function(s,c){n.then(s,c)}):new z(gt,!0,n)},reject:Xn,race:function(){var n=Fe.apply(null,arguments).map(tr);return new z(function(s,c){n.map(function(l){return z.resolve(l).then(s,c)})})},PSD:{get:function(){return W},set:function(n){return W=n}},totalEchoes:{get:function(){return er}},newPSD:wt,usePSD:$t,scheduler:{get:function(){return _n},set:function(n){_n=n}},rejectionMapper:{get:function(){return Mr},set:function(n){Mr=n}},follow:function(n,s){return new z(function(c,l){return wt(function(h,f){var m=W;m.unhandleds=[],m.onunhandled=f,m.finalize=Pe(function(){var v,E=this;v=function(){E.unhandleds.length===0?h():f(E.unhandleds[0])},Yn.push(function _(){v(),Yn.splice(Yn.indexOf(_),1)}),++Nt,_n(function(){--Nt==0&&Hr()},[])},m.finalize),n()},s,c,l)})}}),wn&&(wn.allSettled&&L(z,"allSettled",function(){var n=Fe.apply(null,arguments).map(tr);return new z(function(s){n.length===0&&s([]);var c=n.length,l=new Array(c);n.forEach(function(h,f){return z.resolve(h).then(function(m){return l[f]={status:"fulfilled",value:m}},function(m){return l[f]={status:"rejected",reason:m}}).then(function(){return--c||s(l)})})})}),wn.any&&typeof AggregateError<"u"&&L(z,"any",function(){var n=Fe.apply(null,arguments).map(tr);return new z(function(s,c){n.length===0&&c(new AggregateError([]));var l=n.length,h=new Array(l);n.forEach(function(f,m){return z.resolve(f).then(function(v){return s(v)},function(v){h[m]=v,--l||c(new AggregateError(h))})})})}));var Ae={awaits:0,echoes:0,id:0},aa=0,Qn=[],Zn=0,er=0,ca=0;function wt(n,s,c,l){var h=W,f=Object.create(h);return f.parent=h,f.ref=0,f.global=!1,f.id=++ca,bt.env,f.env=Br?{Promise:z,PromiseProp:{value:z,configurable:!0,writable:!0},all:z.all,race:z.race,allSettled:z.allSettled,any:z.any,resolve:z.resolve,reject:z.reject}:{},s&&p(f,s),++h.ref,f.finalize=function(){--this.parent.ref||this.parent.finalize()},l=$t(f,n,c,l),f.ref===0&&f.finalize(),l}function en(){return Ae.id||(Ae.id=++aa),++Ae.awaits,Ae.echoes+=bn,Ae.id}function _t(){return!!Ae.awaits&&(--Ae.awaits==0&&(Ae.id=0),Ae.echoes=Ae.awaits*bn,!0)}function tr(n){return Ae.echoes&&n&&n.constructor===wn?(en(),n.then(function(s){return _t(),s},function(s){return _t(),ke(s)})):n}function ua(){var n=Qn[Qn.length-1];Qn.pop(),kt(n,!1)}function kt(n,s){var c,l=W;(s?!Ae.echoes||Zn++&&n===W:!Zn||--Zn&&n===W)||queueMicrotask(s?function(h){++er,Ae.echoes&&--Ae.echoes!=0||(Ae.echoes=Ae.awaits=Ae.id=0),Qn.push(W),kt(h,!0)}.bind(null,n):ua),n!==W&&(W=n,l===bt&&(bt.env=di()),Br&&(c=bt.env.Promise,s=n.env,(l.global||n.global)&&(Object.defineProperty(o,"Promise",s.PromiseProp),c.all=s.all,c.race=s.race,c.resolve=s.resolve,c.reject=s.reject,s.allSettled&&(c.allSettled=s.allSettled),s.any&&(c.any=s.any))))}function di(){var n=o.Promise;return Br?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function $t(n,s,c,l,h){var f=W;try{return kt(n,!0),s(c,l,h)}finally{kt(f,!1)}}function fi(n,s,c,l){return typeof n!="function"?n:function(){var h=W;c&&en(),kt(s,!0);try{return n.apply(this,arguments)}finally{kt(h,!1),l&&queueMicrotask(_t)}}}function Vr(n){Promise===wn&&Ae.echoes===0?Zn===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+Ve).indexOf("[native code]")===-1&&(en=_t=G);var ke=z.reject,Lt="",lt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",pi="String expected.",tn=[],nr="__dbnames",Wr="readonly",Gr="readwrite";function Ut(n,s){return n?s?function(){return n.apply(this,arguments)&&s.apply(this,arguments)}:n:s}var mi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function rr(n){return typeof n!="string"||/\./.test(n)?function(s){return s}:function(s){return s[n]===void 0&&n in s&&delete(s=Ie(s))[n],s}}function yi(){throw J.Type()}function le(n,s){try{var c=gi(n),l=gi(s);if(c!==l)return c==="Array"?1:l==="Array"?-1:c==="binary"?1:l==="binary"?-1:c==="string"?1:l==="string"?-1:c==="Date"?1:l!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return s<n?1:n<s?-1:0;case"binary":return function(h,f){for(var m=h.length,v=f.length,E=m<v?m:v,_=0;_<E;++_)if(h[_]!==f[_])return h[_]<f[_]?-1:1;return m===v?0:m<v?-1:1}(vi(n),vi(s));case"Array":return function(h,f){for(var m=h.length,v=f.length,E=m<v?m:v,_=0;_<E;++_){var P=le(h[_],f[_]);if(P!==0)return P}return m===v?0:m<v?-1:1}(n,s)}}catch{}return NaN}function gi(n){var s=typeof n;return s!="object"?s:ArrayBuffer.isView(n)?"binary":(n=Wt(n),n==="ArrayBuffer"?"binary":n)}function vi(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var bi=(ve.prototype._trans=function(n,s,c){var l=this._tx||W.trans,h=this.name,f=Ke&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function m(_,P,b){if(!b.schema[h])throw new J.NotFound("Table "+h+" not part of transaction");return s(b.idbtrans,b)}var v=Qt();try{var E=l&&l.db._novip===this.db._novip?l===W.trans?l._promise(n,m,c):wt(function(){return l._promise(n,m,c)},{trans:l,transless:W.transless||W}):function _(P,b,x,k){if(P.idbdb&&(P._state.openComplete||W.letThrough||P._vip)){var O=P._createTransaction(b,x,P._dbSchema);try{O.create(),P._state.PR1398_maxLoop=3}catch(T){return T.name===Gt.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return _(P,b,x,k)})):ke(T)}return O._promise(b,function(T,S){return wt(function(){return W.trans=O,k(T,S,O)})}).then(function(T){if(b==="readwrite")try{O.idbtrans.commit()}catch{}return b==="readonly"?T:O._completion.then(function(){return T})})}if(P._state.openComplete)return ke(new J.DatabaseClosed(P._state.dbOpenError));if(!P._state.isBeingOpened){if(!P._state.autoOpen)return ke(new J.DatabaseClosed);P.open().catch(G)}return P._state.dbReadyPromise.then(function(){return _(P,b,x,k)})}(this.db,n,[this.name],m);return f&&(E._consoleTask=f,E=E.catch(function(_){return console.trace(_),ke(_)})),E}finally{v&&Zt()}},ve.prototype.get=function(n,s){var c=this;return n&&n.constructor===Object?this.where(n).first(s):n==null?ke(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return c.core.get({trans:l,key:n}).then(function(h){return c.hook.reading.fire(h)})}).then(s)},ve.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(d(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var s=u(n);if(s.length===1)return this.where(s[0]).equals(n[s[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(E){if(E.compound&&s.every(function(P){return 0<=E.keyPath.indexOf(P)})){for(var _=0;_<s.length;++_)if(s.indexOf(E.keyPath[_])===-1)return!1;return!0}return!1}).sort(function(E,_){return E.keyPath.length-_.keyPath.length})[0];if(c&&this.db._maxKey!==Lt){var m=c.keyPath.slice(0,s.length);return this.where(m).equals(m.map(function(_){return n[_]}))}!c&&Ke&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var l=this.schema.idxByName,h=this.db._deps.indexedDB;function f(E,_){return h.cmp(E,_)===0}var v=s.reduce(function(x,_){var P=x[0],b=x[1],x=l[_],k=n[_];return[P||x,P||!x?Ut(b,x&&x.multi?function(O){return O=xe(O,_),d(O)&&O.some(function(T){return f(k,T)})}:function(O){return f(k,xe(O,_))}):b]},[null,null]),m=v[0],v=v[1];return m?this.where(m.name).equals(n[m.keyPath]).filter(v):c?this.filter(v):this.where(s).equals("")},ve.prototype.filter=function(n){return this.toCollection().and(n)},ve.prototype.count=function(n){return this.toCollection().count(n)},ve.prototype.offset=function(n){return this.toCollection().offset(n)},ve.prototype.limit=function(n){return this.toCollection().limit(n)},ve.prototype.each=function(n){return this.toCollection().each(n)},ve.prototype.toArray=function(n){return this.toCollection().toArray(n)},ve.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ve.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,d(n)?"[".concat(n.join("+"),"]"):n))},ve.prototype.reverse=function(){return this.toCollection().reverse()},ve.prototype.mapToClass=function(n){var s,c=this.db,l=this.name;function h(){return s!==null&&s.apply(this,arguments)||this}(this.schema.mappedClass=n).prototype instanceof yi&&(function(E,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function P(){this.constructor=E}t(E,_),E.prototype=_===null?Object.create(_):(P.prototype=_.prototype,new P)}(h,s=n),Object.defineProperty(h.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),h.prototype.table=function(){return l},n=h);for(var f=new Set,m=n.prototype;m;m=y(m))Object.getOwnPropertyNames(m).forEach(function(E){return f.add(E)});function v(E){if(!E)return E;var _,P=Object.create(n.prototype);for(_ in E)if(!f.has(_))try{P[_]=E[_]}catch{}return P}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),n},ve.prototype.defineClass=function(){return this.mapToClass(function(n){p(this,n)})},ve.prototype.add=function(n,s){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=rr(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"add",keys:s!=null?[s]:null,values:[m]})}).then(function(v){return v.numFailures?z.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{we(n,f,v)}catch{}return v})},ve.prototype.update=function(n,s){return typeof n!="object"||d(n)?this.where(":id").equals(n).modify(s):(n=xe(n,this.schema.primKey.keyPath),n===void 0?ke(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(s))},ve.prototype.put=function(n,s){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=rr(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"put",values:[m],keys:s!=null?[s]:null})}).then(function(v){return v.numFailures?z.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{we(n,f,v)}catch{}return v})},ve.prototype.delete=function(n){var s=this;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:[n]})}).then(function(c){return c.numFailures?z.reject(c.failures[0]):void 0})},ve.prototype.clear=function(){var n=this;return this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"deleteRange",range:mi})}).then(function(s){return s.numFailures?z.reject(s.failures[0]):void 0})},ve.prototype.bulkGet=function(n){var s=this;return this._trans("readonly",function(c){return s.core.getMany({keys:n,trans:c}).then(function(l){return l.map(function(h){return s.hook.reading.fire(h)})})})},ve.prototype.bulkAdd=function(n,s,c){var l=this,h=Array.isArray(s)?s:void 0,f=(c=c||(h?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(m){var _=l.schema.primKey,v=_.auto,_=_.keyPath;if(_&&h)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var E=n.length,_=_&&v?n.map(rr(_)):n;return l.core.mutate({trans:m,type:"add",keys:h,values:_,wantResults:f}).then(function(O){var b=O.numFailures,x=O.results,k=O.lastResult,O=O.failures;if(b===0)return f?x:k;throw new tt("".concat(l.name,".bulkAdd(): ").concat(b," of ").concat(E," operations failed"),O)})})},ve.prototype.bulkPut=function(n,s,c){var l=this,h=Array.isArray(s)?s:void 0,f=(c=c||(h?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(m){var _=l.schema.primKey,v=_.auto,_=_.keyPath;if(_&&h)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var E=n.length,_=_&&v?n.map(rr(_)):n;return l.core.mutate({trans:m,type:"put",keys:h,values:_,wantResults:f}).then(function(O){var b=O.numFailures,x=O.results,k=O.lastResult,O=O.failures;if(b===0)return f?x:k;throw new tt("".concat(l.name,".bulkPut(): ").concat(b," of ").concat(E," operations failed"),O)})})},ve.prototype.bulkUpdate=function(n){var s=this,c=this.core,l=n.map(function(m){return m.key}),h=n.map(function(m){return m.changes}),f=[];return this._trans("readwrite",function(m){return c.getMany({trans:m,keys:l,cache:"clone"}).then(function(v){var E=[],_=[];n.forEach(function(b,x){var k=b.key,O=b.changes,T=v[x];if(T){for(var S=0,C=Object.keys(O);S<C.length;S++){var A=C[S],R=O[A];if(A===s.schema.primKey.keyPath){if(le(R,k)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else we(T,A,R)}f.push(x),E.push(k),_.push(T)}});var P=E.length;return c.mutate({trans:m,type:"put",keys:E,values:_,updates:{keys:l,changeSpecs:h}}).then(function(b){var x=b.numFailures,k=b.failures;if(x===0)return P;for(var O=0,T=Object.keys(k);O<T.length;O++){var S,C=T[O],A=f[Number(C)];A!=null&&(S=k[C],delete k[C],k[A]=S)}throw new tt("".concat(s.name,".bulkUpdate(): ").concat(x," of ").concat(P," operations failed"),k)})})})},ve.prototype.bulkDelete=function(n){var s=this,c=n.length;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:n})}).then(function(m){var h=m.numFailures,f=m.lastResult,m=m.failures;if(h===0)return f;throw new tt("".concat(s.name,".bulkDelete(): ").concat(h," of ").concat(c," operations failed"),m)})},ve);function ve(){}function En(n){function s(m,v){if(v){for(var E=arguments.length,_=new Array(E-1);--E;)_[E-1]=arguments[E];return c[m].subscribe.apply(null,_),n}if(typeof m=="string")return c[m]}var c={};s.addEventType=f;for(var l=1,h=arguments.length;l<h;++l)f(arguments[l]);return s;function f(m,v,E){if(typeof m!="object"){var _;v=v||Vn;var P={subscribers:[],fire:E=E||G,subscribe:function(b){P.subscribers.indexOf(b)===-1&&(P.subscribers.push(b),P.fire=v(P.fire,b))},unsubscribe:function(b){P.subscribers=P.subscribers.filter(function(x){return x!==b}),P.fire=P.subscribers.reduce(v,E)}};return c[m]=s[m]=P}u(_=m).forEach(function(b){var x=_[b];if(d(x))f(b,_[b][0],_[b][1]);else{if(x!=="asap")throw new J.InvalidArgument("Invalid event config");var k=f(b,He,function(){for(var O=arguments.length,T=new Array(O);O--;)T[O]=arguments[O];k.subscribers.forEach(function(S){Oe(function(){S.apply(null,T)})})})}})}}function Sn(n,s){return U(s).from({prototype:n}),s}function nn(n,s){return!(n.filter||n.algorithm||n.or)&&(s?n.justLimit:!n.replayFilter)}function Yr(n,s){n.filter=Ut(n.filter,s)}function Xr(n,s,c){var l=n.replayFilter;n.replayFilter=l?function(){return Ut(l(),s())}:s,n.justLimit=c&&!l}function sr(n,s){if(n.isPrimKey)return s.primaryKey;var c=s.getIndexByKeyPath(n.index);if(!c)throw new J.Schema("KeyPath "+n.index+" on object store "+s.name+" is not indexed");return c}function wi(n,s,c){var l=sr(n,s.schema);return s.openCursor({trans:c,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:l,range:n.range}})}function ir(n,s,c,l){var h=n.replayFilter?Ut(n.filter,n.replayFilter()):n.filter;if(n.or){var f={},m=function(v,E,_){var P,b;h&&!h(E,_,function(x){return E.stop(x)},function(x){return E.fail(x)})||((b=""+(P=E.primaryKey))=="[object ArrayBuffer]"&&(b=""+new Uint8Array(P)),w(f,b)||(f[b]=!0,s(v,E,_)))};return Promise.all([n.or._iterate(m,c),_i(wi(n,l,c),n.algorithm,m,!n.keysOnly&&n.valueMapper)])}return _i(wi(n,l,c),Ut(n.algorithm,h),s,!n.keysOnly&&n.valueMapper)}function _i(n,s,c,l){var h=be(l?function(f,m,v){return c(l(f),m,v)}:c);return n.then(function(f){if(f)return f.start(function(){var m=function(){return f.continue()};s&&!s(f,function(v){return m=v},function(v){f.stop(v),m=G},function(v){f.fail(v),m=G})||h(f.value,f,function(v){return m=v}),m()})})}var ht=Symbol(),On=(ki.prototype.execute=function(n){if(this.add!==void 0){var s=this.add;if(d(s))return a(a([],d(n)?n:[],!0),s,!0).sort();if(typeof s=="number")return(Number(n)||0)+s;if(typeof s=="bigint")try{return BigInt(n)+s}catch{return BigInt(0)+s}throw new TypeError("Invalid term ".concat(s))}if(this.remove!==void 0){var c=this.remove;if(d(c))return d(n)?n.filter(function(l){return!c.includes(l)}).sort():[];if(typeof c=="number")return Number(n)-c;if(typeof c=="bigint")try{return BigInt(n)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return s=(s=this.replacePrefix)===null||s===void 0?void 0:s[0],s&&typeof n=="string"&&n.startsWith(s)?this.replacePrefix[1]+n.substring(s.length):n},ki);function ki(n){Object.assign(this,n)}var la=(ue.prototype._read=function(n,s){var c=this._ctx;return c.error?c.table._trans(null,ke.bind(null,c.error)):c.table._trans("readonly",n).then(s)},ue.prototype._write=function(n){var s=this._ctx;return s.error?s.table._trans(null,ke.bind(null,s.error)):s.table._trans("readwrite",n,"locked")},ue.prototype._addAlgorithm=function(n){var s=this._ctx;s.algorithm=Ut(s.algorithm,n)},ue.prototype._iterate=function(n,s){return ir(this._ctx,n,s,this._ctx.table.core)},ue.prototype.clone=function(n){var s=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return n&&p(c,n),s._ctx=c,s},ue.prototype.raw=function(){return this._ctx.valueMapper=null,this},ue.prototype.each=function(n){var s=this._ctx;return this._read(function(c){return ir(s,n,c,s.table.core)})},ue.prototype.count=function(n){var s=this;return this._read(function(c){var l=s._ctx,h=l.table.core;if(nn(l,!0))return h.count({trans:c,query:{index:sr(l,h.schema),range:l.range}}).then(function(m){return Math.min(m,l.limit)});var f=0;return ir(l,function(){return++f,!1},c,h).then(function(){return f})}).then(n)},ue.prototype.sortBy=function(n,s){var c=n.split(".").reverse(),l=c[0],h=c.length-1;function f(E,_){return _?f(E[c[_]],_-1):E[l]}var m=this._ctx.dir==="next"?1:-1;function v(E,_){return E=f(E,h),_=f(_,h),E<_?-m:_<E?m:0}return this.toArray(function(E){return E.sort(v)}).then(s)},ue.prototype.toArray=function(n){var s=this;return this._read(function(c){var l=s._ctx;if(l.dir==="next"&&nn(l,!0)&&0<l.limit){var h=l.valueMapper,f=sr(l,l.table.core.schema);return l.table.core.query({trans:c,limit:l.limit,values:!0,query:{index:f,range:l.range}}).then(function(v){return v=v.result,h?v.map(h):v})}var m=[];return ir(l,function(v){return m.push(v)},c,l.table.core).then(function(){return m})},n)},ue.prototype.offset=function(n){var s=this._ctx;return n<=0||(s.offset+=n,nn(s)?Xr(s,function(){var c=n;return function(l,h){return c===0||(c===1?--c:h(function(){l.advance(c),c=0}),!1)}}):Xr(s,function(){var c=n;return function(){return--c<0}})),this},ue.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),Xr(this._ctx,function(){var s=n;return function(c,l,h){return--s<=0&&l(h),0<=s}},!0),this},ue.prototype.until=function(n,s){return Yr(this._ctx,function(c,l,h){return!n(c.value)||(l(h),s)}),this},ue.prototype.first=function(n){return this.limit(1).toArray(function(s){return s[0]}).then(n)},ue.prototype.last=function(n){return this.reverse().first(n)},ue.prototype.filter=function(n){var s;return Yr(this._ctx,function(c){return n(c.value)}),(s=this._ctx).isMatch=Ut(s.isMatch,n),this},ue.prototype.and=function(n){return this.filter(n)},ue.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},ue.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ue.prototype.desc=function(){return this.reverse()},ue.prototype.eachKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,l){n(l.key,l)})},ue.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},ue.prototype.eachPrimaryKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,l){n(l.primaryKey,l)})},ue.prototype.keys=function(n){var s=this._ctx;s.keysOnly=!s.isMatch;var c=[];return this.each(function(l,h){c.push(h.key)}).then(function(){return c}).then(n)},ue.prototype.primaryKeys=function(n){var s=this._ctx;if(s.dir==="next"&&nn(s,!0)&&0<s.limit)return this._read(function(l){var h=sr(s,s.table.core.schema);return s.table.core.query({trans:l,values:!1,limit:s.limit,query:{index:h,range:s.range}})}).then(function(l){return l.result}).then(n);s.keysOnly=!s.isMatch;var c=[];return this.each(function(l,h){c.push(h.primaryKey)}).then(function(){return c}).then(n)},ue.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},ue.prototype.firstKey=function(n){return this.limit(1).keys(function(s){return s[0]}).then(n)},ue.prototype.lastKey=function(n){return this.reverse().firstKey(n)},ue.prototype.distinct=function(){var n=this._ctx,n=n.index&&n.table.schema.idxByName[n.index];if(!n||!n.multi)return this;var s={};return Yr(this._ctx,function(h){var l=h.primaryKey.toString(),h=w(s,l);return s[l]=!0,!h}),this},ue.prototype.modify=function(n){var s=this,c=this._ctx;return this._write(function(l){var h,f,m;m=typeof n=="function"?n:(h=u(n),f=h.length,function(S){for(var C=!1,A=0;A<f;++A){var R=h[A],j=n[R],D=xe(S,R);j instanceof On?(we(S,R,j.execute(D)),C=!0):D!==j&&(we(S,R,j),C=!0)}return C});function v(S,R){var A=R.failures,R=R.numFailures;O+=S-R;for(var j=0,D=u(A);j<D.length;j++){var M=D[j];k.push(A[M])}}var E=c.table.core,_=E.schema.primaryKey,P=_.outbound,b=_.extractKey,x=s.db._options.modifyChunkSize||200,k=[],O=0,T=[];return s.clone().primaryKeys().then(function(S){function C(R){var j=Math.min(x,S.length-R);return E.getMany({trans:l,keys:S.slice(R,R+j),cache:"immutable"}).then(function(D){for(var M=[],F=[],q=P?[]:null,K=[],B=0;B<j;++B){var Y=D[B],X={value:Ie(Y),primKey:S[R+B]};m.call(X,X.value,X)!==!1&&(X.value==null?K.push(S[R+B]):P||le(b(Y),b(X.value))===0?(F.push(X.value),P&&q.push(S[R+B])):(K.push(S[R+B]),M.push(X.value)))}return Promise.resolve(0<M.length&&E.mutate({trans:l,type:"add",values:M}).then(function(re){for(var te in re.failures)K.splice(parseInt(te),1);v(M.length,re)})).then(function(){return(0<F.length||A&&typeof n=="object")&&E.mutate({trans:l,type:"put",keys:q,values:F,criteria:A,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<R}).then(function(re){return v(F.length,re)})}).then(function(){return(0<K.length||A&&n===Qr)&&E.mutate({trans:l,type:"delete",keys:K,criteria:A,isAdditionalChunk:0<R}).then(function(re){return v(K.length,re)})}).then(function(){return S.length>R+j&&C(R+x)})})}var A=nn(c)&&c.limit===1/0&&(typeof n!="function"||n===Qr)&&{index:c.index,range:c.range};return C(0).then(function(){if(0<k.length)throw new ut("Error modifying one or more objects",k,O,T);return S.length})})})},ue.prototype.delete=function(){var n=this._ctx,s=n.range;return nn(n)&&(n.isPrimKey||s.type===3)?this._write(function(c){var l=n.table.core.schema.primaryKey,h=s;return n.table.core.count({trans:c,query:{index:l,range:h}}).then(function(f){return n.table.core.mutate({trans:c,type:"deleteRange",range:h}).then(function(m){var v=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new ut("Could not delete some values",Object.keys(v).map(function(E){return v[E]}),f-m);return f-m})})}):this.modify(Qr)},ue);function ue(){}var Qr=function(n,s){return s.value=null};function ha(n,s){return n<s?-1:n===s?0:1}function da(n,s){return s<n?-1:n===s?0:1}function ze(n,s,c){return n=n instanceof Si?new n.Collection(n):n,n._ctx.error=new(c||TypeError)(s),n}function rn(n){return new n.Collection(n,function(){return Ei("")}).limit(0)}function or(n,s,c,l){var h,f,m,v,E,_,P,b=c.length;if(!c.every(function(O){return typeof O=="string"}))return ze(n,pi);function x(O){h=O==="next"?function(S){return S.toUpperCase()}:function(S){return S.toLowerCase()},f=O==="next"?function(S){return S.toLowerCase()}:function(S){return S.toUpperCase()},m=O==="next"?ha:da;var T=c.map(function(S){return{lower:f(S),upper:h(S)}}).sort(function(S,C){return m(S.lower,C.lower)});v=T.map(function(S){return S.upper}),E=T.map(function(S){return S.lower}),P=(_=O)==="next"?"":l}x("next"),n=new n.Collection(n,function(){return Et(v[0],E[b-1]+l)}),n._ondirectionchange=function(O){x(O)};var k=0;return n._addAlgorithm(function(O,T,S){var C=O.key;if(typeof C!="string")return!1;var A=f(C);if(s(A,E,k))return!0;for(var R=null,j=k;j<b;++j){var D=function(M,F,q,K,B,Y){for(var X=Math.min(M.length,K.length),re=-1,te=0;te<X;++te){var Ye=F[te];if(Ye!==K[te])return B(M[te],q[te])<0?M.substr(0,te)+q[te]+q.substr(te+1):B(M[te],K[te])<0?M.substr(0,te)+K[te]+q.substr(te+1):0<=re?M.substr(0,re)+F[re]+q.substr(re+1):null;B(M[te],Ye)<0&&(re=te)}return X<K.length&&Y==="next"?M+q.substr(M.length):X<M.length&&Y==="prev"?M.substr(0,q.length):re<0?null:M.substr(0,re)+K[re]+q.substr(re+1)}(C,A,v[j],E[j],m,_);D===null&&R===null?k=j+1:(R===null||0<m(R,D))&&(R=D)}return T(R!==null?function(){O.continue(R+P)}:S),!1}),n}function Et(n,s,c,l){return{type:2,lower:n,upper:s,lowerOpen:c,upperOpen:l}}function Ei(n){return{type:1,lower:n,upper:n}}var Si=(Object.defineProperty(Re.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Re.prototype.between=function(n,s,c,l){c=c!==!1,l=l===!0;try{return 0<this._cmp(n,s)||this._cmp(n,s)===0&&(c||l)&&(!c||!l)?rn(this):new this.Collection(this,function(){return Et(n,s,!c,!l)})}catch{return ze(this,lt)}},Re.prototype.equals=function(n){return n==null?ze(this,lt):new this.Collection(this,function(){return Ei(n)})},Re.prototype.above=function(n){return n==null?ze(this,lt):new this.Collection(this,function(){return Et(n,void 0,!0)})},Re.prototype.aboveOrEqual=function(n){return n==null?ze(this,lt):new this.Collection(this,function(){return Et(n,void 0,!1)})},Re.prototype.below=function(n){return n==null?ze(this,lt):new this.Collection(this,function(){return Et(void 0,n,!1,!0)})},Re.prototype.belowOrEqual=function(n){return n==null?ze(this,lt):new this.Collection(this,function(){return Et(void 0,n)})},Re.prototype.startsWith=function(n){return typeof n!="string"?ze(this,pi):this.between(n,n+Lt,!0,!0)},Re.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):or(this,function(s,c){return s.indexOf(c[0])===0},[n],Lt)},Re.prototype.equalsIgnoreCase=function(n){return or(this,function(s,c){return s===c[0]},[n],"")},Re.prototype.anyOfIgnoreCase=function(){var n=Fe.apply(Ze,arguments);return n.length===0?rn(this):or(this,function(s,c){return c.indexOf(s)!==-1},n,"")},Re.prototype.startsWithAnyOfIgnoreCase=function(){var n=Fe.apply(Ze,arguments);return n.length===0?rn(this):or(this,function(s,c){return c.some(function(l){return s.indexOf(l)===0})},n,Lt)},Re.prototype.anyOf=function(){var n=this,s=Fe.apply(Ze,arguments),c=this._cmp;try{s.sort(c)}catch{return ze(this,lt)}if(s.length===0)return rn(this);var l=new this.Collection(this,function(){return Et(s[0],s[s.length-1])});l._ondirectionchange=function(f){c=f==="next"?n._ascending:n._descending,s.sort(c)};var h=0;return l._addAlgorithm(function(f,m,v){for(var E=f.key;0<c(E,s[h]);)if(++h===s.length)return m(v),!1;return c(E,s[h])===0||(m(function(){f.continue(s[h])}),!1)}),l},Re.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Re.prototype.noneOf=function(){var n=Fe.apply(Ze,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return ze(this,lt)}var s=n.reduce(function(c,l){return c?c.concat([[c[c.length-1][1],l]]):[[-1/0,l]]},null);return s.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},Re.prototype.inAnyRange=function(C,s){var c=this,l=this._cmp,h=this._ascending,f=this._descending,m=this._min,v=this._max;if(C.length===0)return rn(this);if(!C.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&h(A[0],A[1])<=0}))return ze(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var E=!s||s.includeLowers!==!1,_=s&&s.includeUppers===!0,P,b=h;function x(A,R){return b(A[0],R[0])}try{(P=C.reduce(function(A,R){for(var j=0,D=A.length;j<D;++j){var M=A[j];if(l(R[0],M[1])<0&&0<l(R[1],M[0])){M[0]=m(M[0],R[0]),M[1]=v(M[1],R[1]);break}}return j===D&&A.push(R),A},[])).sort(x)}catch{return ze(this,lt)}var k=0,O=_?function(A){return 0<h(A,P[k][1])}:function(A){return 0<=h(A,P[k][1])},T=E?function(A){return 0<f(A,P[k][0])}:function(A){return 0<=f(A,P[k][0])},S=O,C=new this.Collection(this,function(){return Et(P[0][0],P[P.length-1][1],!E,!_)});return C._ondirectionchange=function(A){b=A==="next"?(S=O,h):(S=T,f),P.sort(x)},C._addAlgorithm(function(A,R,j){for(var D,M=A.key;S(M);)if(++k===P.length)return R(j),!1;return!O(D=M)&&!T(D)||(c._cmp(M,P[k][1])===0||c._cmp(M,P[k][0])===0||R(function(){b===h?A.continue(P[k][0]):A.continue(P[k][1])}),!1)}),C},Re.prototype.startsWithAnyOf=function(){var n=Fe.apply(Ze,arguments);return n.every(function(s){return typeof s=="string"})?n.length===0?rn(this):this.inAnyRange(n.map(function(s){return[s,s+Lt]})):ze(this,"startsWithAnyOf() only works with strings")},Re);function Re(){}function nt(n){return be(function(s){return Pn(s),n(s.target.error),!1})}function Pn(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var xn="storagemutated",Zr="x-storagemutated-1",St=En(null,xn),fa=(rt.prototype._lock=function(){return Z(!W.global),++this._reculock,this._reculock!==1||W.global||(W.lockOwnerFor=this),this},rt.prototype._unlock=function(){if(Z(!W.global),--this._reculock==0)for(W.global||(W.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{$t(n[1],n[0])}catch{}}return this},rt.prototype._locked=function(){return this._reculock&&W.lockOwnerFor!==this},rt.prototype.create=function(n){var s=this;if(!this.mode)return this;var c=this.db.idbdb,l=this.db._state.dbOpenError;if(Z(!this.idbtrans),!n&&!c)switch(l&&l.name){case"DatabaseClosedError":throw new J.DatabaseClosed(l);case"MissingAPIError":throw new J.MissingAPI(l.message,l);default:throw new J.OpenFailed(l)}if(!this.active)throw new J.TransactionInactive;return Z(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=be(function(h){Pn(h),s._reject(n.error)}),n.onabort=be(function(h){Pn(h),s.active&&s._reject(new J.Abort(n.error)),s.active=!1,s.on("abort").fire(h)}),n.oncomplete=be(function(){s.active=!1,s._resolve(),"mutatedParts"in n&&St.storagemutated.fire(n.mutatedParts)}),this},rt.prototype._promise=function(n,s,c){var l=this;if(n==="readwrite"&&this.mode!=="readwrite")return ke(new J.ReadOnly("Transaction is readonly"));if(!this.active)return ke(new J.TransactionInactive);if(this._locked())return new z(function(f,m){l._blockedFuncs.push([function(){l._promise(n,s,c).then(f,m)},W])});if(c)return wt(function(){var f=new z(function(m,v){l._lock();var E=s(m,v,l);E&&E.then&&E.then(m,v)});return f.finally(function(){return l._unlock()}),f._lib=!0,f});var h=new z(function(f,m){var v=s(f,m,l);v&&v.then&&v.then(f,m)});return h._lib=!0,h},rt.prototype._root=function(){return this.parent?this.parent._root():this},rt.prototype.waitFor=function(n){var s,c=this._root(),l=z.resolve(n);c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return l}):(c._waitingFor=l,c._waitingQueue=[],s=c.idbtrans.objectStore(c.storeNames[0]),function f(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(s.get(-1/0).onsuccess=f)}());var h=c._waitingFor;return new z(function(f,m){l.then(function(v){return c._waitingQueue.push(be(f.bind(null,v)))},function(v){return c._waitingQueue.push(be(m.bind(null,v)))}).finally(function(){c._waitingFor===h&&(c._waitingFor=null)})})},rt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},rt.prototype.table=function(n){var s=this._memoizedTables||(this._memoizedTables={});if(w(s,n))return s[n];var c=this.schema[n];if(!c)throw new J.NotFound("Table "+n+" not part of transaction");return c=new this.db.Table(n,c,this),c.core=this.db.core.table(n),s[n]=c},rt);function rt(){}function es(n,s,c,l,h,f,m){return{name:n,keyPath:s,unique:c,multi:l,auto:h,compound:f,src:(c&&!m?"&":"")+(l?"*":"")+(h?"++":"")+Oi(s)}}function Oi(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function ts(n,s,c){return{name:n,primKey:s,indexes:c,mappedClass:null,idxByName:(l=function(h){return[h.name,h]},c.reduce(function(h,f,m){return m=l(f,m),m&&(h[m[0]]=m[1]),h},{}))};var l}var Tn=function(n){try{return n.only([[]]),Tn=function(){return[[]]},[[]]}catch{return Tn=function(){return Lt},Lt}};function ns(n){return n==null?function(){}:typeof n=="string"?(s=n).split(".").length===1?function(c){return c[s]}:function(c){return xe(c,s)}:function(c){return xe(c,n)};var s}function Pi(n){return[].slice.call(n)}var pa=0;function Cn(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function ma(n,s,E){function l(S){if(S.type===3)return null;if(S.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var k=S.lower,O=S.upper,T=S.lowerOpen,S=S.upperOpen;return k===void 0?O===void 0?null:s.upperBound(O,!!S):O===void 0?s.lowerBound(k,!!T):s.bound(k,O,!!T,!!S)}function h(x){var k,O=x.name;return{name:O,schema:x,mutate:function(T){var S=T.trans,C=T.type,A=T.keys,R=T.values,j=T.range;return new Promise(function(D,M){D=be(D);var F=S.objectStore(O),q=F.keyPath==null,K=C==="put"||C==="add";if(!K&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var B,Y=(A||R||{length:1}).length;if(A&&R&&A.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(Y===0)return D({numFailures:0,failures:{},results:[],lastResult:void 0});function X(Be){++Ye,Pn(Be)}var re=[],te=[],Ye=0;if(C==="deleteRange"){if(j.type===4)return D({numFailures:Ye,failures:te,results:[],lastResult:void 0});j.type===3?re.push(B=F.clear()):re.push(B=F.delete(l(j)))}else{var q=K?q?[R,A]:[R,null]:[A,null],ne=q[0],$e=q[1];if(K)for(var Le=0;Le<Y;++Le)re.push(B=$e&&$e[Le]!==void 0?F[C](ne[Le],$e[Le]):F[C](ne[Le])),B.onerror=X;else for(Le=0;Le<Y;++Le)re.push(B=F[C](ne[Le])),B.onerror=X}function br(Be){Be=Be.target.result,re.forEach(function(qt,_s){return qt.error!=null&&(te[_s]=qt.error)}),D({numFailures:Ye,failures:te,results:C==="delete"?A:re.map(function(qt){return qt.result}),lastResult:Be})}B.onerror=function(Be){X(Be),br(Be)},B.onsuccess=br})},getMany:function(T){var S=T.trans,C=T.keys;return new Promise(function(A,R){A=be(A);for(var j,D=S.objectStore(O),M=C.length,F=new Array(M),q=0,K=0,B=function(re){re=re.target,F[re._pos]=re.result,++K===q&&A(F)},Y=nt(R),X=0;X<M;++X)C[X]!=null&&((j=D.get(C[X]))._pos=X,j.onsuccess=B,j.onerror=Y,++q);q===0&&A(F)})},get:function(T){var S=T.trans,C=T.key;return new Promise(function(A,R){A=be(A);var j=S.objectStore(O).get(C);j.onsuccess=function(D){return A(D.target.result)},j.onerror=nt(R)})},query:(k=_,function(T){return new Promise(function(S,C){S=be(S);var A,R,j,q=T.trans,D=T.values,M=T.limit,B=T.query,F=M===1/0?void 0:M,K=B.index,B=B.range,q=q.objectStore(O),K=K.isPrimaryKey?q:q.index(K.name),B=l(B);if(M===0)return S({result:[]});k?((F=D?K.getAll(B,F):K.getAllKeys(B,F)).onsuccess=function(Y){return S({result:Y.target.result})},F.onerror=nt(C)):(A=0,R=!D&&"openKeyCursor"in K?K.openKeyCursor(B):K.openCursor(B),j=[],R.onsuccess=function(Y){var X=R.result;return X?(j.push(D?X.value:X.primaryKey),++A===M?S({result:j}):void X.continue()):S({result:j})},R.onerror=nt(C))})}),openCursor:function(T){var S=T.trans,C=T.values,A=T.query,R=T.reverse,j=T.unique;return new Promise(function(D,M){D=be(D);var K=A.index,F=A.range,q=S.objectStore(O),q=K.isPrimaryKey?q:q.index(K.name),K=R?j?"prevunique":"prev":j?"nextunique":"next",B=!C&&"openKeyCursor"in q?q.openKeyCursor(l(F),K):q.openCursor(l(F),K);B.onerror=nt(M),B.onsuccess=be(function(Y){var X,re,te,Ye,ne=B.result;ne?(ne.___id=++pa,ne.done=!1,X=ne.continue.bind(ne),re=(re=ne.continuePrimaryKey)&&re.bind(ne),te=ne.advance.bind(ne),Ye=function(){throw new Error("Cursor not stopped")},ne.trans=S,ne.stop=ne.continue=ne.continuePrimaryKey=ne.advance=function(){throw new Error("Cursor not started")},ne.fail=be(M),ne.next=function(){var $e=this,Le=1;return this.start(function(){return Le--?$e.continue():$e.stop()}).then(function(){return $e})},ne.start=function($e){function Le(){if(B.result)try{$e()}catch(Be){ne.fail(Be)}else ne.done=!0,ne.start=function(){throw new Error("Cursor behind last entry")},ne.stop()}var br=new Promise(function(Be,qt){Be=be(Be),B.onerror=nt(qt),ne.fail=qt,ne.stop=function(_s){ne.stop=ne.continue=ne.continuePrimaryKey=ne.advance=Ye,Be(_s)}});return B.onsuccess=be(function(Be){B.onsuccess=Le,Le()}),ne.continue=X,ne.continuePrimaryKey=re,ne.advance=te,Le(),br},D(ne)):D(null)},M)})},count:function(T){var S=T.query,C=T.trans,A=S.index,R=S.range;return new Promise(function(j,D){var M=C.objectStore(O),F=A.isPrimaryKey?M:M.index(A.name),M=l(R),F=M?F.count(M):F.count();F.onsuccess=be(function(q){return j(q.target.result)}),F.onerror=nt(D)})}}}var f,m,v,P=(m=E,v=Pi((f=n).objectStoreNames),{schema:{name:f.name,tables:v.map(function(x){return m.objectStore(x)}).map(function(x){var k=x.keyPath,S=x.autoIncrement,O=d(k),T={},S={name:x.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:k==null,compound:O,keyPath:k,autoIncrement:S,unique:!0,extractKey:ns(k)},indexes:Pi(x.indexNames).map(function(C){return x.index(C)}).map(function(j){var A=j.name,R=j.unique,D=j.multiEntry,j=j.keyPath,D={name:A,compound:d(j),keyPath:j,unique:R,multiEntry:D,extractKey:ns(j)};return T[Cn(j)]=D}),getIndexByKeyPath:function(C){return T[Cn(C)]}};return T[":id"]=S.primaryKey,k!=null&&(T[Cn(k)]=S.primaryKey),S})},hasGetAll:0<v.length&&"getAll"in m.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),E=P.schema,_=P.hasGetAll,P=E.tables.map(h),b={};return P.forEach(function(x){return b[x.name]=x}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(x){if(!b[x])throw new Error("Table '".concat(x,"' not found"));return b[x]},MIN_KEY:-1/0,MAX_KEY:Tn(s),schema:E}}function ya(n,s,c,l){var h=c.IDBKeyRange;return c.indexedDB,{dbcore:(l=ma(s,h,l),n.dbcore.reduce(function(f,m){return m=m.create,r(r({},f),m(f))},l))}}function ar(n,l){var c=l.db,l=ya(n._middlewares,c,n._deps,l);n.core=l.dbcore,n.tables.forEach(function(h){var f=h.name;n.core.schema.tables.some(function(m){return m.name===f})&&(h.core=n.core.table(f),n[f]instanceof n.Table&&(n[f].core=h.core))})}function cr(n,s,c,l){c.forEach(function(h){var f=l[h];s.forEach(function(m){var v=function E(_,P){return V(_,P)||(_=y(_))&&E(_,P)}(m,h);(!v||"value"in v&&v.value===void 0)&&(m===n.Transaction.prototype||m instanceof n.Transaction?L(m,h,{get:function(){return this.table(h)},set:function(E){$(this,h,{value:E,writable:!0,configurable:!0,enumerable:!0})}}):m[h]=new n.Table(h,f))})})}function rs(n,s){s.forEach(function(c){for(var l in c)c[l]instanceof n.Table&&delete c[l]})}function ga(n,s){return n._cfg.version-s._cfg.version}function va(n,s,c,l){var h=n._dbSchema;c.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=ts("$meta",Ti("")[0],[]),n._storeNames.push("$meta"));var f=n._createTransaction("readwrite",n._storeNames,h);f.create(c),f._completion.catch(l);var m=f._reject.bind(f),v=W.transless||W;wt(function(){return W.trans=f,W.transless=v,s!==0?(ar(n,c),_=s,((E=f).storeNames.includes("$meta")?E.table("$meta").get("version").then(function(P){return P??_}):z.resolve(_)).then(function(P){return x=P,k=f,O=c,T=[],P=(b=n)._versions,S=b._dbSchema=lr(0,b.idbdb,O),(P=P.filter(function(C){return C._cfg.version>=x})).length!==0?(P.forEach(function(C){T.push(function(){var A=S,R=C._cfg.dbschema;hr(b,A,O),hr(b,R,O),S=b._dbSchema=R;var j=ss(A,R);j.add.forEach(function(K){is(O,K[0],K[1].primKey,K[1].indexes)}),j.change.forEach(function(K){if(K.recreate)throw new J.Upgrade("Not yet support for changing primary key");var B=O.objectStore(K.name);K.add.forEach(function(Y){return ur(B,Y)}),K.change.forEach(function(Y){B.deleteIndex(Y.name),ur(B,Y)}),K.del.forEach(function(Y){return B.deleteIndex(Y)})});var D=C._cfg.contentUpgrade;if(D&&C._cfg.version>x){ar(b,O),k._memoizedTables={};var M=yn(R);j.del.forEach(function(K){M[K]=A[K]}),rs(b,[b.Transaction.prototype]),cr(b,[b.Transaction.prototype],u(M),M),k.schema=M;var F,q=et(D);return q&&en(),j=z.follow(function(){var K;(F=D(k))&&q&&(K=_t.bind(null,null),F.then(K,K))}),F&&typeof F.then=="function"?z.resolve(F):j.then(function(){return F})}}),T.push(function(A){var R,j,D=C._cfg.dbschema;R=D,j=A,[].slice.call(j.db.objectStoreNames).forEach(function(M){return R[M]==null&&j.db.deleteObjectStore(M)}),rs(b,[b.Transaction.prototype]),cr(b,[b.Transaction.prototype],b._storeNames,b._dbSchema),k.schema=b._dbSchema}),T.push(function(A){b.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(b.idbdb.version/10)===C._cfg.version?(b.idbdb.deleteObjectStore("$meta"),delete b._dbSchema.$meta,b._storeNames=b._storeNames.filter(function(R){return R!=="$meta"})):A.objectStore("$meta").put(C._cfg.version,"version"))})}),function C(){return T.length?z.resolve(T.shift()(k.idbtrans)).then(C):z.resolve()}().then(function(){xi(S,O)})):z.resolve();var b,x,k,O,T,S}).catch(m)):(u(h).forEach(function(P){is(c,P,h[P].primKey,h[P].indexes)}),ar(n,c),void z.follow(function(){return n.on.populate.fire(f)}).catch(m));var E,_})}function ba(n,s){xi(n._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var c=lr(0,n.idbdb,s);hr(n,n._dbSchema,s);for(var l=0,h=ss(c,n._dbSchema).change;l<h.length;l++){var f=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=s.objectStore(m.name);m.add.forEach(function(E){Ke&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(E.src)),ur(v,E)})}(h[l]);if(typeof f=="object")return f.value}}function ss(n,s){var c,l={del:[],add:[],change:[]};for(c in n)s[c]||l.del.push(c);for(c in s){var h=n[c],f=s[c];if(h){var m={name:c,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(f.primKey.keyPath||"")||h.primKey.auto!==f.primKey.auto)m.recreate=!0,l.change.push(m);else{var v=h.idxByName,E=f.idxByName,_=void 0;for(_ in v)E[_]||m.del.push(_);for(_ in E){var P=v[_],b=E[_];P?P.src!==b.src&&m.change.push(b):m.add.push(b)}(0<m.del.length||0<m.add.length||0<m.change.length)&&l.change.push(m)}}else l.add.push([c,f])}return l}function is(n,s,c,l){var h=n.db.createObjectStore(s,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});return l.forEach(function(f){return ur(h,f)}),h}function xi(n,s){u(n).forEach(function(c){s.db.objectStoreNames.contains(c)||(Ke&&console.debug("Dexie: Creating missing table",c),is(s,c,n[c].primKey,n[c].indexes))})}function ur(n,s){n.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function lr(n,s,c){var l={};return fe(s.objectStoreNames,0).forEach(function(h){for(var f=c.objectStore(h),m=es(Oi(_=f.keyPath),_||"",!0,!1,!!f.autoIncrement,_&&typeof _!="string",!0),v=[],E=0;E<f.indexNames.length;++E){var P=f.index(f.indexNames[E]),_=P.keyPath,P=es(P.name,_,!!P.unique,!!P.multiEntry,!1,_&&typeof _!="string",!1);v.push(P)}l[h]=ts(h,m,v)}),l}function hr(n,s,c){for(var l=c.db.objectStoreNames,h=0;h<l.length;++h){var f=l[h],m=c.objectStore(f);n._hasGetAll="getAll"in m;for(var v=0;v<m.indexNames.length;++v){var E=m.indexNames[v],_=m.index(E).keyPath,P=typeof _=="string"?_:"["+fe(_).join("+")+"]";!s[f]||(_=s[f].idxByName[P])&&(_.name=E,delete s[f].idxByName[P],s[f].idxByName[E]=_)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Ti(n){return n.split(",").map(function(s,c){var l=(s=s.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return es(l,h||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),d(h),c===0)})}var wa=(dr.prototype._parseStoresSpec=function(n,s){u(n).forEach(function(c){if(n[c]!==null){var l=Ti(n[c]),h=l.shift();if(h.unique=!0,h.multi)throw new J.Schema("Primary key cannot be multi-valued");l.forEach(function(f){if(f.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),s[c]=ts(c,h,l)}})},dr.prototype.stores=function(c){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,c):c;var c=s._versions,l={},h={};return c.forEach(function(f){p(l,f._cfg.storesSource),h=f._cfg.dbschema={},f._parseStoresSpec(l,h)}),s._dbSchema=h,rs(s,[s._allTables,s,s.Transaction.prototype]),cr(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],u(h),h),s._storeNames=u(h),this},dr.prototype.upgrade=function(n){return this._cfg.contentUpgrade=yt(this._cfg.contentUpgrade||G,n),this},dr);function dr(){}function os(n,s){var c=n._dbNamesDB;return c||(c=n._dbNamesDB=new dt(nr,{addons:[],indexedDB:n,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function as(n){return n&&typeof n.databases=="function"}function cs(n){return wt(function(){return W.letThrough=!0,n()})}function us(n){return!("from"in n)}var Ne=function(n,s){if(!this){var c=new Ne;return n&&"d"in n&&p(c,n),c}p(this,arguments.length?{d:1,from:n,to:1<arguments.length?s:n}:{d:0})};function An(n,s,c){var l=le(s,c);if(!isNaN(l)){if(0<l)throw RangeError();if(us(n))return p(n,{from:s,to:c,d:1});var h=n.l,l=n.r;if(le(c,n.from)<0)return h?An(h,s,c):n.l={from:s,to:c,d:1,l:null,r:null},Ci(n);if(0<le(s,n.to))return l?An(l,s,c):n.r={from:s,to:c,d:1,l:null,r:null},Ci(n);le(s,n.from)<0&&(n.from=s,n.l=null,n.d=l?l.d+1:1),0<le(c,n.to)&&(n.to=c,n.r=null,n.d=n.l?n.l.d+1:1),c=!n.r,h&&!n.l&&Rn(n,h),l&&c&&Rn(n,l)}}function Rn(n,s){us(s)||function c(l,E){var f=E.from,m=E.to,v=E.l,E=E.r;An(l,f,m),v&&c(l,v),E&&c(l,E)}(n,s)}function fr(n,s){var c=ls(s),l=c.next();if(l.done)return!1;for(var h=l.value,f=ls(n),m=f.next(h.from),v=m.value;!l.done&&!m.done;){if(le(v.from,h.to)<=0&&0<=le(v.to,h.from))return!0;le(h.from,v.from)<0?h=(l=c.next(v.from)).value:v=(m=f.next(h.from)).value}return!1}function ls(n){var s=us(n)?null:{s:0,n};return{next:function(c){for(var l=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,l)for(;s.n.l&&le(c,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!l||le(c,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function Ci(n){var s,c,l=(((s=n.r)===null||s===void 0?void 0:s.d)||0)-(((c=n.l)===null||c===void 0?void 0:c.d)||0),h=1<l?"r":l<-1?"l":"";h&&(s=h=="r"?"l":"r",c=r({},n),l=n[h],n.from=l.from,n.to=l.to,n[h]=l[h],c[h]=l[s],(n[s]=c).d=Ai(c)),n.d=Ai(n)}function Ai(c){var s=c.r,c=c.l;return(s?c?Math.max(s.d,c.d):s.d:c?c.d:0)+1}function pr(n,s){return u(s).forEach(function(c){n[c]?Rn(n[c],s[c]):n[c]=function l(h){var f,m,v={};for(f in h)w(h,f)&&(m=h[f],v[f]=!m||typeof m!="object"||je.has(m.constructor)?m:l(m));return v}(s[c])}),n}function hs(n,s){return n.all||s.all||Object.keys(n).some(function(c){return s[c]&&fr(s[c],n[c])})}N(Ne.prototype,((Ve={add:function(n){return Rn(this,n),this},addKey:function(n){return An(this,n,n),this},addKeys:function(n){var s=this;return n.forEach(function(c){return An(s,c,c)}),this}})[Rt]=function(){return ls(this)},Ve));var Ft={},ds={},fs=!1;function mr(n){pr(ds,n),fs||(fs=!0,setTimeout(function(){fs=!1,ps(ds,!(ds={}))},0))}function ps(n,s){s===void 0&&(s=!1);var c=new Set;if(n.all)for(var l=0,h=Object.values(Ft);l<h.length;l++)Ri(m=h[l],n,c,s);else for(var f in n){var m,v=/^idb\:\/\/(.*)\/(.*)\//.exec(f);v&&(f=v[1],v=v[2],(m=Ft["idb://".concat(f,"/").concat(v)])&&Ri(m,n,c,s))}c.forEach(function(E){return E()})}function Ri(n,s,c,l){for(var h=[],f=0,m=Object.entries(n.queries.query);f<m.length;f++){for(var v=m[f],E=v[0],_=[],P=0,b=v[1];P<b.length;P++){var x=b[P];hs(s,x.obsSet)?x.subscribers.forEach(function(S){return c.add(S)}):l&&_.push(x)}l&&h.push([E,_])}if(l)for(var k=0,O=h;k<O.length;k++){var T=O[k],E=T[0],_=T[1];n.queries.query[E]=_}}function _a(n){var s=n._state,c=n._deps.indexedDB;if(s.isBeingOpened||n.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?ke(s.dbOpenError):n});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var l=s.openCanceller,h=Math.round(10*n.verno),f=!1;function m(){if(s.openCanceller!==l)throw new J.DatabaseClosed("db.open() was cancelled")}function v(){return new z(function(x,k){if(m(),!c)throw new J.MissingAPI;var O=n.name,T=s.autoSchema||!h?c.open(O):c.open(O,h);if(!T)throw new J.MissingAPI;T.onerror=nt(k),T.onblocked=be(n._fireOnBlocked),T.onupgradeneeded=be(function(S){var C;P=T.transaction,s.autoSchema&&!n._options.allowEmptyDB?(T.onerror=Pn,P.abort(),T.result.close(),(C=c.deleteDatabase(O)).onsuccess=C.onerror=be(function(){k(new J.NoSuchDatabase("Database ".concat(O," doesnt exist")))})):(P.onerror=nt(k),S=S.oldVersion>Math.pow(2,62)?0:S.oldVersion,b=S<1,n.idbdb=T.result,f&&ba(n,P),va(n,S/10,P,k))},k),T.onsuccess=be(function(){P=null;var S,C,A,R,j,D=n.idbdb=T.result,M=fe(D.objectStoreNames);if(0<M.length)try{var F=D.transaction((R=M).length===1?R[0]:R,"readonly");if(s.autoSchema)C=D,A=F,(S=n).verno=C.version/10,A=S._dbSchema=lr(0,C,A),S._storeNames=fe(C.objectStoreNames,0),cr(S,[S._allTables],u(A),A);else if(hr(n,n._dbSchema,F),((j=ss(lr(0,(j=n).idbdb,F),j._dbSchema)).add.length||j.change.some(function(q){return q.add.length||q.change.length}))&&!f)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),D.close(),h=D.version+1,f=!0,x(v());ar(n,F)}catch{}tn.push(n),D.onversionchange=be(function(q){s.vcFired=!0,n.on("versionchange").fire(q)}),D.onclose=be(function(q){n.on("close").fire(q)}),b&&(j=n._deps,F=O,D=j.indexedDB,j=j.IDBKeyRange,as(D)||F===nr||os(D,j).put({name:F}).catch(G)),x()},k)}).catch(function(x){switch(x?.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<h)return h=0,v()}return z.reject(x)})}var E,_=s.dbReadyResolve,P=null,b=!1;return z.race([l,(typeof navigator>"u"?z.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(x){function k(){return indexedDB.databases().finally(x)}E=setInterval(k,100),k()}).finally(function(){return clearInterval(E)}):Promise.resolve()).then(v)]).then(function(){return m(),s.onReadyBeingFired=[],z.resolve(cs(function(){return n.on.ready.fire(n.vip)})).then(function x(){if(0<s.onReadyBeingFired.length){var k=s.onReadyBeingFired.reduce(yt,G);return s.onReadyBeingFired=[],z.resolve(cs(function(){return k(n.vip)})).then(x)}})}).finally(function(){s.openCanceller===l&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(x){s.dbOpenError=x;try{P&&P.abort()}catch{}return l===s.openCanceller&&n._close(),ke(x)}).finally(function(){s.openComplete=!0,_()}).then(function(){var x;return b&&(x={},n.tables.forEach(function(k){k.schema.indexes.forEach(function(O){O.name&&(x["idb://".concat(n.name,"/").concat(k.name,"/").concat(O.name)]=new Ne(-1/0,[[[]]]))}),x["idb://".concat(n.name,"/").concat(k.name,"/")]=x["idb://".concat(n.name,"/").concat(k.name,"/:dels")]=new Ne(-1/0,[[[]]])}),St(xn).fire(x),ps(x,!0)),n})}function ms(n){function s(f){return n.next(f)}var c=h(s),l=h(function(f){return n.throw(f)});function h(f){return function(E){var v=f(E),E=v.value;return v.done?E:E&&typeof E.then=="function"?E.then(c,l):d(E)?Promise.all(E).then(c,l):c(E)}}return h(s)()}function yr(n,s,c){for(var l=d(n)?n.slice():[n],h=0;h<c;++h)l.push(s);return l}var ka={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return r(r({},n),{table:function(s){var c=n.table(s),l=c.schema,h={},f=[];function m(b,x,k){var O=Cn(b),T=h[O]=h[O]||[],S=b==null?0:typeof b=="string"?1:b.length,C=0<x,C=r(r({},k),{name:C?"".concat(O,"(virtual-from:").concat(k.name,")"):k.name,lowLevelIndex:k,isVirtual:C,keyTail:x,keyLength:S,extractKey:ns(b),unique:!C&&k.unique});return T.push(C),C.isPrimaryKey||f.push(C),1<S&&m(S===2?b[0]:b.slice(0,S-1),x+1,k),T.sort(function(A,R){return A.keyTail-R.keyTail}),C}s=m(l.primaryKey.keyPath,0,l.primaryKey),h[":id"]=[s];for(var v=0,E=l.indexes;v<E.length;v++){var _=E[v];m(_.keyPath,0,_)}function P(b){var x,k=b.query.index;return k.isVirtual?r(r({},b),{query:{index:k.lowLevelIndex,range:(x=b.query.range,k=k.keyTail,{type:x.type===1?2:x.type,lower:yr(x.lower,x.lowerOpen?n.MAX_KEY:n.MIN_KEY,k),lowerOpen:!0,upper:yr(x.upper,x.upperOpen?n.MIN_KEY:n.MAX_KEY,k),upperOpen:!0})}}):b}return r(r({},c),{schema:r(r({},l),{primaryKey:s,indexes:f,getIndexByKeyPath:function(b){return(b=h[Cn(b)])&&b[0]}}),count:function(b){return c.count(P(b))},query:function(b){return c.query(P(b))},openCursor:function(b){var x=b.query.index,k=x.keyTail,O=x.isVirtual,T=x.keyLength;return O?c.openCursor(P(b)).then(function(C){return C&&S(C)}):c.openCursor(b);function S(C){return Object.create(C,{continue:{value:function(A){A!=null?C.continue(yr(A,b.reverse?n.MAX_KEY:n.MIN_KEY,k)):b.unique?C.continue(C.key.slice(0,T).concat(b.reverse?n.MIN_KEY:n.MAX_KEY,k)):C.continue()}},continuePrimaryKey:{value:function(A,R){C.continuePrimaryKey(yr(A,n.MAX_KEY,k),R)}},primaryKey:{get:function(){return C.primaryKey}},key:{get:function(){var A=C.key;return T===1?A[0]:A.slice(0,T)}},value:{get:function(){return C.value}}})}}})}})}};function ys(n,s,c,l){return c=c||{},l=l||"",u(n).forEach(function(h){var f,m,v;w(s,h)?(f=n[h],m=s[h],typeof f=="object"&&typeof m=="object"&&f&&m?(v=Wt(f))!==Wt(m)?c[l+h]=s[h]:v==="Object"?ys(f,m,c,l+h+"."):f!==m&&(c[l+h]=s[h]):f!==m&&(c[l+h]=s[h])):c[l+h]=void 0}),u(s).forEach(function(h){w(n,h)||(c[l+h]=s[h])}),c}function gs(n,s){return s.type==="delete"?s.keys:s.keys||s.values.map(n.extractKey)}var Ea={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return r(r({},n),{table:function(s){var c=n.table(s),l=c.schema.primaryKey;return r(r({},c),{mutate:function(h){var f=W.trans,m=f.table(s).hook,v=m.deleting,E=m.creating,_=m.updating;switch(h.type){case"add":if(E.fire===G)break;return f._promise("readwrite",function(){return P(h)},!0);case"put":if(E.fire===G&&_.fire===G)break;return f._promise("readwrite",function(){return P(h)},!0);case"delete":if(v.fire===G)break;return f._promise("readwrite",function(){return P(h)},!0);case"deleteRange":if(v.fire===G)break;return f._promise("readwrite",function(){return function b(x,k,O){return c.query({trans:x,values:!1,query:{index:l,range:k},limit:O}).then(function(T){var S=T.result;return P({type:"delete",keys:S,trans:x}).then(function(C){return 0<C.numFailures?Promise.reject(C.failures[0]):S.length<O?{failures:[],numFailures:0,lastResult:void 0}:b(x,r(r({},k),{lower:S[S.length-1],lowerOpen:!0}),O)})})}(h.trans,h.range,1e4)},!0)}return c.mutate(h);function P(b){var x,k,O,T=W.trans,S=b.keys||gs(l,b);if(!S)throw new Error("Keys missing");return(b=b.type==="add"||b.type==="put"?r(r({},b),{keys:S}):r({},b)).type!=="delete"&&(b.values=a([],b.values,!0)),b.keys&&(b.keys=a([],b.keys,!0)),x=c,O=S,((k=b).type==="add"?Promise.resolve([]):x.getMany({trans:k.trans,keys:O,cache:"immutable"})).then(function(C){var A=S.map(function(R,j){var D,M,F,q=C[j],K={onerror:null,onsuccess:null};return b.type==="delete"?v.fire.call(K,R,q,T):b.type==="add"||q===void 0?(D=E.fire.call(K,R,b.values[j],T),R==null&&D!=null&&(b.keys[j]=R=D,l.outbound||we(b.values[j],l.keyPath,R))):(D=ys(q,b.values[j]),(M=_.fire.call(K,D,R,q,T))&&(F=b.values[j],Object.keys(M).forEach(function(B){w(F,B)?F[B]=M[B]:we(F,B,M[B])}))),K});return c.mutate(b).then(function(R){for(var j=R.failures,D=R.results,M=R.numFailures,R=R.lastResult,F=0;F<S.length;++F){var q=(D||S)[F],K=A[F];q==null?K.onerror&&K.onerror(j[F]):K.onsuccess&&K.onsuccess(b.type==="put"&&C[F]?b.values[F]:q)}return{failures:j,results:D,numFailures:M,lastResult:R}}).catch(function(R){return A.forEach(function(j){return j.onerror&&j.onerror(R)}),Promise.reject(R)})})}}})}})}};function ji(n,s,c){try{if(!s||s.keys.length<n.length)return null;for(var l=[],h=0,f=0;h<s.keys.length&&f<n.length;++h)le(s.keys[h],n[f])===0&&(l.push(c?Ie(s.values[h]):s.values[h]),++f);return l.length===n.length?l:null}catch{return null}}var Sa={stack:"dbcore",level:-1,create:function(n){return{table:function(s){var c=n.table(s);return r(r({},c),{getMany:function(l){if(!l.cache)return c.getMany(l);var h=ji(l.keys,l.trans._cache,l.cache==="clone");return h?z.resolve(h):c.getMany(l).then(function(f){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?Ie(f):f},f})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),c.mutate(l)}})}}}};function Ii(n,s){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function Di(n,s){switch(n){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Oa={stack:"dbcore",level:0,name:"Observability",create:function(n){var s=n.schema.name,c=new Ne(n.MIN_KEY,n.MAX_KEY);return r(r({},n),{transaction:function(l,h,f){if(W.subscr&&h!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(W.querier));return n.transaction(l,h,f)},table:function(l){var h=n.table(l),f=h.schema,m=f.primaryKey,b=f.indexes,v=m.extractKey,E=m.outbound,_=m.autoIncrement&&b.filter(function(k){return k.compound&&k.keyPath.includes(m.keyPath)}),P=r(r({},h),{mutate:function(k){function O(B){return B="idb://".concat(s,"/").concat(l,"/").concat(B),R[B]||(R[B]=new Ne)}var T,S,C,A=k.trans,R=k.mutatedParts||(k.mutatedParts={}),j=O(""),D=O(":dels"),M=k.type,K=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[gs(m,k).filter(function(B){return B}),k.values]:[],F=K[0],q=K[1],K=k.trans._cache;return d(F)?(j.addKeys(F),(K=M==="delete"||F.length===q.length?ji(F,K):null)||D.addKeys(F),(K||q)&&(T=O,S=K,C=q,f.indexes.forEach(function(B){var Y=T(B.name||"");function X(te){return te!=null?B.extractKey(te):null}function re(te){return B.multiEntry&&d(te)?te.forEach(function(Ye){return Y.addKey(Ye)}):Y.addKey(te)}(S||C).forEach(function(te,$e){var ne=S&&X(S[$e]),$e=C&&X(C[$e]);le(ne,$e)!==0&&(ne!=null&&re(ne),$e!=null&&re($e))})}))):F?(q={from:F.lower,to:F.upper},D.add(q),j.add(q)):(j.add(c),D.add(c),f.indexes.forEach(function(B){return O(B.name).add(c)})),h.mutate(k).then(function(B){return!F||k.type!=="add"&&k.type!=="put"||(j.addKeys(B.results),_&&_.forEach(function(Y){var X=k.values.map(function(te){return Y.extractKey(te)}),re=Y.keyPath.findIndex(function(te){return te===m.keyPath});B.results.forEach(function(te){return X[re]=te}),O(Y.name).addKeys(X)})),A.mutatedParts=pr(A.mutatedParts||{},R),B})}}),b=function(O){var T=O.query,O=T.index,T=T.range;return[O,new Ne((O=T.lower)!==null&&O!==void 0?O:n.MIN_KEY,(T=T.upper)!==null&&T!==void 0?T:n.MAX_KEY)]},x={get:function(k){return[m,new Ne(k.key)]},getMany:function(k){return[m,new Ne().addKeys(k.keys)]},count:b,query:b,openCursor:b};return u(x).forEach(function(k){P[k]=function(O){var T=W.subscr,S=!!T,C=Ii(W,h)&&Di(k,O)?O.obsSet={}:T;if(S){var A=function(q){return q="idb://".concat(s,"/").concat(l,"/").concat(q),C[q]||(C[q]=new Ne)},R=A(""),j=A(":dels"),T=x[k](O),S=T[0],T=T[1];if((k==="query"&&S.isPrimaryKey&&!O.values?j:A(S.name||"")).add(T),!S.isPrimaryKey){if(k!=="count"){var D=k==="query"&&E&&O.values&&h.query(r(r({},O),{values:!1}));return h[k].apply(this,arguments).then(function(q){if(k==="query"){if(E&&O.values)return D.then(function(X){return X=X.result,R.addKeys(X),q});var K=O.values?q.result.map(v):q.result;(O.values?R:j).addKeys(K)}else if(k==="openCursor"){var B=q,Y=O.values;return B&&Object.create(B,{key:{get:function(){return j.addKey(B.primaryKey),B.key}},primaryKey:{get:function(){var X=B.primaryKey;return j.addKey(X),X}},value:{get:function(){return Y&&R.addKey(B.primaryKey),B.value}}})}return q})}j.add(c)}}return h[k].apply(this,arguments)}}),P}})}};function Ni(n,s,c){if(c.numFailures===0)return s;if(s.type==="deleteRange")return null;var l=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1;return c.numFailures===l?null:(s=r({},s),d(s.keys)&&(s.keys=s.keys.filter(function(h,f){return!(f in c.failures)})),"values"in s&&d(s.values)&&(s.values=s.values.filter(function(h,f){return!(f in c.failures)})),s)}function vs(n,s){return c=n,((l=s).lower===void 0||(l.lowerOpen?0<le(c,l.lower):0<=le(c,l.lower)))&&(n=n,(s=s).upper===void 0||(s.upperOpen?le(n,s.upper)<0:le(n,s.upper)<=0));var c,l}function $i(n,s,x,l,h,f){if(!x||x.length===0)return n;var m=s.query.index,v=m.multiEntry,E=s.query.range,_=l.schema.primaryKey.extractKey,P=m.extractKey,b=(m.lowLevelIndex||m).extractKey,x=x.reduce(function(k,O){var T=k,S=O.type==="add"||O.type==="put"?O.values.filter(function(j){return j=P(j),v&&d(j)?j.some(function(D){return vs(D,E)}):vs(j,E)}).map(function(j){return j=Ie(j),f&&Object.freeze(j),j}):[];switch(O.type){case"add":T=k.concat(s.values?S:S.map(function(D){return _(D)}));break;case"put":var C=new Ne().addKeys(O.values.map(function(D){return _(D)})),T=k.filter(function(D){return D=s.values?_(D):D,!fr(new Ne(D),C)}).concat(s.values?S:S.map(function(D){return _(D)}));break;case"delete":var A=new Ne().addKeys(O.keys);T=k.filter(function(D){return D=s.values?_(D):D,!fr(new Ne(D),A)});break;case"deleteRange":var R=O.range;T=k.filter(function(D){return!vs(_(D),R)})}return T},n);return x===n?n:(x.sort(function(k,O){return le(b(k),b(O))||le(_(k),_(O))}),s.limit&&s.limit<1/0&&(x.length>s.limit?x.length=s.limit:n.length===s.limit&&x.length<s.limit&&(h.dirty=!0)),f?Object.freeze(x):x)}function Li(n,s){return le(n.lower,s.lower)===0&&le(n.upper,s.upper)===0&&!!n.lowerOpen==!!s.lowerOpen&&!!n.upperOpen==!!s.upperOpen}function Pa(n,s){return function(c,l,h,f){if(c===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=le(c,l))===0){if(h&&f)return 0;if(h)return 1;if(f)return-1}return l}(n.lower,s.lower,n.lowerOpen,s.lowerOpen)<=0&&0<=function(c,l,h,f){if(c===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=le(c,l))===0){if(h&&f)return 0;if(h)return-1;if(f)return 1}return l}(n.upper,s.upper,n.upperOpen,s.upperOpen)}function xa(n,s,c,l){n.subscribers.add(c),l.addEventListener("abort",function(){var h,f;n.subscribers.delete(c),n.subscribers.size===0&&(h=n,f=s,setTimeout(function(){h.subscribers.size===0&&_e(f,h)},3e3))})}var Ta={stack:"dbcore",level:0,name:"Cache",create:function(n){var s=n.schema.name;return r(r({},n),{transaction:function(c,l,h){var f,m,v=n.transaction(c,l,h);return l==="readwrite"&&(m=(f=new AbortController).signal,h=function(E){return function(){if(f.abort(),l==="readwrite"){for(var _=new Set,P=0,b=c;P<b.length;P++){var x=b[P],k=Ft["idb://".concat(s,"/").concat(x)];if(k){var O=n.table(x),T=k.optimisticOps.filter(function(Y){return Y.trans===v});if(v._explicit&&E&&v.mutatedParts)for(var S=0,C=Object.values(k.queries.query);S<C.length;S++)for(var A=0,R=(M=C[S]).slice();A<R.length;A++)hs((F=R[A]).obsSet,v.mutatedParts)&&(_e(M,F),F.subscribers.forEach(function(Y){return _.add(Y)}));else if(0<T.length){k.optimisticOps=k.optimisticOps.filter(function(Y){return Y.trans!==v});for(var j=0,D=Object.values(k.queries.query);j<D.length;j++)for(var M,F,q,K=0,B=(M=D[j]).slice();K<B.length;K++)(F=B[K]).res!=null&&v.mutatedParts&&(E&&!F.dirty?(q=Object.isFrozen(F.res),q=$i(F.res,F.req,T,O,F,q),F.dirty?(_e(M,F),F.subscribers.forEach(function(Y){return _.add(Y)})):q!==F.res&&(F.res=q,F.promise=z.resolve({result:q}))):(F.dirty&&_e(M,F),F.subscribers.forEach(function(Y){return _.add(Y)})))}}}_.forEach(function(Y){return Y()})}}},v.addEventListener("abort",h(!1),{signal:m}),v.addEventListener("error",h(!1),{signal:m}),v.addEventListener("complete",h(!0),{signal:m})),v},table:function(c){var l=n.table(c),h=l.schema.primaryKey;return r(r({},l),{mutate:function(f){var m=W.trans;if(h.outbound||m.db._options.cache==="disabled"||m.explicit)return l.mutate(f);var v=Ft["idb://".concat(s,"/").concat(c)];return v?(m=l.mutate(f),f.type!=="add"&&f.type!=="put"||!(50<=f.values.length||gs(h,f).some(function(E){return E==null}))?(v.optimisticOps.push(f),f.mutatedParts&&mr(f.mutatedParts),m.then(function(E){0<E.numFailures&&(_e(v.optimisticOps,f),(E=Ni(0,f,E))&&v.optimisticOps.push(E),f.mutatedParts&&mr(f.mutatedParts))}),m.catch(function(){_e(v.optimisticOps,f),f.mutatedParts&&mr(f.mutatedParts)})):m.then(function(E){var _=Ni(0,r(r({},f),{values:f.values.map(function(k,b){var x,k=(x=h.keyPath)!==null&&x!==void 0&&x.includes(".")?Ie(k):r({},k);return we(k,h.keyPath,E.results[b]),k})}),E);v.optimisticOps.push(_),queueMicrotask(function(){return f.mutatedParts&&mr(f.mutatedParts)})}),m):l.mutate(f)},query:function(f){if(!Ii(W,l)||!Di("query",f))return l.query(f);var m=((_=W.trans)===null||_===void 0?void 0:_.db._options.cache)==="immutable",b=W,v=b.requery,E=b.signal,_=function(O,T,S,C){var A=Ft["idb://".concat(O,"/").concat(T)];if(!A)return[];if(!(T=A.queries[S]))return[null,!1,A,null];var R=T[(C.query?C.query.index.name:null)||""];if(!R)return[null,!1,A,null];switch(S){case"query":var j=R.find(function(D){return D.req.limit===C.limit&&D.req.values===C.values&&Li(D.req.query.range,C.query.range)});return j?[j,!0,A,R]:[R.find(function(D){return("limit"in D.req?D.req.limit:1/0)>=C.limit&&(!C.values||D.req.values)&&Pa(D.req.query.range,C.query.range)}),!1,A,R];case"count":return j=R.find(function(D){return Li(D.req.query.range,C.query.range)}),[j,!!j,A,R]}}(s,c,"query",f),P=_[0],b=_[1],x=_[2],k=_[3];return P&&b?P.obsSet=f.obsSet:(b=l.query(f).then(function(O){var T=O.result;if(P&&(P.res=T),m){for(var S=0,C=T.length;S<C;++S)Object.freeze(T[S]);Object.freeze(T)}else O.result=Ie(T);return O}).catch(function(O){return k&&P&&_e(k,P),Promise.reject(O)}),P={obsSet:f.obsSet,promise:b,subscribers:new Set,type:"query",req:f,dirty:!1},k?k.push(P):(k=[P],(x=x||(Ft["idb://".concat(s,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[f.query.index.name||""]=k)),xa(P,k,v,E),P.promise.then(function(O){return{result:$i(O.result,f,x?.optimisticOps,l,P,m)}})}})}})}};function gr(n,s){return new Proxy(n,{get:function(c,l,h){return l==="db"?s:Reflect.get(c,l,h)}})}var dt=(Ee.prototype.version=function(n){if(isNaN(n)||n<.1)throw new J.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var s=this._versions,c=s.filter(function(l){return l._cfg.version===n})[0];return c||(c=new this.Version(n),s.push(c),s.sort(ga),c.stores({}),this._state.autoSchema=!1,c)},Ee.prototype._whenReady=function(n){var s=this;return this.idbdb&&(this._state.openComplete||W.letThrough||this._vip)?n():new z(function(c,l){if(s._state.openComplete)return l(new J.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void l(new J.DatabaseClosed);s.open().catch(G)}s._state.dbReadyPromise.then(c,l)}).then(n)},Ee.prototype.use=function(n){var s=n.stack,c=n.create,l=n.level,h=n.name;return h&&this.unuse({stack:s,name:h}),n=this._middlewares[s]||(this._middlewares[s]=[]),n.push({stack:s,create:c,level:l??10,name:h}),n.sort(function(f,m){return f.level-m.level}),this},Ee.prototype.unuse=function(n){var s=n.stack,c=n.name,l=n.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(h){return l?h.create!==l:!!c&&h.name!==c})),this},Ee.prototype.open=function(){var n=this;return $t(bt,function(){return _a(n)})},Ee.prototype._close=function(){var n=this._state,s=tn.indexOf(this);if(0<=s&&tn.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new z(function(c){n.dbReadyResolve=c}),n.openCanceller=new z(function(c,l){n.cancelOpen=l}))},Ee.prototype.close=function(c){var s=(c===void 0?{disableAutoOpen:!0}:c).disableAutoOpen,c=this._state;s?(c.isBeingOpened&&c.cancelOpen(new J.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new J.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},Ee.prototype.delete=function(n){var s=this;n===void 0&&(n={disableAutoOpen:!0});var c=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new z(function(h,f){function m(){s.close(n);var v=s._deps.indexedDB.deleteDatabase(s.name);v.onsuccess=be(function(){var E,_,P;E=s._deps,_=s.name,P=E.indexedDB,E=E.IDBKeyRange,as(P)||_===nr||os(P,E).delete(_).catch(G),h()}),v.onerror=nt(f),v.onblocked=s._fireOnBlocked}if(c)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(m):m()})},Ee.prototype.backendDB=function(){return this.idbdb},Ee.prototype.isOpen=function(){return this.idbdb!==null},Ee.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},Ee.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ee.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ee.prototype,"tables",{get:function(){var n=this;return u(this._allTables).map(function(s){return n._allTables[s]})},enumerable:!1,configurable:!0}),Ee.prototype.transaction=function(){var n=function(s,c,l){var h=arguments.length;if(h<2)throw new J.InvalidArgument("Too few arguments");for(var f=new Array(h-1);--h;)f[h-1]=arguments[h];return l=f.pop(),[s,pt(f),l]}.apply(this,arguments);return this._transaction.apply(this,n)},Ee.prototype._transaction=function(n,s,c){var l=this,h=W.trans;h&&h.db===this&&n.indexOf("!")===-1||(h=null);var f,m,v=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");try{if(m=s.map(function(_){if(_=_ instanceof l.Table?_.name:_,typeof _!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return _}),n=="r"||n===Wr)f=Wr;else{if(n!="rw"&&n!=Gr)throw new J.InvalidArgument("Invalid transaction mode: "+n);f=Gr}if(h){if(h.mode===Wr&&f===Gr){if(!v)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&m.forEach(function(_){if(h&&h.storeNames.indexOf(_)===-1){if(!v)throw new J.SubTransaction("Table "+_+" not included in parent transaction.");h=null}}),v&&h&&!h.active&&(h=null)}}catch(_){return h?h._promise(null,function(P,b){b(_)}):ke(_)}var E=function _(P,b,x,k,O){return z.resolve().then(function(){var T=W.transless||W,S=P._createTransaction(b,x,P._dbSchema,k);if(S.explicit=!0,T={trans:S,transless:T},k)S.idbtrans=k.idbtrans;else try{S.create(),S.idbtrans._explicit=!0,P._state.PR1398_maxLoop=3}catch(R){return R.name===Gt.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return _(P,b,x,null,O)})):ke(R)}var C,A=et(O);return A&&en(),T=z.follow(function(){var R;(C=O.call(S,S))&&(A?(R=_t.bind(null,null),C.then(R,R)):typeof C.next=="function"&&typeof C.throw=="function"&&(C=ms(C)))},T),(C&&typeof C.then=="function"?z.resolve(C).then(function(R){return S.active?R:ke(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):T.then(function(){return C})).then(function(R){return k&&S._resolve(),S._completion.then(function(){return R})}).catch(function(R){return S._reject(R),ke(R)})})}.bind(null,this,f,m,h,c);return h?h._promise(f,E,"lock"):W.trans?$t(W.transless,function(){return l._whenReady(E)}):this._whenReady(E)},Ee.prototype.table=function(n){if(!w(this._allTables,n))throw new J.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},Ee);function Ee(n,s){var c=this;this._middlewares={},this.verno=0;var l=Ee.dependencies;this._options=s=r({addons:Ee.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},l=s.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,f,m,v,E,_={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:G,dbReadyPromise:null,cancelOpen:G,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};_.dbReadyPromise=new z(function(b){_.dbReadyResolve=b}),_.openCanceller=new z(function(b,x){_.cancelOpen=x}),this._state=_,this.name=n,this.on=En(this,"populate","blocked","versionchange","close",{ready:[yt,G]}),this.on.ready.subscribe=he(this.on.ready.subscribe,function(b){return function(x,k){Ee.vip(function(){var O,T=c._state;T.openComplete?(T.dbOpenError||z.resolve().then(x),k&&b(x)):T.onReadyBeingFired?(T.onReadyBeingFired.push(x),k&&b(x)):(b(x),O=c,k||b(function S(){O.on.ready.unsubscribe(x),O.on.ready.unsubscribe(S)}))})}}),this.Collection=(h=this,Sn(la.prototype,function(C,S){this.db=h;var k=mi,O=null;if(S)try{k=S()}catch(A){O=A}var T=C._ctx,S=T.table,C=S.hook.reading.fire;this._ctx={table:S,index:T.index,isPrimKey:!T.index||S.schema.primKey.keyPath&&T.index===S.schema.primKey.name,range:k,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:O,or:T.or,valueMapper:C!==He?C:null}})),this.Table=(f=this,Sn(bi.prototype,function(b,x,k){this.db=f,this._tx=k,this.name=b,this.schema=x,this.hook=f._allTables[b]?f._allTables[b].hook:En(null,{creating:[Yt,G],reading:[Jn,He],updating:[Xt,G],deleting:[Hn,G]})})),this.Transaction=(m=this,Sn(fa.prototype,function(b,x,k,O,T){var S=this;this.db=m,this.mode=b,this.storeNames=x,this.schema=k,this.chromeTransactionDurability=O,this.idbtrans=null,this.on=En(this,"complete","error","abort"),this.parent=T||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new z(function(C,A){S._resolve=C,S._reject=A}),this._completion.then(function(){S.active=!1,S.on.complete.fire()},function(C){var A=S.active;return S.active=!1,S.on.error.fire(C),S.parent?S.parent._reject(C):A&&S.idbtrans&&S.idbtrans.abort(),ke(C)})})),this.Version=(v=this,Sn(wa.prototype,function(b){this.db=v,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(E=this,Sn(Si.prototype,function(b,x,k){if(this.db=E,this._ctx={table:b,index:x===":id"?null:x,or:k},this._cmp=this._ascending=le,this._descending=function(O,T){return le(T,O)},this._max=function(O,T){return 0<le(O,T)?O:T},this._min=function(O,T){return le(O,T)<0?O:T},this._IDBKeyRange=E._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(b){0<b.newVersion?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(b){!b.newVersion||b.newVersion<b.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(b.oldVersion/10))}),this._maxKey=Tn(s.IDBKeyRange),this._createTransaction=function(b,x,k,O){return new c.Transaction(b,x,k,c._options.chromeTransactionDurability,O)},this._fireOnBlocked=function(b){c.on("blocked").fire(b),tn.filter(function(x){return x.name===c.name&&x!==c&&!x._state.vcFired}).map(function(x){return x.on("versionchange").fire(b)})},this.use(Sa),this.use(Ta),this.use(Oa),this.use(ka),this.use(Ea);var P=new Proxy(this,{get:function(b,x,k){if(x==="_vip")return!0;if(x==="table")return function(T){return gr(c.table(T),P)};var O=Reflect.get(b,x,k);return O instanceof bi?gr(O,P):x==="tables"?O.map(function(T){return gr(T,P)}):x==="_createTransaction"?function(){return gr(O.apply(this,arguments),P)}:O}});this.vip=P,l.forEach(function(b){return b(c)})}var vr,Ve=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ca=(bs.prototype.subscribe=function(n,s,c){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:s,complete:c})},bs.prototype[Ve]=function(){return this},bs);function bs(n){this._subscribe=n}try{vr={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{vr={indexedDB:null,IDBKeyRange:null}}function Ui(n){var s,c=!1,l=new Ca(function(h){var f=et(n),m,v=!1,E={},_={},P={get closed(){return v},unsubscribe:function(){v||(v=!0,m&&m.abort(),b&&St.storagemutated.unsubscribe(k))}};h.start&&h.start(P);var b=!1,x=function(){return Vr(O)},k=function(T){pr(E,T),hs(_,E)&&x()},O=function(){var T,S,C;!v&&vr.indexedDB&&(E={},T={},m&&m.abort(),m=new AbortController,C=function(A){var R=Qt();try{f&&en();var j=wt(n,A);return j=f?j.finally(_t):j}finally{R&&Zt()}}(S={subscr:T,signal:m.signal,requery:x,querier:n,trans:null}),Promise.resolve(C).then(function(A){c=!0,s=A,v||S.signal.aborted||(E={},function(R){for(var j in R)if(w(R,j))return;return 1}(_=T)||b||(St(xn,k),b=!0),Vr(function(){return!v&&h.next&&h.next(A)}))},function(A){c=!1,["DatabaseClosedError","AbortError"].includes(A?.name)||v||Vr(function(){v||h.error&&h.error(A)})}))};return setTimeout(x,0),P});return l.hasValue=function(){return c},l.getValue=function(){return s},l}var Bt=dt;function ws(n){var s=Ot;try{Ot=!0,St.storagemutated.fire(n),ps(n,!0)}finally{Ot=s}}N(Bt,r(r({},ce),{delete:function(n){return new Bt(n,{addons:[]}).delete()},exists:function(n){return new Bt(n,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return s=Bt.dependencies,c=s.indexedDB,s=s.IDBKeyRange,(as(c)?Promise.resolve(c.databases()).then(function(l){return l.map(function(h){return h.name}).filter(function(h){return h!==nr})}):os(c,s).toCollection().primaryKeys()).then(n)}catch{return ke(new J.MissingAPI)}var s,c},defineClass:function(){return function(n){p(this,n)}},ignoreTransaction:function(n){return W.trans?$t(W.transless,n):n()},vip:cs,async:function(n){return function(){try{var s=ms(n.apply(this,arguments));return s&&typeof s.then=="function"?s:z.resolve(s)}catch(c){return ke(c)}}},spawn:function(n,s,c){try{var l=ms(n.apply(c,s||[]));return l&&typeof l.then=="function"?l:z.resolve(l)}catch(h){return ke(h)}},currentTransaction:{get:function(){return W.trans||null}},waitFor:function(n,s){return s=z.resolve(typeof n=="function"?Bt.ignoreTransaction(n):n).timeout(s||6e4),W.trans?W.trans.waitFor(s):s},Promise:z,debug:{get:function(){return Ke},set:function(n){It(n)}},derive:U,extend:p,props:N,override:he,Events:En,on:St,liveQuery:Ui,extendObservabilitySet:pr,getByKeyPath:xe,setByKeyPath:we,delByKeyPath:function(n,s){typeof s=="string"?we(n,s,void 0):"length"in s&&[].map.call(s,function(c){we(n,c,void 0)})},shallowClone:yn,deepClone:Ie,getObjectDiff:ys,cmp:le,asap:Oe,minKey:-1/0,addons:[],connections:tn,errnames:Gt,dependencies:vr,cache:Ft,semVer:"4.0.7",version:"4.0.7".split(".").map(function(n){return parseInt(n)}).reduce(function(n,s,c){return n+s/Math.pow(10,2*c)})})),Bt.maxKey=Tn(Bt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(St(xn,function(n){Ot||(n=new CustomEvent(Zr,{detail:n}),Ot=!0,dispatchEvent(n),Ot=!1)}),addEventListener(Zr,function(n){n=n.detail,Ot||ws(n)}));var sn,Ot=!1,Fi=function(){};return typeof BroadcastChannel<"u"&&((Fi=function(){(sn=new BroadcastChannel(Zr)).onmessage=function(n){return n.data&&ws(n.data)}})(),typeof sn.unref=="function"&&sn.unref(),St(xn,function(n){Ot||sn.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!dt.disableBfCache&&n.persisted){Ke&&console.debug("Dexie: handling persisted pagehide"),sn?.close();for(var s=0,c=tn;s<c.length;s++)c[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!dt.disableBfCache&&n.persisted&&(Ke&&console.debug("Dexie: handling persisted pageshow"),Fi(),ws({all:new Ne(-1/0,[[]])}))})),z.rejectionMapper=function(n,s){return!n||n instanceof De||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Te[n.name]?n:(s=new Te[n.name](s||n.message,n),"stack"in n&&L(s,"stack",{get:function(){return this.inner.stack}}),s)},It(Ke),r(dt,Object.freeze({__proto__:null,Dexie:dt,liveQuery:Ui,Entity:yi,cmp:le,PropModSymbol:ht,PropModification:On,replacePrefix:function(n,s){return new On({replacePrefix:[n,s]})},add:function(n){return new On({add:n})},remove:function(n){return new On({remove:n})},default:dt,RangeSet:Ne,mergeRanges:Rn,rangesOverlap:fr}),{default:dt}),dt})})(ra);var oh=ra.exports;const Vs=Ma(oh),go=Symbol.for("Dexie"),Rr=globalThis[go]||(globalThis[go]=Vs);if(Vs.semVer!==Rr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Vs.semVer} and ${Rr.semVer}`);class ah extends Rr{constructor(){super("MapDatabase"),this.version(1).stores({maps:"tilemapKey",jsonFiles:"tilemapKey",tilesetImages:"tilemapKey"}),this.maps=this.table("maps"),this.jsonFiles=this.table("jsonFiles"),this.tilesetImages=this.table("tilesetImages")}async initializeMapDatabase(){const e="/api/mapdb.json",t="https://kbve.com/api/mapdb.json";let r;try{r=(await de.get(e)).data,H.log(`Map database loaded from ${e}`)}catch{H.warn(`Failed to load map database from ${e}, trying fallback URL.`);try{r=(await de.get(t)).data,H.log(`Map database loaded from ${t}`)}catch{H.error(`Failed to load map database from both ${e} and ${t}`);return}}if(r&&r.key){for(const a in r.key)if(Object.prototype.hasOwnProperty.call(r.key,a)){const o=r.key[a];await this.addMap(o),await this.addJsonData(a,o.jsonDataUrl);const u=await this.fetchTilesetImage(o.tilesetImageUrl);u&&await this.addTilesetImage(a,u)}H.log("Map database initialized and data loaded.")}else H.error("Invalid map database format.")}async addMap(e){await this.maps.put(e)}async getMap(e){return await this.maps.get(e)}async addJsonData(e,t){await this.jsonFiles.put({tilemapKey:e,jsonData:t})}async getJsonData(e){return(await this.jsonFiles.get(e))?.jsonData}async addTilesetImage(e,t){await this.tilesetImages.put({tilemapKey:e,imageData:t})}async getTilesetImage(e){return(await this.tilesetImages.get(e))?.imageData}async getBounds(e){return(await this.maps.get(e))?.bounds}async getNpcsFromTilesetKey(e){const t=await ch.getMap(e);if(!t){H.error(`No map data found for tilesetKey: ${e}`);return}return t.npcs}async fetchMapData(e){try{return(await de.get(e)).data}catch(t){H.error(`Failed to fetch map data from ${e}:`,t);return}}async fetchJsonData(e){try{return(await de.get(e)).data}catch(t){H.error(`Failed to fetch JSON data from ${e}:`,t);return}}async fetchTilesetImage(e){try{return(await de.get(e,{responseType:"blob"})).data}catch(t){H.error(`Failed to fetch tileset image from ${e}:`,t);return}}async initializeMap(e,t,r,a){try{const o=await this.fetchMapData(t);if(o){await this.addMap(o);const u=await this.fetchJsonData(r);u&&await this.addJsonData(e,u);const d=await this.fetchTilesetImage(a);d&&await this.addTilesetImage(e,d)}}catch(o){H.error("Failed to initialize map database:",o)}}async loadMapIntoScene(e,t){const r=await this.getMap(t);if(!r){H.error(`Map with key ${t} not found`);return}const a=await this.getJsonData(t);if(!a){H.error(`JSON data for map ${t} not found`);return}const o=await this.getTilesetImage(t);if(!o){H.error(`Tileset image for map ${t} not found`);return}let u=null;try{u=URL.createObjectURL(o)}catch(d){H.error(`Failed to create object URL for tileset image: ${d}`);return}if(!u){H.error(`Tileset image URL for map ${t} could not be created.`);return}e.load.tilemapTiledJSON(t,a),e.load.image(r.tilesetKey,u),e.load.once("complete",()=>{const d=e.make.tilemap({key:t}),p=d.addTilesetImage(r.tilesetName,r.tilesetKey);if(p)for(let y=0;y<d.layers.length;y++){const g=d.createLayer(y,p,0,0);g?g.scale=r.scale:H.error(`Layer ${y} could not be created.`)}else H.error(`Tileset ${r.tilesetName} could not be created.`)}),e.load.start()}async loadMap(e,t){const r=await this.getMap(t);if(!r)throw new Error(`Map with key ${t} not found`);const a=await this.getJsonData(t);if(!a)throw new Error(`JSON data for map ${t} not found`);const o=await this.getTilesetImage(t);if(!o)throw new Error(`Tileset image for map ${t} not found`);let u=null;try{u=URL.createObjectURL(o)}catch(d){throw new Error(`Failed to create object URL for tileset image: ${d}`)}if(!u)throw new Error(`Tileset image URL for map ${t} could not be created.`);return e.load.tilemapTiledJSON(t,a),e.load.image(r.tilesetKey,u),new Promise(d=>{e.load.once("complete",()=>{const p=e.make.tilemap({key:t});if(p.addTilesetImage(r.tilesetName,r.tilesetKey)){for(let g=0;g<p.layers.length;g++){const w=p.createLayer(g,r.tilesetName,0,0);w?w.scale=r.scale:console.error(`Layer ${g} could not be created.`)}d(p)}else console.error(`Tileset ${r.tilesetName} could not be created.`),d(null)}),e.load.start()})}}const ch=new ah,uh=({text:i,speed:e=80,onComplete:t})=>{const[r,a]=ks.useState([]),o=ks.useRef([]);return ks.useEffect(()=>{let u,d=0;const p=i.split(/(<\/?span[^>]*>)/g).filter(Boolean),y=[];p.forEach((w,N)=>{if(w.startsWith("<span")||w.startsWith("</span")){const $=w.match(/<span class="([^"]*)">/);if($){const L=$[1];y.push(_r.jsx("span",{className:L},`span-${N}`))}else y.push(_r.jsx("span",{},`span-${N}`))}else w.split("").forEach(($,L)=>{y.push(_r.jsx("span",{children:$},`char-${N}-${L}`))})}),d=0;const g=()=>{d<y.length?(o.current=[...o.current,y[d]],a([...o.current]),d++,u=window.setTimeout(g,e)):t&&t()};return o.current=[],a([]),g(),()=>{window.clearTimeout(u)}},[i,e,t]),_r.jsx("div",{children:r})};Ka.memo(uh);class lh extends Rr{constructor(){super("NPCDatabase"),this.version(3).stores({npcs:"id,name",sprites:"id",avatars:"id",dialogues:"id"}),this.npcs=this.table("npcs"),this.sprites=this.table("sprites"),this.avatars=this.table("avatars"),this.dialogues=this.table("dialogues")}async addNPC(e){await this.npcs.put(e)}async getNPC(e){return await this.npcs.get(e)}async getNPCByName(e){return await this.npcs.where("name").equals(e).first()}async getAllNPCs(){return await this.npcs.toArray()}async exportNPCs(){const e=await this.getAllNPCs();return JSON.stringify(e,null,2)}async importNPCs(e){const t=JSON.parse(e);await this.npcs.bulkPut(t)}async fetchNPCData(e){try{return(await de.get(e)).data}catch(t){H.error(`Failed to fetch NPC data from ${e}:`,t);return}}async addSprite(e){await this.sprites.put(e)}async getSprite(e){return await this.sprites.get(e)}async getAllSprites(){return await this.sprites.toArray()}async addAvatar(e){await this.avatars.put(e)}async getAvatar(e){return await this.avatars.get(e)}async getAllAvatars(){return await this.avatars.toArray()}async urlToBlob(e){try{return(await de.get(e,{responseType:"blob"})).data}catch(t){H.error(`Failed to fetch blob from ${e}:`,t);return}}async addNewSprite(e,t){const r=await this.urlToBlob(e);if(r){const a={...t,spriteData:r};return await this.addSprite(a),a.id}}async addNewNPC(e,t,r){const a={...e,spriteImageId:t,avatarImageId:r};await this.addNPC(a)}async addNewAvatar(e,t){const r=await this.urlToBlob(e);if(r){const a={...t,avatarData:r};return await this.addAvatar(a),a.id}}async fetchAvatars(e){try{const r=(await de.get(e)).data.key;for(const a in r){const o=r[a];let u=await this.urlToBlob(o.avatarLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${o.avatarLocation}`)),u){const d={id:o.id,avatarName:o.avatarName,avatarLocation:o.avatarLocation,avatarData:u,slug:o.slug};await this.addAvatar(d)}}}catch(t){H.error(`Failed to fetch avatars from ${e}:`,t)}}async fetchSprites(e){try{const r=(await de.get(e)).data.key;for(const a in r){const o=r[a];let u=await this.urlToBlob(o.assetLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${o.assetLocation}`)),u){const d={id:o.id,spriteName:o.spriteName,assetLocation:o.assetLocation,frameWidth:o.frameWidth,frameHeight:o.frameHeight,scale:o.scale,slug:o.slug,spriteData:u};await this.addSprite(d)}}}catch(t){H.error(`Failed to fetch sprites from ${e}:`,t)}}async fetchNPCs(e){try{const r=(await de.get(e)).data.key;for(const a in r){const o=r[a],u={id:o.id,name:o.name,spriteKey:o.spriteKey,walkingAnimationMapping:o.walkingAnimationMapping,startPosition:o.startPosition,speed:o.speed,scale:o.scale,slug:o.slug,actions:o.actions,effects:o.effects,stats:o.stats,spriteImageId:o.spriteImageId,avatarImageId:o.avatarImageId,dialogues:o.dialogues||[]};await this.addNPC(u)}}catch(t){H.error(`Failed to fetch NPCs from ${e}:`,t)}}async initializeDatabase(e="https://kbve.com"){await this.fetchAvatars(`${e}/api/avatardb.json`),await this.fetchSprites(`${e}/api/spritedb.json`),await this.fetchNPCs(`${e}/api/npcdb.json`),await this.fetchDialogues(`${e}/api/dialogue.json`)}async loadNPC(e,t,r,a){try{H.log(`Loading NPC with name: ${t}`);const o=await this.getNPCByName(t);if(!o)throw new Error(`NPC with name ${t} not found`);H.log(`NPC Data: ${JSON.stringify(o)}`),await this.loadCharacter(e,o.id,r,a)}catch(o){o instanceof Error?H.error(`Failed to load NPC: ${o.message}`):H.error("Failed to load NPC:",o)}}async loadCharacter(e,t,r,a){try{H.log(`Loading NPC with ID: ${t}`);const o=await this.getNPC(t);if(!o)throw new Error(`NPC with ID ${t} not found`);H.log(`NPC Data: ${JSON.stringify(o)}`);const u=o.spriteKey;if(e.textures.exists(u))H.log(`Texture with key ${u} already loaded.`),this.addNPCToScene(e,o,r,a);else{H.log(`Texture with key ${u} not found, attempting to load.`);const d=await this.getSprite(o.spriteImageId);if(d&&d.spriteData){H.log(`Sprite Data: ${JSON.stringify(d)}`);const p=URL.createObjectURL(d.spriteData);e.load.spritesheet(u,p,{frameWidth:d.frameWidth,frameHeight:d.frameHeight}),e.load.once("complete",()=>{H.log(`Texture ${u} loaded successfully.`),this.addNPCToScene(e,o,r,a)}),e.load.start()}else throw new Error(`Sprite with ID ${o.spriteImageId} not found`)}}catch(o){o instanceof Error?H.error(`Failed to load NPC: ${o.message}`):H.error("Failed to load NPC:",o)}}addNPCToScene(e,t,r,a){try{H.log(`Adding NPC to scene: ${JSON.stringify(t)}`),H.log(`Using sprite key: ${t.spriteKey}`);const o=e.add.sprite(0,0,t.spriteKey);o.scale=t.scale||1.5,o.name=t.id||"Error Missing Name",H.log(`NPC Sprite created with texture key ${t.spriteKey} at position (${t.startPosition.x}, ${t.startPosition.y})`);const u={id:t.id,sprite:o,walkingAnimationMapping:t.walkingAnimationMapping,startPosition:{x:r??t.startPosition.x,y:a??t.startPosition.y},speed:t.speed};if(H.log(`Grid engine config: ${JSON.stringify(u)}`),!e.textures.exists(t.spriteKey))throw new Error(`Texture with key ${t.spriteKey} does not exist in the scene`);e.gridEngine.addCharacter(u),H.log(`NPC added to grid engine with ID ${t.id}`),((p,y,g)=>{const w=e.gridEngine.getPosition(p.name);H.log(`Attaching NPC events to ${y} at position: ${JSON.stringify(w)}`),fh.attachNPCEvent(p,y,g,{coords:w})})(o,t.name,t.actions.map(p=>({label:p}))),H.log(`NPC ${t.name} added to scene successfully`)}catch(o){o instanceof Error?H.error(`Error adding NPC to scene from addNPCToScene: ${o.message}`):H.error("Error adding NPC to scene:",o)}}async addDialogue(e){await this.dialogues.put(e)}async getDialogue(e){return await this.dialogues.get(e)}async getAllDialogues(){return await this.dialogues.toArray()}async getDialoguesForNPC(e){const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);return(await Promise.all((t.dialogues||[]).map(a=>this.getDialogue(a.dialogueId)))).filter(a=>a!==void 0)}async markDialogueAsRead(e,t){const r=await this.getNPC(e);if(!r)throw new Error(`NPC with ID ${e} not found`);const a=r.dialogues?.find(o=>o.dialogueId===t);a&&(a.read=!0,await this.addNPC(r))}async fetchDialogues(e){try{const r=(await de.get(e)).data.key,a=Object.values(r).map(o=>({...o}));await this.dialogues.bulkPut(a)}catch(t){H.error(`Failed to fetch dialogues from ${e}:`,t)}}async getPrioritizedDialoguesForNPC(e){try{const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);const a=(await Promise.all((t.dialogues||[]).map(async o=>{const u=await this.getDialogue(o.dialogueId);return u?{...u,priority:o.priority,read:o.read}:null}))).filter(o=>o!==null);return a.sort((o,u)=>u.priority-o.priority),a}catch(t){return H.error(`Failed to get prioritized dialogues for NPC with ID ${e}:`,t),[]}}async getNPCNameById(e){return(await this.getNPC(e))?.name}async getNPCAvatarById(e){const t=await this.getNPC(e);if(t?.avatarImageId)return(await this.getAvatar(t.avatarImageId))?.avatarData}async getNPCSlugById(e){return(await this.getNPC(e))?.slug}async getNPCHealthById(e){try{return(await this.getNPC(e))?.stats?.health}catch(t){H.error(`Failed to get health for NPC with ID ${e}:`,t);return}}async getNPCManaById(e){try{return(await this.getNPC(e))?.stats?.mana}catch(t){H.error(`Failed to get mana for NPC with ID ${e}:`,t);return}}async createNPCSession(e,t){try{const r=this.getNPCNameById(t),a=this.getNPCSlugById(t),o=this.getNPCAvatarById(t),u=this.getNPCHealthById(t),d=this.getNPCManaById(t),[p,y,g,w,N]=await Promise.all([r,a,o,u,d]),$={...e.get(),[`${t}_name`]:p||"Unknown",[`${t}_slug`]:y||"Unknown",[`${t}_avatar`]:g?URL.createObjectURL(g):"Unknown",[`${t}_health`]:w||"100",[`${t}_mana`]:N||"100"};e.set($)}catch{const a={...e.get(),[`${t}_name`]:"Unknown",[`${t}_slug`]:"Unknown",[`${t}_avatar`]:"Unknown",[`${t}_hp`]:"100",[`${t}_mana`]:"100"};e.set(a)}}async getNPCDialogueOptionsByULID(e){try{const t=await this.getDialogue(e);if(!t||!t.options)return"[]";const r=await Promise.all(t.options.map(async a=>this.getDialogue(a)));return JSON.stringify(r.filter(a=>a!==void 0))}catch(t){return H.error(`Failed to get dialogue options for ID ${e}:`,t),"[]"}}async getAllDialogueOptions(e){const t=[],r=new Set,a=async o=>{if(r.has(o))return;r.add(o);const u=await this.getDialogue(o);if(u&&(t.push(u),u.options&&u.options.length>0))for(const d of u.options)await a(d)};return await a(e),t}async createDialogueSession(e,t){try{const r=await this.getNPCDialogueOptionsByULID(t),a={...e.get(),[`${t}_options`]:r||"[]"};e.set(a)}catch{const a={...e.get(),[`${t}_options`]:"[]"};e.set(a)}}}const hh=new lh;class dh{constructor(){this.actionHandlers={talk:this.talkToNPC.bind(this),quest:this.questWithNPC.bind(this),trade:this.tradeWithNPC.bind(this),combat:this.startCombat.bind(this),heal:this.healNPC.bind(this),steal:this.stealFromNPC.bind(this),lore:this.loreFromNPC.bind(this)}}getActionHandler(e){return this.actionHandlers[e]}loreFromNPC(e){H.log(`Pulling up the lore of the NPC with ID: ${e.npcId}`)}questWithNPC(e){H.log(`Starting quest with NPC with ID: ${e.npcId}`)}healNPC(e){H.log(`Healing NPC with ID: ${e.npcId}`)}oathFromNPC(e){H.log(`Oath from NPC with ID: ${e.npcId}`)}async talkToNPC(e){try{H.log(`Talking to NPC with ID: ${e.npcId}`);const t=await hh.getPrioritizedDialoguesForNPC(e.npcId);if(H.log(t),t.length>0){const r=t[0];Nn.emit("npcDialogue",{npcId:e.npcId,dialogue:r},1e3)}else H.log("No dialogues available for this NPC.")}catch(t){H.error(`Failed to fetch dialogues for NPC with ID ${e.npcId}:`,t)}}tradeWithNPC(e){H.log(`Trading with NPC with ID: ${e.npcId}`)}moveToNPC(e){const r=e.data?.coords||{x:10,y:15};Nn.emit("playerMove",r)}stealFromNPC(e){H.log(`Attempting to steal from NPC with ID: ${e.npcId}`);const t={npcId:e.npcId,npcName:e.npcName,data:e.data};Nn.emit("playerSteal",t)}startCombat(e){H.log(`Starting combat with NPC with ID: ${e.npcId}`)}checkFish(e){H.log(`Checking fish for NPC with ID: ${e.npcId}`)}attachNPCEvent(e,t,r,a){e.setInteractive(),e.on("pointerover",o=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:a||{},coords:{x:o.x,y:o.y}};Nn.emit("npcInteraction",u),e.setTint(65280)}),e.on("pointerout",()=>{e.clearTint()}),e.on("pointerdown",o=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:a||{},coords:{x:o.x,y:o.y}};H.log(`Click Registered at X: ${u.coords.x} Y: ${u.coords.y}`),Nn.emit("npcInteractionClick",u,1e3)})}}const fh=new dh,{document:Is}=Fa;function vo(i){let e,t;return{c(){e=pe("script"),this.h()},l(r){e=me(r,"SCRIPT",{src:!0});var a=Se(e);a.forEach(ye),this.h()},h(){Xs(e.src,t=i[4])||ee(e,"src",t),e.async=!0,e.defer=!0},m(r,a){Fn(r,e,a)},p:Ds,d(r){r&&ye(e)}}}function bo(i){let e,t,r,a,o,u=i[3].svelte_internal_message+"",d;return{c(){e=pe("div"),t=pe("dotlottie-player"),a=qe(),o=pe("span"),d=Ws(u),this.h()},l(p){e=me(p,"DIV",{class:!0});var y=Se(e);t=me(y,"DOTLOTTIE-PLAYER",{autoplay:!0,loop:!0,class:!0,mode:!0,src:!0});var g=Se(t);g.forEach(ye),a=Me(y),o=me(y,"SPAN",{class:!0});var w=Se(o);d=Gs(w,u),w.forEach(ye),y.forEach(ye),this.h()},h(){st(t,"autoplay",""),st(t,"loop",""),st(t,"class","w-8"),st(t,"mode","normal"),Xs(t.src,r="/assets/lottie/"+sa)||st(t,"src",r),ee(o,"class","text-lg text-red-600 dark:text-red-300"),ee(e,"class","flex")},m(p,y){Fn(p,e,y),Q(e,t),Q(e,a),Q(e,o),Q(o,d)},p(p,y){y&8&&u!==(u=p[3].svelte_internal_message+"")&&Ys(d,u)},d(p){p&&ye(e)}}}function wo(i){let e,t,r,a,o,u=i[3].successful_message+"",d;return{c(){e=pe("div"),t=pe("dotlottie-player"),a=qe(),o=pe("span"),d=Ws(u),this.h()},l(p){e=me(p,"DIV",{class:!0});var y=Se(e);t=me(y,"DOTLOTTIE-PLAYER",{autoplay:!0,loop:!0,class:!0,mode:!0,src:!0});var g=Se(t);g.forEach(ye),a=Me(y),o=me(y,"SPAN",{class:!0});var w=Se(o);d=Gs(w,u),w.forEach(ye),y.forEach(ye),this.h()},h(){st(t,"autoplay",""),st(t,"loop",""),st(t,"class","w-8"),st(t,"mode","normal"),Xs(t.src,r="/assets/lottie/"+sa)||st(t,"src",r),ee(o,"class","text-lg text-cyan-600 dark:text-cyan-300"),ee(e,"class","flex")},m(p,y){Fn(p,e,y),Q(e,t),Q(e,a),Q(e,o),Q(o,d)},p(p,y){y&8&&u!==(u=p[3].successful_message+"")&&Ys(d,u)},d(p){p&&ye(e)}}}function ph(i){let e,t,r,a,o,u,d,p,y,g="Username",w,N,$,L,U,V,se="Email Address",fe,he,Z,Oe,xe,we,yn='<label for="register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Password</label>',gn,pt,je,at,Ie,ct,Wt='<label for="confirm-register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Confirm Password</label>',Rt,jt,_e,Ze,Fe,et,vn,De,mt=i[2]?"Loading...":"Register",ut,tt,Gt,Ce=i[1]&&!window?.hcaptcha&&vo(i),J=i[3].svelte_internal_message&&bo(i),Te=i[3].successful_message&&wo(i);return{c(){Ce&&Ce.c(),e=Bi(),t=qe(),r=pe("div"),J&&J.c(),a=qe(),Te&&Te.c(),o=qe(),u=pe("form"),d=pe("div"),p=pe("div"),y=pe("label"),y.textContent=g,w=qe(),N=pe("div"),$=pe("input"),L=qe(),U=pe("div"),V=pe("label"),V.textContent=se,fe=qe(),he=pe("div"),Z=pe("input"),Oe=qe(),xe=pe("div"),we=pe("div"),we.innerHTML=yn,gn=qe(),pt=pe("div"),je=pe("input"),at=qe(),Ie=pe("div"),ct=pe("div"),ct.innerHTML=Wt,Rt=qe(),jt=pe("div"),_e=pe("input"),Ze=qe(),Fe=pe("div"),et=pe("div"),vn=qe(),De=pe("button"),ut=Ws(mt),this.h()},l(ce){const G=Ia("svelte-1fvsnp3",Is.head);Ce&&Ce.l(G),e=Bi(),G.forEach(ye),t=Me(ce),r=me(ce,"DIV",{});var He=Se(r);J&&J.l(He),a=Me(He),Te&&Te.l(He),o=Me(He),u=me(He,"FORM",{id:!0,action:!0});var Jn=Se(u);d=me(Jn,"DIV",{class:!0});var Pe=Se(d);p=me(Pe,"DIV",{});var Yt=Se(p);y=me(Yt,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),wr(y)!=="svelte-3ztkdk"&&(y.textContent=g),w=Me(Yt),N=me(Yt,"DIV",{});var Hn=Se(N);$=me(Hn,"INPUT",{type:!0,id:!0,name:!0,autocomplete:!0,class:!0,"aria-describedby":!0}),Hn.forEach(ye),Yt.forEach(ye),L=Me(Pe),U=me(Pe,"DIV",{});var Xt=Se(U);V=me(Xt,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),wr(V)!=="svelte-tys8zs"&&(V.textContent=se),fe=Me(Xt),he=me(Xt,"DIV",{});var Vn=Se(he);Z=me(Vn,"INPUT",{type:!0,id:!0,name:!0,autocomplete:!0,class:!0,"aria-describedby":!0}),Vn.forEach(ye),Xt.forEach(ye),Oe=Me(Pe),xe=me(Pe,"DIV",{});var yt=Se(xe);we=me(yt,"DIV",{class:!0,"data-svelte-h":!0}),wr(we)!=="svelte-10lrkcu"&&(we.innerHTML=yn),gn=Me(yt),pt=me(yt,"DIV",{});var Ke=Se(pt);je=me(Ke,"INPUT",{type:!0,id:!0,name:!0,class:!0,"aria-describedby":!0}),Ke.forEach(ye),yt.forEach(ye),at=Me(Pe),Ie=me(Pe,"DIV",{});var It=Se(Ie);ct=me(It,"DIV",{class:!0,"data-svelte-h":!0}),wr(ct)!=="svelte-189nfcj"&&(ct.innerHTML=Wt),Rt=Me(It),jt=me(It,"DIV",{});var gt=Se(jt);_e=me(gt,"INPUT",{type:!0,id:!0,name:!0,class:!0,"aria-describedby":!0}),gt.forEach(ye),It.forEach(ye),Ze=Me(Pe),Fe=me(Pe,"DIV",{});var bn=Se(Fe);et=me(bn,"DIV",{id:!0,class:!0}),Se(et).forEach(ye),bn.forEach(ye),vn=Me(Pe),De=me(Pe,"BUTTON",{type:!0,class:!0});var vt=Se(De);ut=Gs(vt,mt),vt.forEach(ye),Pe.forEach(ye),Jn.forEach(ye),He.forEach(ye),this.h()},h(){ee(y,"for","login-username"),ee(y,"class","mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200"),ee($,"type","text"),ee($,"id","register-username"),ee($,"name","username"),ee($,"autocomplete","username"),ee($,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),$.required=!0,ee($,"aria-describedby","register-username"),ee(V,"for","register-email"),ee(V,"class","mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200"),ee(Z,"type","email"),ee(Z,"id","register-email"),ee(Z,"name","email"),ee(Z,"autocomplete","email"),ee(Z,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),Z.required=!0,ee(Z,"aria-describedby","register-email"),ee(we,"class","flex items-center justify-between"),ee(je,"type","password"),ee(je,"id","register-password"),ee(je,"name","password"),ee(je,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),je.required=!0,ee(je,"aria-describedby","register-password"),ee(ct,"class","flex items-center justify-between"),ee(_e,"type","password"),ee(_e,"id","confirm-register-password"),ee(_e,"name","password"),ee(_e,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),_e.required=!0,ee(_e,"aria-describedby","confirm-register-password"),ee(et,"id","h-captcha-"+i[5]),ee(et,"class","flex justify-center scale-75 md:scale-100"),ee(De,"type","submit"),ee(De,"class",`${mh} ${yh} ${gh} ${vh} ${bh} ${wh} ${_h}`),De.disabled=i[2],ee(d,"class","grid gap-y-2 md:gap-y-4"),ee(u,"id","registerForm"),ee(u,"action","#")},m(ce,G){Ce&&Ce.m(Is.head,null),Q(Is.head,e),Fn(ce,t,G),Fn(ce,r,G),J&&J.m(r,null),Q(r,a),Te&&Te.m(r,null),Q(r,o),Q(r,u),Q(u,d),Q(d,p),Q(p,y),Q(p,w),Q(p,N),Q(N,$),Pt($,i[3].username),Q(d,L),Q(d,U),Q(U,V),Q(U,fe),Q(U,he),Q(he,Z),Pt(Z,i[3].email),Q(d,Oe),Q(d,xe),Q(xe,we),Q(xe,gn),Q(xe,pt),Q(pt,je),Pt(je,i[3].password),Q(d,at),Q(d,Ie),Q(Ie,ct),Q(Ie,Rt),Q(Ie,jt),Q(jt,_e),Pt(_e,i[3].confirm),Q(d,Ze),Q(d,Fe),Q(Fe,et),Q(d,vn),Q(d,De),Q(De,ut),tt||(Gt=[jn($,"input",i[8]),jn(Z,"input",i[9]),jn(je,"input",i[10]),jn(_e,"input",i[11]),jn(u,"submit",Da(i[0]))],tt=!0)},p(ce,[G]){ce[1]&&!window?.hcaptcha?Ce?Ce.p(ce,G):(Ce=vo(ce),Ce.c(),Ce.m(e.parentNode,e)):Ce&&(Ce.d(1),Ce=null),ce[3].svelte_internal_message?J?J.p(ce,G):(J=bo(ce),J.c(),J.m(r,a)):J&&(J.d(1),J=null),ce[3].successful_message?Te?Te.p(ce,G):(Te=wo(ce),Te.c(),Te.m(r,o)):Te&&(Te.d(1),Te=null),G&8&&$.value!==ce[3].username&&Pt($,ce[3].username),G&8&&Z.value!==ce[3].email&&Pt(Z,ce[3].email),G&8&&je.value!==ce[3].password&&Pt(je,ce[3].password),G&8&&_e.value!==ce[3].confirm&&Pt(_e,ce[3].confirm),G&4&&mt!==(mt=ce[2]?"Loading...":"Register")&&Ys(ut,mt),G&4&&(De.disabled=ce[2])},i:Ds,o:Ds,d(ce){ce&&(ye(t),ye(r)),Ce&&Ce.d(ce),ye(e),J&&J.d(),Te&&Te.d(),tt=!1,Na(Gt)}}}let sa="";const mh="inline-flex w-full items-center justify-center gap-x-2 rounded-lg px-4 py-1 text-sm font-normal text-blue-400 focus-visible:ring outline-none transition duration-300 py-3",yh="border border-transparent",gh="bg-blue-100 dark:focus:outline-none",vh="hover:bg-blue-400 hover:text-white",bh="2xl:text-base",wh="disabled:pointer-events-none disabled:opacity-50 disabled:animate-pulse",_h="ring-zinc-500 dark:ring-zinc-200";function kh(i,e,t){const r=$a(),a=()=>{t(2,y=!1),t(3,$.successful_message="",$),d&&p&&g&&hcaptcha.reset(g)},o=Oe=>{if(d&&p&&g)return hcaptcha.execute(g,Oe)},u=async()=>{if(!w)try{w=Tu(Or.get().api,Or.get().anonKey),console.log("Supabase Instance:",w)}catch(Oe){console.error("Error creating Supabase client:",Oe)}if(w){const{data:Oe,error:xe}=await w.auth.signUp({email:$.email,password:$.password,options:{data:{token:$.captchaToken,username:$.username}}});console.log(`Data: ${Oe}`),console.log(`Error: ${xe}`)}};let d=!1,p=!1,y=!1,g,w;const N={hl:"",sitekey:Or.get().hcaptcha,apihost:Or.get().hcaptcha_api,reCaptchaCompat:!0,theme:Io.DARK,size:"compact"};let $={email:"",password:"",confirm:"",username:"",captchaToken:"",svelte_internal_message:"",successful_message:""};const L=new URLSearchParams({recaptchacompat:"on",onload:"hcaptchaOnLoad",render:"explicit"}),U=`${N.apihost}?${L.toString()}`,V=Math.floor(Math.random()*100);La(()=>{ih({elementIdOrName:"skeleton_login_loader",duration:500}),document.getElementById("astro_error_message")&&document.getElementById("astro_error_message"),window.hcaptchaOnLoad=()=>{r("load"),p=!0},window.onSuccess=Oe=>{r("success",{token:Oe}),t(3,$.captchaToken=Oe,$)},window.onError=()=>{r("error")},window.onClose=()=>{r("close")},window.onExpired=()=>{r("expired"),a()},r("mount"),t(1,d=!0)}),Ua(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,p&&(hcaptcha=null)});function se(){$.username=this.value,t(3,$)}function fe(){$.email=this.value,t(3,$)}function he(){$.password=this.value,t(3,$)}function Z(){$.confirm=this.value,t(3,$)}return[u,d,y,$,U,V,a,o,se,fe,he,Z]}class Ah extends Aa{constructor(e){super(),Ra(this,e,kh,ph,ja,{reset:6,execute:7,handleRegister:0})}get reset(){return this.$$.ctx[6]}get execute(){return this.$$.ctx[7]}get handleRegister(){return this.$$.ctx[0]}}export{Ah as default};
