import{r as b,j as e}from"./react.CvslfkeK.js";import{z as t}from"./zod.D6aOmuMC.js";import{supabase as E}from"./supabaseClient.BwbbkKqX.js";import{u as D}from"./react-hook-form.D5LhBzNo.js";import{t as q}from"./tailwind-merge.B9ugUrge.js";import{c as y}from"./clsx.B-dksMZM.js";import{t as K}from"./@hookform.DFFlZybA.js";import"./@react-three.B-wTPXHf.js";import"./@supabase.aKZxS6oP.js";import"./Page.astro_astro_type_script_index_0_lang.CHoS6oJr.js";import"./react-dom.CtWA3ti2.js";import"./svelte.BEh2_tzM.js";import"./esm-env.rsSWfq8L.js";t.object({user_id:t.string().uuid(),key:t.string().regex(/^[a-z0-9_]{3,64}$/),vault_key:t.string(),created_at:t.string().datetime(),updated_at:t.string().datetime()});const z=t.object({id:t.string().uuid(),user_id:t.string().uuid(),account_name:t.string().regex(/^[a-z0-9_]{3,64}$/),vault_email_key:t.string(),vault_password_key:t.string(),state:t.enum(["offline","active","banned","error"]),world:t.number().int().nullable(),p2p:t.boolean(),created_at:t.string().datetime(),updated_at:t.string().datetime()});z.pick({account_name:!0,state:!0,world:!0,p2p:!0,created_at:!0,updated_at:!0});const $=t.object({username:t.string().min(3).max(32).optional(),combat_level:t.number().int().min(3).max(126),total_level:t.number().int().min(0).max(2277),quest_points:t.number().int().min(0).max(300),wealth_gp:t.number().int().min(0).optional(),notes:t.string().max(500).optional(),last_synced_at:t.string().datetime(),updated_at:t.string().datetime()}),M=t.object({account_name:t.string().regex(/^[a-z0-9_]{3,64}$/,"Account name must be 3-64 characters, lowercase letters, numbers, and underscores only"),email:t.string().email("Please enter a valid email address"),password:t.string().min(8,"Password must be at least 8 characters").max(128,"Password must be less than 128 characters"),world:t.number().int().min(1).max(999).nullable().optional(),p2p:t.boolean().optional().default(!1)}),R=t.object({account_name:t.string().regex(/^[a-z0-9_]{3,64}$/),username:t.string().min(3).max(32).optional(),combat_level:t.number().int().min(3).max(126).optional(),total_level:t.number().int().min(0).max(2277).optional(),quest_points:t.number().int().min(0).max(300).optional(),wealth_gp:t.number().int().min(0).optional(),notes:t.string().max(500).optional()});t.object({key:t.string().regex(/^[a-z0-9_]{3,64}$/,"Key must be 3-64 characters, lowercase letters, numbers, and underscores only"),value:t.string().min(1,"Value cannot be empty").max(1e3,"Value too long")});t.object({message:t.string(),details:t.string().optional(),hint:t.string().optional(),code:t.string().optional()});const T={offline:{label:"Offline",color:"gray",icon:"‚ö´"},active:{label:"Active",color:"green",icon:"üü¢"},banned:{label:"Banned",color:"red",icon:"üî¥"},error:{label:"Error",color:"yellow",icon:"üü°"}},B=(i,x)=>`${x}_email`,W=i=>`${i}_password`,O=i=>/^[a-z0-9_]{3,64}$/.test(i),I=(i,x)=>{const n=B(x,i),m=W(i);return{emailKey:n,passwordKey:m,isValid:O(n)&&O(m)}};$.partial().omit({last_synced_at:!0,updated_at:!0});const a={account_name:{label:"Account Name",placeholder:"Enter account name (a-z, 0-9, _)",maxLength:64},email:{label:"Email",placeholder:"Enter email address"},password:{label:"Password",placeholder:"Enter password",minLength:8,maxLength:128},username:{label:"Display Name",placeholder:"Enter display name (optional)",maxLength:32},world:{label:"World",placeholder:"Enter world number (optional)",min:1,max:999},combat_level:{label:"Combat Level",placeholder:"Enter combat level",min:3,max:126},total_level:{label:"Total Level",placeholder:"Enter total level",min:0,max:2277},quest_points:{label:"Quest Points",placeholder:"Enter quest points",min:0,max:300},wealth_gp:{label:"Wealth (GP)",placeholder:"Enter total wealth in GP",min:0},notes:{label:"Notes",placeholder:"Enter notes (optional)",maxLength:500,rows:3}},G=async({account_name:i,email:x,password:n,world:m,p2p:w})=>{const{emailKey:p,passwordKey:f,isValid:k}=I(i,x);if(!k)throw new Error("Failed to generate valid secret keys. Please try a shorter account name or email.");try{const{error:h}=await E.rpc("set_user_secret",{p_key:p,p_value:x});if(h)throw new Error(`Failed to store email secret: ${h.message}`);const{error:g}=await E.rpc("set_user_secret",{p_key:f,p_value:n});if(g)throw new Error(`Failed to store password secret: ${g.message}`);const{data:v,error:o}=await E.rpc("create_osrs_account",{p_account_name:i,p_email:p,p_password:f,p_world:m||null,p_p2p:w||!1});if(o)throw new Error(o.message||"Failed to create OSRS account");return v}catch(h){throw h}};function U({onSuccess:i,onCancel:x,className:n}){const[m,w]=b.useState(!1),[p,f]=b.useState(null),[k,h]=b.useState(null),{register:g,handleSubmit:v,formState:{errors:o,isValid:c,dirtyFields:L},reset:j,watch:S}=D({resolver:K(M),mode:"onChange",defaultValues:{account_name:"",email:"",password:"",world:void 0,p2p:!1}}),d=S("account_name"),F=S("email"),A=S("p2p"),r=d&&F?I(d,F):null,l=async N=>{w(!0),f(null),h(null);try{await G(N),h(`Account "${N.account_name}" created successfully!`),j(),i?.(N.account_name)}catch(P){const V=P instanceof Error?P.message:"An unexpected error occurred";f(V)}finally{w(!1)}},C=()=>{j(),f(null),h(null),x?.()};return e.jsx("div",{className:q("w-full max-w-md mx-auto",n),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Create OSRS Account"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Add a new Old School RuneScape account to your dashboard"})]}),e.jsxs("form",{onSubmit:v(l),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"account_name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.account_name.label}),e.jsx("input",{...g("account_name"),type:"text",id:"account_name",placeholder:a.account_name.placeholder,maxLength:a.account_name.maxLength,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",o.account_name?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),o.account_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.account_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.email.label}),e.jsx("input",{...g("email"),type:"email",id:"email",placeholder:a.email.placeholder,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",o.email?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),o.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.password.label}),e.jsx("input",{...g("password"),type:"password",id:"password",placeholder:a.password.placeholder,minLength:a.password.minLength,maxLength:a.password.maxLength,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",o.password?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),o.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.password.message})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{...g("p2p"),type:"checkbox",id:"p2p",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded dark:border-gray-600 dark:bg-gray-700"}),e.jsx("label",{htmlFor:"p2p",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Premium (P2P) Account"})]}),A&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"world",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.world.label}),e.jsx("input",{...g("world",{setValueAs:N=>N===""?void 0:Number(N)}),type:"number",id:"world",placeholder:a.world.placeholder,min:a.world.min,max:a.world.max,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",o.world?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),o.world&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.world.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"P2P worlds: 300-599 | F2P worlds: 1-99"})]}),r&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:"üîê Secret Keys Preview"}),e.jsxs("div",{className:"space-y-1 text-xs text-blue-800 dark:text-blue-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email Key:"}),e.jsx("code",{className:"ml-1 bg-blue-100 dark:bg-blue-800 px-1 rounded",children:r.emailKey})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Password Key:"}),e.jsx("code",{className:"ml-1 bg-blue-100 dark:bg-blue-800 px-1 rounded",children:r.passwordKey})]}),!r.isValid&&e.jsx("div",{className:"text-red-600 dark:text-red-400 font-medium mt-2",children:"‚ö†Ô∏è Keys are too long. Please use a shorter account name or email."})]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2",children:"These keys will be automatically generated to securely store your credentials."})]}),k&&e.jsx("div",{className:"p-3 bg-green-100 border border-green-300 rounded-md",children:e.jsx("p",{className:"text-sm text-green-700",children:k})}),p&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-300 rounded-md",children:e.jsx("p",{className:"text-sm text-red-700",children:p})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:!c||m||(r?!r.isValid:!1),className:y("flex-1 py-2 px-4 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2","transition-colors duration-200",c&&!m&&(!r||r.isValid)?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:m?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):r&&!r.isValid?"Invalid Key Length":"Create Account"}),x&&e.jsx("button",{type:"button",onClick:C,disabled:m,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Cancel"})]})]})]})})}function H({accountName:i,onSuccess:x,onCancel:n,className:m}){const[w,p]=b.useState(!1),[f,k]=b.useState(!0),[h,g]=b.useState(null),[v,o]=b.useState(null),[c,L]=b.useState(null),{register:j,handleSubmit:S,formState:{errors:d,isValid:F,isDirty:A},reset:r,setValue:l}=D({resolver:K(R),mode:"onChange",defaultValues:{account_name:i,username:"",combat_level:void 0,total_level:void 0,quest_points:void 0,notes:""}}),C=async()=>{try{k(!0);const{data:s,error:_}=await E.rpc("get_osrs_account_info",{p_account_name:i});if(_)throw new Error(_.message);const u=s?.[0]||null;L(u),u&&(l("username",u.username||""),l("combat_level",u.combat_level!==null&&u.combat_level!==void 0?u.combat_level:void 0),l("total_level",u.total_level!==null&&u.total_level!==void 0?u.total_level:void 0),l("quest_points",u.quest_points!==null&&u.quest_points!==void 0?u.quest_points:void 0),l("wealth_gp",u.wealth_gp!==null&&u.wealth_gp!==void 0?u.wealth_gp:void 0),l("notes",u.notes||""))}catch(s){const _=s instanceof Error?s.message:"Failed to load account info";g(_),console.error("Error fetching account info:",s)}finally{k(!1)}};b.useEffect(()=>{C()},[i]);const N=async s=>{p(!0),g(null),o(null);try{const{error:_}=await E.rpc("update_osrs_account_info",{p_account_name:s.account_name,p_username:s.username||null,p_notes:s.notes||null,p_combat_level:s.combat_level!==void 0?s.combat_level:null,p_total_level:s.total_level!==void 0?s.total_level:null,p_quest_points:s.quest_points!==void 0?s.quest_points:null,p_wealth_gp:s.wealth_gp!==void 0?s.wealth_gp:null});if(_)throw new Error(_.message||"Failed to update account info");o("Account information updated successfully!"),await C(),x?.()}catch(_){const u=_ instanceof Error?_.message:"An unexpected error occurred";g(u)}finally{p(!1)}},P=()=>{r(),g(null),o(null),n?.()},V=()=>c?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Current Stats"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:c.combat_level!==null&&c.combat_level!==void 0?c.combat_level:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Combat Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:c.total_level!==null&&c.total_level!==void 0?c.total_level:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:c.quest_points!==null&&c.quest_points!==void 0?c.quest_points:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Quest Points"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:c.wealth_gp!==null&&c.wealth_gp!==void 0?c.wealth_gp.toLocaleString():"N/A"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Wealth (GP)"})]})]}),c.last_synced_at&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:["Last synced: ",new Date(c.last_synced_at).toLocaleString()]})]}):null;return f?e.jsx("div",{className:q("w-full max-w-2xl mx-auto",m),children:e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading account details..."})]})})}):e.jsx("div",{className:q("w-full max-w-2xl mx-auto",m),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Account Details: ",i]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"View and update your OSRS account information"})]}),V(),e.jsxs("form",{onSubmit:S(N),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.username.label}),e.jsx("input",{...j("username"),type:"text",id:"username",placeholder:a.username.placeholder,maxLength:a.username.maxLength,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.username?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.username.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Optional display name for your account"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"combat_level",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.combat_level.label}),e.jsx("input",{...j("combat_level",{setValueAs:s=>s===""?void 0:Number(s)}),type:"number",id:"combat_level",placeholder:a.combat_level.placeholder,min:a.combat_level.min,max:a.combat_level.max,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.combat_level?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.combat_level&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.combat_level.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"total_level",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.total_level.label}),e.jsx("input",{...j("total_level",{setValueAs:s=>s===""?void 0:Number(s)}),type:"number",id:"total_level",placeholder:a.total_level.placeholder,min:a.total_level.min,max:a.total_level.max,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.total_level?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.total_level&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.total_level.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quest_points",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.quest_points.label}),e.jsx("input",{...j("quest_points",{setValueAs:s=>s===""?void 0:Number(s)}),type:"number",id:"quest_points",placeholder:a.quest_points.placeholder,min:a.quest_points.min,max:a.quest_points.max,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.quest_points?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.quest_points&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.quest_points.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"wealth_gp",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.wealth_gp.label}),e.jsx("input",{...j("wealth_gp",{setValueAs:s=>s===""?void 0:Number(s)}),type:"number",id:"wealth_gp",placeholder:a.wealth_gp.placeholder,min:a.wealth_gp.min,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.wealth_gp?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.wealth_gp&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.wealth_gp.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.notes.label}),e.jsx("textarea",{...j("notes"),id:"notes",rows:a.notes.rows,placeholder:a.notes.placeholder,maxLength:a.notes.maxLength,className:y("w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",d.notes?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),d.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.notes.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Add personal notes about this account (goals, strategies, etc.)"})]}),v&&e.jsx("div",{className:"p-3 bg-green-100 border border-green-300 rounded-md",children:e.jsx("p",{className:"text-sm text-green-700",children:v})}),h&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-300 rounded-md",children:e.jsx("p",{className:"text-sm text-red-700",children:h})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:!A||w,className:y("flex-1 py-2 px-4 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2","transition-colors duration-200",A&&!w?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:w?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):A?"Update Account Info":"No Changes"}),n&&e.jsx("button",{type:"button",onClick:P,disabled:w,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Cancel"})]})]})]})})}function ne({className:i}){const[x,n]=b.useState("dashboard"),[m,w]=b.useState([]),[p,f]=b.useState(null),[k,h]=b.useState(!0),[g,v]=b.useState(null),o=async()=>{try{h(!0);const{data:r,error:l}=await E.rpc("list_osrs_accounts");if(l)throw new Error(l.message);w(r||[])}catch(r){const l=r instanceof Error?r.message:"Failed to load accounts";v(l),console.error("Error fetching accounts:",r)}finally{h(!1)}},c=async r=>{if(confirm(`Are you sure you want to delete the account "${r}"? This action cannot be undone.`))try{const{error:l}=await E.rpc("delete_osrs_account",{p_account_name:r});if(l)throw new Error(l.message);await o(),p===r&&(f(null),n("dashboard"))}catch(l){const C=l instanceof Error?l.message:"Failed to delete account";v(C)}};b.useEffect(()=>{o()},[]);const L=r=>{n("dashboard"),o()},j=r=>{f(r),n("details")},S=r=>{f(r),n("edit")},d=r=>{const l=T[r.state];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r.account_name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsx("span",{className:y("px-2 py-1 text-xs font-medium rounded-full",l.color==="green"&&"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",l.color==="red"&&"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",l.color==="yellow"&&"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",l.color==="gray"&&"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:l.label})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium",children:r.p2p?"Premium (P2P)":"Free (F2P)"})]}),r.world&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"World:"}),e.jsx("span",{className:"font-medium",children:r.world})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{className:"font-medium",children:new Date(r.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>j(r.account_name),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-md transition-colors duration-200",children:"View Details"}),e.jsx("button",{onClick:()=>S(r.account_name),className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-md transition-colors duration-200",children:"Edit"}),e.jsx("button",{onClick:()=>c(r.account_name),className:"px-3 py-2 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 text-sm font-medium rounded-md transition-colors duration-200",children:"Delete"})]})]},r.account_name)},F=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"OSRS Dashboard"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage your Old School RuneScape accounts"})]}),e.jsxs("button",{onClick:()=>n("create"),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Add Account"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:m.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Accounts"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:m.filter(r=>r.state==="active").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:m.filter(r=>r.p2p).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Premium"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:m.filter(r=>r.state==="banned").length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Banned"})]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üéÆ"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No accounts yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Get started by adding your first OSRS account"}),e.jsx("button",{onClick:()=>n("create"),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Add Your First Account"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(d)})]}),A=()=>p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{onClick:()=>n("dashboard"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2",children:"‚Üê Back to Dashboard"})}),e.jsx(H,{accountName:p,onSuccess:()=>{o()},onCancel:()=>n("dashboard")})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No account selected"})});return e.jsxs("div",{className:q("w-full max-w-7xl mx-auto p-6",i),children:[g&&e.jsxs("div",{className:"mb-6 p-4 bg-red-100 border border-red-300 rounded-md",children:[e.jsx("p",{className:"text-red-700",children:g}),e.jsx("button",{onClick:()=>v(null),className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Dismiss"})]}),x==="dashboard"&&F(),x==="create"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>n("dashboard"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2",children:"‚Üê Back to Dashboard"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Add New Account"})]}),e.jsx(U,{onSuccess:L,onCancel:()=>n("dashboard"),className:"max-w-md mx-auto"})]}),x==="details"&&A(),x==="edit"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>n("dashboard"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2",children:"‚Üê Back to Dashboard"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Edit Account: ",p]})]}),e.jsxs("div",{className:"max-w-md mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"Account editing form coming soon..."}),e.jsx("button",{onClick:()=>n("dashboard"),className:"w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition-colors duration-200",children:"Back to Dashboard"})]})]})]})}export{ne as OsrsApp};
