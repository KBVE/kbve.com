import{r as A,j as B}from"./react.DlTOZz3w.js";import{R as Ve,O as We,P as Xe,S as $e,a as le,V as Ye,b as Ke,B as Je,N as Qe,A as Ze,W as et,C as tt,c as ie,d as nt,e as rt,L as ce,f as ot,U as it,T as st}from"./three.Ga6J2dPR.js";import{j as at}from"./react-use-measure.BL_PlT8A.js";import{F as lt,u as ct}from"./its-fine.zliSf007.js";import{c as J,R as ut}from"./react-reconciler.19LmHG8m.js";import"./react-dom.DmziSIKl.js";import{_ as ft}from"./@babel.CF3RwP-h.js";import{O as dt}from"./three-stdlib.C120A-Vd.js";import{c as pt}from"./zustand.BejR9DWA.js";var Xt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Yt(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var n=e.default;if(typeof n=="function"){var o=function i(){return this instanceof i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};o.prototype=n.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var d=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(o,i,d.get?d:{enumerable:!0,get:function(){return e[i]}})}),o}var ue={exports:{}},fe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ee;function vt(){return Ee||(Ee=1,function(e){function n(v,S){var _=v.length;v.push(S);e:for(;0<_;){var j=_-1>>>1,L=v[j];if(0<d(L,S))v[j]=S,v[_]=L,_=j;else break e}}function o(v){return v.length===0?null:v[0]}function i(v){if(v.length===0)return null;var S=v[0],_=v.pop();if(_!==S){v[0]=_;e:for(var j=0,L=v.length,D=L>>>1;j<D;){var z=2*(j+1)-1,G=v[z],V=z+1,ne=v[V];if(0>d(G,_))V<L&&0>d(ne,G)?(v[j]=ne,v[V]=_,j=V):(v[j]=G,v[z]=_,j=z);else if(V<L&&0>d(ne,_))v[j]=ne,v[V]=_,j=V;else break e}}return S}function d(v,S){var _=v.sortIndex-S.sortIndex;return _!==0?_:v.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var E=Date,g=E.now();e.unstable_now=function(){return E.now()-g}}var f=[],p=[],t=1,r=null,a=3,u=!1,c=!1,P=!1,b=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,l=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(v){for(var S=o(p);S!==null;){if(S.callback===null)i(p);else if(S.startTime<=v)i(p),S.sortIndex=S.expirationTime,n(f,S);else break;S=o(p)}}function M(v){if(P=!1,m(v),!c)if(o(f)!==null)c=!0,H(C);else{var S=o(p);S!==null&&q(M,S.startTime-v)}}function C(v,S){c=!1,P&&(P=!1,s(T),T=-1),u=!0;var _=a;try{for(m(S),r=o(f);r!==null&&(!(r.expirationTime>S)||v&&!w());){var j=r.callback;if(typeof j=="function"){r.callback=null,a=r.priorityLevel;var L=j(r.expirationTime<=S);S=e.unstable_now(),typeof L=="function"?r.callback=L:r===o(f)&&i(f),m(S)}else i(f);r=o(f)}if(r!==null)var D=!0;else{var z=o(p);z!==null&&q(M,z.startTime-S),D=!1}return D}finally{r=null,a=_,u=!1}}var y=!1,R=null,T=-1,O=5,k=-1;function w(){return!(e.unstable_now()-k<O)}function x(){if(R!==null){var v=e.unstable_now();k=v;var S=!0;try{S=R(!0,v)}finally{S?F():(y=!1,R=null)}}else y=!1}var F;if(typeof l=="function")F=function(){l(x)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,W=N.port2;N.port1.onmessage=x,F=function(){W.postMessage(null)}}else F=function(){b(x,0)};function H(v){R=v,y||(y=!0,F())}function q(v,S){T=b(function(){v(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(v){v.callback=null},e.unstable_continueExecution=function(){c||u||(c=!0,H(C))},e.unstable_forceFrameRate=function(v){0>v||125<v?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<v?Math.floor(1e3/v):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return o(f)},e.unstable_next=function(v){switch(a){case 1:case 2:case 3:var S=3;break;default:S=a}var _=a;a=S;try{return v()}finally{a=_}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(v,S){switch(v){case 1:case 2:case 3:case 4:case 5:break;default:v=3}var _=a;a=v;try{return S()}finally{a=_}},e.unstable_scheduleCallback=function(v,S,_){var j=e.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?j+_:j):_=j,v){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=_+L,v={id:t++,callback:S,priorityLevel:v,startTime:_,expirationTime:L,sortIndex:-1},_>j?(v.sortIndex=_,n(p,v),o(f)===null&&v===o(p)&&(P?(s(T),T=-1):P=!0,q(M,_-j))):(v.sortIndex=L,n(f,v),c||u||(c=!0,H(C))),v},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(v){var S=a;return function(){var _=a;a=S;try{return v.apply(this,arguments)}finally{a=_}}}}(fe)),fe}var Pe;function ht(){return Pe||(Pe=1,ue.exports=vt()),ue.exports}var Se=ht();const Ce={},mt=e=>void Object.assign(Ce,e);function gt(e,n){function o(t,{args:r=[],attach:a,...u},c){let P=`${t[0].toUpperCase()}${t.slice(1)}`,b;if(t==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=u.object;b=Y(s,{type:t,root:c,attach:a,primitive:!0})}else{const s=Ce[P];if(!s)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");b=Y(new s(...r),{type:t,root:c,attach:a,memoizedProps:{args:r}})}return b.__r3f.attach===void 0&&(b.isBufferGeometry?b.__r3f.attach="geometry":b.isMaterial&&(b.__r3f.attach="material")),P!=="inject"&&ve(b,u),b}function i(t,r){let a=!1;if(r){var u,c;(u=r.__r3f)!=null&&u.attach?pe(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),a=!0),a||(c=t.__r3f)==null||c.objects.push(r),r.__r3f||Y(r,{}),r.__r3f.parent=t,we(r),K(r)}}function d(t,r,a){let u=!1;if(r){var c,P;if((c=r.__r3f)!=null&&c.attach)pe(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:r});const b=t.children.filter(l=>l!==r),s=b.indexOf(a);t.children=[...b.slice(0,s),r,...b.slice(s)],u=!0}u||(P=t.__r3f)==null||P.objects.push(r),r.__r3f||Y(r,{}),r.__r3f.parent=t,we(r),K(r)}}function h(t,r,a=!1){t&&[...t].forEach(u=>E(r,u,a))}function E(t,r,a){if(r){var u,c,P;if(r.__r3f&&(r.__r3f.parent=null),(u=t.__r3f)!=null&&u.objects&&(t.__r3f.objects=t.__r3f.objects.filter(M=>M!==r)),(c=r.__r3f)!=null&&c.attach)Te(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var b;t.remove(r),(b=r.__r3f)!=null&&b.root&&Pt(se(r),r)}const l=(P=r.__r3f)==null?void 0:P.primitive,m=!l&&(a===void 0?r.dispose!==null:a);if(!l){var s;h((s=r.__r3f)==null?void 0:s.objects,r,m),h(r.children,r,m)}if(delete r.__r3f,m&&r.dispose&&r.type!=="Scene"){const M=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Se.unstable_scheduleCallback(Se.unstable_IdlePriority,M):M()}K(t)}}function g(t,r,a,u){var c;const P=(c=t.__r3f)==null?void 0:c.parent;if(!P)return;const b=o(r,a,t.__r3f.root);if(t.children){for(const s of t.children)s.__r3f&&i(b,s);t.children=t.children.filter(s=>!s.__r3f)}t.__r3f.objects.forEach(s=>i(b,s)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||E(P,t),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),i(P,b),b.raycast&&b.__r3f.eventCount&&se(b).getState().internal.interaction.push(b),[u,u.alternate].forEach(s=>{s!==null&&(s.stateNode=b,s.ref&&(typeof s.ref=="function"?s.ref(b):s.ref.current=b))})}const f=()=>{};return{reconciler:ut({createInstance:o,removeChild:E,appendChild:i,appendInitialChild:i,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const a=t.getState().scene;a.__r3f&&(a.__r3f.root=t,i(a,r))},removeChildFromContainer:(t,r)=>{r&&E(t.getState().scene,r)},insertInContainerBefore:(t,r,a)=>{if(!r||!a)return;const u=t.getState().scene;u.__r3f&&d(u,r,a)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t?.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,a,u){var c;if(((c=t?.__r3f)!=null?c:{}).primitive&&u.object&&u.object!==t)return[!0];{const{args:b=[],children:s,...l}=u,{args:m=[],children:M,...C}=a;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((R,T)=>R!==m[T]))return[!0];const y=Be(t,l,C,!0);return y.changes.length?[!1,y]:null}},commitUpdate(t,[r,a],u,c,P,b){r?g(t,u,P,b):ve(t,a)},commitMount(t,r,a,u){var c;const P=(c=t.__r3f)!=null?c:{};t.raycast&&P.handlers&&P.eventCount&&se(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>Y(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:a,parent:u}=(r=t.__r3f)!=null?r:{};a&&u&&Te(u,t,a),t.isObject3D&&(t.visible=!1),K(t)},unhideInstance(t,r){var a;const{attach:u,parent:c}=(a=t.__r3f)!=null?a:{};u&&c&&pe(c,t,u),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),K(t)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>n?n():J.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ve}}var Me,je;const de=e=>"colorSpace"in e||"outputColorSpace"in e,Le=()=>{var e;return(e=Ce.ColorManagement)!=null?e:null},De=e=>e&&e.isOrthographicCamera,bt=e=>e&&e.hasOwnProperty("current"),te=typeof window<"u"&&((Me=window.document)!=null&&Me.createElement||((je=window.navigator)==null?void 0:je.product)==="ReactNative")?A.useLayoutEffect:A.useEffect;function Ae(e){const n=A.useRef(e);return te(()=>void(n.current=e),[e]),n}function yt({set:e}){return te(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ie extends A.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}Ie.getDerivedStateFromError=()=>({error:!0});const Fe="__default",Oe=new Map,_t=e=>e&&!!e.memoized&&!!e.changes;function ze(e){var n;const o=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const Z=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()};function se(e){let n=e.__r3f.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:o="shallow",objects:i="reference",strict:d=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(I.str(e)||I.num(e)||I.boo(e))return e===n;const h=I.obj(e);if(h&&i==="reference")return e===n;const E=I.arr(e);if(E&&o==="reference")return e===n;if((E||h)&&e===n)return!0;let g;for(g in e)if(!(g in n))return!1;if(h&&o==="shallow"&&i==="shallow"){for(g in d?n:e)if(!I.equ(e[g],n[g],{strict:d,objects:"reference"}))return!1}else for(g in d?n:e)if(e[g]!==n[g])return!1;if(I.und(g)){if(E&&e.length===0&&n.length===0||h&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function wt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function Y(e,n){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function _e(e,n){let o=e;if(n.includes("-")){const i=n.split("-"),d=i.pop();return o=i.reduce((h,E)=>h[E],e),{target:o,key:d}}else return{target:o,key:n}}const Re=/-\d+$/;function pe(e,n,o){if(I.str(o)){if(Re.test(o)){const h=o.replace(Re,""),{target:E,key:g}=_e(e,h);Array.isArray(E[g])||(E[g]=[])}const{target:i,key:d}=_e(e,o);n.__r3f.previousAttach=i[d],i[d]=n}else n.__r3f.previousAttach=o(e,n)}function Te(e,n,o){var i,d;if(I.str(o)){const{target:h,key:E}=_e(e,o),g=n.__r3f.previousAttach;g===void 0?delete h[E]:h[E]=g}else(i=n.__r3f)==null||i.previousAttach==null||i.previousAttach(e,n);(d=n.__r3f)==null||delete d.previousAttach}function Be(e,{children:n,key:o,ref:i,...d},{children:h,key:E,ref:g,...f}={},p=!1){const t=e.__r3f,r=Object.entries(d),a=[];if(p){const c=Object.keys(f);for(let P=0;P<c.length;P++)d.hasOwnProperty(c[P])||r.unshift([c[P],Fe+"remove"])}r.forEach(([c,P])=>{var b;if((b=e.__r3f)!=null&&b.primitive&&c==="object"||I.equ(P,f[c]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(c))return a.push([c,P,!0,[]]);let s=[];c.includes("-")&&(s=c.split("-")),a.push([c,P,!1,s]);for(const l in d){const m=d[l];l.startsWith(`${c}-`)&&a.push([l,m,!1,l.split("-")])}});const u={...d};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(u.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(u.attach=t.memoizedProps.attach),{memoized:u,changes:a}}function ve(e,n){var o;const i=e.__r3f,d=i?.root,h=d==null||d.getState==null?void 0:d.getState(),{memoized:E,changes:g}=_t(n)?n:Be(e,n),f=i?.eventCount;e.__r3f&&(e.__r3f.memoizedProps=E);for(let a=0;a<g.length;a++){let[u,c,P,b]=g[a];if(de(e)){const M="srgb",C="srgb-linear";u==="encoding"?(u="colorSpace",c=c===3001?M:C):u==="outputEncoding"&&(u="outputColorSpace",c=c===3001?M:C)}let s=e,l=s[u];if(b.length&&(l=b.reduce((m,M)=>m[M],e),!(l&&l.set))){const[m,...M]=b.reverse();s=M.reverse().reduce((C,y)=>C[y],e),u=m}if(c===Fe+"remove")if(s.constructor){let m=Oe.get(s.constructor);m||(m=new s.constructor,Oe.set(s.constructor,m)),c=m[u]}else c=0;if(P&&i)c?i.handlers[u]=c:delete i.handlers[u],i.eventCount=Object.keys(i.handlers).length;else if(l&&l.set&&(l.copy||l instanceof ce)){if(Array.isArray(c))l.fromArray?l.fromArray(c):l.set(...c);else if(l.copy&&c&&c.constructor&&l.constructor===c.constructor)l.copy(c);else if(c!==void 0){var p;const m=(p=l)==null?void 0:p.isColor;!m&&l.setScalar?l.setScalar(c):l instanceof ce&&c instanceof ce?l.mask=c.mask:l.set(c),!Le()&&h&&!h.linear&&m&&l.convertSRGBToLinear()}}else{var t;if(s[u]=c,(t=s[u])!=null&&t.isTexture&&s[u].format===ot&&s[u].type===it&&h){const m=s[u];de(m)&&de(h.gl)?m.colorSpace=h.gl.outputColorSpace:m.encoding=h.gl.outputEncoding}}K(e)}if(i&&i.parent&&e.raycast&&f!==i.eventCount){const a=se(e).getState().internal,u=a.interaction.indexOf(e);u>-1&&a.interaction.splice(u,1),i.eventCount&&a.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(o=e.__r3f)!=null&&o.parent&&we(e),e}function K(e){var n,o;const i=(n=e.__r3f)==null||(o=n.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function we(e){e.onUpdate==null||e.onUpdate(e)}function Ct(e,n){e.manual||(De(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function re(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Et(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return J.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return J.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return J.ContinuousEventPriority;default:return J.DefaultEventPriority}}function He(e,n,o,i){const d=o.get(n);d&&(o.delete(n),o.size===0&&(e.delete(i),d.target.releasePointerCapture(i)))}function Pt(e,n){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==n),o.initialHits=o.initialHits.filter(i=>i!==n),o.hovered.forEach((i,d)=>{(i.eventObject===n||i.object===n)&&o.hovered.delete(d)}),o.capturedMap.forEach((i,d)=>{He(o.capturedMap,n,i,d)})}function St(e){function n(f){const{internal:p}=e.getState(),t=f.offsetX-p.initialClick[0],r=f.offsetY-p.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function o(f){return f.filter(p=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=p.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function i(f,p){const t=e.getState(),r=new Set,a=[],u=p?p(t.internal.interaction):t.internal.interaction;for(let s=0;s<u.length;s++){const l=Z(u[s]);l&&(l.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(f,t);function c(s){const l=Z(s);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var m;l.events.compute==null||l.events.compute(f,l,(m=l.previousRoot)==null?void 0:m.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(s,!0):[]}let P=u.flatMap(c).sort((s,l)=>{const m=Z(s.object),M=Z(l.object);return!m||!M?s.distance-l.distance:M.events.priority-m.events.priority||s.distance-l.distance}).filter(s=>{const l=re(s);return r.has(l)?!1:(r.add(l),!0)});t.events.filter&&(P=t.events.filter(P,t));for(const s of P){let l=s.object;for(;l;){var b;(b=l.__r3f)!=null&&b.eventCount&&a.push({...s,eventObject:l}),l=l.parent}}if("pointerId"in f&&t.internal.capturedMap.has(f.pointerId))for(let s of t.internal.capturedMap.get(f.pointerId).values())r.has(re(s.intersection))||a.push(s.intersection);return a}function d(f,p,t,r){const a=e.getState();if(f.length){const u={stopped:!1};for(const c of f){const P=Z(c.object)||a,{raycaster:b,pointer:s,camera:l,internal:m}=P,M=new ie(s.x,s.y,0).unproject(l),C=k=>{var w,x;return(w=(x=m.capturedMap.get(k))==null?void 0:x.has(c.eventObject))!=null?w:!1},y=k=>{const w={intersection:c,target:p.target};m.capturedMap.has(k)?m.capturedMap.get(k).set(c.eventObject,w):m.capturedMap.set(k,new Map([[c.eventObject,w]])),p.target.setPointerCapture(k)},R=k=>{const w=m.capturedMap.get(k);w&&He(m.capturedMap,c.eventObject,w,k)};let T={};for(let k in p){let w=p[k];typeof w!="function"&&(T[k]=w)}let O={...c,...T,pointer:s,intersections:f,stopped:u.stopped,delta:t,unprojectedPoint:M,ray:b.ray,camera:l,stopPropagation(){const k="pointerId"in p&&m.capturedMap.get(p.pointerId);if((!k||k.has(c.eventObject))&&(O.stopped=u.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(w=>w.eventObject===c.eventObject))){const w=f.slice(0,f.indexOf(c));h([...w,c])}},target:{hasPointerCapture:C,setPointerCapture:y,releasePointerCapture:R},currentTarget:{hasPointerCapture:C,setPointerCapture:y,releasePointerCapture:R},nativeEvent:p};if(r(O),u.stopped===!0)break}}return f}function h(f){const{internal:p}=e.getState();for(const t of p.hovered.values())if(!f.length||!f.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const a=t.eventObject.__r3f,u=a?.handlers;if(p.hovered.delete(re(t)),a!=null&&a.eventCount){const c={...t,intersections:f};u.onPointerOut==null||u.onPointerOut(c),u.onPointerLeave==null||u.onPointerLeave(c)}}}function E(f,p){for(let t=0;t<p.length;t++){const r=p[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(f)}}function g(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>h([]);case"onLostPointerCapture":return p=>{const{internal:t}=e.getState();"pointerId"in p&&t.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(p.pointerId)&&(t.capturedMap.delete(p.pointerId),h([]))})}}return function(t){const{onPointerMissed:r,internal:a}=e.getState();a.lastEvent.current=t;const u=f==="onPointerMove",c=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",b=i(t,u?o:void 0),s=c?n(t):0;f==="onPointerDown"&&(a.initialClick=[t.offsetX,t.offsetY],a.initialHits=b.map(m=>m.eventObject)),c&&!b.length&&s<=2&&(E(t,a.interaction),r&&r(t)),u&&h(b);function l(m){const M=m.eventObject,C=M.__r3f,y=C?.handlers;if(C!=null&&C.eventCount)if(u){if(y.onPointerOver||y.onPointerEnter||y.onPointerOut||y.onPointerLeave){const R=re(m),T=a.hovered.get(R);T?T.stopped&&m.stopPropagation():(a.hovered.set(R,m),y.onPointerOver==null||y.onPointerOver(m),y.onPointerEnter==null||y.onPointerEnter(m))}y.onPointerMove==null||y.onPointerMove(m)}else{const R=y[f];R?(!c||a.initialHits.includes(M))&&(E(t,a.interaction.filter(T=>!a.initialHits.includes(T))),R(m)):c&&a.initialHits.includes(M)&&E(t,a.interaction.filter(T=>!a.initialHits.includes(T)))}}d(b,t,s,l)}}return{handlePointer:g}}const Ne=e=>!!(e!=null&&e.render),qe=A.createContext(null),Mt=(e,n)=>{const o=pt((g,f)=>{const p=new ie,t=new ie,r=new ie;function a(s=f().camera,l=t,m=f().size){const{width:M,height:C,top:y,left:R}=m,T=M/C;l.isVector3?r.copy(l):r.set(...l);const O=s.getWorldPosition(p).distanceTo(r);if(De(s))return{width:M/s.zoom,height:C/s.zoom,top:y,left:R,factor:1,distance:O,aspect:T};{const k=s.fov*Math.PI/180,w=2*Math.tan(k/2)*O,x=w*(M/C);return{width:x,height:w,top:y,left:R,factor:M/x,distance:O,aspect:T}}}let u;const c=s=>g(l=>({performance:{...l.performance,current:s}})),P=new nt;return{set:g,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(f(),s),advance:(s,l)=>n(s,l,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=f();u&&clearTimeout(u),s.performance.current!==s.performance.min&&c(s.performance.min),u=setTimeout(()=>c(f().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:s=>g(l=>({...l,events:{...l.events,...s}})),setSize:(s,l,m,M,C)=>{const y=f().camera,R={width:s,height:l,top:M||0,left:C||0,updateStyle:m};g(T=>({size:R,viewport:{...T.viewport,...a(y,t,R)}}))},setDpr:s=>g(l=>{const m=ze(s);return{viewport:{...l.viewport,dpr:m,initialDpr:l.viewport.initialDpr||m}}}),setFrameloop:(s="always")=>{const l=f().clock;l.stop(),l.elapsedTime=0,s!=="never"&&(l.start(),l.elapsedTime=0),g(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:A.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,l,m)=>{const M=f().internal;return M.priority=M.priority+(l>0?1:0),M.subscribers.push({ref:s,priority:l,store:m}),M.subscribers=M.subscribers.sort((C,y)=>C.priority-y.priority),()=>{const C=f().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(l>0?1:0),C.subscribers=C.subscribers.filter(y=>y.ref!==s))}}}}}),i=o.getState();let d=i.size,h=i.viewport.dpr,E=i.camera;return o.subscribe(()=>{const{camera:g,size:f,viewport:p,gl:t,set:r}=o.getState();if(f.width!==d.width||f.height!==d.height||p.dpr!==h){var a;d=f,h=p.dpr,Ct(g,f),t.setPixelRatio(p.dpr);const u=(a=f.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(f.width,f.height,u)}g!==E&&(E=g,r(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(g)}})))}),o.subscribe(g=>e(g)),o};let oe,jt=new Set,Ot=new Set,Rt=new Set;function he(e,n){if(e.size)for(const{callback:o}of e.values())o(n)}function ee(e,n){switch(e){case"before":return he(jt,n);case"after":return he(Ot,n);case"tail":return he(Rt,n)}}let me,ge;function be(e,n,o){let i=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(i=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),me=n.internal.subscribers,oe=0;oe<me.length;oe++)ge=me[oe],ge.ref.current(ge.store.getState(),i,o);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function Tt(e){let n=!1,o=!1,i,d,h;function E(p){d=requestAnimationFrame(E),n=!0,i=0,ee("before",p),o=!0;for(const r of e.values()){var t;h=r.store.getState(),h.internal.active&&(h.frameloop==="always"||h.internal.frames>0)&&!((t=h.gl.xr)!=null&&t.isPresenting)&&(i+=be(p,h))}if(o=!1,ee("after",p),i===0)return ee("tail",p),n=!1,cancelAnimationFrame(d)}function g(p,t=1){var r;if(!p)return e.forEach(a=>g(a.store.getState(),t));(r=p.gl.xr)!=null&&r.isPresenting||!p.internal.active||p.frameloop==="never"||(t>1?p.internal.frames=Math.min(60,p.internal.frames+t):o?p.internal.frames=2:p.internal.frames=1,n||(n=!0,requestAnimationFrame(E)))}function f(p,t=!0,r,a){if(t&&ee("before",p),r)be(p,r,a);else for(const u of e.values())be(p,u.store.getState());t&&ee("after",p)}return{loop:E,invalidate:g,advance:f}}function Ge(){const e=A.useContext(qe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=o=>o,n){return Ge()(e,n)}function xt(e,n=0){const o=Ge(),i=o.getState().internal.subscribe,d=Ae(e);return te(()=>i(d,n,o),[n,i,o]),null}const Q=new Map,{invalidate:xe,advance:ke}=Tt(Q),{reconciler:ae,applyProps:X}=gt(Q,Et),$={objects:"shallow",strict:!1},kt=(e,n)=>{const o=typeof e=="function"?e(n):e;return Ne(o)?o:new et({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function Lt(e,n){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(n){const{width:i,height:d,top:h,left:E,updateStyle:g=o}=n;return{width:i,height:d,top:h,left:E,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:d,top:h,left:E}=e.parentElement.getBoundingClientRect();return{width:i,height:d,top:h,left:E,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Dt(e){const n=Q.get(e),o=n?.fiber,i=n?.store;n&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,h=i||Mt(xe,ke),E=o||ae.createContainer(h,J.ConcurrentRoot,null,!1,null,"",d,null);n||Q.set(e,{fiber:E,store:h});let g,f=!1,p;return{configure(t={}){let{gl:r,size:a,scene:u,events:c,onCreated:P,shadows:b=!1,linear:s=!1,flat:l=!1,legacy:m=!1,orthographic:M=!1,frameloop:C="always",dpr:y=[1,2],performance:R,raycaster:T,camera:O,onPointerMissed:k}=t,w=h.getState(),x=w.gl;w.gl||w.set({gl:x=kt(r,e)});let F=w.raycaster;F||w.set({raycaster:F=new Ve});const{params:N,...W}=T||{};if(I.equ(W,F,$)||X(F,{...W}),I.equ(N,F.params,$)||X(F,{params:{...F.params,...N}}),!w.camera||w.camera===p&&!I.equ(p,O,$)){p=O;const _=O instanceof tt,j=_?O:M?new We(0,0,0,0,.1,1e3):new Xe(75,0,.1,1e3);_||(j.position.z=5,O&&(X(j,O),("aspect"in O||"left"in O||"right"in O||"bottom"in O||"top"in O)&&(j.manual=!0,j.updateProjectionMatrix())),!w.camera&&!(O!=null&&O.rotation)&&j.lookAt(0,0,0)),w.set({camera:j}),F.camera=j}if(!w.scene){let _;u!=null&&u.isScene?_=u:(_=new $e,u&&X(_,u)),w.set({scene:Y(_)})}if(!w.xr){var H;const _=(D,z)=>{const G=h.getState();G.frameloop!=="never"&&ke(D,!0,G,z)},j=()=>{const D=h.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?_:null),D.gl.xr.isPresenting||xe(D)},L={connect(){const D=h.getState().gl;D.xr.addEventListener("sessionstart",j),D.xr.addEventListener("sessionend",j)},disconnect(){const D=h.getState().gl;D.xr.removeEventListener("sessionstart",j),D.xr.removeEventListener("sessionend",j)}};typeof((H=x.xr)==null?void 0:H.addEventListener)=="function"&&L.connect(),w.set({xr:L})}if(x.shadowMap){const _=x.shadowMap.enabled,j=x.shadowMap.type;if(x.shadowMap.enabled=!!b,I.boo(b))x.shadowMap.type=le;else if(I.str(b)){var q;const L={basic:Je,percentage:Ke,soft:le,variance:Ye};x.shadowMap.type=(q=L[b])!=null?q:le}else I.obj(b)&&Object.assign(x.shadowMap,b);(_!==x.shadowMap.enabled||j!==x.shadowMap.type)&&(x.shadowMap.needsUpdate=!0)}const v=Le();v&&("enabled"in v?v.enabled=!m:"legacyMode"in v&&(v.legacyMode=m)),f||X(x,{outputEncoding:s?3e3:3001,toneMapping:l?Qe:Ze}),w.legacy!==m&&w.set(()=>({legacy:m})),w.linear!==s&&w.set(()=>({linear:s})),w.flat!==l&&w.set(()=>({flat:l})),r&&!I.fun(r)&&!Ne(r)&&!I.equ(r,x,$)&&X(x,r),c&&!w.events.handlers&&w.set({events:c(h)});const S=Lt(e,a);return I.equ(S,w.size,$)||w.setSize(S.width,S.height,S.updateStyle,S.top,S.left),y&&w.viewport.dpr!==ze(y)&&w.setDpr(y),w.frameloop!==C&&w.setFrameloop(C),w.onPointerMissed||w.set({onPointerMissed:k}),R&&!I.equ(R,w.performance,$)&&w.set(_=>({performance:{..._.performance,...R}})),g=P,f=!0,this},render(t){return f||this.configure(),ae.updateContainer(B.jsx(At,{store:h,children:t,onCreated:g,rootElement:e}),E,null,()=>{}),h},unmount(){Ue(e)}}}function At({store:e,children:n,onCreated:o,rootElement:i}){return te(()=>{const d=e.getState();d.set(h=>({internal:{...h.internal,active:!0}})),o&&o(d),e.getState().events.connected||d.events.connect==null||d.events.connect(i)},[]),B.jsx(qe.Provider,{value:e,children:n})}function Ue(e,n){const o=Q.get(e),i=o?.fiber;if(i){const d=o?.store.getState();d&&(d.internal.active=!1),ae.updateContainer(null,i,null,()=>{d&&setTimeout(()=>{try{var h,E,g,f;d.events.disconnect==null||d.events.disconnect(),(h=d.gl)==null||(E=h.renderLists)==null||E.dispose==null||E.dispose(),(g=d.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(f=d.gl)!=null&&f.xr&&d.xr.disconnect(),wt(d),Q.delete(e)}catch{}},500)})}}ae.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:A.version});const ye={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function It(e){const{handlePointer:n}=St(e);return{priority:1,enabled:!0,compute(o,i,d){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ye).reduce((o,i)=>({...o,[i]:n(i)}),{}),update:()=>{var o;const{events:i,internal:d}=e.getState();(o=d.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(d.lastEvent.current)},connect:o=>{var i;const{set:d,events:h}=e.getState();h.disconnect==null||h.disconnect(),d(E=>({events:{...E.events,connected:o}})),Object.entries((i=h.handlers)!=null?i:[]).forEach(([E,g])=>{const[f,p]=ye[E];o.addEventListener(f,g,{passive:p})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var d;Object.entries((d=i.handlers)!=null?d:[]).forEach(([h,E])=>{if(i&&i.connected instanceof HTMLElement){const[g]=ye[h];i.connected.removeEventListener(g,E)}}),o(h=>({events:{...h.events,connected:void 0}}))}}}}const Ft=A.forwardRef(function({children:n,fallback:o,resize:i,style:d,gl:h,events:E=It,eventSource:g,eventPrefix:f,shadows:p,linear:t,flat:r,legacy:a,orthographic:u,frameloop:c,dpr:P,performance:b,raycaster:s,camera:l,scene:m,onPointerMissed:M,onCreated:C,...y},R){A.useMemo(()=>mt(st),[]);const T=ct(),[O,k]=at({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=A.useRef(null),x=A.useRef(null);A.useImperativeHandle(R,()=>w.current);const F=Ae(M),[N,W]=A.useState(!1),[H,q]=A.useState(!1);if(N)throw N;if(H)throw H;const v=A.useRef(null);te(()=>{const _=w.current;k.width>0&&k.height>0&&_&&(v.current||(v.current=Dt(_)),v.current.configure({gl:h,events:E,shadows:p,linear:t,flat:r,legacy:a,orthographic:u,frameloop:c,dpr:P,performance:b,raycaster:s,camera:l,scene:m,size:k,onPointerMissed:(...j)=>F.current==null?void 0:F.current(...j),onCreated:j=>{j.events.connect==null||j.events.connect(g?bt(g)?g.current:g:x.current),f&&j.setEvents({compute:(L,D)=>{const z=L[f+"X"],G=L[f+"Y"];D.pointer.set(z/D.size.width*2-1,-(G/D.size.height)*2+1),D.raycaster.setFromCamera(D.pointer,D.camera)}}),C?.(j)}}),v.current.render(B.jsx(T,{children:B.jsx(Ie,{set:q,children:B.jsx(A.Suspense,{fallback:B.jsx(yt,{set:W}),children:n??null})})})))}),A.useEffect(()=>{const _=w.current;if(_)return()=>Ue(_)},[]);const S=g?"none":"auto";return B.jsx("div",{ref:x,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:S,...d},...y,children:B.jsx("div",{ref:O,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:w,style:{display:"block"},children:o})})})}),Kt=A.forwardRef(function(n,o){return B.jsx(lt,{children:B.jsx(Ft,{...n,ref:o})})}),Jt=A.forwardRef(({makeDefault:e,camera:n,regress:o,domElement:i,enableDamping:d=!0,keyEvents:h=!1,onChange:E,onStart:g,onEnd:f,...p},t)=>{const r=U(y=>y.invalidate),a=U(y=>y.camera),u=U(y=>y.gl),c=U(y=>y.events),P=U(y=>y.setEvents),b=U(y=>y.set),s=U(y=>y.get),l=U(y=>y.performance),m=n||a,M=i||c.connected||u.domElement,C=A.useMemo(()=>new dt(m),[m]);return xt(()=>{C.enabled&&C.update()},-1),A.useEffect(()=>(h&&C.connect(h===!0?M:h),C.connect(M),()=>void C.dispose()),[h,M,o,C,r]),A.useEffect(()=>{const y=O=>{r(),o&&l.regress(),E&&E(O)},R=O=>{g&&g(O)},T=O=>{f&&f(O)};return C.addEventListener("change",y),C.addEventListener("start",R),C.addEventListener("end",T),()=>{C.removeEventListener("start",R),C.removeEventListener("end",T),C.removeEventListener("change",y)}},[E,g,f,C,r,P]),A.useEffect(()=>{if(e){const y=s().controls;return b({controls:C}),()=>b({controls:y})}},[e,C]),A.createElement("primitive",ft({ref:t,object:C,enableDamping:d},p))});export{Kt as C,Jt as O,$t as a,Xt as c,Yt as g,xt as u};
