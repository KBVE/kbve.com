import{r as A,j as B}from"./react.DlTOZz3w.js";import{R as Ve,O as We,P as Xe,S as $e,a as le,V as Ye,b as Ke,B as Je,N as Qe,A as Ze,W as et,C as tt,c as ie,d as nt,e as rt,L as ce,f as ot,U as it,T as st}from"./three.Ga6J2dPR.js";import{j as at}from"./react-use-measure.BL_PlT8A.js";import{F as lt,u as ct}from"./its-fine.zliSf007.js";import{c as J,R as ut}from"./react-reconciler.19LmHG8m.js";import"./react-dom.DmziSIKl.js";import{_ as ft}from"./@babel.CF3RwP-h.js";import{O as dt}from"./three-stdlib.C120A-Vd.js";import{c as pt}from"./zustand.BejR9DWA.js";var Xt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Yt(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var Ee,Pe,ue={exports:{}},fe={};function vt(){return Ee||(Ee=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<o(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,i=a>>>1;r<i;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>o(c,n))l<a&&0>o(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<a&&0>o(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,s=i.now();e.unstable_now=function(){return i.now()-s}}var c=[],l=[],u=1,f=null,p=3,d=!1,v=!1,h=!1,m="function"==typeof setTimeout?setTimeout:null,g="function"==typeof clearTimeout?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function y(e){for(var o=n(l);null!==o;){if(null===o.callback)r(l);else{if(!(o.startTime<=e))break;r(l),o.sortIndex=o.expirationTime,t(c,o)}o=n(l)}}function w(e){if(h=!1,y(e),!v)if(null!==n(c))v=!0,O(_);else{var t=n(l);null!==t&&T(w,t.startTime-e)}}function _(t,o){v=!1,h&&(h=!1,g(E),E=-1),d=!0;var a=p;try{for(y(o),f=n(c);null!==f&&(!(f.expirationTime>o)||t&&!S());){var i=f.callback;if("function"==typeof i){f.callback=null,p=f.priorityLevel;var s=i(f.expirationTime<=o);o=e.unstable_now(),"function"==typeof s?f.callback=s:f===n(c)&&r(c),y(o)}else r(c);f=n(c)}if(null!==f)var u=!0;else{var m=n(l);null!==m&&T(w,m.startTime-o),u=!1}return u}finally{f=null,p=a,d=!1}}typeof navigator<"u"&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var P,C=!1,j=null,E=-1,M=5,x=-1;function S(){return!(e.unstable_now()-x<M)}function I(){if(null!==j){var t=e.unstable_now();x=t;var n=!0;try{n=j(!0,t)}finally{n?P():(C=!1,j=null)}}else C=!1}if("function"==typeof b)P=function(){b(I)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,A=k.port2;k.port1.onmessage=I,P=function(){A.postMessage(null)}}else P=function(){m(I,0)};function O(e){j=e,C||(C=!0,P())}function T(t,n){E=m((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){v||d||(v=!0,O(_))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_scheduleCallback=function(r,o,a){var i=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?i+a:i:a=i,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:o,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(r.sortIndex=a,t(l,r),null===n(c)&&r===n(l)&&(h?(g(E),E=-1):h=!0,T(w,a-i))):(r.sortIndex=s,t(c,r),v||d||(v=!0,O(_))),r},e.unstable_shouldYield=S,e.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}}(fe)),fe}function ht(){return Pe||(Pe=1,ue.exports=vt()),ue.exports}var Se=ht();const Ce={},mt=e=>{Object.assign(Ce,e)};function gt(e,t){function n(e,{args:t=[],attach:n,...r},o){let a,i=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");a=Y(r.object,{type:e,root:o,attach:n,primitive:!0})}else{const r=Ce[i];if(!r)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");a=Y(new r(...t),{type:e,root:o,attach:n,memoizedProps:{args:t}})}return void 0===a.__r3f.attach&&(a.isBufferGeometry?a.__r3f.attach="geometry":a.isMaterial&&(a.__r3f.attach="material")),"inject"!==i&&ve(a,r),a}function r(e,t){let n=!1;var r,o;t&&(null!=(r=t.__r3f)&&r.attach?pe(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||Y(t,{}),t.__r3f.parent=e,we(t),K(t))}function o(e,t,n){let r=!1;if(t){var o,a;if(null!=(o=t.__r3f)&&o.attach)pe(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const o=e.children.filter((e=>e!==t)),a=o.indexOf(n);e.children=[...o.slice(0,a),t,...o.slice(a)],r=!0}r||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||Y(t,{}),t.__r3f.parent=e,we(t),K(t)}}function a(e,t,n=!1){e&&[...e].forEach((e=>i(t,e,n)))}function i(e,t,n){if(t){var r,o,i;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),null!=(o=t.__r3f)&&o.attach)Te(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&Pt(se(t),t)}const l=null==(i=t.__r3f)?void 0:i.primitive,u=!l&&(void 0===n?null!==t.dispose:n);var c;if(!l)a(null==(c=t.__r3f)?void 0:c.objects,t,u),a(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Se.unstable_scheduleCallback(Se.unstable_IdlePriority,e):e()}K(e)}}const s=()=>{};return{reconciler:ut({createInstance:n,removeChild:i,appendChild:r,appendInitialChild:r,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&i(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&o(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;return!!(null!=(t=e?.__r3f)?t:{}).handlers},prepareUpdate(e,t,n,r){var o;if((null!=(o=e?.__r3f)?o:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:o,...a}=r,{args:i=[],children:s,...c}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some(((e,t)=>e!==i[t])))return[!0];const l=Be(e,a,c,!0);return l.changes.length?[!1,l]:null}},commitUpdate(e,[t,o],a,s,c,l){t?function(e,t,o,a){var s;const c=null==(s=e.__r3f)?void 0:s.parent;if(!c)return;const l=n(t,o,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(l,t);e.children=e.children.filter((e=>!e.__r3f))}e.__r3f.objects.forEach((e=>r(l,e))),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||i(c,e),l.parent&&(l.__r3f.autoRemovedBeforeAppend=!0),r(c,l),l.raycast&&l.__r3f.eventCount&&se(l).getState().internal.interaction.push(l),[a,a.alternate].forEach((e=>{null!==e&&(e.stateNode=l,e.ref&&("function"==typeof e.ref?e.ref(l):e.ref.current=l))}))}(e,a,c,l):ve(e,o)},commitMount(e,t,n,r){var o;const a=null!=(o=e.__r3f)?o:{};e.raycast&&a.handlers&&a.eventCount&&se(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>Y(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&Te(r,e,n),e.isObject3D&&(e.visible=!1),K(e)},unhideInstance(e,t){var n;const{attach:r,parent:o}=null!=(n=e.__r3f)?n:{};r&&o&&pe(o,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),K(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():J.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ve}}var Me,je;const de=e=>"colorSpace"in e||"outputColorSpace"in e,Le=()=>{var e;return null!=(e=Ce.ColorManagement)?e:null},De=e=>e&&e.isOrthographicCamera,bt=e=>e&&e.hasOwnProperty("current"),te=typeof window<"u"&&(null!=(Me=window.document)&&Me.createElement||"ReactNative"===(null==(je=window.navigator)?void 0:je.product))?A.useLayoutEffect:A.useEffect;function Ae(e){const t=A.useRef(e);return te((()=>{t.current=e}),[e]),t}function yt({set:e}){return te((()=>(e(new Promise((()=>null))),()=>e(!1))),[e]),null}class Ie extends A.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Ie.getDerivedStateFromError=()=>({error:!0});const Fe="__default",Oe=new Map,_t=e=>e&&!!e.memoized&&!!e.changes;function ze(e){var t;const n=typeof window<"u"?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const Z=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function se(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const I={obj:e=>e===Object(e)&&!I.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e)||I.boo(e))return e===t;const a=I.obj(e);if(a&&"reference"===r)return e===t;const i=I.arr(e);if(i&&"reference"===n)return e===t;if((i||a)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(a&&"shallow"===n&&"shallow"===r){for(s in o?t:e)if(!I.equ(e[s],t[s],{strict:o,objects:"reference"}))return!1}else for(s in o?t:e)if(e[s]!==t[s])return!1;if(I.und(s)){if(i&&0===e.length&&0===t.length||a&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function wt(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}function Y(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function _e(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),o=r.pop();return n=r.reduce(((e,t)=>e[t]),e),{target:n,key:o}}return{target:n,key:t}}const Re=/-\d+$/;function pe(e,t,n){if(I.str(n)){if(Re.test(n)){const t=n.replace(Re,""),{target:r,key:o}=_e(e,t);Array.isArray(r[o])||(r[o]=[])}const{target:r,key:o}=_e(e,n);t.__r3f.previousAttach=r[o],r[o]=t}else t.__r3f.previousAttach=n(e,t)}function Te(e,t,n){var r,o;if(I.str(n)){const{target:r,key:o}=_e(e,n),a=t.__r3f.previousAttach;void 0===a?delete r[o]:r[o]=a}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(o=t.__r3f)||delete o.previousAttach}function Be(e,{children:t,key:n,ref:r,...o},{children:a,key:i,ref:s,...c}={},l=!1){const u=e.__r3f,f=Object.entries(o),p=[];if(l){const e=Object.keys(c);for(let t=0;t<e.length;t++)o.hasOwnProperty(e[t])||f.unshift([e[t],Fe+"remove"])}f.forEach((([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t||I.equ(n,c[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return p.push([t,n,!0,[]]);let a=[];t.includes("-")&&(a=t.split("-")),p.push([t,n,!1,a]);for(const e in o){const n=o[e];e.startsWith(`${t}-`)&&p.push([e,n,!1,e.split("-")])}}));const d={...o};return null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.args&&(d.args=u.memoizedProps.args),null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.attach&&(d.attach=u.memoizedProps.attach),{memoized:d,changes:p}}function ve(e,t){var n;const r=e.__r3f,o=r?.root,a=null==o||null==o.getState?void 0:o.getState(),{memoized:i,changes:s}=_t(t)?t:Be(e,t),c=r?.eventCount;e.__r3f&&(e.__r3f.memoizedProps=i);for(let t=0;t<s.length;t++){let[n,o,i,c]=s[t];if(de(e)){const e="srgb",t="srgb-linear";"encoding"===n?(n="colorSpace",o=3001===o?e:t):"outputEncoding"===n&&(n="outputColorSpace",o=3001===o?e:t)}let f=e,p=f[n];if(c.length&&(p=c.reduce(((e,t)=>e[t]),e),!p||!p.set)){const[t,...r]=c.reverse();f=r.reverse().reduce(((e,t)=>e[t]),e),n=t}if(o===Fe+"remove")if(f.constructor){let e=Oe.get(f.constructor);e||(e=new f.constructor,Oe.set(f.constructor,e)),o=e[n]}else o=0;if(i&&r)o?r.handlers[n]=o:delete r.handlers[n],r.eventCount=Object.keys(r.handlers).length;else if(p&&p.set&&(p.copy||p instanceof ce)){if(Array.isArray(o))p.fromArray?p.fromArray(o):p.set(...o);else if(p.copy&&o&&o.constructor&&p.constructor===o.constructor)p.copy(o);else if(void 0!==o){var l;const e=null==(l=p)?void 0:l.isColor;!e&&p.setScalar?p.setScalar(o):p instanceof ce&&o instanceof ce?p.mask=o.mask:p.set(o),!Le()&&a&&!a.linear&&e&&p.convertSRGBToLinear()}}else{var u;if(f[n]=o,null!=(u=f[n])&&u.isTexture&&f[n].format===ot&&f[n].type===it&&a){const e=f[n];de(e)&&de(a.gl)?e.colorSpace=a.gl.outputColorSpace:e.encoding=a.gl.outputEncoding}}K(e)}if(r&&r.parent&&e.raycast&&c!==r.eventCount){const t=se(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),r.eventCount&&t.interaction.push(e)}return!(1===s.length&&"onUpdate"===s[0][0])&&s.length&&null!=(n=e.__r3f)&&n.parent&&we(e),e}function K(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function we(e){null==e.onUpdate||e.onUpdate(e)}function Ct(e,t){e.manual||(De(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function re(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Et(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return J.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return J.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return J.ContinuousEventPriority;default:return J.DefaultEventPriority}}function He(e,t,n,r){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(r),o.target.releasePointerCapture(r)))}function Pt(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,r)=>{(e.eventObject===t||e.object===t)&&n.hovered.delete(r)})),n.capturedMap.forEach(((e,r)=>{He(n.capturedMap,t,e,r)}))}function St(e){function t(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const r=e.eventObject.__r3f,o=r?.handlers;if(n.hovered.delete(re(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame((()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))}))}}return function(a){const{onPointerMissed:i,internal:s}=e.getState();s.lastEvent.current=a;const c="onPointerMove"===o,l="onClick"===o||"onContextMenu"===o||"onDoubleClick"===o,u=function(t,n){const r=e.getState(),o=new Set,a=[],i=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<i.length;e++){const t=Z(i[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=i.flatMap((function(e){const n=Z(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r})).sort(((e,t)=>{const n=Z(e.object),r=Z(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance})).filter((e=>{const t=re(e);return!o.has(t)&&(o.add(t),!0)}));r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var c;null!=(c=t.__r3f)&&c.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())o.has(re(e.intersection))||a.push(e.intersection);return a}(a,c?t:void 0),f=l?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}(a):0;"onPointerDown"===o&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map((e=>e.eventObject))),l&&!u.length&&f<=2&&(r(a,s.interaction),i&&i(a)),c&&n(u),function(t,r,o,a){const i=e.getState();if(t.length){const e={stopped:!1};for(const s of t){const c=Z(s.object)||i,{raycaster:l,pointer:u,camera:f,internal:p}=c,d=new ie(u.x,u.y,0).unproject(f),v=e=>{var t,n;return null!=(t=null==(n=p.capturedMap.get(e))?void 0:n.has(s.eventObject))&&t},h=e=>{const t={intersection:s,target:r.target};p.capturedMap.has(e)?p.capturedMap.get(e).set(s.eventObject,t):p.capturedMap.set(e,new Map([[s.eventObject,t]])),r.target.setPointerCapture(e)},m=e=>{const t=p.capturedMap.get(e);t&&He(p.capturedMap,s.eventObject,t,e)};let g={};for(let e in r){let t=r[e];"function"!=typeof t&&(g[e]=t)}let b={...s,...g,pointer:u,intersections:t,stopped:e.stopped,delta:o,unprojectedPoint:d,ray:l.ray,camera:f,stopPropagation(){const o="pointerId"in r&&p.capturedMap.get(r.pointerId);(!o||o.has(s.eventObject))&&(b.stopped=e.stopped=!0,p.hovered.size&&Array.from(p.hovered.values()).find((e=>e.eventObject===s.eventObject)))&&n([...t.slice(0,t.indexOf(s)),s])},target:{hasPointerCapture:v,setPointerCapture:h,releasePointerCapture:m},currentTarget:{hasPointerCapture:v,setPointerCapture:h,releasePointerCapture:m},nativeEvent:r};if(a(b),!0===e.stopped)break}}}(u,a,f,(function(e){const t=e.eventObject,n=t.__r3f,i=n?.handlers;if(null!=n&&n.eventCount)if(c){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){const t=re(e),n=s.hovered.get(t);n?n.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{const n=i[o];n?(!l||s.initialHits.includes(t))&&(r(a,s.interaction.filter((e=>!s.initialHits.includes(e)))),n(e)):l&&s.initialHits.includes(t)&&r(a,s.interaction.filter((e=>!s.initialHits.includes(e))))}}))}}}}const Ne=e=>!(null==e||!e.render),qe=A.createContext(null),Mt=(e,t)=>{const n=pt(((n,r)=>{const o=new ie,a=new ie,i=new ie;function s(e=r().camera,t=a,n=r().size){const{width:s,height:c,top:l,left:u}=n,f=s/c;t.isVector3?i.copy(t):i.set(...t);const p=e.getWorldPosition(o).distanceTo(i);if(De(e))return{width:s/e.zoom,height:c/e.zoom,top:l,left:u,factor:1,distance:p,aspect:f};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*p,r=n*(s/c);return{width:r,height:n,top:l,left:u,factor:s/r,distance:p,aspect:f}}}let c;const l=e=>n((t=>({performance:{...t.performance,current:e}}))),u=new nt;return{set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(t=1)=>e(r(),t),advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rt,pointer:u,mouse:u,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&l(e.performance.min),c=setTimeout((()=>l(r().performance.max)),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:e=>n((t=>({...t,events:{...t.events,...e}}))),setSize:(e,t,o,i,c)=>{const l=r().camera,u={width:e,height:t,top:i||0,left:c||0,updateStyle:o};n((e=>({size:u,viewport:{...e.viewport,...s(l,a,u)}})))},setDpr:e=>n((t=>{const n=ze(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}})),setFrameloop:(e="always")=>{const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n((()=>({frameloop:e})))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:A.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const o=r().internal;return o.priority=o.priority+(t>0?1:0),o.subscribers.push({ref:e,priority:t,store:n}),o.subscribers=o.subscribers.sort(((e,t)=>e.priority-t.priority)),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((t=>t.ref!==e)))}}}}})),r=n.getState();let o=r.size,a=r.viewport.dpr,i=r.camera;return n.subscribe((()=>{const{camera:e,size:t,viewport:r,gl:s,set:c}=n.getState();if(t.width!==o.width||t.height!==o.height||r.dpr!==a){var l;o=t,a=r.dpr,Ct(e,t),s.setPixelRatio(r.dpr);const n=null!=(l=t.updateStyle)?l:typeof HTMLCanvasElement<"u"&&s.domElement instanceof HTMLCanvasElement;s.setSize(t.width,t.height,n)}e!==i&&(i=e,c((t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}}))))})),n.subscribe((t=>e(t))),n};let oe,me,ge,jt=new Set,Ot=new Set,Rt=new Set;function he(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ee(e,t){switch(e){case"before":return he(jt,t);case"after":return he(Ot,t);case"tail":return he(Rt,t)}}function be(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),me=t.internal.subscribers,oe=0;oe<me.length;oe++)ge=me[oe],ge.ref.current(ge.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Tt(e){let t,n,r,o=!1,a=!1;function i(s){n=requestAnimationFrame(i),o=!0,t=0,ee("before",s),a=!0;for(const n of e.values()){var c;r=n.store.getState(),r.internal.active&&("always"===r.frameloop||r.internal.frames>0)&&(null==(c=r.gl.xr)||!c.isPresenting)&&(t+=be(s,r))}if(a=!1,ee("after",s),0===t)return ee("tail",s),o=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n,r=1){var s;if(!n)return e.forEach((e=>t(e.store.getState(),r)));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):a?2:1,o||(o=!0,requestAnimationFrame(i)))},advance:function(t,n=!0,r,o){if(n&&ee("before",t),r)be(t,r,o);else for(const n of e.values())be(t,n.store.getState());n&&ee("after",t)}}}function Ge(){const e=A.useContext(qe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=e=>e,t){return Ge()(e,t)}function xt(e,t=0){const n=Ge(),r=n.getState().internal.subscribe,o=Ae(e);return te((()=>r(o,t,n)),[t,r,n]),null}const Q=new Map,{invalidate:xe,advance:ke}=Tt(Q),{reconciler:ae,applyProps:X}=gt(Q,Et),$={objects:"shallow",strict:!1},kt=(e,t)=>{const n="function"==typeof e?e(t):e;return Ne(n)?n:new et({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Lt(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:o,left:a,updateStyle:i=n}=t;return{width:e,height:r,top:o,left:a,updateStyle:i}}if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:o,left:a}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:o,left:a,updateStyle:n}}return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}function Dt(e){const t=Q.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o="function"==typeof reportError?reportError:console.error,a=r||Mt(xe,ke),i=n||ae.createContainer(a,J.ConcurrentRoot,null,!1,null,"",o,null);t||Q.set(e,{fiber:i,store:a});let s,c,l=!1;return{configure(t={}){let{gl:n,size:r,scene:o,events:i,onCreated:u,shadows:f=!1,linear:p=!1,flat:d=!1,legacy:v=!1,orthographic:h=!1,frameloop:m="always",dpr:g=[1,2],performance:b,raycaster:y,camera:w,onPointerMissed:_}=t,P=a.getState(),C=P.gl;P.gl||P.set({gl:C=kt(n,e)});let j=P.raycaster;j||P.set({raycaster:j=new Ve});const{params:E,...M}=y||{};if(I.equ(M,j,$)||X(j,{...M}),I.equ(E,j.params,$)||X(j,{params:{...j.params,...E}}),!P.camera||P.camera===c&&!I.equ(c,w,$)){c=w;const e=w instanceof tt,t=e?w:h?new We(0,0,0,0,.1,1e3):new Xe(75,0,.1,1e3);e||(t.position.z=5,w&&(X(t,w),("aspect"in w||"left"in w||"right"in w||"bottom"in w||"top"in w)&&(t.manual=!0,t.updateProjectionMatrix())),!P.camera&&!(null!=w&&w.rotation)&&t.lookAt(0,0,0)),P.set({camera:t}),j.camera=t}if(!P.scene){let e;null!=o&&o.isScene?e=o:(e=new $e,o&&X(e,o)),P.set({scene:Y(e)})}if(!P.xr){var x;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&ke(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||xe(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(x=C.xr)?void 0:x.addEventListener)&&n.connect(),P.set({xr:n})}if(C.shadowMap){const e=C.shadowMap.enabled,t=C.shadowMap.type;if(C.shadowMap.enabled=!!f,I.boo(f))C.shadowMap.type=le;else if(I.str(f)){var S;const e={basic:Je,percentage:Ke,soft:le,variance:Ye};C.shadowMap.type=null!=(S=e[f])?S:le}else I.obj(f)&&Object.assign(C.shadowMap,f);(e!==C.shadowMap.enabled||t!==C.shadowMap.type)&&(C.shadowMap.needsUpdate=!0)}const k=Le();k&&("enabled"in k?k.enabled=!v:"legacyMode"in k&&(k.legacyMode=v)),l||X(C,{outputEncoding:p?3e3:3001,toneMapping:d?Qe:Ze}),P.legacy!==v&&P.set((()=>({legacy:v}))),P.linear!==p&&P.set((()=>({linear:p}))),P.flat!==d&&P.set((()=>({flat:d}))),n&&!I.fun(n)&&!Ne(n)&&!I.equ(n,C,$)&&X(C,n),i&&!P.events.handlers&&P.set({events:i(a)});const A=Lt(e,r);return I.equ(A,P.size,$)||P.setSize(A.width,A.height,A.updateStyle,A.top,A.left),g&&P.viewport.dpr!==ze(g)&&P.setDpr(g),P.frameloop!==m&&P.setFrameloop(m),P.onPointerMissed||P.set({onPointerMissed:_}),b&&!I.equ(b,P.performance,$)&&P.set((e=>({performance:{...e.performance,...b}}))),s=u,l=!0,this},render(t){return l||this.configure(),ae.updateContainer(B.jsx(At,{store:a,children:t,onCreated:s,rootElement:e}),i,null,(()=>{})),a},unmount(){Ue(e)}}}function At({store:e,children:t,onCreated:n,rootElement:r}){return te((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),n&&n(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)}),[]),B.jsx(qe.Provider,{value:e,children:t})}function Ue(e,t){const n=Q.get(e),r=n?.fiber;if(r){const t=n?.store.getState();t&&(t.internal.active=!1),ae.updateContainer(null,r,null,(()=>{t&&setTimeout((()=>{try{var n,r,o,a;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(o=t.gl)||null==o.forceContextLoss||o.forceContextLoss(),null!=(a=t.gl)&&a.xr&&t.xr.disconnect(),wt(t),Q.delete(e)}catch{}}),500)}))}}ae.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:A.version});const ye={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function It(e){const{handlePointer:t}=St(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(ye).reduce(((e,n)=>({...e,[n]:t(n)})),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:o}=e.getState();null==o.disconnect||o.disconnect(),r((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(n=o.handlers)?n:[]).forEach((([e,n])=>{const[r,o]=ye[e];t.addEventListener(r,n,{passive:o})}))},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach((([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=ye[e];n.connected.removeEventListener(r,t)}})),t((e=>({events:{...e.events,connected:void 0}}))))}}}const Ft=A.forwardRef((function({children:e,fallback:t,resize:n,style:r,gl:o,events:a=It,eventSource:i,eventPrefix:s,shadows:c,linear:l,flat:u,legacy:f,orthographic:p,frameloop:d,dpr:v,performance:h,raycaster:m,camera:g,scene:b,onPointerMissed:y,onCreated:w,..._},P){A.useMemo((()=>mt(st)),[]);const C=ct(),[j,E]=at({scroll:!0,debounce:{scroll:50,resize:0},...n}),M=A.useRef(null),x=A.useRef(null);A.useImperativeHandle(P,(()=>M.current));const S=Ae(y),[I,k]=A.useState(!1),[O,T]=A.useState(!1);if(I)throw I;if(O)throw O;const L=A.useRef(null);te((()=>{const t=M.current;E.width>0&&E.height>0&&t&&(L.current||(L.current=Dt(t)),L.current.configure({gl:o,events:a,shadows:c,linear:l,flat:u,legacy:f,orthographic:p,frameloop:d,dpr:v,performance:h,raycaster:m,camera:g,scene:b,size:E,onPointerMissed:(...e)=>null==S.current?void 0:S.current(...e),onCreated:e=>{null==e.events.connect||e.events.connect(i?bt(i)?i.current:i:x.current),s&&e.setEvents({compute:(e,t)=>{const n=e[s+"X"],r=e[s+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),w?.(e)}}),L.current.render(B.jsx(C,{children:B.jsx(Ie,{set:T,children:B.jsx(A.Suspense,{fallback:B.jsx(yt,{set:k}),children:e??null})})})))})),A.useEffect((()=>{const e=M.current;if(e)return()=>Ue(e)}),[]);const R=i?"none":"auto";return B.jsx("div",{ref:x,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:R,...r},..._,children:B.jsx("div",{ref:j,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:M,style:{display:"block"},children:t})})})})),Kt=A.forwardRef((function(e,t){return B.jsx(lt,{children:B.jsx(Ft,{...e,ref:t})})})),Jt=A.forwardRef((({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:o=!0,keyEvents:a=!1,onChange:i,onStart:s,onEnd:c,...l},u)=>{const f=U((e=>e.invalidate)),p=U((e=>e.camera)),d=U((e=>e.gl)),v=U((e=>e.events)),h=U((e=>e.setEvents)),m=U((e=>e.set)),g=U((e=>e.get)),b=U((e=>e.performance)),y=t||p,w=r||v.connected||d.domElement,_=A.useMemo((()=>new dt(y)),[y]);return xt((()=>{_.enabled&&_.update()}),-1),A.useEffect((()=>(a&&_.connect(!0===a?w:a),_.connect(w),()=>{_.dispose()})),[a,w,n,_,f]),A.useEffect((()=>{const e=e=>{f(),n&&b.regress(),i&&i(e)},t=e=>{s&&s(e)},r=e=>{c&&c(e)};return _.addEventListener("change",e),_.addEventListener("start",t),_.addEventListener("end",r),()=>{_.removeEventListener("start",t),_.removeEventListener("end",r),_.removeEventListener("change",e)}}),[i,s,c,_,f,h]),A.useEffect((()=>{if(e){const e=g().controls;return m({controls:_}),()=>m({controls:e})}}),[e,_]),A.createElement("primitive",ft({ref:u,object:_,enableDamping:o},l))}));export{Kt as C,Jt as O,$t as a,Xt as c,Yt as g,xt as u};