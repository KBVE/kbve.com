import{r as E}from"./react.CvslfkeK.js";import{l as g,a as w,o as L,m as k}from"./nanostores.Bo9-_MAV.js";function b(e,r={}){let s=E.useCallback(f=>r.keys?g(e,r.keys,f):e.listen(f),[r.keys,e]),v=e.get.bind(e);return E.useSyncExternalStore(s,v,v)}let y=e=>e,o={},d={addEventListener(){},removeEventListener(){}};function m(){try{return typeof localStorage<"u"}catch{return!1}}m()&&(o=localStorage);let K={addEventListener(e,r,s){window.addEventListener("storage",r),window.addEventListener("pageshow",s)},removeEventListener(e,r,s){window.removeEventListener("storage",r),window.removeEventListener("pageshow",s)}};typeof window<"u"&&(d=K);function M(e,r=void 0,s={}){let v=s.encode||y,f=s.decode||y,n=w(r),u=n.set;n.set=i=>{typeof i>"u"?delete o[e]:o[e]=v(i),u(i)};function c(i){i.key===e?i.newValue===null?u(void 0):u(f(i.newValue)):o[e]||u(void 0)}function a(){n.set(o[e]?f(o[e]):r)}return L(n,()=>{if(a(),s.listen!==!1)return d.addEventListener(e,c,a),()=>{d.removeEventListener(e,c,a)}}),n}function W(e,r={},s={}){let v=s.encode||y,f=s.decode||y,n=k(),u=n.setKey;n.setKey=(t,l)=>{typeof l>"u"?(s.listen!==!1&&d.perKey&&d.removeEventListener(e+t,a,i),delete o[e+t]):(s.listen!==!1&&d.perKey&&!(t in n.value)&&d.addEventListener(e+t,a,i),o[e+t]=v(l)),u(t,l)};let c=n.set;n.set=function(t){for(let l in t)n.setKey(l,t[l]);for(let l in n.value)l in t||n.setKey(l)};function a(t){t.key?t.key.startsWith(e)&&(t.newValue===null?u(t.key.slice(e.length),void 0):u(t.key.slice(e.length),f(t.newValue))):c({})}function i(){let t={...r};for(let l in o)l.startsWith(e)&&(t[l.slice(e.length)]=f(o[l]));n.set(t)}return L(n,()=>{if(i(),s.listen!==!1)return d.addEventListener(e,a,i),()=>{d.removeEventListener(e,a,i);for(let t in n.value)d.removeEventListener(e+t,a,i)}}),n}export{W as a,M as p,b as u};
